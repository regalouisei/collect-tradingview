"""
DS-TV Backtest Results: vsa-simple
============================================================

--- SPY ---
  ERROR: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().

--- BTC ---
  ERROR: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().

--- QQQ ---
  ERROR: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().

============================================================
Unoptimized run. No parameter tuning applied.

Source: TradingView Community Script â€” vsa-simple
Generated by DeepStack TradingView Pipeline
"""

import numpy as np
import pandas as pd
import pandas_ta as pta
from backtesting import Backtest, Strategy
from backtesting.lib import crossover


class TvStrategy(Strategy):
    param1 = 30  # MA Length

    def init(self):
        close = pd.Series(self.data.Close)
        volume = pd.Series(self.data.Volume)
        # Calculate indicators using self.I() wrapper
        self.ma = self.I(pta.sma, volume, length=self.param1)
        self.volColor = self.I(lambda: color.red if volume > self.ma * 3 else color.orange if volume > self.ma * 1.5 else color.green if volume > self.ma * 0.5 else color.blue)

    def next(self):
        # Trading logic
        pass  # No trading logic based on the given Pine Script

    def I(self, func, *args, **kwargs):
        result = func(*args, **kwargs)
        return result if result is not None else pd.Series([np.nan] * len(self.data))