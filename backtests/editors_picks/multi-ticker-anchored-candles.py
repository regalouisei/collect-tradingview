"""
OpenClaw Backtest Results: multi-ticker-anchored-candles
============================================================

--- SPY ---
  ERROR: object of type 'TvStrategy' has no len()

--- BTC ---
  ERROR: object of type 'TvStrategy' has no len()

--- QQQ ---
  ERROR: object of type 'TvStrategy' has no len()

============================================================
Unoptimized run. No parameter tuning applied.

Source: TradingView Community Script â€” multi-ticker-anchored-candles
Generated by OpenClaw TradingView Pipeline
"""

import numpy as np
import pandas as pd
import pandas_ta as pta
from backtesting import Backtest, Strategy
from backtesting.lib import crossover


class TvStrategy(Strategy):
    
    def init(self):
        pass
    
    def next(self):
        if len(self) == 1:
            self.buy()
        elif len(self) > 1 and not self.position:
            if self.data.Close[-1] > self.data.Close[-2]:
                self.buy()
        elif self.position and self.data.Close[-1] < self.data.Close[-2]:
            self.sell()


if __name__ == "__main__":
    from backtesting.test import SMA, GOOG
    
    bt = Backtest(GOOG, TvStrategy, cash=10000, commission=.002)
    results = bt.run()
    print(results)
    bt.plot()