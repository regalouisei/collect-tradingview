//@version=5
indicator("Silverhawk Momentum Surge", shorttitle="SH M.Surge", overlay=true)

// ═══════════════════════════════════════════════════════════════════════
// SILVERHAWK MOMENTUM SURGE FREE
// Momentum Acceleration + Volatility Expansion + Candle Strength
// Non-repainting. Clean. Focused.
// ═══════════════════════════════════════════════════════════════════════

// ───────────────────────── INPUTS ─────────────────────────

// Momentum
rsi_length      = input.int(14, "RSI Length", minval=2, maxval=50, group="Momentum Settings")
roc_length      = input.int(9,  "ROC Lookback (Acceleration)", minval=2, maxval=50, group="Momentum Settings")
momentum_threshold = input.float(0.5, "Momentum Threshold", minval=0.1, maxval=5.0, step=0.1, group="Signal Sensitivity")

// Volatility
atr_length      = input.int(14, "ATR Length", minval=2, maxval=50, group="Volatility Filter")
atr_sma_length  = input.int(20, "ATR SMA Length", minval=5, maxval=100, group="Volatility Filter")

// Candle Filter
candle_strength_multiplier = input.float(0.6, "Candle Body Size (× ATR)", minval=0.3, maxval=1.0, step=0.1, group="Candle Filter")

// Visual
show_momentum_histogram = input.bool(true, "Show Momentum Histogram", group="Visual")
show_background_glow    = input.bool(true, "Show Background Glow", group="Visual")
show_signals            = input.bool(true, "Show Signal Arrows", group="Visual")

// Alerts
enable_alerts = input.bool(true, "Enable Alerts", group="Alerts")

// Colors
color_bullish = input.color(color.new(#00C851, 70), "Bullish Color", group="Colors")
color_bearish = input.color(color.new(#CC0000, 70), "Bearish Color", group="Colors")

// ───────────────────── CORE CALCULATIONS ─────────────────────

// RSI
rsi = ta.rsi(close, rsi_length)

// RSI Acceleration
roc_rsi = ta.roc(rsi, roc_length)

// ATR Expansion
atr = ta.atr(atr_length)
atr_sma = ta.sma(atr, atr_sma_length)
volatility_expanding = atr > atr_sma

// Candle Strength
body_size = math.abs(close - open)
is_strong_candle = body_size > (candle_strength_multiplier * atr)

is_bullish_candle = close > open and is_strong_candle
is_bearish_candle = close < open and is_strong_candle

// ───────────────────── SIGNAL LOGIC ─────────────────────

// Momentum cross logic (cleaner entries)
momentum_bullish = ta.crossover(roc_rsi, momentum_threshold)
momentum_bearish = ta.crossunder(roc_rsi, -momentum_threshold)

// Final Signals (Non-Repainting — confirmed close only)
bull_surge = momentum_bullish and volatility_expanding and is_bullish_candle and barstate.isconfirmed
bear_surge = momentum_bearish and volatility_expanding and is_bearish_candle and barstate.isconfirmed

// ───────────────────── VISUALS ─────────────────────

// Momentum Histogram
hist_color = roc_rsi > 0 ? color.new(color_bullish, 40) : color.new(color_bearish, 40)

plot(show_momentum_histogram ? roc_rsi : na,
     title="Momentum Acceleration",
     color=hist_color,
     style=plot.style_histogram,
     linewidth=2)

hline(0, "Zero Line", color=color.gray, linestyle=hline.style_dashed)

// Unified Background Logic
bg_color =
     show_background_glow and bull_surge ? color.new(color_bullish, 85) :
     show_background_glow and bear_surge ? color.new(color_bearish, 85) :
     na

bgcolor(bg_color)

// Signal Arrows
plotshape(show_signals and bull_surge,
          title="Bullish Surge",
          style=shape.triangleup,
          location=location.belowbar,
          color=color.new(color_bullish, 0),
          size=size.small)

plotshape(show_signals and bear_surge,
          title="Bearish Surge",
          style=shape.triangledown,
          location=location.abovebar,
          color=color.new(color_bearish, 0),
          size=size.small)

// ───────────────────── ALERTS ─────────────────────

alertcondition(bull_surge and enable_alerts,
     title="Bullish Momentum Surge",
     message="Silverhawk FREE: Bullish Momentum Surge | {{exchange}}:{{ticker}} | Price: {{close}}")

alertcondition(bear_surge and enable_alerts,
     title="Bearish Momentum Surge",
     message="Silverhawk FREE: Bearish Momentum Surge | {{exchange}}:{{ticker}} | Price: {{close}}")
