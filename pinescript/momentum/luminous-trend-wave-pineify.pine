// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© Pineify

//======================================================================//
//                    ____  _            _  __                          //
//                   |  _ \(_)_ __   ___(_)/ _|_   _                    //
//                   | |_) | | '_ \ / _ \ | |_| | | |                   //
//                   |  __/| | | | |  __/ |  _| |_| |                   //
//                   |_|   |_|_| |_|\___|_|_|  \__, |                   //
//                                             |___/                    //
//======================================================================//


//@version=6
indicator("Luminous Trend Wave [Pineify]", shorttitle="LTW", overlay=false, precision=2)

//-----------------------------------------------------------------------------}
// ðŸ”¶ SETTINGS
//-----------------------------------------------------------------------------{

group_calc = "Calculation"
// Core params: HMA period | Signal smoothing | Sensitivity multiplier
len     = input.int(21, "Trend Lookback", minval=2, group=group_calc, tooltip="HMA period for trend detection")
smooth  = input.int(5,  "Signal Smoothing", minval=1, group=group_calc, tooltip="WMA period to filter noise")
sens    = input.float(1.5, "Sensitivity", minval=0.1, step=0.1, group=group_calc, tooltip="Higher = more responsive to price changes")

group_style = "Visuals"
col_up  = input.color(#00E676, "Bullish Color", group=group_style)
col_dn  = input.color(#FF5252, "Bearish Color", group=group_style)
use_grad = input.bool(true, "Use Gradients", group=group_style)

//-----------------------------------------------------------------------------}
// ðŸ”¶ CALCULATIONS
//-----------------------------------------------------------------------------{

// 1. Trend Basis: Hull MA (less lag than SMA/EMA)
price_basis = ta.hma(close, len)

// 2. Normalize by ATR â†’ universal across assets
dist = close - price_basis
volatility = ta.atr(len)
normalized = dist / volatility

// 3. Bound to [-100, 100] using tanh: (e^2x - 1) / (e^2x + 1)
osc_raw = (math.exp(2 * normalized * sens) - 1) / (math.exp(2 * normalized * sens) + 1) * 100

// 4. Signal line: smoothed WMA
signal = ta.wma(osc_raw, smooth)

//-----------------------------------------------------------------------------}
// ðŸ”¶ LOGIC & COLORING
//-----------------------------------------------------------------------------{

// Trend state: bull/bear | strong/weak momentum
bool is_bull = osc_raw > 0
bool is_strong = math.abs(osc_raw) > math.abs(signal)

// Base color by direction
color base_col = is_bull ? col_up : col_dn

// Optional gradient: intensity mapped to [-100, 100]
color final_col = use_grad ?
     color.from_gradient(osc_raw, -100, 100, color.new(col_dn, 20), color.new(col_up, 20)) :
     base_col

// Fade on weak momentum (reversion to mean)
color plot_col = is_strong ? final_col : color.new(final_col, 50)

//-----------------------------------------------------------------------------}
// ðŸ”¶ PLOTTING
//-----------------------------------------------------------------------------{

// Histogram: main oscillator
plot(osc_raw, "Trend Wave", color=plot_col, style=plot.style_columns, linewidth=1)

// Signal: smoothed reference line
plot(signal, "Signal Line", color=color.new(chart.fg_color, 50), linewidth=2)

// Key levels: zero | extremes Â±80
hline(0, "Zero Line", color=color.new(color.gray, 50), linestyle=hline.style_dotted)
hline(80, "Overbought", color=color.new(col_up, 80))
hline(-80, "Oversold", color=color.new(col_dn, 80))

// Background glow on strong trends
bgcolor(is_strong and math.abs(osc_raw) > 50 ? color.new(base_col, 90) : na, title="Trend Glow")

//-----------------------------------------------------------------------------}
// ðŸ”¶ ALERTS
//-----------------------------------------------------------------------------{

// Trend direction change | momentum cross
alertcondition(ta.crossover(osc_raw, 0), "Bullish", "LTW: Bullish flip")
alertcondition(ta.crossunder(osc_raw, 0), "Bearish", "LTW: Bearish flip")
alertcondition(ta.crossover(osc_raw, signal), "Momentum Up", "LTW: Momentum increasing")
alertcondition(ta.crossunder(osc_raw, signal), "Momentum Down", "LTW: Momentum decreasing")
