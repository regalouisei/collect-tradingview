//@version=5
indicator("QQE Momentum Pulse [identityKa]", overlay=false)

// ==========================================
// 1. KULLANICI AYARLARI
// ==========================================
grp1 = "âš™ï¸ Momentum (QQE) AyarlarÄ±"
rsi_len = input.int(14, "RSI Periyodu", group=grp1)
rsi_smooth = input.int(5, "RSI YumuÅŸatma (EMA)", group=grp1)
qqe_factor = input.float(4.236, "QQE Ã‡arpanÄ±", tooltip="DÃ¼ÅŸÃ¼rÃ¼rseniz sinyaller hÄ±zlanÄ±r, artÄ±rÄ±rsanÄ±z trendi daha uzun tutar.", group=grp1)

grp2 = "ðŸŽ¨ identityKa TemasÄ± (Pulse Renkleri)"
col_grow_above = input.color(#00ffbb, "GÃ¼Ã§lÃ¼ YÃ¼kseliÅŸ (Neon YeÅŸil)", group=grp2)
col_fall_above = input.color(color.new(#00ffbb, 70), "ZayÄ±f YÃ¼kseliÅŸ (Koyu YeÅŸil)", group=grp2)
col_grow_below = input.color(#ff1744, "GÃ¼Ã§lÃ¼ DÃ¼ÅŸÃ¼ÅŸ (Neon KÄ±rmÄ±zÄ±)", group=grp2)
col_fall_below = input.color(color.new(#ff1744, 70), "ZayÄ±f DÃ¼ÅŸÃ¼ÅŸ (Koyu KÄ±rmÄ±zÄ±)", group=grp2)

// ==========================================
// 2. QQE MATEMATÄ°KSEL MOTORU
// ==========================================
wilders_period = rsi_len * 2 - 1

// Temel RSI ve YumuÅŸatÄ±lmÄ±ÅŸ Hali
rsi = ta.rsi(close, rsi_len)
rsi_ema = ta.ema(rsi, rsi_smooth)

// Ortalama GerÃ§ek AralÄ±k (ATR) HesaplamasÄ±
atr_rsi = math.abs(rsi_ema[1] - rsi_ema)
atr_rsi_ema = ta.ema(atr_rsi, wilders_period)
dar = ta.ema(atr_rsi_ema, wilders_period) * qqe_factor

var float longband = 0.0
var float shortband = 0.0
var int trend = 0

newshortband = rsi_ema + dar
newlongband = rsi_ema - dar

longband := rsi_ema[1] > longband[1] and rsi_ema > longband[1] ? math.max(longband[1], newlongband) : newlongband
shortband := rsi_ema[1] < shortband[1] and rsi_ema < shortband[1] ? math.min(shortband[1], newshortband) : newshortband

cross_1 = ta.cross(longband[1], rsi_ema)
trend := ta.cross(rsi_ema, shortband[1]) ? 1 : cross_1 ? -1 : nz(trend[1], 1)

fast_atr_rsi_tl = trend == 1 ? longband : shortband

// ==========================================
// 3. MOMENTUM PULSE (HISTOGRAM) HESAPLAMASI
// ==========================================
// SÄ±fÄ±r Ã§izgisi etrafÄ±nda dalgalanan histogram iÃ§in farkÄ± alÄ±yoruz
pulse = rsi_ema - fast_atr_rsi_tl

// ==========================================
// 4. GÃ–RSELLEÅžTÄ°RME 
// ==========================================
// MACD benzeri 4 renkli bar mantÄ±ÄŸÄ±
pulse_color = pulse > 0 ? (pulse > pulse[1] ? col_grow_above : col_fall_above) : (pulse < pulse[1] ? col_grow_below : col_fall_below)

plot(pulse, title="Momentum Pulse", style=plot.style_columns, color=pulse_color, linewidth=2)
hline(0, color=color.new(color.gray, 50), linestyle=hline.style_dashed, title="SÄ±fÄ±r Ã‡izgisi")
