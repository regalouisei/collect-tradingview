//@version=6
indicator("Delta Hedging Pressure", overlay=false)

//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ðŸ”§ INPUTS
//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
lenCum         = input.int(50, "Cumulative Length", minval=1)
resetOnSession = input.bool(true, "Reset on New Day")
showBG         = input.bool(true, "Show Background Bias")

//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ðŸ•’ SESSION RESET (BOOLEAN SAFE)
//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
newSession = ta.change(time("D")) != 0

//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ðŸ“Š DELTA / HEDGE PRESSURE PROXY
//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
dir = close > open ? 1 : close < open ? -1 : 0
hedgePressure = volume * dir

//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ðŸ“ˆ CUMULATIVE HEDGE PRESSURE
//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
var float cumHedge = na

if resetOnSession and newSession
    cumHedge := hedgePressure
else
    cumHedge := nz(cumHedge[1]) + hedgePressure

//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ðŸ§­ SENTIMENT
//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
sentiment = (
    cumHedge > 0 ? "Bullish" :
    cumHedge < 0 ? "Bearish" :
                   "Neutral"
)

//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ðŸŽ¨ BACKGROUND COLOR (GLOBAL SCOPE âœ”)
//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
bgColor =
     not showBG ? na :
     sentiment == "Bullish" ? color.new(color.green, 90) :
     sentiment == "Bearish" ? color.new(color.red, 90) :
                              color.new(color.gray, 90)

bgcolor(bgColor)

//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ðŸ“Š PLOTS
//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
plot(cumHedge, title="Cumulative Hedge Pressure", color=color.blue, linewidth=2)
hline(0, "Zero Line", color=color.gray)

//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ðŸ· LABEL (ARGUMENT FIXED âœ”)
//â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
if barstate.islast
    label.new(
        bar_index,
        cumHedge,
        "Hedge Bias: " + sentiment,
        style=label.style_label_left,
        textcolor=color.white,
        color=
            sentiment == "Bullish" ? color.green :
            sentiment == "Bearish" ? color.red :
                                     color.gray
    )
