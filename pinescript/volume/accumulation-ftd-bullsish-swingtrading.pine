//@version=6
indicator("ACCVOL 1j (SMA5 + SMA10) - AD/B", overlay=true, max_labels_count=500)  // You can set max_labels_count up to 500. [web:23]

// ─────────────────────────────────────────────────────────────────────────────
// Inputs (user settings)
grp1 = "Case 1 (SMA #1)"
grp2 = "Case 2 (SMA #2)"
grpV = "Volume"
grpP = "Price"
grpD = "Display"

useCase1 = input.bool(true, "Enable case 1", group=grp1)  // Grouped inputs are shown together in settings. [page:1]
lenSma1  = input.int(5, "SMA #1 length", group=grp1, minval=1)  // input.int() creates a configurable integer input. [page:1]

useCase2 = input.bool(true, "Enable case 2", group=grp2)  // Toggle the second case on/off. [page:1]
lenSma2  = input.int(10, "SMA #2 length", group=grp2, minval=1)  // Independent length for the second SMA. [page:1]

plotSma1 = input.bool(false, "Show SMA #1", group=grpD)
plotSma2 = input.bool(false, "Show SMA #2", group=grpD)

minPct   = input.float(1.24, "Min daily change (%)", group=grpP, step=0.01)  // input.float() for decimals. [page:1]

volLen   = input.int(50, "Volume SMA length", group=grpV, minval=1)

// ─────────────────────────────────────────────────────────────────────────────
// Series (computed in global scope)
sma1   = ta.sma(close, lenSma1)
sma2   = ta.sma(close, lenSma2)
volSma = ta.sma(volume, volLen)

// Optional plots (hidden by default)
plot(plotSma1 ? sma1 : na, "SMA #1", color=color.white)
plot(plotSma2 ? sma2 : na, "SMA #2", color=color.new(color.white, 40))

// ─────────────────────────────────────────────────────────────────────────────
// Generic checker: same logic for both cases, only the SMA series changes.
check_conditions(n, smaSeries) =>
    // Current-day filters
    price_change     = (close - close[1]) / close[1] * 100 >= minPct
    volume_increased = volume > volume[1]
    volume_above_sma = volume > volSma

    // Pattern day (n bars ago)
    closed_below_smaN = close[n] < smaSeries[n]
    bullish_dayN      = close[n] > open[n] and low[n] < low

    // The day AFTER the pattern day must be bearish (same as your original scripts)
    bearish_next_day  = close[n + 1] < open[n + 1]

    // Rebuild the "higher lows between" condition exactly as in your original code
    higher_lows_between = true
    if n == 3
        higher_lows_between := low[2] > low[3] and low[1] > low[3]
    else if n == 4
        higher_lows_between := low[3] > low[4] and low[2] > low[4] and low[1] > low[4]
    else if n == 5
        higher_lows_between := low[4] > low[5] and low[3] > low[5] and low[2] > low[5] and low[1] > low[5]
    else if n == 6
        higher_lows_between := low[5] > low[6] and low[4] > low[6] and low[3] > low[6] and low[2] > low[6] and low[1] > low[6]
    else if n == 7
        higher_lows_between := low[6] > low[7] and low[5] > low[7] and low[4] > low[7] and low[3] > low[7] and low[2] > low[7] and low[1] > low[7]
    else if n == 8
        higher_lows_between := low[7] > low[8] and low[6] > low[8] and low[5] > low[8] and low[4] > low[8] and low[3] > low[8] and low[2] > low[8] and low[1] > low[8]
    else if n == 9
        higher_lows_between := low[8] > low[9] and low[7] > low[9] and low[6] > low[9] and low[5] > low[9] and low[4] > low[9] and low[3] > low[9] and low[2] > low[9] and low[1] > low[9]
    else if n == 10
        higher_lows_between := low[9] > low[10] and low[8] > low[10] and low[7] > low[10] and low[6] > low[10] and low[5] > low[10] and low[4] > low[10] and low[3] > low[10] and low[2] > low[10] and low[1] > low[10]
    else if n == 11
        higher_lows_between := low[10] > low[11] and low[9] > low[11] and low[8] > low[11] and low[7] > low[11] and low[6] > low[11] and low[5] > low[11] and low[4] > low[11] and low[3] > low[11] and low[2] > low[11] and low[1] > low[11]
    else if n == 12
        higher_lows_between := low[11] > low[12] and low[10] > low[12] and low[9] > low[12] and low[8] > low[12] and low[7] > low[12] and low[6] > low[12] and low[5] > low[12] and low[4] > low[12] and low[3] > low[12] and low[2] > low[12] and low[1] > low[12]
    else if n == 13
        higher_lows_between := low[12] > low[13] and low[11] > low[13] and low[10] > low[13] and low[9] > low[13] and low[8] > low[13] and low[7] > low[13] and low[6] > low[13] and low[5] > low[13] and low[4] > low[13] and low[3] > low[13] and low[2] > low[13] and low[1] > low[13]

    // Final condition for a valid setup
    price_change and volume_increased and volume_above_sma and closed_below_smaN and bullish_dayN and higher_lows_between and bearish_next_day

// For a given n, trigger if either case matches.
// Note: In v6, `and`/`or` are evaluated lazily, which can change evaluation order vs v5. [web:13]
cond(n) =>
    (useCase1 and check_conditions(n, sma1)) or (useCase2 and check_conditions(n, sma2))

// ─────────────────────────────────────────────────────────────────────────────
// Labels: no visual distinction between SMA #1 vs SMA #2.
// Priority is kept "as is": only the first matching n (3..13) creates labels.
bool triggered = false

if not triggered and cond(3)
    label.new(bar_index[3], high[3], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(4)
    label.new(bar_index[4], high[4], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(5)
    label.new(bar_index[5], high[5], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(6)
    label.new(bar_index[6], high[6], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(7)
    label.new(bar_index[7], high[7], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(8)
    label.new(bar_index[8], high[8], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(9)
    label.new(bar_index[9], high[9], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(10)
    label.new(bar_index[10], high[10], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(11)
    label.new(bar_index[11], high[11], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red,   textcolor=color.white)
    label.new(bar_index,     low,      "B",  style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(12)
    label.new(bar_index[12], high[12], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
if not triggered and cond(13)
    label.new(bar_index[13], high[13], "AD", yloc=yloc.belowbar, style=label.style_label_up, color=color.red, textcolor=color.white)
    label.new(bar_index, low, "B", style=label.style_label_up, color=color.green, textcolor=color.white)
    triggered := true
