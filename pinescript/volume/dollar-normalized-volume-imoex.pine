//@version=6
indicator("Dollar Normalized Volume & IMOEX", shorttitle="DNV&IMOEX", format=format.volume)

volumeColor = input.color(color.gray, "Цвет объема")

isIndexTicker = (syminfo.ticker == "IRUS" or syminfo.ticker == "IRUS2")

var array<string> allTickers = array.from(
    "MOEX:LKOH",
    "MOEX:SBER",
    "MOEX:GAZP",
    "MOEX:YDEX",
    "MOEX:TCSG",
    "MOEX:GMKN",
    "MOEX:TATN",
    "MOEX:PLZL",
    "MOEX:NVTK",
    "MOEX:VTBR",
    "MOEX:OZON",
    "MOEX:X5",
    "MOEX:ROSN",
    "MOEX:SBERP",
    "MOEX:SNGS",
    "MOEX:SNGSP",
    "MOEX:IRAO",
    "MOEX:MOEX",
    "MOEX:CHMF",
    "MOEX:MTSS",
    "MOEX:RUAL",
    "MOEX:NLMK",
    "MOEX:PIKK",
    "MOEX:HEAD",
    "MOEX:TATNP",
    "MOEX:AFLT",
    "MOEX:PHOR",
    "MOEX:RTKM",
    "MOEX:ALRS",
    "MOEX:MAGN"
)

getVolume(string ticker) =>
    vol = request.security(ticker, timeframe.period, volume, barmerge.gaps_off, barmerge.lookahead_off)
    nz(vol, 0)

totalVolume = 0.0
if isIndexTicker
    for ticker in allTickers
        totalVolume += getVolume(ticker)

dollarVolume = close * volume

volumeToPlot = isIndexTicker ? totalVolume : dollarVolume
plot(volumeToPlot, title="Volume", color=volumeColor, style=plot.style_columns, linewidth=3)
