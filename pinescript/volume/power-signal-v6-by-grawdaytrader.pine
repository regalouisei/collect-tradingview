// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© GRAWDAYTRADER

//@version=6
indicator("Power Signal v6 by GRAWDAYTRADER", shorttitle="PSI", overlay=false)

// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// AUTHOR: GRAWDAYTRADER 
// Free to copy - CREDIT GRAWDAYTRADER!
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

len = input.int(20, "Length", minval=1)
thr = input.float(100, "Plot Threshold", minval=1)
sigThr = input.float(150, "Signal Trigger (>this)", minval=1)
enAlerts = input.bool(true, "Enable Alerts")
enShapes = input.bool(true, "Enable Shapes")

ph = request.security(syminfo.tickerid, "1D", high[1])
px = (high - ph) / ph * 100
vr = volume / ta.sma(volume, len) * 100
pwr = px > -1 and vr > 150 ? vr * 1.2 : 0

plot(pwr, "Power", linewidth=3, color=pwr > thr ? color.lime : color.gray)
hline(thr, "Threshold", color=color.yellow)
hline(sigThr, "Signal Thr", color=color.red, linestyle=hline.style_dotted)
hline(0)

sig = ta.crossover(pwr, sigThr)
plotshape(enShapes and sig, "PSI!", style=shape.labelup, location=location.bottom, color=color.lime, textcolor=color.white, text="PSI!")

if barstate.islast
    var tbl = table.new(position.top_right, 2, 5, bgcolor=color.black, border_width=1)
    // GRAWDAYTRADER: Ð¢ÐÐœÐÐž-Ð¡Ð˜ÐÐ˜Ð™ Ñ„Ð¾Ð½ + Ð±ÐµÐ»Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚
    table.cell(tbl, 0, 0, "GRAWDAYTRADER", bgcolor=color.navy, text_color=color.white, text_size=size.normal)
    // PSI ÑÐ¿Ñ€Ð°Ð²Ð°: Ð—Ð•Ð›ÐÐÐ«Ð™ Ñ„Ð¾Ð½ + Ð±ÐµÐ»Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚ (Ð²ÑÐµÐ³Ð´Ð°)
    table.cell(tbl, 1, 0, str.tostring(math.round(pwr)), bgcolor=color.new(color.green, 20), text_color=color.white, text_size=size.large)
    table.cell(tbl, 0, 1, "Prox%", text_color=color.white)
    table.cell(tbl, 1, 1, str.tostring(math.round(px,1)), text_color=color.yellow)
    table.cell(tbl, 0, 2, "Vol%", text_color=color.white)
    table.cell(tbl, 1, 2, str.tostring(math.round(vr)), text_color=color.aqua)
    table.cell(tbl, 0, 3, "High", text_color=color.white)
    table.cell(tbl, 1, 3, str.tostring(ph, "#.##"), text_color=color.silver)
    table.cell(tbl, 0, 4, "SigThr", text_color=color.red)
    table.cell(tbl, 1, 4, str.tostring(sigThr), text_color=color.red)

// Ð—Ð’Ð£ÐšÐžÐ’ÐžÐ™ ÐÐ›Ð•Ð Ð¢
if enAlerts and sig
    alert("ðŸ”¥ PSI > " + str.tostring(sigThr) + "! " + syminfo.ticker + " Power: " + str.tostring(math.round(pwr)), alert.freq_once_per_bar_close)

alertcondition(sig, "PSI Alert", "Power Signal!")
