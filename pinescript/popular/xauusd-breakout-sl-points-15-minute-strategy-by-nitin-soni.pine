//@version=5
indicator("XAUUSD Dynamic Breakout + SL Points", overlay=true, max_boxes_count=500, max_labels_count=500)

// --- इनपुट्स ---
tz = input.string("GMT+5:30", "Timezone", tooltip="IST के लिए GMT+5:30 रहने दें")
target_hour = input.int(4, "Start Hour (24h Format)", minval=0, maxval=23)
target_minute = input.int(30, "Start Minute", minval=0, maxval=59)
box_width = input.int(40, "Box Width (Bars)", minval=1)

// चेक करना कि क्या यह सेलेक्ट की हुई टाइम वाली कैंडल है
isFirstCandle = hour(time, tz) == target_hour and minute(time, tz) == target_minute

// लेबल्स के लिए फंक्शन
f_createLabel(_x, _y, _txt, _color, _style) =>
    label.new(_x, _y, _txt, color=_color, textcolor=color.white, style=_style, size=size.small)

// लाइन के लिए फंक्शन
f_createLine(_x1, _x2, _y, _color) =>
    line.new(_x1, _y, _x2, _y, color=_color, width=1, style=line.style_dashed)

if isFirstCandle
    float cHigh = high
    float cLow  = low
    float body  = cHigh - cLow
    int labelX  = bar_index + box_width 
    
    // SL पॉइंट्स कैलकुलेशन (Gold/Silver के लिए 10 से गुना किया है ताकि पॉइंट्स दिखे)
    // अगर आप पिप्स देखना चाहते हैं तो इसे अपने हिसाब से एडजस्ट कर सकते हैं
    float slPoints = body * 1

    // --- कैलकुलेशन (RR 1:1, 1:2, 1:3) ---
    float buyTP1 = cHigh + body, buyTP2 = cHigh + (body * 2), buyFinal = cHigh + (body * 3)
    float sellTP1 = cLow - body, sellTP2 = cLow - (body * 2), sellFinal = cLow - (body * 3)

    // --- LEFT SIDE SL LABEL ---
    f_createLabel(bar_index, cLow - (body * 0.2), "SL Points: " + str.tostring(slPoints, "#.#"), color.orange, label.style_label_right)

    // --- BUY SETUP ड्राइंग ---
    box.new(bar_index, buyFinal, labelX, cHigh, bgcolor=color.new(color.green, 90), border_color=color.new(color.green, 50))
    box.new(bar_index, cHigh, labelX, cLow, bgcolor=color.new(color.red, 90), border_color=color.new(color.red, 50))
    
    // TP Lines
    f_createLine(bar_index, labelX, buyTP1, color.new(color.green, 50))
    f_createLine(bar_index, labelX, buyTP2, color.new(color.green, 50))
    f_createLine(bar_index, labelX, buyFinal, color.new(color.green, 20))

    // Right Side Labels
    f_createLabel(labelX, buyFinal, "Final TP (1:3)\n" + str.tostring(buyFinal, "#.##"), color.green, label.style_label_left)
    f_createLabel(labelX, buyTP2, "2nd TP (1:2)\n" + str.tostring(buyTP2, "#.##"), color.green, label.style_label_left)
    f_createLabel(labelX, buyTP1, "1st TP (1:1)\n" + str.tostring(buyTP1, "#.##"), color.green, label.style_label_left)
    f_createLabel(labelX, cHigh, "Entry (High)\n" + str.tostring(cHigh, "#.##"), color.gray, label.style_label_left)
    f_createLabel(labelX, cLow, "SL (Low)\n" + str.tostring(cLow, "#.##"), color.red, label.style_label_left)

    // --- SELL SETUP ड्राइंग ---
    box.new(bar_index, cLow, labelX, sellFinal, bgcolor=color.new(color.red, 90), border_color=color.new(color.red, 50))
    
    // TP Lines
    f_createLine(bar_index, labelX, sellTP1, color.new(color.red, 50))
    f_createLine(bar_index, labelX, sellTP2, color.new(color.red, 50))
    f_createLine(bar_index, labelX, sellFinal, color.new(color.red, 20))
    
    f_createLabel(labelX, sellFinal, "Final TP (1:3)\n" + str.tostring(sellFinal, "#.##"), color.red, label.style_label_left)
    f_createLabel(labelX, sellTP2, "2nd TP (1:2)\n" + str.tostring(sellTP2, "#.##"), color.red, label.style_label_left)
    f_createLabel(labelX, sellTP1, "1st TP (1:1)\n" + str.tostring(sellTP1, "#.##"), color.red, label.style_label_left)
    f_createLabel(labelX, cLow, "Entry (Low)\n" + str.tostring(cLow, "#.##"), color.gray, label.style_label_left)
