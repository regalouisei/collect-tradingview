// (\_/)
// ( â€¢.â€¢)  White Rabbit Oracle v2 â€” Pro Edition
// (")_(")
//@version=6
indicator("ğŸ‡ White Rabbit Oracle v2 â€” Pro", overlay=true, max_labels_count=500, max_lines_count=500, max_boxes_count=500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆ  WHITE RABBIT ORACLE v2 â€” PRO EDITION
//     â€¢ Dynamic Accelerated EMA (replaces slow cross)
//     â€¢ Hybrid Signal: Cross + Pullback Confirmation
//     â€¢ Break of Structure (BOS) scoring
//     â€¢ Session Killzone Filter
//     â€¢ Full Pro Table + MTF Visual Panel
//     â€¢ Simplified PSAR
//     â€¢ Session-based background (useful)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ“Š CORE EMA SETTINGS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string GRP_EMA = "ğŸ“Š EMA Settings"
int   inp_emaFast   = input.int  (7,   "EMA Fast",   group=GRP_EMA, inline="a")
int   inp_emaMid    = input.int  (50,  "EMA Mid",    group=GRP_EMA, inline="a")
int   inp_emaLong   = input.int  (200, "EMA Long",   group=GRP_EMA, inline="b")
int   inp_atrLen    = input.int  (14,  "ATR Period", group=GRP_EMA, inline="b")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// âš¡ DYNAMIC ACCELERATED EMA (Option 1)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string GRP_DACC = "âš¡ Dynamic Acceleration Filter"
bool  inp_useAccel    = input.bool  (true,  "Enable Acceleration Filter",         group=GRP_DACC, tooltip="Mesure l'angle de l'EMA Fast â€” signal plus rapide que le cross classique")
float inp_accelThresh = input.float (0.05,  "Min Acceleration Threshold",         group=GRP_DACC, minval=0.01, maxval=0.5, step=0.01, tooltip="Pente minimum de l'EMA7 normalisÃ©e par ATR")
int   inp_accelLB     = input.int   (3,     "Acceleration Lookback (bars)",       group=GRP_DACC, minval=2, maxval=8)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ”„ HYBRID PULLBACK SIGNAL (Option 5)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string GRP_PB = "ğŸ”„ Hybrid Pullback Confirmation"
bool  inp_usePullback  = input.bool (true,  "Enable Pullback Signal",             group=GRP_PB, tooltip="Signal haute probabilitÃ©: prix revient tester EMA50 aprÃ¨s un cross confirmÃ©")
float inp_pbZone       = input.float(0.3,   "Pullback Zone % (distance EMA50)",   group=GRP_PB, minval=0.05, maxval=1.0, step=0.05)
int   inp_pbExpiry     = input.int  (30,    "Pullback Window (bars after cross)",  group=GRP_PB, minval=5, maxval=100, tooltip="Nombre de barres pendant lesquelles on guette le pullback")

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ—ï¸ BREAK OF STRUCTURE SCORING (Option 2)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string GRP_BOS = "ğŸ—ï¸ Market Structure & Score"
bool  inp_useBOS       = input.bool (true,  "Enable BOS Scoring",                 group=GRP_BOS)
int   inp_swingLB      = input.int  (10,    "Swing Lookback for BOS",             group=GRP_BOS, minval=5, maxval=30)
int   inp_minScore     = input.int  (5,     "Min Score to Signal",                group=GRP_BOS, minval=0, maxval=12)
bool  inp_showScore    = input.bool (true,  "Show Score on Labels",               group=GRP_BOS)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ• SESSION KILLZONE FILTER (Option 3)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string GRP_SESS = "ğŸ• Session Killzone Filter"
bool  inp_useSession   = input.bool (true,  "Enable Session Filter",              group=GRP_SESS)
bool  inp_useLondon    = input.bool (true,  "London Open (02:00â€“05:00 ET)",       group=GRP_SESS)
bool  inp_useNY        = input.bool (true,  "New York Open (08:00â€“11:00 ET)",     group=GRP_SESS)
bool  inp_useAsian     = input.bool (false, "Asian Session (20:00â€“00:00 ET)",     group=GRP_SESS)
bool  inp_showSessBG   = input.bool (true,  "Show Session Background",            group=GRP_SESS)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ“¡ MULTI-TIMEFRAME ALIGNMENT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string GRP_MTF = "ğŸ“¡ Multi-Timeframe Alignment"
int   inp_minTF        = input.int  (2,    "Min TF Aligned",  group=GRP_MTF, minval=1, maxval=3)
bool  inp_showMTFPanel = input.bool (true, "Show MTF Panel in Table", group=GRP_MTF)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ¯ TP / SL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string GRP_TPSL = "ğŸ¯ Take Profit / Stop Loss"
bool  inp_showTPSL     = input.bool  (true, "Show TP/SL on Labels",              group=GRP_TPSL)
float inp_tpMult       = input.float (3.0,  "TP ATR Multiplier",                  group=GRP_TPSL, minval=1.5, maxval=8.0, step=0.5)
float inp_slMult       = input.float (1.5,  "SL ATR Multiplier",                  group=GRP_TPSL, minval=0.5, maxval=5.0, step=0.25)
bool  inp_adaptTPSL    = input.bool  (true, "Adaptive TP/SL (scale with score)",  group=GRP_TPSL)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ“‰ PSAR (Simplified)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string GRP_PSAR = "ğŸ“‰ PSAR"
float inp_psarStart    = input.float(0.002, "Start",     group=GRP_PSAR, step=0.001)
float inp_psarInc      = input.float(0.002, "Increment", group=GRP_PSAR, step=0.001)
float inp_psarMax      = input.float(0.2,   "Maximum",   group=GRP_PSAR, step=0.01)
bool  inp_showPSAR     = input.bool (true,  "Show PSAR Labels",  group=GRP_PSAR)
bool  inp_showPSARFill = input.bool (true,  "Show PSAR Fill",    group=GRP_PSAR)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ğŸ¨ VISUAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
string GRP_VIS = "ğŸ¨ Visual Settings"
bool  inp_showTable    = input.bool(true, "Show Dashboard Table",  group=GRP_VIS)
bool  inp_showLabels   = input.bool(true, "Show Signal Labels",    group=GRP_VIS)
bool  inp_showSR       = input.bool(false,"Show S/R Pivots",       group=GRP_VIS, tooltip="DÃ©sactivÃ© par dÃ©faut â€” peut ralentir sur gros historiques")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ CORE CALCULATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
float emaFast  = ta.ema(close, inp_emaFast)
float emaMid   = ta.ema(close, inp_emaMid)
float emaLong  = ta.ema(close, inp_emaLong)
float atrVal   = ta.atr(inp_atrLen)
float volMA    = ta.sma(volume, 20)
float rsiVal   = ta.rsi(close, 14)
[macdLine, signalLine, histLine] = ta.macd(close, 12, 26, 9)

// Classic cross
bool goldenCross = ta.crossover (emaMid, emaLong)
bool deathCross  = ta.crossunder(emaMid, emaLong)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš¡ DYNAMIC ACCELERATION (Option 1)
// Mesure la pente normalisÃ©e de l'EMA Fast â€” signal plus rapide
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
float emaFastSlope    = (emaFast - emaFast[inp_accelLB]) / math.max(atrVal, 1e-10)
float emaMidSlope     = (emaMid  - emaMid [inp_accelLB]) / math.max(atrVal, 1e-10)

bool  fastAccelBull   = emaFastSlope >  inp_accelThresh and emaFast > emaMid
bool  fastAccelBear   = emaFastSlope < -inp_accelThresh and emaFast < emaMid

// Acceleration condition: EMA7 accelerates ABOVE EMA50 before the full cross
bool earlyBullSignal  = inp_useAccel and fastAccelBull and emaMid > emaLong
bool earlyBearSignal  = inp_useAccel and fastAccelBear and emaMid < emaLong

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ—ï¸ BREAK OF STRUCTURE (Option 2)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
float swingHigh = ta.highest(high, inp_swingLB)
float swingLow  = ta.lowest (low,  inp_swingLB)

// BOS: price breaks above previous swing high (bullish) or below swing low (bearish)
bool  bosLong   = inp_useBOS and ta.crossover (close, swingHigh[1])
bool  bosShort  = inp_useBOS and ta.crossunder(close, swingLow[1])

// Higher Highs / Lower Lows structure
bool  hhStructure = high > high[inp_swingLB] and low > low[inp_swingLB]
bool  llStructure = high < high[inp_swingLB] and low < low[inp_swingLB]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ• SESSION KILLZONES (Option 3)
// Times in Exchange timezone (ET for most US brokers)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
bool inLondon  = inp_useLondon and  not na(time("1", "0200-0500:23456", "America/New_York"))
bool inNY      = inp_useNY     and  not na(time("1", "0800-1100:23456", "America/New_York"))
bool inAsian   = inp_useAsian  and  not na(time("1", "2000-0000:1234567","America/New_York"))

bool inKillzone = not inp_useSession or (inLondon or inNY or inAsian)

// Session background â€” global scope, fully ternary (no local bgcolor)
color sessBG = inLondon ? color.new(#1a3a5c, 92) : inNY ? color.new(#1a4a2a, 92) : inAsian ? color.new(#3a1a5c, 95) : color.new(color.black, 100)
bgcolor(inp_showSessBG ? sessBG : na, title="Session Background")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¡ MULTI-TIMEFRAME ALIGNMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
float ema7_1m   = request.security(syminfo.tickerid, "1",  ta.ema(close, 7),   lookahead=barmerge.lookahead_off)
float ema200_1m = request.security(syminfo.tickerid, "1",  ta.ema(close, 200), lookahead=barmerge.lookahead_off)
float ema7_5m   = request.security(syminfo.tickerid, "5",  ta.ema(close, 7),   lookahead=barmerge.lookahead_off)
float ema200_5m = request.security(syminfo.tickerid, "5",  ta.ema(close, 200), lookahead=barmerge.lookahead_off)
float ema7_15m  = request.security(syminfo.tickerid, "15", ta.ema(close, 7),   lookahead=barmerge.lookahead_off)
float ema200_15m= request.security(syminfo.tickerid, "15", ta.ema(close, 200), lookahead=barmerge.lookahead_off)

int bullTF = (ema7_1m  > ema200_1m  ? 1 : 0)
           + (ema7_5m  > ema200_5m  ? 1 : 0)
           + (ema7_15m > ema200_15m ? 1 : 0)
int bearTF = (ema7_1m  < ema200_1m  ? 1 : 0)
           + (ema7_5m  < ema200_5m  ? 1 : 0)
           + (ema7_15m < ema200_15m ? 1 : 0)

bool bullAlign = bullTF >= inp_minTF
bool bearAlign = bearTF >= inp_minTF

bool bullMomentum = rsiVal > 50 and macdLine > signalLine and histLine > histLine[1]
bool bearMomentum = rsiVal < 50 and macdLine < signalLine and histLine < histLine[1]

bool volConfirmed = volume > volMA * 1.5

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ† CONFLUENCE SCORE (enhanced â€” max 12)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
f_score(bool isLong) =>
    int sc = 0

    // Volume (0-2)
    if volume > volMA * 2.0
        sc += 2
    else if volume > volMA * 1.5
        sc += 1

    // ATR range (0-2)
    float atrMean = ta.sma(atrVal, 50)
    if atrVal > atrMean * 0.8 and atrVal < atrMean * 1.8
        sc += 2
    else if atrVal > atrMean * 0.6
        sc += 1

    // RSI + MACD (0-2)
    if isLong  and rsiVal > 40 and rsiVal < 65 and macdLine > signalLine
        sc += 2
    else if not isLong and rsiVal < 60 and rsiVal > 35 and macdLine < signalLine
        sc += 2
    else if rsiVal > 30 and rsiVal < 70
        sc += 1

    // MTF alignment (0-2)
    if isLong  and bullTF >= 3
        sc += 2
    else if not isLong and bearTF >= 3
        sc += 2
    else if isLong and bullTF >= 2
        sc += 1
    else if not isLong and bearTF >= 2
        sc += 1

    // BOS structure alignment (0-2)
    if inp_useBOS
        if isLong  and hhStructure
            sc += 2
        else if not isLong and llStructure
            sc += 2
        else if isLong  and bosLong
            sc += 1
        else if not isLong and bosShort
            sc += 1

    // EMA acceleration bonus (0-2)
    if inp_useAccel
        if isLong  and fastAccelBull
            sc += 2
        else if not isLong and fastAccelBear
            sc += 2

    sc

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”„ HYBRID PULLBACK SIGNAL (Option 5)
// After a confirmed cross, wait for price to pull back to EMA50 zone
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var int  lastGoldenBar = na
var int  lastDeathBar  = na
var bool goldenActive  = false
var bool deathActive   = false

if goldenCross
    lastGoldenBar := bar_index
    goldenActive  := true
    deathActive   := false

if deathCross
    lastDeathBar  := bar_index
    deathActive   := true
    goldenActive  := false

// Pullback zone: price within inp_pbZone% of EMA50
float pbZoneDist = (math.abs(close - emaMid) / emaMid) * 100
bool  nearMid    = pbZoneDist <= inp_pbZone

// Expire the pullback window
if goldenActive and not na(lastGoldenBar) and (bar_index - lastGoldenBar) > inp_pbExpiry
    goldenActive := false
if deathActive and not na(lastDeathBar)  and (bar_index - lastDeathBar)  > inp_pbExpiry
    deathActive  := false

bool pullbackLong  = inp_usePullback and goldenActive and nearMid and close > emaMid and close > emaLong
bool pullbackShort = inp_usePullback and deathActive  and nearMid and close < emaMid and close < emaLong

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… FINAL SIGNALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
int scoreLong  = f_score(true)
int scoreShort = f_score(false)

// Classic cross (confirmed)
bool crossLong  = goldenCross and volConfirmed and bullAlign and bullMomentum and inKillzone and scoreLong  >= inp_minScore
bool crossShort = deathCross  and volConfirmed and bearAlign and bearMomentum and inKillzone and scoreShort >= inp_minScore

// Early acceleration signal (faster entry)
bool accelLong  = earlyBullSignal and not goldenCross and volConfirmed and bullAlign and inKillzone and scoreLong  >= (inp_minScore - 1)
bool accelShort = earlyBearSignal and not deathCross  and volConfirmed and bearAlign and inKillzone and scoreShort >= (inp_minScore - 1)

// Pullback re-entry (highest probability)
bool pbLong  = pullbackLong  and volConfirmed and bullAlign and inKillzone and scoreLong  >= (inp_minScore - 2)
bool pbShort = pullbackShort and volConfirmed and bearAlign and inKillzone and scoreShort >= (inp_minScore - 2)

// Quality labels
bool crossLongQ  = goldenCross and volConfirmed and (bullAlign or bullMomentum) and inKillzone and scoreLong  >= (inp_minScore - 2)
bool crossShortQ = deathCross  and volConfirmed and (bearAlign or bearMomentum) and inKillzone and scoreShort >= (inp_minScore - 2)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ TP/SL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
f_tpsl(bool isLong, float entry, int sc) =>
    float tpDist = atrVal * inp_tpMult
    float slDist = atrVal * inp_slMult
    if inp_adaptTPSL
        float bonus = math.max(sc - inp_minScore, 0) * 0.25
        tpDist := tpDist * (1 + bonus)
        slDist := slDist * (1 + bonus * 0.5)
    float tp = isLong ? entry + tpDist : entry - tpDist
    float sl = isLong ? entry - slDist : entry + slDist
    float rr = tpDist / math.max(slDist, 1e-10)
    [tp, sl, rr]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“‰ PSAR (Simplified, clean)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
float psar    = ta.sar(inp_psarStart, inp_psarInc, inp_psarMax)
int   psarDir = psar < close ? 1 : -1
bool  psarBuy  = psarDir == 1  and psarDir[1] == -1
bool  psarSell = psarDir == -1 and psarDir[1] == 1

color psarCol = psarDir == 1 ? color.new(#00e5ff, 30) : color.new(#aa00ff, 30)
plot(psar, "PSAR", style=plot.style_line, linewidth=2, color=psarCol)

if inp_showPSAR
    if psarBuy
        label.new(bar_index, psar, "â–²", style=label.style_label_up,
             color=color.new(#00e5ff, 20), textcolor=color.white, size=size.tiny)
    if psarSell
        label.new(bar_index, psar, "â–¼", style=label.style_label_down,
             color=color.new(#aa00ff, 20), textcolor=color.white, size=size.tiny)

// PSAR fill â€” global scope (bgcolor cannot be used in local scope)
float psarDist   = math.abs(close - psar) / close * 100
bool  psarNear   = inp_showPSARFill and psarDist < 1.5
color psarFillC  = psarDir == 1 ? color.new(#00e5ff, 90) : color.new(#aa00ff, 90)
bgcolor(psarNear ? psarFillC : na, title="PSAR Proximity")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š EMA PLOTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
color emaFastCol = emaFast > emaMid ? color.new(#00e5ff, 20) : color.new(#aa00ff, 20)
color emaMidCol  = emaMid  > emaLong ? color.new(#26a69a, 0) : color.new(#ef5350, 0)

plot(emaFast, "EMA Fast",  color=emaFastCol, linewidth=1)
plot(emaMid,  "EMA Mid",   color=emaMidCol,  linewidth=2)
plot(emaLong, "EMA Long",  color=color.new(color.yellow, 10), linewidth=2)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ·ï¸ SIGNAL LABELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if inp_showLabels
    // â”€â”€ PREMIUM GOLDEN CROSS
    if crossLong
        [tp, sl, rr] = f_tpsl(true, close, scoreLong)
        string lbl = "ğŸ‡ GOLDEN CROSS\n"
        lbl += inp_showScore ? str.tostring(scoreLong) + "/12 â€¢ " + str.tostring(bullTF) + "/3 TF\n" : ""
        lbl += inp_showTPSL  ? "TP: " + str.tostring(tp, format.mintick) + "  R:" + str.tostring(rr, "#.1") : ""
        label.new(bar_index, low, lbl,
             style=label.style_label_up,
             color=color.new(#00c853, 5),
             textcolor=color.white,
             size=size.normal)

    // â”€â”€ QUALITY GOLDEN CROSS (below premium threshold)
    else if crossLongQ
        string lbl = "ğŸ‡ Golden\n" + (inp_showScore ? str.tostring(scoreLong) + "/12" : "")
        label.new(bar_index, low, lbl,
             style=label.style_label_up,
             color=color.new(#00c853, 35),
             textcolor=color.white,
             size=size.small)

    // â”€â”€ EARLY ACCELERATION LONG
    if accelLong
        string lbl = "âš¡ ACCEL LONG\n" + (inp_showScore ? str.tostring(scoreLong) + "/12" : "")
        label.new(bar_index, low, lbl,
             style=label.style_label_up,
             color=color.new(#00bcd4, 15),
             textcolor=color.white,
             size=size.small)

    // â”€â”€ PULLBACK LONG (highest prob)
    if pbLong
        [tp, sl, rr] = f_tpsl(true, close, scoreLong)
        string lbl = "ğŸ¯ PULLBACK LONG\n"
        lbl += inp_showScore ? str.tostring(scoreLong) + "/12\n" : ""
        lbl += inp_showTPSL  ? "R:" + str.tostring(rr, "#.1") : ""
        label.new(bar_index, low, lbl,
             style=label.style_label_up,
             color=color.new(#64dd17, 5),
             textcolor=color.rgb(0,0,0),
             size=size.normal)

    // â”€â”€ PREMIUM DEATH CROSS
    if crossShort
        [tp, sl, rr] = f_tpsl(false, close, scoreShort)
        string lbl = "ğŸ’€ DEATH CROSS\n"
        lbl += inp_showScore ? str.tostring(scoreShort) + "/12 â€¢ " + str.tostring(bearTF) + "/3 TF\n" : ""
        lbl += inp_showTPSL  ? "TP: " + str.tostring(tp, format.mintick) + "  R:" + str.tostring(rr, "#.1") : ""
        label.new(bar_index, high, lbl,
             style=label.style_label_down,
             color=color.new(#d50000, 5),
             textcolor=color.white,
             size=size.normal)

    // â”€â”€ QUALITY DEATH CROSS
    else if crossShortQ
        string lbl = "ğŸ’€ Death\n" + (inp_showScore ? str.tostring(scoreShort) + "/12" : "")
        label.new(bar_index, high, lbl,
             style=label.style_label_down,
             color=color.new(#d50000, 35),
             textcolor=color.white,
             size=size.small)

    // â”€â”€ EARLY ACCELERATION SHORT
    if accelShort
        string lbl = "âš¡ ACCEL SHORT\n" + (inp_showScore ? str.tostring(scoreShort) + "/12" : "")
        label.new(bar_index, high, lbl,
             style=label.style_label_down,
             color=color.new(#aa00ff, 15),
             textcolor=color.white,
             size=size.small)

    // â”€â”€ PULLBACK SHORT (highest prob)
    if pbShort
        [tp, sl, rr] = f_tpsl(false, close, scoreShort)
        string lbl = "ğŸ¯ PULLBACK SHORT\n"
        lbl += inp_showScore ? str.tostring(scoreShort) + "/12\n" : ""
        lbl += inp_showTPSL  ? "R:" + str.tostring(rr, "#.1") : ""
        label.new(bar_index, high, lbl,
             style=label.style_label_down,
             color=color.new(#ff6d00, 5),
             textcolor=color.white,
             size=size.normal)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ—ºï¸ S/R PIVOT LINES (optional, disabled by default)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var line[] srLines = array.new<line>(0)

if inp_showSR and barstate.islast
    for i = 0 to array.size(srLines) - 1
        line.delete(array.get(srLines, i))
    array.clear(srLines)

    float ph = ta.pivothigh(high, 5, 5)
    float pl = ta.pivotlow (low,  5, 5)

    if not na(ph)
        array.push(srLines, line.new(bar_index - 30, ph, bar_index, ph,
             color=color.new(#ef5350, 70), width=1, style=line.style_dashed))
    if not na(pl)
        array.push(srLines, line.new(bar_index - 30, pl, bar_index, pl,
             color=color.new(#26a69a, 70), width=1, style=line.style_dashed))

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š PROFESSIONAL DASHBOARD TABLE (Option 4)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Colour palette
color C_BG    = color.new(#0d1117, 8)
color C_HEAD  = color.new(#161b22, 5)
color C_ROW   = color.new(#0d1117, 12)
color C_ACC   = color.new(#1c2128, 5)
color C_BULL  = color.rgb(0,   230, 118)
color C_BEAR  = color.rgb(255,  70, 110)
color C_WARN  = color.rgb(255, 190,  50)
color C_NEUT  = color.rgb(148, 163, 184)
color C_WHITE = color.rgb(240, 246, 252)
color C_DIM   = color.rgb( 88, 101, 114)
color C_BLUE  = color.rgb( 88, 166, 255)
color C_PURP  = color.rgb(180, 120, 255)

f_tfBar(int cnt) =>
    cnt >= 3 ? "â–ˆâ–ˆâ–ˆ" : cnt == 2 ? "â–ˆâ–ˆâ–‘" : cnt == 1 ? "â–ˆâ–‘â–‘" : "â–‘â–‘â–‘"

f_scoreBar(int sc, int mx) =>
    int filled = math.round(sc / mx * 8)
    string bar = ""
    for i = 1 to 8
        bar += i <= filled ? "â–ˆ" : "â–‘"
    bar

if inp_showTable and barstate.islast
    var table dash = table.new(position.bottom_left, 2, 20,
         bgcolor=C_BG,
         border_width=1, border_color=color.new(#30363d, 25),
         frame_width=1,  frame_color=color.new(#30363d, 25))

    int r = 0

    // â”€â”€ HEADER
    table.cell(dash, 0, r, "  ğŸ‡  White Rabbit v2", text_color=C_WHITE, text_size=size.normal, bgcolor=C_HEAD, text_halign=text.align_left)
    table.cell(dash, 1, r, syminfo.tickerid + "  ",  text_color=color.rgb(88,166,255), text_size=size.normal, bgcolor=C_HEAD, text_halign=text.align_right)
    r += 1

    // â”€â”€ SESSION
    string sessLabel = inLondon ? "ğŸ”µ London  " : inNY ? "ğŸŸ¢ New York  " : inAsian ? "ğŸŸ£ Asian  " : "â¸ Off Hours  "
    color  sessCol   = inLondon ? C_BLUE : inNY ? C_BULL : inAsian ? C_PURP : C_DIM
    table.cell(dash, 0, r, "  Session",  text_color=C_DIM,    text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, sessLabel,    text_color=sessCol,  text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    // â”€â”€ KILLZONE STATUS
    string kzLabel = inKillzone ? (not inp_useSession ? "All Allowed  " : "âœ… In Zone  ") : "â³ Wait  "
    color  kzCol   = inKillzone ? C_BULL : C_DIM
    table.cell(dash, 0, r, "  Killzone", text_color=C_DIM,  text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, kzLabel,      text_color=kzCol,  text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    // â”€â”€ MTF ALIGNMENT
    if inp_showMTFPanel
        table.cell(dash, 0, r, "  ğŸ“¡ MTF Alignment", text_color=C_WHITE, text_size=size.small, bgcolor=C_ACC, text_halign=text.align_left)
        table.cell(dash, 1, r, "", bgcolor=C_ACC)
        r += 1

        bool tf1Bull = ema7_1m  > ema200_1m
        bool tf5Bull = ema7_5m  > ema200_5m
        bool tf15Bull= ema7_15m > ema200_15m
        color c1  = tf1Bull  ? C_BULL : C_BEAR
        color c5  = tf5Bull  ? C_BULL : C_BEAR
        color c15 = tf15Bull ? C_BULL : C_BEAR
        table.cell(dash, 0, r, "  1m / 5m / 15m", text_color=C_DIM, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
        string tfRow = (tf1Bull ? "â–²" : "â–¼") + "  " + (tf5Bull ? "â–²" : "â–¼") + "  " + (tf15Bull ? "â–²" : "â–¼") + "  "
        color tfRowC = bullTF >= 2 ? C_BULL : bearTF >= 2 ? C_BEAR : C_WARN
        table.cell(dash, 1, r, tfRow, text_color=tfRowC, text_size=size.small, bgcolor=C_ROW, text_halign=text.align_right)
        r += 1

        table.cell(dash, 0, r, "  Bull / Bear TF",  text_color=C_DIM, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
        table.cell(dash, 1, r, f_tfBar(bullTF) + " / " + f_tfBar(bearTF) + "  ", text_color=bullTF > bearTF ? C_BULL : C_BEAR, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
        r += 1

    // â”€â”€ SIGNAL QUALITY
    table.cell(dash, 0, r, "  âš¡ Signal Quality", text_color=C_WHITE, text_size=size.small, bgcolor=C_ACC, text_halign=text.align_left)
    table.cell(dash, 1, r, "", bgcolor=C_ACC)
    r += 1

    int  dispScore = close > emaMid ? scoreLong : scoreShort
    color scCol    = dispScore >= 9 ? C_BULL : dispScore >= 6 ? C_WARN : C_BEAR
    table.cell(dash, 0, r, "  Score",   text_color=C_DIM, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, f_scoreBar(dispScore, 12) + " " + str.tostring(dispScore) + "/12  ", text_color=scCol, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    // â”€â”€ MOMENTUM INDICATORS
    color rsiCol = rsiVal >= 70 ? C_BEAR : rsiVal <= 30 ? C_BULL : C_NEUT
    table.cell(dash, 0, r, "  RSI",     text_color=C_DIM,  text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, str.tostring(rsiVal, "#.1") + "  ", text_color=rsiCol, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    color macdCol = macdLine > signalLine ? C_BULL : C_BEAR
    table.cell(dash, 0, r, "  MACD",    text_color=C_DIM,  text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, (macdLine > signalLine ? "â–² Bullish  " : "â–¼ Bearish  "), text_color=macdCol, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    // â”€â”€ STRUCTURE
    table.cell(dash, 0, r, "  ğŸ—ï¸ Structure", text_color=C_WHITE, text_size=size.small, bgcolor=C_ACC, text_halign=text.align_left)
    table.cell(dash, 1, r, "", bgcolor=C_ACC)
    r += 1

    string structLabel = hhStructure ? "ğŸ“ˆ HH/HL  " : llStructure ? "ğŸ“‰ LH/LL  " : "â†”ï¸ Mixed  "
    color  structCol   = hhStructure ? C_BULL : llStructure ? C_BEAR : C_WARN
    table.cell(dash, 0, r, "  Swing",   text_color=C_DIM, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, structLabel, text_color=structCol, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    string bosLabel = bosLong ? "ğŸ”¼ BOS Up  " : bosShort ? "ğŸ”½ BOS Down  " : "â€”  "
    color  bosCol   = bosLong ? C_BULL : bosShort ? C_BEAR : C_DIM
    table.cell(dash, 0, r, "  BOS",     text_color=C_DIM, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, bosLabel,    text_color=bosCol, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    // â”€â”€ ACCELERATION
    string accelLabel = fastAccelBull ? "âš¡ BULL ACCEL  " : fastAccelBear ? "âš¡ BEAR ACCEL  " : "â€”  "
    color  accelCol   = fastAccelBull ? C_BULL : fastAccelBear ? C_BEAR : C_DIM
    table.cell(dash, 0, r, "  EMA Accel", text_color=C_DIM, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, accelLabel,    text_color=accelCol, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    // â”€â”€ PULLBACK STATUS
    string pbLabel = goldenActive ? ("ğŸ¯ PB BULL (" + str.tostring(bar_index - lastGoldenBar) + "b)  ") : deathActive ? ("ğŸ¯ PB BEAR (" + str.tostring(bar_index - lastDeathBar) + "b)  ") : "â€”  "
    color  pbCol   = goldenActive ? C_BULL : deathActive ? C_BEAR : C_DIM
    table.cell(dash, 0, r, "  Pullback", text_color=C_DIM, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, pbLabel,      text_color=pbCol, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    // â”€â”€ PSAR
    string psarLabel = psarDir == 1 ? "â–² Long  " : "â–¼ Short  "
    color  psarCol   = psarDir == 1 ? C_BULL : C_BEAR
    table.cell(dash, 0, r, "  PSAR",    text_color=C_DIM, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_left)
    table.cell(dash, 1, r, psarLabel,   text_color=psarCol, text_size=size.tiny, bgcolor=C_ROW, text_halign=text.align_right)
    r += 1

    // â”€â”€ SIGNAL STATUS
    string sigLabel = crossLong or pbLong or accelLong ? "ğŸ‡ LONG SETUP  " : crossShort or pbShort or accelShort ? "ğŸ’€ SHORT SETUP  " : "â³ WAIT  "
    color  sigCol   = (crossLong or pbLong or accelLong) ? C_BULL : (crossShort or pbShort or accelShort) ? C_BEAR : C_DIM
    table.cell(dash, 0, r, "  Status",  text_color=C_WHITE, text_size=size.small, bgcolor=C_HEAD, text_halign=text.align_left)
    table.cell(dash, 1, r, sigLabel,    text_color=sigCol,  text_size=size.small, bgcolor=C_HEAD, text_halign=text.align_right)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”” ALERT CONDITIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
alertcondition(crossLong,   "ğŸ‡ GOLDEN CROSS Premium",   "Golden Cross PREMIUM â€” Score: High | TF Aligned")
alertcondition(crossShort,  "ğŸ’€ DEATH CROSS Premium",    "Death Cross PREMIUM â€” Score: High | TF Aligned")
alertcondition(crossLongQ,  "ğŸ‡ Golden Cross Quality",   "Golden Cross â€” Quality signal")
alertcondition(crossShortQ, "ğŸ’€ Death Cross Quality",    "Death Cross â€” Quality signal")
alertcondition(accelLong,   "âš¡ EMA Acceleration LONG",  "EMA7 accelerating bullish before cross")
alertcondition(accelShort,  "âš¡ EMA Acceleration SHORT", "EMA7 accelerating bearish before cross")
alertcondition(pbLong,      "ğŸ¯ Pullback LONG",          "High-probability pullback entry â€” LONG")
alertcondition(pbShort,     "ğŸ¯ Pullback SHORT",         "High-probability pullback entry â€” SHORT")
alertcondition(psarBuy,     "ğŸ“‰ PSAR Long",              "PSAR direction changed to Long")
alertcondition(psarSell,    "ğŸ“‰ PSAR Short",             "PSAR direction changed to Short")
alertcondition(bosLong,     "ğŸ—ï¸ BOS Bullish",            "Break of Structure â€” Bullish")
alertcondition(bosShort,    "ğŸ—ï¸ BOS Bearish",            "Break of Structure â€” Bearish")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¡ DATA WINDOW EXPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
plot(scoreLong,  "Score Long",  display=display.data_window)
plot(scoreShort, "Score Short", display=display.data_window)
plot(bullTF,     "Bull TF",     display=display.data_window)
plot(bearTF,     "Bear TF",     display=display.data_window)
plot(emaFastSlope, "EMA Fast Slope", display=display.data_window)
