//@version=6
strategy("Stella's SuperTrend Basic", overlay=true, 
         default_qty_type=strategy.percent_of_equity, 
         default_qty_value=10,
         initial_capital=10000,
         currency=currency.USD)

// パラメーター設定
atrPeriod = input.int(10, "ATR期間", minval=1, maxval=100)
multiplier = input.float(3.0, "乗数", minval=0.1, maxval=10.0, step=0.1)
useStopLoss = input.bool(true, "損切りを使用")
stopLossPercent = input.float(8.0, "損切り幅(%)", minval=1.0, maxval=20.0)  // 5%→8%

// SuperTrend計算
[supertrend, direction] = ta.supertrend(multiplier, atrPeriod)

// 表示
plot(supertrend, color=direction < 0 ? color.green : color.red, linewidth=2, title="SuperTrend")

// エントリー条件
longCondition = ta.crossover(close, supertrend)
shortCondition = ta.crossunder(close, supertrend)

// 売買実行
if longCondition
    strategy.entry("Long", strategy.long)
if shortCondition
    strategy.entry("Short", strategy.short)

// パーセント損切り
if useStopLoss and strategy.position_size > 0
    strategy.exit("SL Long", "Long", stop=strategy.position_avg_price * (1 - stopLossPercent / 100))
if useStopLoss and strategy.position_size < 0
    strategy.exit("SL Short", "Short", stop=strategy.position_avg_price * (1 + stopLossPercent / 100))

// 背景色
bgcolor(direction < 0 ? color.new(color.green, 90) : color.new(color.red, 90))

// シグナルマーカー
plotshape(longCondition, "Long", shape.triangleup, location.belowbar, color.green, size=size.small)
plotshape(shortCondition, "Short", shape.triangledown, location.abovebar, color.red, size=size.small)
