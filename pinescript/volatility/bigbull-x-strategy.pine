//@version=5
strategy("bigbull X Strategy", overlay=true, pyramiding=0,  initial_capital=10000, default_qty_type=strategy.fixed, default_qty_value=120, commission_type=strategy.commission.percent, commission_value=0.01,  slippage=2 ,process_orders_on_close=true)

//────────────────────────
// DATE FILTER
//────────────────────────
startYear  = input.int(2012, "Start Year")
startMonth = input.int(9, "Start Month")
startDay   = input.int(22, "Start Day")
startDate  = timestamp(startYear, startMonth, startDay, 0, 0)

endYear   = input.int(2099, "End Year")
endMonth  = input.int(12, "End Month")
endDay    = input.int(31, "End Day")
endDate   = timestamp(endYear, endMonth, endDay, 23, 59)

isDateValid = time >= startDate and time <= endDate

//────────────────────────
// TRADE SESSION
//────────────────────────
sessionTime = input.session("0915-1500","Trade Session")
inSession = not na(time(timeframe.period, sessionTime))

//────────────────────────
// === Moving Averages ===
ema10 = ta.ema(close, 10)
ema20 = ta.ema(close, 20)
ema30 = ta.ema(close, 30)
ema50 = ta.ema(close, 50)
ema100 = ta.ema(close, 100)
ema200 = ta.ema(close, 200)

sma10 = ta.sma(close, 10)
sma20 = ta.sma(close, 20)
sma30 = ta.sma(close, 30)
sma50 = ta.sma(close, 50)
sma100 = ta.sma(close, 100)
sma200 = ta.sma(close, 200)

vwma = ta.vwma(close, 20)
hullma = ta.wma(2 * ta.wma(close, 10 / 2) - ta.wma(close, 10), math.round(math.sqrt(10)))

// Ichimoku
conversionLine = (ta.highest(high, 9) + ta.lowest(low, 9)) / 2
baseLine = (ta.highest(high, 26) + ta.lowest(low, 26)) / 2

//────────────────────────
// === Oscillators ===
rsi = ta.rsi(close, 14)
k = ta.stoch(close, high, low, 14)
d = ta.sma(k, 3)
stochRSI = ta.stoch(rsi, rsi, rsi, 14)
macd = ta.ema(close, 12) - ta.ema(close, 26)
signal = ta.ema(macd, 9)

// ADX manually
len = 14
upMove = high - high[1]
downMove = low[1] - low
plusDM = (upMove > downMove and upMove > 0) ? upMove : 0
minusDM = (downMove > upMove and downMove > 0) ? downMove : 0
trur = ta.rma(ta.tr, len)
plusDI = 100 * ta.rma(plusDM, len) / trur
minusDI = 100 * ta.rma(minusDM, len) / trur
dx = 100 * math.abs(plusDI - minusDI) / (plusDI + minusDI)
adx = ta.rma(dx, len)

cci = ta.cci(close, 20)
ao = ta.sma(hl2, 5) - ta.sma(hl2, 34)
mom = ta.mom(close, 10)

wrLength = 14
hh = ta.highest(high, wrLength)
ll = ta.lowest(low, wrLength)
wr = -100 * (hh - close) / (hh - ll)

bullPower = high - ta.ema(close, 13)
bearPower = low - ta.ema(close, 13)

bp = close - math.min(low, close[1])
tr = math.max(high, close[1]) - math.min(low, close[1])
avg7  = ta.sma(bp, 7)  / ta.sma(tr, 7)
avg14 = ta.sma(bp, 14) / ta.sma(tr, 14)
avg28 = ta.sma(bp, 28) / ta.sma(tr, 28)
ultOsc = 100 * (4 * avg7 + 2 * avg14 + avg28) / 7

//────────────────────────
// SCORE CALCULATION
//────────────────────────
score = 0
score += close > ema10  ? 1 : close < ema10  ? -1 : 0
score += close > ema20  ? 1 : close < ema20  ? -1 : 0
score += close > ema30  ? 1 : close < ema30  ? -1 : 0
score += close > ema50  ? 1 : close < ema50  ? -1 : 0
score += close > ema100 ? 1 : close < ema100 ? -1 : 0
score += close > ema200 ? 1 : close < ema200 ? -1 : 0
score += close > sma10  ? 1 : close < sma10  ? -1 : 0
score += close > sma20  ? 1 : close < sma20  ? -1 : 0
score += close > sma30  ? 1 : close < sma30  ? -1 : 0
score += close > sma50  ? 1 : close < sma50  ? -1 : 0
score += close > sma100 ? 1 : close < sma100 ? -1 : 0
score += close > sma200 ? 1 : close < sma200 ? -1 : 0
score += close > vwma   ? 1 : close < vwma   ? -1 : 0
score += close > hullma ? 1 : close < hullma ? -1 : 0
score += conversionLine > baseLine ? 1 : conversionLine < baseLine ? -1 : 0
score += rsi > 55 and rsi[1] < 55 ? 1 : rsi < 45 and rsi[1] > 45 ? -1 : 0
score += k > d ? 1 : k < d ? -1 : 0
score += stochRSI > 0.8 ? 1 : stochRSI < 0.2 ? -1 : 0
score += macd > signal and macd > 0 ? 1 : macd < signal and macd < 0 ? -1 : 0
score += adx > 20 and plusDI > minusDI ? 1 : adx > 20 and minusDI > plusDI ? -1 : 0
score += cci > 100 ? 1 : cci < -100 ? -1 : 0
score += ao > 0 and ao > ao[1] ? 1 : ao < 0 and ao < ao[1] ? -1 : 0
score += mom > 0 and mom > mom[1] ? 1 : mom < 0 and mom < mom[1] ? -1 : 0
score += wr > -80 and wr > wr[1] ? 1 : wr < -20 and wr < -20 ? -1 : 0
score += bullPower > 0 ? 1 : bearPower < 0 ? -1 : 0
score += ultOsc > 55 and ultOsc > ultOsc[1] ? 1 : ultOsc < 45 and ultOsc < ultOsc[1] ? -1 : 0

strongBuy  = score >= 9
buy        = score >= 4 and score < 9
neutral    = score > -4 and score < 4
sell       = score <= -4 and score > -9
strongSell = score <= -9

//────────────────────────
// STRATEGY EXECUTION
//────────────────────────
if isDateValid and inSession
    if strongBuy or buy
        strategy.entry("Buy", strategy.long)
    if strongSell or sell
        strategy.entry("Sell", strategy.short)
    if neutral
        strategy.close("Buy")
        strategy.close("Sell")


//==============================
// ONE-TIME EXECUTION LOCK
//==============================
newBuy     = (strongBuy or buy) and not (strongBuy[1] or buy[1])
newSell    = (strongSell or sell) and not (strongSell[1] or sell[1])
newNeutral = neutral and not neutral[1]
