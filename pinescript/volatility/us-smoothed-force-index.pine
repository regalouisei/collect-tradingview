// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Lullo73

//@version=6
indicator("US Smoothed FORCE INDEX", overlay=false)

// ===== INPUT =====
rocLen     = input.int(20, "ROC Length", minval=1)
smoothLen  = input.int(10, "Smoothing Length", minval=1)
smoothType = input.string("RMA", "Smoothing Type", options=["EMA", "RMA", "SMA"])

// ===== SYMBOLS =====
symNQ  = "CME_MINI:NQ1!"
symES  = "CME_MINI:ES1!"
symYM  = "CBOT_MINI:YM1!"
symRTY = "CME_MINI:RTY1!"

// ===== DATA =====
nq  = request.security(symNQ, timeframe.period, close)
es  = request.security(symES, timeframe.period, close)
ym  = request.security(symYM, timeframe.period, close)
rty = request.security(symRTY, timeframe.period, close)

// ===== ROC =====
rocNQ  = ta.roc(nq, rocLen)
rocES  = ta.roc(es, rocLen)
rocYM  = ta.roc(ym, rocLen)
rocRTY = ta.roc(rty, rocLen)

// ===== RELATIVE STRENGTH =====
avgROC = (rocNQ + rocES + rocYM + rocRTY) / 4

rsNQ_raw  = rocNQ  - avgROC
rsES_raw  = rocES  - avgROC
rsYM_raw  = rocYM  - avgROC
rsRTY_raw = rocRTY - avgROC

// ===== SMOOTHING FUNCTION =====
f_smooth(src) =>
    smoothType == "EMA" ? ta.ema(src, smoothLen) : smoothType == "SMA" ? ta.sma(src, smoothLen) : ta.rma(src, smoothLen)

// ===== SMOOTHED VALUES =====
rsNQ  = f_smooth(rsNQ_raw)
rsES  = f_smooth(rsES_raw)
rsYM  = f_smooth(rsYM_raw)
rsRTY = f_smooth(rsRTY_raw)

// ===== PLOTS =====
plot(rsNQ,  "NQ Strength",  color=color.blue,   linewidth=2)
plot(rsES,  "ES Strength",  color=color.green,  linewidth=2)
plot(rsYM,  "YM Strength",  color=color.orange, linewidth=2)
plot(rsRTY, "RTY Strength", color=color.red,    linewidth=2)

hline(0, "Neutral", color=color.gray)

// ===== LABELS =====
var label lblNQ  = na
var label lblES  = na
var label lblYM  = na
var label lblRTY = na

if barstate.islast
    label.delete(lblNQ)
    label.delete(lblES)
    label.delete(lblYM)
    label.delete(lblRTY)

    lblNQ  := label.new(bar_index + 1, rsNQ,  "NQ",  style=label.style_label_left,
         color=color.blue,   textcolor=color.white, size=size.small)

    lblES  := label.new(bar_index + 1, rsES,  "ES",  style=label.style_label_left,
         color=color.green,  textcolor=color.white, size=size.small)

    lblYM  := label.new(bar_index + 1, rsYM,  "YM",  style=label.style_label_left,
         color=color.orange, textcolor=color.white, size=size.small)

    lblRTY := label.new(bar_index + 1, rsRTY, "RTY", style=label.style_label_left,
         color=color.red,    textcolor=color.white, size=size.small)
