// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © rcaminero

//@version=6
indicator("Opening Range 8:00–8:15 + Midpoint", overlay=true)

// Inputs
sess        = input.session("0800-0815", "Opening Range Session")
useExchange = input.bool(true, "Use Exchange Timezone?")
customTz    = input.string("America/New_York", "Custom Timezone (if not exchange)")
showFill    = input.bool(true, "Fill Opening Range")

tz = useExchange ? syminfo.timezone : customTz

// Detect OR window
inOR = not na(time(timeframe.period, sess, tz))

// New day (timezone aware)
newDay = ta.change(time("D", "", tz)) != 0

// Store range
var float orHigh = na
var float orLow  = na

if newDay
    orHigh := na
    orLow  := na

if inOR
    orHigh := na(orHigh) ? high : math.max(orHigh, high)
    orLow  := na(orLow)  ? low  : math.min(orLow, low)

// Midpoint
orMid = (orHigh + orLow) / 2.0

// Plot
pHigh = plot(orHigh, "OR High", color=color.lime, linewidth=2, style=plot.style_stepline)
pLow  = plot(orLow,  "OR Low",  color=color.red,  linewidth=2, style=plot.style_stepline)
pMid  = plot(orMid,  "OR Mid",  color=color.yellow, linewidth=2, style=plot.style_stepline)

// Fill must be in global scope
fillColor = showFill ? color.new(color.aqua, 85) : na
fill(pHigh, pLow, color=fillColor)
