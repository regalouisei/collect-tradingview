//@version=6
strategy("XAUUSD 1-Minute Scalping Strategy", overlay=true)

// Input parameters
length = input.int(14, title="RSI Length")
overbought = input.int(70, title="Overbought Level")
oversold = input.int(30, title="Oversold Level")
takeProfit = input.int(10, title="Take Profit (pips)")
stopLoss = input.int(5, title="Stop Loss (pips)")

// Calculate R:R ratio
rrRatio = takeProfit / stopLoss

// Calculate RSI
rsi = ta.rsi(close, length)

// Entry conditions
longCondition = (rsi < oversold)
shortCondition = (rsi > overbought)

// Entry Logic
if (longCondition and strategy.position_size == 0)
    strategy.entry("Long", strategy.long)

if (shortCondition and strategy.position_size == 0)
    strategy.entry("Short", strategy.short)

// Exit conditions
if (strategy.position_size > 0)
    strategy.exit("Take Profit/Stop Loss", "Long", limit=close + takeProfit * syminfo.mintick, stop=close - stopLoss * syminfo.mintick)

if (strategy.position_size < 0)
    strategy.exit("Take Profit/Stop Loss", "Short", limit=close - takeProfit * syminfo.mintick, stop=close + stopLoss * syminfo.mintick)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VISUALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// RSI Plot with styling
hline(overbought, "Overbought", color=color.new(color.red, 50), linestyle=hline.style_dashed, linewidth=2)
hline(oversold, "Oversold", color=color.new(color.green, 50), linestyle=hline.style_dashed, linewidth=2)
hline(50, "Midline", color=color.new(color.gray, 70), linestyle=hline.style_dotted, linewidth=1)

rsiPlot = plot(rsi, title="RSI", color=color.new(color.blue, 0), linewidth=2)
fill(plot(50, display=display.none), rsiPlot, color=rsi > 50 ? color.new(color.blue, 90) : color.new(color.orange, 90), title="RSI Background")

// Background color for oversold/overbought zones
bgcolor(rsi > overbought ? color.new(color.red, 85) : rsi < oversold ? color.new(color.green, 85) : na, title="RSI Zones")

// Entry signal markers
plotshape(longCondition, "Long Entry", style=shape.triangleup, location=location.belowbar, color=color.new(color.lime, 0), size=size.small, text="BUY", textcolor=color.white)
plotshape(shortCondition, "Short Entry", style=shape.triangledown, location=location.abovebar, color=color.new(color.red, 0), size=size.small, text="SELL", textcolor=color.white)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFESSIONAL DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table dashboard = table.new(
     position=position.top_right,
     columns=2,
     rows=11,
     bgcolor=color.new(color.black, 30),
     border_color=color.new(color.blue, 70),
     border_width=2,
     frame_color=color.new(color.blue, 70),
     frame_width=2)

if barstate.islast
    // â• HEADER â•
    table.cell(dashboard, 0, 0, "XAUUSD 1M SCALPER", 
               bgcolor=color.new(color.blue, 60), text_color=color.white, 
               text_size=size.large, text_halign=text.align_center)
    table.merge_cells(dashboard, 0, 0, 1, 0)
    
    // â• NET PROFIT â•
    table.cell(dashboard, 0, 1, "Net P&L", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)
    profitColor = strategy.netprofit > 0 ? color.new(color.green, 30) : color.new(color.red, 30)
    profitTextColor = strategy.netprofit > 0 ? color.lime : color.red
    table.cell(dashboard, 1, 1, "$" + str.tostring(strategy.netprofit, "#,##0.00"), 
               bgcolor=profitColor, text_color=profitTextColor, text_size=size.large, text_halign=text.align_right)
    
    // â• TOTAL TRADES â•
    table.cell(dashboard, 0, 2, "Total Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 2, str.tostring(strategy.closedtrades), 
               text_color=color.white, text_size=size.normal, text_halign=text.align_right)
    
    // â• WIN RATE â•
    table.cell(dashboard, 0, 3, "Win Rate", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)
    winRate = strategy.closedtrades > 0 ? (strategy.wintrades / strategy.closedtrades) * 100 : 0
    wrColor = winRate > 50 ? color.lime : winRate > 40 ? color.yellow : color.red
    table.cell(dashboard, 1, 3, str.tostring(winRate, "#.##") + "%", 
               text_color=wrColor, text_size=size.normal, text_halign=text.align_right)
    
    // â• PROFIT FACTOR â•
    table.cell(dashboard, 0, 4, "Profit Factor", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)
    pf = strategy.grossloss != 0 ? math.abs(strategy.grossprofit / strategy.grossloss) : 0
    pfColor = pf > 1.5 ? color.lime : pf > 1.0 ? color.yellow : color.red
    table.cell(dashboard, 1, 4, str.tostring(pf, "#.##"), 
               text_color=pfColor, text_size=size.normal, text_halign=text.align_right)
    
    // â• WINNING TRADES â•
    table.cell(dashboard, 0, 5, "Winning Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 5, str.tostring(strategy.wintrades), 
               text_color=color.lime, text_size=size.normal, text_halign=text.align_right)
    
    // â• LOSING TRADES â•
    table.cell(dashboard, 0, 6, "Losing Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 6, str.tostring(strategy.losstrades), 
               text_color=color.red, text_size=size.normal, text_halign=text.align_right)
    
    // â• CURRENT RSI â•
    table.cell(dashboard, 0, 7, "Current RSI", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)
    rsiColor = rsi > overbought ? color.red : rsi < oversold ? color.lime : color.yellow
    table.cell(dashboard, 1, 7, str.tostring(rsi, "#.##"), 
               text_color=rsiColor, text_size=size.normal, text_halign=text.align_right)
    
    // â• POSITION STATUS â•
    table.cell(dashboard, 0, 8, "Position", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)
    posText = strategy.position_size > 0 ? "LONG ðŸ“ˆ" : strategy.position_size < 0 ? "SHORT ðŸ“‰" : "FLAT â”"
    posColor = strategy.position_size > 0 ? color.lime : strategy.position_size < 0 ? color.red : color.gray
    table.cell(dashboard, 1, 8, posText, 
               text_color=posColor, text_size=size.normal, text_halign=text.align_right)
    
     // â• RISK/REWARD â•
    table.cell(dashboard, 0, 9, "TP/SL Ratio", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)
    table.cell(dashboard, 1, 9, "1:" + str.tostring(rrRatio, "#.#"), text_color=color.aqua, text_size=size.normal, text_halign=text.align_right)
    
    // â• FOOTER â•
    table.cell(dashboard, 0, 10, "IC Markets â€¢ v6", bgcolor=color.new(color.gray, 70), text_color=color.white, text_size=size.tiny, text_halign=text.align_center)
    table.merge_cells(dashboard, 0, 10, 1, 10)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTS - GLOBAL SCOPE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Condition for LONG alert (only if not in short)
longAlertCondition = longCondition and strategy.position_size <= 0

// Condition for SHORT alert (only if not in long)
shortAlertCondition = shortCondition and strategy.position_size >= 0

// Fire alerts at global scope
alertcondition(longAlertCondition, "ðŸŸ¢ LONG ENTRY", "Long entry - RSI oversold")
alertcondition(shortAlertCondition, "ðŸ”´ SHORT ENTRY", "Short entry - RSI overbought")
