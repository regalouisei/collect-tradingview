// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© Pineify

//======================================================================//
//                    ____  _            _  __                          //
//                   |  _ \(_)_ __   ___(_)/ _|_   _                    //
//                   | |_) | | '_ \ / _ \ | |_| | | |                   //
//                   |  __/| | | | |  __/ |  _| |_| |                   //
//                   |_|   |_|_| |_|\___|_|_|  \__, |                   //
//                                             |___/                    //
//======================================================================//


//@version=6
indicator("Radiant Mean Reversion Channels [Pineify]", shorttitle="Pineify - Radiant Channels", overlay=false)

// -----------------------------------------------------------------------------
// SETTINGS
// -----------------------------------------------------------------------------
group_calc = "Calculation"
len     = input.int(21, "Channel Length", minval=1, group=group_calc, tooltip="The lookback period for the Mean and Volatility.")
mult    = input.float(2.0, "Band Multiplier", step=0.1, group=group_calc, tooltip="Expands the width of the channel. Higher values = fewer signals.")
smooth  = input.int(3, "Oscillator Smoothing", minval=1, group=group_calc, tooltip="Smooths the main line to reduce noise.")
src     = input.source(close, "Source", group=group_calc)

group_style = "Visuals"
col_bull = input.color(#089981, "Bullish Color", group=group_style)
col_bear = input.color(#f23645, "Bearish Color", group=group_style)
col_neu  = input.color(#2962ff, "Neutral Color", group=group_style)

// -----------------------------------------------------------------------------
// CALCULATIONS
// -----------------------------------------------------------------------------

// 1. Define the Mean (Center)
// We use HMA (Hull Moving Average) for the mean because it reduces lag while staying smooth.
mean = ta.hma(src, len)

// 2. Define the Volatility Bands (Width)
// We use ATR (Average True Range) to measure volatility.
volatility = ta.atr(len) * mult

// 3. Create the Channel Extremities
upper_band = mean + volatility
lower_band = mean - volatility

// 4. Normalize Price into an Oscillator (0 to 100)
// This converts the chart channel into a sub-chart oscillator.
// Formula: (Price - Lower) / (Upper - Lower) * 100
raw_osc = (src - lower_band) / (upper_band - lower_band) * 100

// 5. Smooth the Oscillator
osc = ta.wma(raw_osc, smooth)

// -----------------------------------------------------------------------------
// PLOTTING & VISUALS
// -----------------------------------------------------------------------------

// Dynamic Gradient Color for the Oscillator Line
osc_color = color.from_gradient(osc, 0, 100, col_bear, col_bull)

// Plot the Main Oscillator
plot(osc, "Radiant Oscillator", color=osc_color, linewidth=2)

// Plot Key Levels
h_ob = hline(90, "Extreme Overbought", color=color.new(col_bear, 50), linestyle=hline.style_dotted)
h_top = hline(80, "Overbought", color=color.new(col_bear, 50))
h_mid = hline(50, "Mean (Equilibrium)", color=color.new(color.gray, 50), linestyle=hline.style_solid)
h_bot = hline(20, "Oversold", color=color.new(col_bull, 50))
h_os = hline(10, "Extreme Oversold", color=color.new(col_bull, 50), linestyle=hline.style_dotted)

// Beautiful Fills
fill(h_top, h_ob, color=color.new(col_bear, 85), title="Bearish Zone")
fill(h_bot, h_os, color=color.new(col_bull, 85), title="Bullish Zone")

// -----------------------------------------------------------------------------
// SIGNALS
// -----------------------------------------------------------------------------

// Generate Signals based on "Reversion to Mean"
// Buy when price crosses back ABOVE 20 (leaving oversold)
// Sell when price crosses back BELOW 80 (leaving overbought)
long_signal  = ta.crossover(osc, 20)
short_signal = ta.crossunder(osc, 80)

// Plot Signals
plotshape(long_signal, "Buy Signal", shape.circle, location.bottom, color=col_bull, size=size.tiny, offset=0)
plotshape(short_signal, "Sell Signal", shape.circle, location.top, color=col_bear, size=size.tiny, offset=0)

// Alert Conditions for automation
alertcondition(long_signal, "Radiant Buy", "Price is reversing from oversold conditions")
alertcondition(short_signal, "Radiant Sell", "Price is reversing from overbought conditions")
