//@version=5
indicator("MNQ 99% Sniper Reversal", overlay=true)

// --- 1. Institutional Time Window (The Most Important Filter) ---
// High-accuracy swings almost always happen in these windows.
is_killzone = not na(time(timeframe.period, "1000-1100:23456", "America/New_York"))

// --- 2. Key Level Tracking (PDH/PDL) ---
pdh = request.security(syminfo.tickerid, "D", high[1], lookahead=barmerge.lookahead_on)
pdl = request.security(syminfo.tickerid, "D", low[1], lookahead=barmerge.lookahead_on)

// --- 3. Displacement & Volume Confirmation ---
// ATR filter ensures the move has "teeth" and isn't just noise
displacement = math.abs(open - close) > ta.atr(14) * 1.5
vol_spike    = volume > ta.sma(volume, 20) * 1.2

// --- 4. The 99% Logic (The Triple-Confluence) ---
// Long: Price swept PDL + Reclaimed it + During Killzone + Displacement
long_sniper  = low < pdl and close > pdl and is_killzone and displacement and vol_spike
// Short: Price swept PDH + Reclaimed it + During Killzone + Displacement
short_sniper = high > pdh and close < pdh and is_killzone and displacement and vol_spike

// --- Visual Signaling ---
plot(pdh, "Prev Day High", color=color.new(color.red, 60), style=plot.style_linebr)
plot(pdl, "Prev Day Low", color=color.new(color.green, 60), style=plot.style_linebr)

if long_sniper
    label.new(bar_index, low, "ðŸŽ¯ 99% LONG\nENTRY: " + str.tostring(close), color=color.green, textcolor=color.white, style=label.style_label_up)
    
if short_sniper
    label.new(bar_index, high, "ðŸŽ¯ 99% SHORT\nENTRY: " + str.tostring(close), color=color.red, textcolor=color.white, style=label.style_label_down)

// Background highlight for the Killzone
bgcolor(is_killzone ? color.new(color.yellow, 95) : na)
