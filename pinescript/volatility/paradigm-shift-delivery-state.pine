// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © BLKMonk

//@version=5
indicator("Paradigm Shift: Delivery State", overlay=true)

// --- 1. SYSTEMIC STRESS (Dalio Filter) ---
// Note: MOVE Index is not natively in TradingView, so we use US10Y Volatility as a proxy
bond_vol = ta.stdev(request.security("US10Y", "W", close), 20)
move_proxy = ta.percentrank(bond_vol, 252) // Rank of current bond stress over 1 year

// --- 2. ALGO EFFICIENCY (ICT Filter) ---
// Measure 'Symmetry': Did the last Weekly FVG get filled?
var float last_fvg_high = na
var float last_fvg_low = na
if low[1] > high[3] // Bullish FVG detected
    last_fvg_high := high[3]
    last_fvg_low := low[1]

// Check if price returned to that FVG
was_fvg_filled = low <= last_fvg_low

// --- 3. THE "GRINDER" STATE LOGIC ---
string market_state = "SYMMETRICAL"
color state_color = color.green

if move_proxy > 70 or not was_fvg_filled
    market_state := "SATURATED"
    state_color := color.orange

if move_proxy > 90 and (close > open and request.security("GOLD", "W", close) > request.security("GOLD", "W", open))
    market_state := "OPAQUE (PARADIGM SHIFT)"
    state_color := color.red

// --- 4. DASHBOARD VISUAL ---
var table status_table = table.new(position.top_right, 2, 2, border_width=1)
if barstate.islast
    table.cell(status_table, 0, 0, "Delivery State:", bgcolor=color.gray, text_color=color.white)
    table.cell(status_table, 1, 0, market_state, bgcolor=state_color, text_color=color.white)
    table.cell(status_table, 0, 1, "Systemic Stress:", bgcolor=color.gray, text_color=color.white)
    table.cell(status_table, 1, 1, str.tostring(math.round(move_proxy)) + "%", bgcolor=state_color, text_color=color.white)

// Background highlight for "Opaque" Weeks
bgcolor(market_state == "OPAQUE (PARADIGM SHIFT)" ? color.new(color.red, 90) : na)
