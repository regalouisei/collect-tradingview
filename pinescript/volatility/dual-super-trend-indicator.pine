//@version=6
indicator("Dual Super Trend Indicator", overlay=true)

// ===== INPUTS =====
atrLen1 = input.int(10, "ATR Length TF1")
factor1 = input.float(3.0, "Factor TF1")

atrLen2 = input.int(10, "ATR Length TF2")
factor2 = input.float(3.0, "Factor TF2")

tf1 = input.timeframe("15", "Lower TF")
tf2 = input.timeframe("60", "Higher TF")

// ===== SUPER TREND FUNCTION =====
f_st(_factor, _len) =>
    [st, dir] = ta.supertrend(_factor, _len)
    dir

// ===== GET CONFIRMED MTF DIRECTIONS =====
dir1 = request.security(syminfo.tickerid, tf1, f_st(factor1, atrLen1), barmerge.gaps_off, barmerge.lookahead_off)
dir2 = request.security(syminfo.tickerid, tf2, f_st(factor2, atrLen2), barmerge.gaps_off, barmerge.lookahead_off)

// ===== CURRENT TREND =====
// Supertrend dir = -1 → Bullish (Long)
// Supertrend dir =  1 → Bearish (Short)
int currTrend = 0
if dir1 == -1 and dir2 == -1
    currTrend := 1
else if dir1 == 1 and dir2 == 1
    currTrend := -1
else
    currTrend := 0

// ===== STATE =====
var int trendState = 0

// ===== SIGNALS ONLY ON TRUE FLIP =====
longSignal  = currTrend == 1  and trendState != 1
shortSignal = currTrend == -1 and trendState != -1

// ===== UPDATE STATE AFTER BAR CLOSE =====
if barstate.isconfirmed
    if currTrend != 0
        trendState := currTrend

// ===== PLOT SIGNALS =====
plotshape(longSignal,  title="Long",  style=shape.triangleup,   location=location.belowbar, color=color.green, size=size.small, text="LONG")
plotshape(shortSignal, title="Short", style=shape.triangledown, location=location.abovebar, color=color.red,   size=size.small, text="SHORT")

// ===== ALERTS =====
alertcondition(longSignal,  title="Dual ST LONG",  message="Dual Super Trend Indicator flipped to LONG")
alertcondition(shortSignal, title="Dual ST SHORT", message="Dual Super Trend Indicator flipped to SHORT")
