//@version=6
strategy("Inside Bar Strategy with SL/TP", overlay=true)

// Warunek Inside Bar
isInsideBar = high < high[1] and low > low[1]

// Obliczenia dla zarządzania ryzykiem
candleRange = high - low                // Rozpiętość świecy wejścia
candleMiddle = (high + low) / 2         // Środek świecy wejścia

// DŁUGIE WEJŚCIE (LONG)
if (isInsideBar and close > open)
    // Obliczenie poziomów SL i TP dla LONG
    longStopLoss = low                  // SL na dole świecy wejścia
    longTakeProfit = high + (candleRange * 2)  // TP = high + 2x rozpiętość świecy
    
    // Wejście w pozycję LONG
    strategy.entry("InsBarLE", strategy.long, comment="InsBarLE")
    
    // Ustawienie Stop Loss i Take Profit dla LONG
    strategy.exit("InsBarLE Exit", "InsBarLE", 
         stop=longStopLoss, 
         limit=longTakeProfit,
         comment="SL: " + str.tostring(longStopLoss) + " TP: " + str.tostring(longTakeProfit))

// KRÓTKIE WEJŚCIE (SHORT)
if (isInsideBar and close < open)
    // Obliczenie poziomów SL i TP dla SHORT
    shortStopLoss = high                // SL na szczycie świecy wejścia
    shortTakeProfit = low - (candleRange * 2)  // TP = low - 2x rozpiętość świecy
    
    // Wejście w pozycję SHORT
    strategy.entry("InsBarSE", strategy.short, comment="InsBarSE")
    
    // Ustawienie Stop Loss i Take Profit dla SHORT
    strategy.exit("InsBarSE Exit", "InsBarSE", 
         stop=shortStopLoss, 
         limit=shortTakeProfit,
         comment="SL: " + str.tostring(shortStopLoss) + " TP: " + str.tostring(shortTakeProfit))

// Wizualizacja na wykresie
plot(series=isInsideBar ? high : na, title="Inside Bar High", color=color.blue, linewidth=1)
plot(series=isInsideBar ? low : na, title="Inside Bar Low", color=color.blue, linewidth=1)

// Podświetlanie świec Inside Bar
bgcolor(color=isInsideBar ? color.new(color.blue, 90) : na, title="Inside Bar Background")
