// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © mustafrslan

//@version=5
indicator("BIST Expansion Hunter", overlay=true, max_labels_count=500)

// ATR
atr = ta.atr(14)
atrAvg = ta.sma(atr, 30)

// Volatilite sıkışması (gevşetildi)
volatilityContract = atr < atrAvg * 0.95

// Expansion (gevşetildi)
expansion = atr > atrAvg * 1.15

// Volume
volAvg = ta.sma(volume, 30)
volumeSpike = volume > volAvg * 1.2

// Breakout level
highestLevel = ta.highest(high, 15)
breakout = close > highestLevel[1]

// Trend filtresi (çok önemli)
ema50 = ta.ema(close, 50)
trendOK = close > ema50

// Final signal
signal =
     expansion and
     volumeSpike and
     breakout and
     trendOK

// Cooldown
var int lastSignal = na
cooldown = 10

validSignal =
     signal and
     (na(lastSignal) or bar_index - lastSignal > cooldown)

if validSignal
    lastSignal := bar_index
    label.new(bar_index, low,
     "EXPANSION",
     style=label.style_triangleup,
     color=color.lime,
     textcolor=color.black,
     size=size.large)

plot(ema50, color=color.orange, linewidth=2)
