// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © averagejoe_1919

//@version=5
indicator("VIX High/Low Zones Pro", overlay=false)

// INPUTS
// Display Settings
showZones = input.bool(true, "Show Background Zones", group="Display")
showLevels = input.bool(true, "Show Key Levels", group="Display")
showMA = input.bool(true, "Show VIX Moving Average", group="Display")

// VIX Smoothing
smoothingLength = input.int(10, "VIX Smoothing Length", minval=1, maxval=20, 
     tooltip="Apply smoothing to VIX data (1 = no smoothing)", group="VIX Settings")
smoothingType = input.string("SMA", "Smoothing Type", 
     options=["SMA", "EMA", "WMA"], group="VIX Settings")

// Moving Average
maLength = input.int(50, "MA Length", minval=1, group="Display")

// VIX Symbol Input
vixSymbol = input.string("VIX", "VIX Symbol", 
     options=["VIX", "VXN"],
     group="VIX Settings")

// FETCH AND SMOOTH VIX DATA
vixRaw = request.security(vixSymbol, timeframe.period, close, gaps=barmerge.gaps_off)

// Apply smoothing to VIX
vix = smoothingLength == 1 ? vixRaw :
     smoothingType == "EMA" ? ta.ema(vixRaw, smoothingLength) :
     smoothingType == "WMA" ? ta.wma(vixRaw, smoothingLength) :
     ta.sma(vixRaw, smoothingLength)

// CALCULATIONS
vixMA = ta.sma(vix, maLength)

// Momentum detection
vixRising = vix > vix[1]
vixFalling = vix < vix[1]

// KEY VIX LEVELS
level_16 = 16.0
level_18 = 18.0
level_20 = 20.0
level_22 = 22.0
level_25 = 25.0
level_28 = 28.0

// COLORS
calm_color = color.new(color.green, 85)
//moderate_color = color.new(color.yellow, 93)
//elevated_color = color.new(color.orange, 93)
fear_color = color.new(color.red, 85)
//extreme_color = color.new(color.maroon, 88)

// PLOTTING
// Main VIX line with dynamic coloring
vixColor = vix < 16 ? color.new(color.lime, 0) : 
           vix < 18 ? color.new(color.green, 0) :
           vix < 25 ? color.new(color.orange, 0) :
           vix < 32 ? color.new(color.red, 0) : 
           color.new(color.maroon, 0)

plot(vix, title="VIX", color=vixColor, linewidth=2)
plot(showMA ? vixMA : na, title="VIX MA", color=color.new(color.blue, 30), linewidth=1)

// BACKGROUND ZONES
//bgcolor(showZones and vix < 16 ? calm_color : na, 
     //title="Multi-Year Lows (<16)")
//bgcolor(showZones and vix >= 16 and vix < 18 ? moderate_color : na, 
     //title="Calm Territory (16-18)")
//bgcolor(showZones and vix >= 18 and vix < 25 ? elevated_color : na, 
     //title="Elevated (18-25)")
//bgcolor(showZones and vix >= 25 and vix < 32 ? fear_color : na, 
     //title="Fear Zone (25-32)")
//bgcolor(showZones and vix >= 32 ? extreme_color : na, 
     //title="Extreme Fear (32+)")

// Crossover Detection
vixCrossAbove = vix > vixMA
vixCrossBelow = vix < vixMA
bgcolor(vixCrossAbove ? fear_color : na, title="Short")
bgcolor(vixCrossBelow ? calm_color : na, title="Long")

// KEY HORIZONTAL LEVELS
hline(showLevels ? level_16 : na, "16", 
     color=color.new(color.green, 40), linestyle=hline.style_dashed, linewidth=1)
hline(showLevels ? level_18 : na, "18", 
     color=color.new(color.yellow, 20), linestyle=hline.style_solid, linewidth=1)
hline(showLevels ? level_20 : na, "20", 
     color=color.new(color.orange, 60), linestyle=hline.style_dotted)
hline(showLevels ? level_22 : na, "22", 
     color=color.new(color.orange, 60), linestyle=hline.style_dotted)
hline(showLevels ? level_25 : na, "25", 
     color=color.new(color.red, 50), linestyle=hline.style_dashed)
hline(showLevels ? level_28 : na, "28", 
     color=color.new(color.red, 60), linestyle=hline.style_dotted)

// STATUS LABEL
status = vix < 16 ? "CALM" :
         vix >= 16 and vix < 18 ? "CALM" :
         vix >= 18 and vix < 25 ? "ELEVATED" :
         vix >= 25 and vix < 32 ? "FEAR" : "EXTREME"

labelColor = vix < 16 ? color.green :
             vix >= 16 and vix < 18 ? color.new(#4caf4f, 90) :
             vix >= 18 and vix < 25 ? color.new(#ff9800, 90) :
             vix >= 25 and vix < 32 ? color.new(color.red, 90) : 
             color.new(color.maroon, 90)

// Momentum indicator
momentumText = vixRising ? "↑" : vixFalling ? "↓" : "→"

// var label statusLabel = na
// if barstate.islast
//     label.delete(statusLabel)
//     statusLabel := label.new(
//          bar_index, vix,
//          text="VIX: " + str.tostring(vix, "#.##") + " " + momentumText,
//          style=label.style_label_left,
//          color=labelColor,
//          textcolor=color.white,
//          size=size.normal)
