// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0
//@version=6
indicator("RSI Divergence (Close inside Band) v6", overlay=false)

//──────────────────────────────────────────────────────────────────────────────
// Inputs
rsiLen   = input.int(14, "RSI Length", minval=1)

lvlLow   = input.float(20, "Level Low",  minval=0, maxval=100)
lvlMid   = input.float(50, "Level Mid",  minval=0, maxval=100)
lvlHigh  = input.float(80, "Level High", minval=0, maxval=100)

showBand = input.bool(true, "Show High/Low Band")

colClose = input.color(color.aqua,  "RSI Close Color")
colBand  = input.color(color.white, "Band Color")

wClose   = input.int(1, "RSI Close Width", minval=1, maxval=5)
wBand    = input.int(1, "Band Width", minval=1, maxval=5)

//──────────────────────────────────────────────────────────────────────────────
// RSI calculations
rsiClose = ta.rsi(close, rsiLen)
rsiHigh  = ta.rsi(high,  rsiLen)
rsiLow   = ta.rsi(low,   rsiLen)

// Band that ALWAYS contains RSI Close
rsiUpper = math.max(rsiHigh, math.max(rsiLow, rsiClose))
rsiLower = math.min(rsiHigh, math.min(rsiLow, rsiClose))

//──────────────────────────────────────────────────────────────────────────────
// Levels
hline(lvlLow,  "Low",  color=color.gray, linestyle=hline.style_dotted)
hline(lvlMid,  "Mid",  color=color.gray, linestyle=hline.style_dotted)
hline(lvlHigh, "High", color=color.gray, linestyle=hline.style_dotted)

//──────────────────────────────────────────────────────────────────────────────
// Plots
plot(rsiClose, title="RSI Close", color=colClose, linewidth=wClose)
plot(showBand ? rsiUpper : na, title="RSI Upper", color=colBand, linewidth=wBand)
plot(showBand ? rsiLower : na, title="RSI Lower", color=colBand, linewidth=wBand)
