//@version=5
strategy(  "Momentum Concepts | Baseline Strategy ",  overlay=false , pyramiding=0,  initial_capital=1000 ,default_qty_type=strategy.cash,default_qty_value=1000, commission_type=strategy.commission.percent, commission_value=0.01,  slippage=2 ,process_orders_on_close=true)

//━━━━━━━━━━━━━━━━━━━
// DATE FILTER
//━━━━━━━━━━━━━━━━━━━
startYear  = input.int(2023, "Start Year")
startMonth = input.int(6,   "Start Month")
startDay   = input.int(16,    "Start Day")

startDate  = timestamp(startYear, startMonth, startDay, 00, 00)
dateFilter = time >= startDate

//━━━━━━━━━━━━━━━━━━━
// SESSION FILTER
//━━━━━━━━━━━━━━━━━━━
tradeSession  = input.session("0000-0000", "Trading Session")
inSession     = not na(time(timeframe.period, tradeSession))
sessionStart  = inSession and not inSession[1]

//━━━━━━━━━━━━━━━━━━━
// INPUTS
//━━━━━━━━━━━━━━━━━━━
src     = input.source(close, "Source")
fastLen = input.int(9, "Fast Oscillator Length")

useBarClose = input.bool(true, "Trade on Bar Close Only")
confirm     = useBarClose ? barstate.isconfirmed : true

//━━━━━━━━━━━━━━━━━━━
// FAST OSCILLATOR
//━━━━━━━━━━━━━━━━━━━
fastRSI  = ta.rsi(src, fastLen)
fastWave = ta.ema(fastRSI - 50, 3)

//━━━━━━━━━━━━━━━━━━━
// BASELINE
//━━━━━━━━━━━━━━━━━━━
baseline = 0.0

//━━━━━━━━━━━━━━━━━━━
// TRADE ALLOWED
//━━━━━━━━━━━━━━━━━━━
tradeAllowed = dateFilter and inSession and confirm

//━━━━━━━━━━━━━━━━━━━
// CONDITIONS (STATE BASED)
//━━━━━━━━━━━━━━━━━━━
aboveBase = fastWave > baseline
belowBase = fastWave < baseline

// Session start entry
buyAtSessionStart  = sessionStart and aboveBase and dateFilter
sellAtSessionStart = sessionStart and belowBase and dateFilter

// Normal continuation
buyCond  = tradeAllowed and aboveBase and strategy.position_size <= 0
sellCond = tradeAllowed and belowBase and strategy.position_size >= 0

//━━━━━━━━━━━━━━━━━━━
// EXECUTION
//━━━━━━━━━━━━━━━━━━━
if buyAtSessionStart or buyCond
    strategy.entry("BUY", strategy.long)

if sellAtSessionStart or sellCond
    strategy.entry("SELL", strategy.short)

//━━━━━━━━━━━━━━━━━━━
// PLOTS
//━━━━━━━━━━━━━━━━━━━
plot(fastWave, title="Fast Oscillator", color=color.aqua, linewidth=2)
hline(0, "Baseline", color=color.gray)

plotshape(buyAtSessionStart,  title="Buy @ Session Start",  style=shape.circle, location=location.bottom, color=color.lime, size=size.small)
plotshape(sellAtSessionStart, title="Sell @ Session Start", style=shape.circle, location=location.top,   color=color.red,  size=size.small)
