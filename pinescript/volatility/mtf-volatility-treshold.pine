//@version=6
indicator("Vol Number Top Right - MTF Matching", overlay=true)

vol_tf      = input.timeframe("1", "Vol Timeframe (e.g. 1, 5, 15, D)")
length      = input.int(10, "Vol Length")   // â† changed to 10 to match
low_thresh  = input.float(15, "Low Vol Threshold (%)")
high_thresh = input.float(30, "High Vol Threshold (%)")

low_color   = input.color(color.green,  "Low Color")
mid_color   = input.color(color.yellow, "Mid Color")
high_color  = input.color(color.red,    "High Color")

vol_expr() => ta.stdev(math.log(close/close[1]), length) * math.sqrt(365) * 100

float vol = na
if timeframe.in_seconds(vol_tf) <= timeframe.in_seconds()
    arr = request.security_lower_tf(syminfo.tickerid, vol_tf, vol_expr())
    vol := array.size(arr) > 0 ? array.last(arr) : na
else
    vol := request.security(syminfo.tickerid, vol_tf, vol_expr())

var tbl = table.new(position.top_right, 1, 2, bgcolor=color.new(color.black, 70), frame_color=color.new(color.black, 100), frame_width=0)

if barstate.islast
    table.cell(tbl, 0, 0, "", bgcolor=color.new(color.black, 100), text_color=color.new(color.black, 100))
    col = vol < low_thresh ? low_color : vol > high_thresh ? high_color : mid_color
    table.cell(tbl, 0, 1, na(vol) ? "n/a" : str.tostring(vol, "#.##") + "%", text_color=col, text_size=size.normal)
