// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © BigGuavaTrading
//@version=5

// 1. STANDARDIZATION: Name [ST]
indicator("Hidden Relative Strength [ST]", shorttitle="HRS [ST]", overlay=false, precision=2)

// 2. VERSION CONTROL
string ver_num  = "v6.4"
string ver_date = "2026-02-09"

// ==========================================
// 1. INPUTS
// ==========================================
grp_calc = "Calculation Settings"
grp_vis  = "Visual Settings"

// Benchmark Symbol (Default QQQ for SMB Style)
sym_bench = input.symbol("NASDAQ:QQQ", "Benchmark Symbol", group=grp_calc, display=display.data_window)

// ATR Length (Default 5 for SMB Style)
len_atr   = input.int(5, "ATR Period", minval=1, group=grp_calc, tooltip="SMB uses 5 for faster reaction.", display=display.data_window)

// Calculation Mode
calc_type = input.string("Simple (SMA)", "ATR Type", options=["Simple (SMA)", "Smoothed (RMA)"], group=grp_calc, tooltip="SMB uses Simple (SMA).", display=display.data_window)

// Signal Line
show_sig  = input.bool(false, "Show Signal Line?", group=grp_vis, display=display.data_window)
len_sig   = input.int(20, "Signal MA Period", minval=1, group=grp_vis, display=display.data_window)

// ==========================================
// 2. CALCULATIONS
// ==========================================

// --- A. CURRENT ASSET (The Stock) ---
// Calculate local volatility components
float vol_sma_sym = ta.sma(ta.tr, len_atr)
float vol_rma_sym = ta.rma(ta.tr, len_atr) // standard ATR

// Select local volatility
float vol_sym = calc_type == "Simple (SMA)" ? vol_sma_sym : vol_rma_sym

float chg_sym = close - close[1]
// Normalize: (Change / Volatility)
float norm_move_sym = nz(chg_sym / vol_sym)


// --- B. BENCHMARK (QQQ/SPY) ---
// Request all potential data at once to avoid conditional errors
[b_close, b_vol_sma, b_vol_rma] = request.security(sym_bench, timeframe.period, [close, ta.sma(ta.tr, len_atr), ta.rma(ta.tr, len_atr)])

// Select benchmark volatility AFTER the request
float b_vol = calc_type == "Simple (SMA)" ? b_vol_sma : b_vol_rma

float chg_bench = b_close - b_close[1]
// Normalize
float norm_move_bench = nz(chg_bench / b_vol)


// --- C. HIDDEN RELATIVE STRENGTH MATH ---
// Formula: Stock Normalized Move MINUS Market Normalized Move
float raw_rs = norm_move_sym - norm_move_bench

// Accumulate (The Line)
// FIXED MULTIPLIER (10x) applied internally for better Y-Axis scaling
float rs_line = ta.cum(raw_rs) * 10.0

// Signal
float rs_sig  = ta.sma(rs_line, len_sig)

// ==========================================
// 3. PLOTTING
// ==========================================
// Color Logic: Dark Blue (Royal Blue)
color col_rs = #2962ff 

plot(rs_line, "Hidden RS Line", color=col_rs, linewidth=2, display=display.pane + display.data_window)
plot(show_sig ? rs_sig : na, "Signal MA", color=color.gray, style=plot.style_line, display=display.pane + display.data_window)

// ==========================================
// 4. ALERTS
// ==========================================
alertcondition(ta.crossover(rs_line, rs_sig), "RS Breakout", "Hidden RS Line broke above Signal MA")
