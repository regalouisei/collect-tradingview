// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © ZulSyirah

//@version=5
indicator("Distance From ATH (%)", overlay=true)

// === SETTINGS ===
boxPosition = position.top_right   // change if needed

// === ALL TIME HIGH ===
ath = ta.highest(high, bar_index + 1)

// === CURRENT PRICE ===
currentPrice = close

// === PERCENT DIFFERENCE ===
percentFromATH = ((currentPrice - ath) / ath) * 100

// === TABLE (CORNER BOX) ===
var table athTable = table.new(boxPosition, 1, 3, border_width = 1)

// Color logic
bgColor = percentFromATH >= -5 ? color.new(color.green, 80) :
          percentFromATH >= -15 ? color.new(color.orange, 80) :
          color.new(color.red, 80)

// === UPDATE TABLE ===
if barstate.islast
    table.cell(athTable, 0, 0, "ATH Price: " + str.tostring(ath, format.mintick))
    table.cell(athTable, 0, 1, "Current: " + str.tostring(currentPrice, format.mintick))
    table.cell(athTable, 0, 2, "From ATH: " + str.tostring(percentFromATH, "#.##") + "%", bgcolor = bgColor)
