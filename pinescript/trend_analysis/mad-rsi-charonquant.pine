// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © CharonQuant

//@version=6
indicator("MAD RSI ~ CharonQuant")

//RSI
int   rsi_len = input.int(16, "RSI Length", group = "RSI")
src   = input.source(low, "RSI Source",   group = "RSI")
rsi   = ta.rsi(src, rsi_len)

//MAD
int mad_len = input.int(25, "MAD Length", group = "Mean Absolute Deviation")
float mean_rsi = ta.sma(rsi, mad_len)
float abs_dev  = math.abs(rsi - mean_rsi)
float mad      = ta.sma(abs_dev, mad_len) 

float upper    = rsi + mad
float lower    = rsi - mad

//Conditions
LongCondition = lower>50
ShortCondition = upper<50

var int CharonQuant = 0
if LongCondition and not ShortCondition
    CharonQuant := 1
if ShortCondition
    CharonQuant := -1

//Plots
color BULL = #D4A017
color BEAR = #6B2A3A
rsiColor = CharonQuant == 1 ? BULL : CharonQuant == -1 ? BEAR : color.gray
plot(rsi, 
     title="MAD RSI", 
     color=rsiColor, 
     linewidth=2)
plot(upper, 
     title="Upper Deviation", 
     color=color.new(BEAR, 40), 
     linewidth=1)
plot(lower, 
     title="Lower Deviation", 
     color=color.new(BULL, 40), 
     linewidth=1)
hline(50, "Midline 50", color=color.gray, linestyle=hline.style_dashed)
bgcolor(CharonQuant == 1 ? color.new(BULL, 90) :
       CharonQuant == -1 ? color.new(BEAR, 90) : na)
       
plotcandle(
     open, high, low, close,
     title="Candles",
     color=rsiColor,
     wickcolor=rsiColor,
     bordercolor=rsiColor,
     force_overlay=true
)
