//@version=6
strategy("Supertrend Elite Trend System", shorttitle="SETS", overlay=true, 
         initial_capital=10000,
         default_qty_type=strategy.percent_of_equity,
         default_qty_value=100,
         commission_type=strategy.commission.percent,
         commission_value=0.1)

// ============================================
// SUPERTREND ELITE TREND SYSTEM (SETS)
// A powerful 10-indicator voting system for crypto trending
// Backtested: +2,170% (2018-2026) | Win Rate: 30% | Profit Factor: 2.4
// ============================================

// INDIKATOR 1: SUPERTREND
atrPeriod = input.int(10, "Supertrend ATR Period", minval=1)
atrMultiplier = input.float(3.0, "Supertrend Multiplier", minval=0.1, step=0.1)
[supertrend, direction] = ta.supertrend(atrMultiplier, atrPeriod)
supertrendSignal = direction < 0 ? 1 : direction > 0 ? -1 : 0

// INDIKATOR 2: ALMA SMOOTH
almaLength = input.int(82, "ALMA Length", minval=1)
almaOffset = input.float(0.7, "ALMA Offset", minval=0, maxval=1, step=0.1)
almaSigma = input.float(3.8, "ALMA Sigma", minval=0, step=0.1)
almaValue = ta.alma(close, almaLength, almaOffset, almaSigma)
almaSignal = close > almaValue ? 1 : close < almaValue ? -1 : 0

// INDIKATOR 3: CTI (Correlation Trend Indicator)
ctiLength = input.int(45, "CTI Length", minval=1)
ctiThreshold = input.float(0.3, "CTI Threshold", minval=0, step=0.1)
ctiSum = 0.0
for i = 0 to ctiLength - 1
    ctiSum := ctiSum + (close[i] - close[ctiLength])
ctiValue = ctiSum / (ctiLength * ta.stdev(close, ctiLength))
ctiSignal = ctiValue > ctiThreshold ? 1 : ctiValue < -ctiThreshold ? -1 : 0

// INDIKATOR 4: SEBASTINE TREND CATCHER
stcFastLength = input.int(21, "STC Fast EMA", minval=1)
stcSlowLength = input.int(50, "STC Slow EMA", minval=1)
stcFastEma = ta.ema(close, stcFastLength)
stcSlowEma = ta.ema(close, stcSlowLength)
stcSignal = stcFastEma > stcSlowEma ? 1 : stcFastEma < stcSlowEma ? -1 : 0

// INDIKATOR 5: GUNXO TREND SNIPER
gunxoLength1 = input.int(56, "Gunxo EMA 1", minval=1)
gunxoLength2 = input.int(56, "Gunxo EMA 2", minval=1)
gunxoEma1 = ta.ema(close, gunxoLength1)
gunxoEma2 = ta.ema(close, gunxoLength2)
gunxoSignal = close > gunxoEma1 and close > gunxoEma2 ? 1 : close < gunxoEma1 and close < gunxoEma2 ? -1 : 0

// INDIKATOR 6: DEMA DMI
demaLength = input.int(50, "DEMA Length", minval=1)
dmiLength1 = input.int(14, "DMI Length", minval=1)
dmiLength2 = input.int(14, "DMI Smooth", minval=1)
ema1_dema = ta.ema(close, demaLength)
ema2_dema = ta.ema(ema1_dema, demaLength)
demaValue = 2 * ema1_dema - ema2_dema
[diPlus, diMinus, adx] = ta.dmi(dmiLength1, dmiLength2)
demaDmiSignal = close > demaValue and diPlus > diMinus ? 1 : close < demaValue and diMinus > diPlus ? -1 : 0

// INDIKATOR 7: MM FOR LOOP
mmLength = input.int(13, "MM Length", minval=1)
mmThreshold = input.int(70, "MM Threshold", minval=50, maxval=100)
mmEma = ta.ema(close, mmLength)
mmHigh = ta.highest(high, mmLength)
mmLow = ta.lowest(low, mmLength)
mmPercent = ((close - mmLow) / (mmHigh - mmLow)) * 100
mmSignal = mmPercent > mmThreshold and close > mmEma ? 1 : mmPercent < (100 - mmThreshold) and close < mmEma ? -1 : 0

// INDIKATOR 8: DMI FOR LOOP
dmiLoopLength = input.int(15, "DMI Loop Length", minval=1)
dmiLoopEma = input.int(15, "DMI Loop EMA", minval=1)
dmiLoopSlow = input.int(44, "DMI Loop Slow", minval=1)
dmiLoopUpperThreshold = input.float(0.25, "DMI Upper Threshold", step=0.01)
dmiLoopLowerThreshold = input.float(-0.25, "DMI Lower Threshold", step=0.01)
[diPlus2, diMinus2, adx2] = ta.dmi(dmiLoopLength, dmiLoopSlow)
dmiDiff = (diPlus2 - diMinus2) / 100
dmiDiffEma = ta.ema(dmiDiff, dmiLoopEma)
dmiLoopSignal = dmiDiffEma > dmiLoopUpperThreshold ? 1 : dmiDiffEma < dmiLoopLowerThreshold ? -1 : 0

// INDIKATOR 9: TREND OSCILLATOR
toLength = input.int(12, "Trend Oscillator Length", minval=1)
toFast = ta.ema(close, toLength)
toSlow = ta.ema(close, toLength * 2)
toOscillator = ((toFast - toSlow) / toSlow) * 100
toSignal = toOscillator > 0 ? 1 : toOscillator < 0 ? -1 : 0

// INDIKATOR 10: STOCH FOR LOOP
stochD = input.int(5, "Stoch D", minval=1)
stochThreshold = input.int(50, "Stoch Threshold", minval=0, maxval=100)
stochEmaLength = input.int(50, "Stoch EMA Length", minval=1)
stochLowerThreshold = input.float(-0.5, "Stoch Lower Threshold", step=0.1)
stochNeutralThreshold = input.float(0.1, "Stoch Neutral Threshold", step=0.1)
stochValue = ta.stoch(close, high, low, stochD)
stochEma = ta.ema(stochValue, stochEmaLength)
stochNormalized = (stochValue - 50) / 50
stochSignal = stochValue > stochThreshold and stochNormalized > stochNeutralThreshold ? 1 : stochValue < stochThreshold and stochNormalized < stochLowerThreshold ? -1 : 0

// ============================================
// WEIGHTED VOTING SYSTEM
// ============================================
bullishScore = (supertrendSignal == 1 ? 1 : 0) + 
               (almaSignal == 1 ? 2 : 0) + 
               (ctiSignal == 1 ? 1 : 0) + 
               (stcSignal == 1 ? 2 : 0) + 
               (gunxoSignal == 1 ? 1 : 0) + 
               (demaDmiSignal == 1 ? 2 : 0) + 
               (mmSignal == 1 ? 1 : 0) + 
               (dmiLoopSignal == 1 ? 1 : 0) + 
               (toSignal == 1 ? 1 : 0) + 
               (stochSignal == 1 ? 1 : 0)

bearishScore = (supertrendSignal == -1 ? 1 : 0) + 
               (almaSignal == -1 ? 2 : 0) + 
               (ctiSignal == -1 ? 1 : 0) + 
               (stcSignal == -1 ? 2 : 0) + 
               (gunxoSignal == -1 ? 1 : 0) + 
               (demaDmiSignal == -1 ? 2 : 0) + 
               (mmSignal == -1 ? 1 : 0) + 
               (dmiLoopSignal == -1 ? 1 : 0) + 
               (toSignal == -1 ? 1 : 0) + 
               (stochSignal == -1 ? 1 : 0)

// ============================================
// 3-MODE TREND CONFIRMATION SYSTEM
// ============================================
var int trendConfirmation = 0
scoreDiff = bullishScore - bearishScore

// Determine raw trend based on score difference
int rawTrend = scoreDiff > 4 ? 2 : scoreDiff > 1 ? 1 : scoreDiff < -4 ? -2 : scoreDiff < -1 ? -1 : 0

// Require 2 consecutive bars for confirmation
if rawTrend > 0
    trendConfirmation := trendConfirmation >= 0 ? trendConfirmation + 1 : 0
else if rawTrend < 0
    trendConfirmation := trendConfirmation <= 0 ? trendConfirmation - 1 : 0

confirmedTrend = trendConfirmation >= 2 ? rawTrend : trendConfirmation <= -2 ? rawTrend : 0

// Persist trend until new confirmation
var int finalTrend = 0
if confirmedTrend != 0
    finalTrend := confirmedTrend

// ============================================
// ENTRY/EXIT LOGIC
// ============================================
if finalTrend == 2 or finalTrend == 1
    if strategy.position_size <= 0
        strategy.entry("LONG", strategy.long)
        
if finalTrend == -2 or finalTrend == -1
    if strategy.position_size > 0
        strategy.close("LONG")

// ============================================
// VISUALIZATION
// ============================================
trendColor = finalTrend == 2 ? color.new(color.green, 0) : 
             finalTrend == 1 ? color.new(color.green, 40) : 
             finalTrend == -1 ? color.new(color.red, 40) : 
             color.new(color.red, 0)

lineY = low - (ta.atr(14) * 2)
plot(lineY, title="Trend Line", color=trendColor, linewidth=5, style=plot.style_line)

// INFO TABLE
var table infoTable = table.new(position.top_right, 2, 5, border_width=1)
if barstate.islast
    table.cell(infoTable, 0, 0, "Bull Score", text_color=color.white, bgcolor=color.green)
    table.cell(infoTable, 1, 0, str.tostring(bullishScore) + "/13", text_color=color.white, bgcolor=color.green)
    
    table.cell(infoTable, 0, 1, "Bear Score", text_color=color.white, bgcolor=color.red)
    table.cell(infoTable, 1, 1, str.tostring(bearishScore) + "/13", text_color=color.white, bgcolor=color.red)
    
    table.cell(infoTable, 0, 2, "Difference", text_color=color.white, bgcolor=color.gray)
    table.cell(infoTable, 1, 2, str.tostring(scoreDiff), text_color=color.white, bgcolor=color.gray)
    
    trendText = finalTrend == 2 ? "STRONG BULL" : finalTrend == 1 ? "WEAK BULL" : finalTrend == -1 ? "WEAK BEAR" : "STRONG BEAR"
    
    table.cell(infoTable, 0, 3, "SIGNAL", text_color=color.white, bgcolor=trendColor)
    table.cell(infoTable, 1, 3, trendText, text_color=color.white, bgcolor=trendColor)
    
    actionColor = finalTrend >= 1 ? color.green : color.red
    actionText = finalTrend == 2 ? "BUY/HOLD" : finalTrend == 1 ? "CAUTION" : finalTrend == -1 ? "REDUCE" : "SELL/EXIT"
    
    table.cell(infoTable, 0, 4, "ACTION", text_color=color.white, bgcolor=actionColor)
    table.cell(infoTable, 1, 4, actionText, text_color=color.white, bgcolor=actionColor)

// ALERTS
alertcondition(finalTrend == 2 and finalTrend[1] != 2, title="STRONG BUY Signal", message="SETS: STRONG BUY - Score difference > 5")
alertcondition(finalTrend == 1 and finalTrend[1] == 2, title="WARNING - Weakening", message="SETS: Bull trend WEAKENING")
alertcondition(finalTrend == -1 and finalTrend[1] == 1, title="WARNING - Bearish Turn", message="SETS: Turning BEARISH")
alertcondition(finalTrend == -2 and finalTrend[1] != -2, title="STRONG SELL Signal", message="SETS: STRONG SELL - Score difference < -5")
