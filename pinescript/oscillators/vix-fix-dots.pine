// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© ecowolfrb

//@version=5
indicator(title='Vix FIX dots', overlay=true)

///////////// Stochastic Slow
Stochlength = input.int(14, minval=1, title='lookback length of Stochastic')
StochOverBought = input(80, title='Stochastic overbought condition')
StochOverSold = input(20, title='Stochastic oversold condition')
smoothK = input(3, title='smoothing of Stochastic %K ')
smoothD = input(3, title='moving average of Stochastic %K')
k = ta.sma(ta.stoch(close, high, low, Stochlength), smoothK)
d = ta.sma(k, smoothD)

///////////// RSI
RSIlength = input.int(14, minval=1, title='lookback length of RSI')
RSIOverBought = input(70, title='RSI overbought condition')
RSIOverSold = input(30, title='RSI oversold condition')
RSIprice = close
vrsi = ta.rsi(RSIprice, RSIlength)

///////////// Double strategy: RSI strategy + Stochastic strategy
pd = input(22, title='LookBack Period Standard Deviation High')
bbl = input(20, title='Bolinger Band Length')
mult2 = input.float(2.0, minval=1, maxval=5, title='Bollinger Band Standard Devaition Up')
lb = input(50, title='Look Back Period Percentile High')
ph = input(0.85, title='Highest Percentile - 0.90=90%, 0.95=95%, 0.99=99%')
new = input(false, title='-------Text Plots Below Use Original Criteria-------')
sbc = input(false, title='Show Text Plot if WVF WAS True and IS Now False')
sbcc = input(false, title='Show Text Plot if WVF IS True')
new2 = input(false, title='-------Text Plots Below Use FILTERED Criteria-------')
sbcFilt = input(true, title='Show Text Plot For Filtered Entry')
sbcAggr = input(true, title='Show Text Plot For AGGRESSIVE Filtered Entry')
show_exit_Aggr = input.bool(true, title='Show Text Plot For AGGRESSIVE Exit')
ltLB = input.int(40, minval=25, maxval=99, title='Long-Term Look Back Current Bar Has To Close Below This Value OR Medium Term--Default=40')
mtLB = input.int(14, minval=10, maxval=20, title='Medium-Term Look Back Current Bar Has To Close Below This Value OR Long Term--Default=14')
str = input.int(3, minval=1, maxval=9, title='Entry Price Action Strength--Close > X Bars Back---Default=3')
aggr_candle_lookback = input.int(4, title='Aggressive Candle Lookback (3-6)', minval=3, maxval=6, step=1, group='Aggressive Signal Settings')

// Williams Vix Fix Formula
wvf = (ta.highest(close, pd) - low) / ta.highest(close, pd) * 100
sDev = mult2 * ta.stdev(wvf, bbl)
midLine = ta.sma(wvf, bbl)
lowerBand = midLine - sDev
upperBand = midLine + sDev
rangeHigh = ta.highest(wvf, lb) * ph
rangeLow = ta.lowest(wvf, lb) * (2 - ph)

// Filtered Bar Criteria
upRange = low > low[1] and close > high[1]
downrange = high < high[1] and close < high[1]
upRange_Aggr = close > close[1] and close > open[1]
downRange_Aggr = close < close[1] and close < open[1]

// Filtered Criteria
filtered = (wvf[1] >= upperBand[1] or wvf[1] >= rangeHigh[1]) and wvf < upperBand and wvf < rangeHigh
filtered_Aggr = (wvf[1] >= upperBand[1] or wvf[1] >= rangeHigh[1]) and not(wvf < upperBand and wvf < rangeHigh)
filtered_exit = (wvf[1] <= lowerBand[1] or wvf[1] <= rangeLow[1]) and wvf > lowerBand and wvf > rangeLow
filtered_Aggr_exit = (wvf[1] <= lowerBand[1] or wvf[1] <= rangeLow[1]) and not(wvf > lowerBand and wvf > rangeLow)

// Alerts Criteria
alert1 = wvf >= upperBand or wvf >= rangeHigh ? 1 : 0
alert2 = (wvf[1] >= upperBand[1] or wvf[1] >= rangeHigh[1]) and wvf < upperBand and wvf < rangeHigh ? 1 : 0
alert3 = upRange and close > close[str] and (close < close[ltLB] or close < close[mtLB]) and filtered ? 1 : 0
alert4 = upRange_Aggr and close > close[str] and (close < close[ltLB] or close < close[mtLB]) and filtered_Aggr ? 1 : 0
alert5 = downrange and close < close[str] and (close > close[ltLB] or close > close[mtLB]) and filtered_exit ? 1 : 0
alert6 = downRange_Aggr and close < close[str] and (close > close[ltLB] or close > close[mtLB]) and filtered_Aggr_exit ? 1 : 0

// Coloring Criteria of Williams Vix Fix
col = wvf >= upperBand or wvf >= rangeHigh ? color.lime : color.gray

isOverBought = ta.crossover(k, d) and k > StochOverBought ? 1 : 0
isOverBoughtv2 = k > StochOverBought ? 1 : 0
filteredAlert = alert3 ? 1 : 0
aggressiveAlert = alert4 ? 1 : 0
Filteredexitalert = alert5 ? 1 : 0
aggressiveExitAlert = alert6 ? 1 : 0

// Candle Range Calculations
a = high - low
b = a / 3
c = low + b - a
da = low + b + b
e = high - b + a

// Aggressive Candle Conditions
aggr_bullish_candle = close > ta.highest(high[1], aggr_candle_lookback)
aggr_bearish_candle = close < ta.lowest(low[1], aggr_candle_lookback)

// Entry and Exit Conditions
enterLong = filteredAlert and close > c  // Filtered entry with original candle condition
enterLong_Aggr = aggressiveAlert and aggr_bullish_candle  // Aggressive entry with multi-candle condition
exitLong = downrange and close < close[str] and filtered_exit and close < close[1] and (close > close[ltLB] or close > close[mtLB])  // Filtered exit unchanged
exitLong_Aggr = downRange_Aggr and close < close[str] and filtered_Aggr_exit and close < close[1] and (close > close[ltLB] or close > close[mtLB]) and aggr_bearish_candle  // Aggressive exit with multi-candle condition

// Plotting
plotshape(enterLong, title='Filtered Enter Long', style=shape.circle, location=location.belowbar, color=color.new(#00ff00, 30), size=size.small)
plotshape(exitLong, title='Filtered Exit Long', style=shape.circle, location=location.abovebar, color=color.new(#ff0000, 30), size=size.small)
plotshape(enterLong_Aggr and sbcAggr, title='Aggressive Enter Long', style=shape.circle, location=location.belowbar, color=color.new(#0000FF, 30), size=size.small)
plotshape(exitLong_Aggr and show_exit_Aggr, title='Aggressive Exit Long', style=shape.circle, location=location.abovebar, color=color.new(#f58b01, 30), size=size.small)

// Alerts
alertcondition(enterLong, title='Filtered Enter Long', message='Filtered Enter Long {{ticker}}')
alertcondition(exitLong, title='Filtered Exit Long', message='Filtered Exit Long {{ticker}}')
alertcondition(enterLong_Aggr, title='Aggressive Enter Long', message='Aggressive Enter Long {{ticker}}')
alertcondition(exitLong_Aggr, title='Aggressive Exit Long', message='Aggressive Exit Long {{ticker}}')
