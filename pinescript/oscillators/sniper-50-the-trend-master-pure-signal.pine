//@version=5
indicator("Sniper: Pure EMA 50 Cross", shorttitle="Sniper EMA 50", overlay=true)

// --- הגדרות ---
len = input.int(50, title="EMA Length", minval=1)

// --- חישוב ---
emaVal = ta.ema(close, len)

// --- זיהוי חצייה (סגירה מעל/מתחת לקו) ---
crossUp   = ta.crossover(close, emaVal)
crossDown = ta.crossunder(close, emaVal)

// --- ניהול זיכרון (כדי לקבל איתות רק פעם אחת בשינוי מגמה) ---
var int state = 0 // 0=כלום, 1=לונג, -1=שורט

triggerBuy = false
triggerSell = false

// בדיקת לונג (חצה למעלה)
if crossUp
    if state != 1 
        triggerBuy := true
        state := 1

// בדיקת שורט (חצה למטה)
if crossDown
    if state != -1
        triggerSell := true
        state := -1

// --- ויזואליזציה ---

// 1. קו ה-EMA 50 הצבעוני
// ירוק כשהמחיר מעליו, אדום כשהמחיר מתחתיו
emaColor = close > emaVal ? color.new(color.green, 20) : color.new(color.red, 20)
plot(emaVal, title="EMA 50", color=emaColor, linewidth=3)

// 2. איתות BUY (חץ ירוק ותווית)
plotshape(triggerBuy, title="Buy Signal", style=shape.labelup, location=location.belowbar, color=color.green, text="BUY", textcolor=color.white, size=size.small)

// 3. איתות SELL (חץ אדום ותווית)
plotshape(triggerSell, title="Sell Signal", style=shape.labeldown, location=location.abovebar, color=color.red, text="SELL", textcolor=color.white, size=size.small)
