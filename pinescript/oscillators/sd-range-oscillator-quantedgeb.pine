// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© QuantEdgeB
// _____________________________________________________________________________________________
//                                                                                              |
//      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 
//     â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ      â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ       â–ˆâ–ˆ      â–ˆâ–ˆ   â–ˆâ–ˆ    |  
//     â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     |   
//     â–ˆâ–ˆ â–„â–„ â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ  â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ      â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ      â–ˆâ–ˆ   â–ˆâ–ˆ    | 
//      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     |  
//         â–€â–€                                                                                   |
//-----------------------------------------------------------------------------------------------                                                                                            

//@version=6
indicator("SD-Range Oscillator | QuantEdgeB",shorttitle = "SDRO | QB", overlay = false)



//Imports
import TradingView/ta/9

// Design Setup
LABEL   = input.bool(false,"Long/Cash Signal Lable" , group = "Visual | QuantEdgeB")
ColMode = input.string("Alpha", title = "Color Mode", group = "Visual | QuantEdgeB", options = ["Alpha","MultiEdge","TradingSuite", "Premium","Fundamental","Classic","Warm","Cold","Strategy" ])
ColOp = input.int(60,"Color Transperency", group = "Visual | QuantEdgeB",tooltip = "100 = Invisible")
[color_up, color_dn, color_nu] = switch ColMode
    "Alpha"        =>[#00ddff, color.rgb(219, 77, 12),color.gray]
    "MultiEdge"    => [color.rgb(2, 181, 184), color.rgb(185, 1, 202),color.gray]
    "TradingSuite" => [color.rgb(4, 208, 14), color.rgb(211, 248, 3),color.gray]
    "Premium"      => [color.rgb(49, 140, 252), color.rgb(144, 60, 208),color.gray]
    "Fundamental"  => [color.rgb(53, 220, 250), color.rgb(141, 6, 78),color.gray]
    "Warm"         => [#ffbb00, #770737,color.gray]
    "Cold"         => [color.rgb(109, 216, 255), color.rgb(34, 82, 255),color.gray]
    "Classic"      => [#04f7e7, color.rgb(190, 10, 52),color.gray]
    "Strategy"    => [color.rgb(0, 200, 255), color.rgb(122, 3, 3),color.rgb(140, 144, 160)]


// Color Palette
color col_up1     = color_up
color col_up2     = color.new(color_up,ColOp) 
color col_dn1     = color_dn
color col_dn2     = color.new(color_dn,ColOp)
color col_nu1     = color_nu
color col_nu2     = color.new(color_nu,ColOp)

//###############################################################################################################################################################################################################################################//
// Inputs
len_TEMA = input.int(7, "TEMA Period")
base_len = input.int(25, 'Base lenght')
Lu       = input.float(55, 'Long Threshold', step = 0.05)
Su       = input.float(45, 'Short Threshold', step = 0.05)

//###############################################################################################################################################################################################################################################//
// Calculation
// SMMA and TEMA Function
F_SMMA(float src, int len) =>
    float smma = na
    if bar_index >= len - 1
        alpha = 1 / len
        smma := na(smma[1]) ? ta.sma(src, len) : (src - smma[1]) * alpha + smma[1]
        smma
    else
        smma := src
        smma
    smma
F_TEMA(float src, int len) =>
    // Compute the first EMA
    ema1 = ta.ema(src, len)
    // Compute the second EMA
    ema2 = ta.ema(ema1, len)
    // Compute the third EMA
    ema3 = ta.ema(ema2, len)
    // TEMA Calculation
    temaValue = 3 * (ema1 - ema2) + ema3
    temaValue

TEMA     = F_TEMA(close, len_TEMA)
BASE     = F_SMMA(TEMA, base_len)
SD       = ta.stdev(TEMA, base_len) * 2
upperSD  = BASE + SD
lowerSD  = BASE - SD
NormBase = 100 * (TEMA - lowerSD)/(upperSD - lowerSD)

long_TEMA = close > lowerSD
short_TEMA = close < upperSD

//###############################################################################################################################################################################################################################################//
// Final Signal 
Long_C = NormBase > Lu and not short_TEMA
Short_C = NormBase < Su 


var QB = 0

if Long_C and not Short_C
    QB := 1
    QB

if Short_C
    QB := -1
    QB

//###############################################################################################################################################################################################################################################//
// Plots
color = QB == 1 ? color_up : QB == -1 ? color_dn : color_nu
pB = plot(NormBase,color = color)
pL = plot(Lu,color = color_up)
pS = plot(Su,color = color_dn)
plotcandle(open, high, low, close, 'BarColor', color = color, bordercolor = color, wickcolor = color, force_overlay = true)
pB2 = plot(BASE,color = color,linewidth = 2,force_overlay = true)
upperBaseSD = plot(upperSD, title = 'Upper Base SD ', color = color.new(color.white, 70), linewidth = 1,force_overlay = true)
lowerBaseSD = plot(lowerSD, title = 'Lower Base SD', color = color.new(color.white, 70), linewidth = 1,force_overlay = true)

fill(upperBaseSD, pB2, upperSD, BASE,  QB==1 ? col_up2 : QB == -1 ? col_dn2 : #0000004d, na)
fill(lowerBaseSD, pB2, lowerSD, BASE,  QB==-1 ? col_dn2 : QB == 1 ? col_up2 : color.rgb(0, 0, 0, 70), na)

OB1 = plot(100,display = display.none)
OB2 = plot(135,color = color_dn)
OS1 = plot(0,display = display.none)
OS2 = plot(-35,color = color_up)
fill(OB1, OB2, 135, 100,  color.new(color_dn,20) , color.new(color_dn,90))
fill(OS1, OS2, 0, -35,  color.new(color_up,90) , color.new(color_up,20))

fill(pL, pB, NormBase, Lu, QB > 0 ? color : na, na)
fill(pS, pB, Su, NormBase, QB < 0 ? color : na, na)
//###############################################################################################################################################################################################################################################//
// Plot Labels
if QB == -1 and QB[1] == -1 and  QB[2] == 1 and LABEL// Only plot when the signal changes
    label.new(x=bar_index, y= high * 1.08, text= "ð“¢ð“±ð“¸ð“»ð“½" , color=  color_dn, style=  label.style_label_down  ,textcolor=color.white, size=size.tiny)

if QB == 1 and QB[1] == 1 and  QB[2] == -1 and LABEL// Only plot when the signal changes
    label.new(x=bar_index, y= low * 0.9, text= "ð“›ð“¸ð“·ð“°" , color=  color_up, style=  label.style_label_up  ,textcolor=color.white, size=size.tiny)

alertcondition(ta.crossover(QB, 0), title=" Long", message="Long {{exchange}}:{{ticker}}")
alertcondition(ta.crossunder(QB, 0), title=" Short", message=" Short {{exchange}}:{{ticker}}")

//###############################################################################################################################################################################################################################################//
// _____________________________________________________________________________________________
//                                                                                              |
//      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 
//     â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ      â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ       â–ˆâ–ˆ      â–ˆâ–ˆ   â–ˆâ–ˆ    |  
//     â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     |   
//     â–ˆâ–ˆ â–„â–„ â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ  â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ      â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ    â–ˆâ–ˆ â–ˆâ–ˆ      â–ˆâ–ˆ   â–ˆâ–ˆ    | 
//      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     |  
//         â–€â–€                                                                                   |
//-----------------------------------------------------------------------------------------------
