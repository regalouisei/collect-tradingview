//@version=5
indicator("Multi-Indicator Scoring System", overlay=true, max_bars_back=500)

// ========== SETTINGS ==========
showSignals = input.bool(true, "Show Signals", group="Display")

signalStrength = 65  // Higher threshold = fewer signals

// ========== INDICATORS ==========

// RSI
rsi = ta.rsi(close, 14)
rsiScore = rsi < 30 ? 25 : rsi > 70 ? -25 : 0

// MACD
[macdLine, signalLine, histLine] = ta.macd(close, 12, 26, 9)
macdScore = macdLine > signalLine ? 25 : macdLine < signalLine ? -25 : 0

// EMA
ema21 = ta.ema(close, 21)
ema50 = ta.ema(close, 50)
ema200 = ta.ema(close, 200)

emaTrendScore = ema21 > ema50 and close > ema21 ? 25 : ema21 < ema50 and close < ema21 ? -25 : 0
mainTrendScore = close > ema200 ? 15 : close < ema200 ? -15 : 0

// Volume
volumeAvg = ta.sma(volume, 20)
volumeScore = volume > volumeAvg * 1.5 ? 10 : 0

// ========== SCORE CALCULATION ==========

rawScore = rsiScore + macdScore + emaTrendScore + mainTrendScore
if volumeScore > 0
    rawScore := rawScore + volumeScore

finalScore = math.round((rawScore + 100) / 2)

// ========== SIGNALS ==========

buySignal = finalScore >= signalStrength and finalScore[1] < signalStrength
sellSignal = finalScore <= (100 - signalStrength) and finalScore[1] > (100 - signalStrength)

// ========== VISUALIZATION ==========

plotshape(showSignals and buySignal, "BUY", shape.triangleup, location.belowbar, 
          color=color.new(color.lime, 0), size=size.tiny)

plotshape(showSignals and sellSignal, "SELL", shape.triangledown, location.abovebar, 
          color=color.new(color.red, 0), size=size.tiny)

// ========== SCORE DASHBOARD (2X BIGGER) ==========

var table infoTable = table.new(position.top_right, 2, 3, 
                                 bgcolor=color.new(color.black, 20), 
                                 frame_color=color.new(color.gray, 40), 
                                 frame_width=1)

if barstate.islast
    // Header
    table.cell(infoTable, 0, 0, "CRYPTO SIGNAL", 
               text_color=color.white, 
               bgcolor=color.new(color.blue, 40), 
               text_size=size.normal)
    table.merge_cells(infoTable, 0, 0, 1, 0)
    
    // Score Display
    scoreColor = finalScore >= signalStrength ? color.lime : 
                 finalScore <= (100 - signalStrength) ? color.red : 
                 color.orange
    
    table.cell(infoTable, 0, 1, "SCORE", 
               text_color=color.gray, 
               text_size=size.normal)
    table.cell(infoTable, 1, 1, str.tostring(finalScore) + "%", 
               text_color=scoreColor, 
               text_size=size.large)
    
    // Signal Status
    signalText = buySignal ? "BUY" : sellSignal ? "SELL" : "WAIT"
    signalColor = buySignal ? color.lime : sellSignal ? color.red : color.gray
    
    table.cell(infoTable, 0, 2, "SIGNAL", 
               text_color=color.gray, 
               text_size=size.normal)
    table.cell(infoTable, 1, 2, signalText, 
               text_color=signalColor, 
               text_size=size.normal)

// ========== ALERTS ==========

alertcondition(buySignal, title="BUY Signal", message="Buy signal detected - Score crossed above 65%")
alertcondition(sellSignal, title="SELL Signal", message="Sell signal detected - Score crossed below 35%")
