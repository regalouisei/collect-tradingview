//@version=6
indicator(title = 'Relative Strength index 2x', shorttitle = 'RSI*2 by AZly', format = format.price, precision = 2, timeframe = '', timeframe_gaps = true)

ma(source, length, type) =>
    switch type
        'SMA' => ta.sma(source, length)
        'Bollinger Bands' => ta.sma(source, length)
        'EMA' => ta.ema(source, length)
        'SMMA (RMA)' => ta.rma(source, length)
        'WMA' => ta.wma(source, length)
        'VWMA' => ta.vwma(source, length)
        'HMA' => ta.hma(source, length)

// First RSI settings
rsiLengthInput = input.int(13, minval = 1, title = 'RSI Length', group = 'RSI 1 Settings')
rsiSourceInput = input.source(close, 'Source', group = 'RSI Settings')

maTypeInput = input.string('SMA', title = 'MA Type', options = ['SMA', 'EMA', 'SMMA (RMA)', 'WMA', 'VWMA', 'HMA'], group = 'MA Settings', display = display.none)
maLengthInput = input.int(14, title = 'MA Length', group = 'MA Settings')
rsiTimeframe = input.timeframe('', title = 'RSI Timeframe', group = 'RSI Settings')

up = request.security(syminfo.tickerid, rsiTimeframe, ta.rma(math.max(ta.change(rsiSourceInput), 0), rsiLengthInput))
down = request.security(syminfo.tickerid, rsiTimeframe, ta.rma(-math.min(ta.change(rsiSourceInput), 0), rsiLengthInput))
rsi = down == 0 ? 100 : up == 0 ? 0 : 100 - 100 / (1 + up / down)
rsiMA = request.security(syminfo.tickerid, rsiTimeframe, ma(rsi, maLengthInput, maTypeInput))
isBB = maTypeInput == 'Bollinger Bands'



rsiUpperBand = hline(60, 'RSI Upper Band', linestyle = hline.style_dotted, color = color.rgb(255, 0, 0, 60), display = display.none)
line1 = hline(80, 'RSI Max line', linestyle = hline.style_dotted, color = color.rgb(50, 100, 255), linewidth = 1)
midline = hline(50, 'RSI Middle Band', linestyle = hline.style_dashed, color = color.rgb(95, 95, 100), linewidth = 1)
rsiLowerBand = hline(40, 'RSI Lower Band', linestyle = hline.style_dotted, color = color.rgb(50, 100, 255, 60), display = display.none)
line2 = hline(20, 'RSI Bottom line', linestyle = hline.style_dotted, color = color.rgb(255, 0, 0), linewidth = 1)
line3 = hline(70, 'RSI mid high line', color = #000000, linestyle = hline.style_dashed, linewidth = 1)
line4 = hline(30, 'RSI mid low line', color = #000000, linestyle = hline.style_dashed, linewidth = 1)
line5 = hline(90, 'RSI max high line', linestyle = hline.style_dotted, color = color.rgb(0, 0, 0), linewidth = 1, display = display.none)
line6 = hline(10, 'RSI max high line', linestyle = hline.style_dotted, color = color.rgb(0, 0, 0), linewidth = 1, display = display.none)
line7 = hline(95, 'RSI max high line', linestyle = hline.style_dotted, color = #ff0000, linewidth = 1)
line8 = hline(5, 'RSI max high line', linestyle = hline.style_dotted, color = color.rgb(30, 180, 20), linewidth = 1)
fill(rsiUpperBand, rsiLowerBand, color = color.rgb(175, 175, 180, 85), title = 'RSI Background Fill')
fill(line1, line3, color = color.rgb(255, 0, 0, 90), title = 'Overbought Zone')
fill(line2, line4, color = color.rgb(39, 201, 14, 90), title = 'Oversold Zone')
fill(line5, line7, color = color.rgb(255, 180, 0, 95), title = 'Extreme Zone')
fill(line6, line8, color = color.rgb(0, 242, 255, 95), title = 'Extreme Zone')




// Second RSI settings
rsiLengthInput2 = input.int(2, minval = 1, title = 'RSI Length 2', group = 'RSI 2 Settings')
rsiSourceInput2 = input.source(close, 'Source 2', group = 'RSI 2 Settings')
maTypeInput2 = input.string('HMA', title = 'MA Type 2', options = ['SMA', 'EMA', 'SMMA (RMA)', 'WMA', 'VWMA', 'HMA'], group = 'MA 2 Settings')
maLengthInput2 = input.int(14, title = 'MA Length 2', group = 'MA 2 Settings')
rsiTimeframe2 = input.timeframe('', title = 'RSI Timeframe 2', group = 'RSI 2 Settings')

up2 = request.security(syminfo.tickerid, rsiTimeframe2, ta.rma(math.max(ta.change(rsiSourceInput2), 0), rsiLengthInput2))
down2 = request.security(syminfo.tickerid, rsiTimeframe2, ta.rma(-math.min(ta.change(rsiSourceInput2), 0), rsiLengthInput2))
rsi2 = down2 == 0 ? 100 : up2 == 0 ? 0 : 100 - 100 / (1 + up2 / down2)
rsiMA2 = request.security(syminfo.tickerid, rsiTimeframe2, ma(rsi2, maLengthInput2, maTypeInput2))




//RSI PLOTS COLORS

/// RSI 1

rsiColor = rsi > 50 ? #0249fc : color.rgb(255, 0, 0)
rsiPlot = plot(rsi, color = rsiColor, linewidth = 1, title = 'RSI')
rsiMAColor = color.rgb(255, 150, 0)
rsiMAPlot = plot(rsiMA, color = rsiMAColor, linewidth = 1, title = 'RSI1 MA', display = display.none)

midLinePlot = plot(50, color = na, editable = false, display = display.none)
fill(rsiPlot, midLinePlot, 100, 60, top_color =color.rgb(75, 175, 80), bottom_color = color.rgb(40, 233, 14, 100), title = 'Overbought Gradient Fill', fillgaps=true)
fill(rsiPlot, midLinePlot, 40, 0, top_color = color.rgb(255, 153, 0, 100), bottom_color =  color.rgb(255, 82, 82), title = 'Oversold Gradient Fill', fillgaps=true)


//RSI 2

rsiColor2 = color.rgb(0, 0, 0, 90)
rsiPlot2 = plot(rsi2, color = rsiColor2, linewidth = 1, title = 'RSI 2')
fill(rsiPlot2, midLinePlot, 100, 85, top_color = color.rgb(10, 240, 210, 50), bottom_color = color.rgb(10, 240, 210, 100), title = 'Overbought Gradient Fill 2', fillgaps=true)
fill(rsiPlot2, midLinePlot, 15, 0, top_color = color.rgb (255, 0, 190, 100), bottom_color =  color.rgb(255, 0, 190, 50), title = 'Oversold Gradient Fill 2', fillgaps=true)



rsiMA2Plot = plot(rsiMA2, color = color.rgb(0, 0, 0, 95), linewidth = 1, title = 'RSI2 MA', display = display.none)
