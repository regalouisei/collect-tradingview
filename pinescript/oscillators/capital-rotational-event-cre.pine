//@version=6
indicator("Capital Rotational Event (CRE)", overlay=false)

// ───────────────────────────
// INPUTS
// ───────────────────────────
pairSymbol = input.symbol("SPY", "Asset #1 (lead)")
pairSymbol2 = input.symbol("GLD", "Asset #2 (rotate into)")

lenRS = input.int(14, "RS Length")
lenMom = input.int(9, "Momentum Length")

// ───────────────────────────
// PRICE SERIES
// ───────────────────────────
p1 = request.security(pairSymbol, timeframe.period, close)
p2 = request.security(pairSymbol2, timeframe.period, close)

// ───────────────────────────
// RELATIVE STRENGTH
// ───────────────────────────
rsLine = ta.sma(p2 / p1, lenRS) * 100

plot(rsLine, title="Relative Strength (p2/p1)", color=color.blue, linewidth=2)
hline(50, "Neutral RS", color=color.gray)

// ───────────────────────────
// MOMENTUM OF RS
// ───────────────────────────
momRS = ta.sma(ta.change(rsLine), lenMom)

plot(momRS, title="RS Momentum", color=color.orange)

// ───────────────────────────
// ROTATIONAL SIGNAL
// ───────────────────────────
int creSignal = na

// define bullish rotation
bull = rsLine > ta.sma(rsLine, lenRS) and momRS > 0
// define bearish rotation
bear = rsLine < ta.sma(rsLine, lenRS) and momRS < 0

creSignal := bull ? 1 : bear ? -1 : 0

// ───────────────────────────
// PLOT CRE SIGNAL
// ───────────────────────────
plotshape(creSignal == 1, style=shape.triangleup, location=location.bottom, color=color.green, size=size.small, title="CRE Bullish")
plotshape(creSignal == -1, style=shape.triangledown, location=location.top, color=color.red, size=size.small, title="CRE Bearish")

// ───────────────────────────
// COLOR BACKGROUND
// ───────────────────────────
bgColor = (
     creSignal == 1 ? color.new(color.green, 85) :
     creSignal == -1 ? color.new(color.red, 85) :
     na
)
