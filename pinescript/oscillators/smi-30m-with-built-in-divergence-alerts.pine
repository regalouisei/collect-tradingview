//@version=6
indicator("SMI (1 TF)", "SMI 30m", timeframe = "30", timeframe_gaps = true)

// Inputs
lengthK   = input.int(13, "%K Length",  minval = 1, maxval = 15000)
lengthD   = input.int(3,  "%D Length",  minval = 1, maxval = 4999)
lengthEMA = input.int(3,  "EMA Length", minval = 1, maxval = 4999)

// Functions
emaEma(source, length) => ta.ema(ta.ema(source, length), length)

// SMI calc
highestHigh         = ta.highest(lengthK)
lowestLow           = ta.lowest(lengthK)
highestLowestRange  = highestHigh - lowestLow
relativeRange       = close - (highestHigh + lowestLow) / 2
smi                 = 200 * (emaEma(relativeRange, lengthD) / emaEma(highestLowestRange, lengthD))
smiEma              = ta.ema(smi, lengthEMA)

// Plots (blue & orange exposed)
smiPlot    = plot(smi,    "SMI Blue",   color = color.blue)
smiEmaPlot = plot(smiEma, "SMI Orange", color = color.orange)

// Levels and fills
overbought = hline(40,  "Overbought Line")
oversold   = hline(-40, "Oversold Line")
fill(overbought, oversold, color = color.new(color.blue, 90))
hline(0, "Middle Line", color = color.new(color.gray, 50))

midLinePlot = plot(0, color = na, editable = false, display = display.none)
fill(smiPlot, midLinePlot, 120,  40,   top_color = color.new(#4caf4f, 50),    bottom_color = color.new(color.green, 100), title = "Overbought Gradient Fill")
fill(smiPlot, midLinePlot, -40, -120,  top_color = color.new(color.red, 100), bottom_color = color.new(color.red, 50),    title = "Oversold Gradient Fill")

// ─────────────────────────────────────────────
//  ALERTS
// ─────────────────────────────────────────────

// Bearish divergence: blue crosses below orange AND overbought area
bearCrossOver60 = ta.crossunder(smi, smiEma) and smi > 60
alertcondition(bearCrossOver60, title   = "SMI Bearish Cross", message = "SMI Bearish Cross xxx 30min.")

// Bullish divergence: blue crosses above orange AND oversold area
bullCrossUnderNeg60 = ta.crossover(smi, smiEma) and smi < -60
alertcondition(bullCrossUnderNeg60, title   = "SMI Bullish Cross", message = "SMI Bullish Cross xxx 30min.")
