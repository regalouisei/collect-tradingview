//@version=5
indicator("Multi-Timeframe RSI Table (Movable)", overlay = true)

// === Inputs ===
rsiLength = input.int(14, title="RSI Length")

// Timeframe Inputs
tf0 = input.timeframe("5", title="TF0 (5m)")
tf1 = input.timeframe("15", title="TF1 (15m)")
tf2 = input.timeframe("60", title="TF2 (1h)")
tf3 = input.timeframe("240", title="TF3 (4h)")
tf4 = input.timeframe("D", title="TF4 (Daily)")
tf5 = input.timeframe("W", title="TF5 (Weekly)")
tf6 = input.timeframe("M", title="TF6 (Monthly)")

// Labels
label0 = tf0
label1 = tf1
label2 = tf2
label3 = tf3
label4 = tf4
label5 = tf5
label6 = tf6

// === Table Position Selector ===
tablePos = input.string("Top Right", title="Table Position", options=["Top Left", "Top Right", "Bottom Left", "Bottom Right"])
pos = tablePos == "Top Left" ? position.top_left :
      tablePos == "Top Right" ? position.top_right :
      tablePos == "Bottom Left" ? position.bottom_left :
      position.bottom_right

// === Function to fetch RSI from a given timeframe ===
getRSI(tf) =>
    r = request.security(syminfo.tickerid, tf, ta.rsi(close, rsiLength))
    c = r > 60 ? color.green : r < 40 ? color.red : color.yellow
    [r, c]

// === Create Table ===
var table rsiTable = table.new(pos, 7, 2, border_width=1)

// === Create Header Row Once ===
if bar_index == 1
    table.cell(rsiTable, 0, 0, label0, text_color=color.white, bgcolor=color.gray)
    table.cell(rsiTable, 1, 0, label1, text_color=color.white, bgcolor=color.gray)
    table.cell(rsiTable, 2, 0, label2, text_color=color.white, bgcolor=color.gray)
    table.cell(rsiTable, 3, 0, label3, text_color=color.white, bgcolor=color.gray)
    table.cell(rsiTable, 4, 0, label4, text_color=color.white, bgcolor=color.gray)
    table.cell(rsiTable, 5, 0, label5, text_color=color.white, bgcolor=color.gray)
    table.cell(rsiTable, 6, 0, label6, text_color=color.white, bgcolor=color.gray)

// === Get RSI values and fill table ===
[r0, c0] = getRSI(tf0)
[r1, c1] = getRSI(tf1)
[r2, c2] = getRSI(tf2)
[r3, c3] = getRSI(tf3)
[r4, c4] = getRSI(tf4)
[r5, c5] = getRSI(tf5)
[r6, c6] = getRSI(tf6)

table.cell(rsiTable, 0, 1, str.tostring(r0, format.mintick), bgcolor=c0, text_color=color.black)
table.cell(rsiTable, 1, 1, str.tostring(r1, format.mintick), bgcolor=c1, text_color=color.black)
table.cell(rsiTable, 2, 1, str.tostring(r2, format.mintick), bgcolor=c2, text_color=color.black)
table.cell(rsiTable, 3, 1, str.tostring(r3, format.mintick), bgcolor=c3, text_color=color.black)
table.cell(rsiTable, 4, 1, str.tostring(r4, format.mintick), bgcolor=c4, text_color=color.black)
table.cell(rsiTable, 5, 1, str.tostring(r5, format.mintick), bgcolor=c5, text_color=color.black)
table.cell(rsiTable, 6, 1, str.tostring(r6, format.mintick), bgcolor=c6, text_color=color.black)