//@version=6
indicator(
    "RSI Exhaustion Gate (Visual Flip)", 
    shorttitle="RSI Exhaustion Flip", 
    overlay=false, 
    max_lines_count=500, 
    max_labels_count=500
)

// ─────────────────────────────
// INPUTS
// ─────────────────────────────
rsiLen  = input.int(14, "RSI Length")
src     = input.source(close, "Source")

shortOB = input.float(70.0, "Short Exhaustion (Overbought)")
longOS  = input.float(30.0, "Long Exhaustion (Oversold)")

showLevels = input.bool(true, "Show RSI Levels")
showDots   = input.bool(true, "Show Exhaustion Dots")

colorShort = input.color(color.red, "Short Exhaustion Dot Color")
colorLong  = input.color(color.lime, "Long Exhaustion Dot Color")

// ─────────────────────────────
// RSI
// ─────────────────────────────
rsi = ta.rsi(src, rsiLen)

// ─────────────────────────────
// EXHAUSTION LOGIC (BOOL SAFE)
// ─────────────────────────────
shortExhaust = rsi >= shortOB
longExhaust  = rsi <= longOS

shortTrigger = shortExhaust and not shortExhaust[1]
longTrigger  = longExhaust  and not longExhaust[1]

// ─────────────────────────────
// RSI PLOT
// ─────────────────────────────
plot(rsi, title="RSI", color=color.blue, linewidth=2)

// ─────────────────────────────
// LEVELS
// ─────────────────────────────
hline(
    shortOB,
    "Overbought",
    color = showLevels ? color.new(color.red, 60) : na
)
hline(
    50,
    "Midline",
    color = showLevels ? color.new(color.gray, 70) : na
)
hline(
    longOS,
    "Oversold",
    color = showLevels ? color.new(color.green, 60) : na
)

// ─────────────────────────────
// VISUALLY FLIPPED EXHAUSTION DOTS
// ─────────────────────────────
plot(
    showDots and shortTrigger ? shortOB : na,
    title="SELL Exhaustion",
    style=plot.style_circles,
    linewidth=4,
    color=colorShort
)

plot(
    showDots and longTrigger ? longOS : na,
    title="BUY Exhaustion",
    style=plot.style_circles,
    linewidth=4,
    color=colorLong
)

// ─────────────────────────────
// ALERTS
// ─────────────────────────────
alertcondition(shortTrigger, "RSI Short Exhaustion", "RSI hit overbought — short exhaustion")
alertcondition(longTrigger,  "RSI Long Exhaustion",  "RSI hit oversold — long exhaustion")
