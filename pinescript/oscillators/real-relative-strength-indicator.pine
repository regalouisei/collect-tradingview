// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © EMA34TRADER
//@version=5
indicator("Real Relative Strength Indicator", shorttitle="Trinity RRS", overlay=false, scale=scale.right)

// ── INPUTS WITH HINTS (hover over each setting in TradingView to read the tooltip) ──
comp = input.symbol(
     "SPY", 
     "Benchmark Symbol", 
     tooltip="Stocks → SPY or QQQ\nSmall-caps → IWM\nCrypto → BTCUSD or ETHUSD\nChange this to match the asset class you are trading!")

len = input.int(
     14, "Length (Momentum Period)", minval=5, maxval=50,
     tooltip="How many bars to measure momentum over\n• Daily/4H swing trading: 14–20\n• Intraday 15m–1H: 10–14\n• Weekly/monthly: 8–13\nLonger = smoother, slower signals")

mult = input.float(
     1.0, "ATR Multiplier", step=0.1, minval=0.5, maxval=3.0,
     tooltip="Adjust sensitivity to volatility\n• 1.0 = standard (recommended)\n• >1.0 = more sensitive (more signals)\n• <1.0 = calmer (fewer signals)")

showArrows = input.bool(
     true, "Show Zero-Cross Arrows",
     tooltip="Greenish-aqua triangle = fresh outperformance\nPurple triangle = fresh underperformance\nVery high-probability early signals")

showLine = input.bool(
     true, "Show Thin RRS Line on Top of Area",
     tooltip="Uncheck if you want pure clean area only\nKeep checked to see exact RRS value at all times")

// ── Core calculation (same bulletproof version) ──
benchClose = request.security(comp, timeframe.period, close,  lookahead=barmerge.lookahead_off, gaps=barmerge.gaps_off)
benchATR   = request.security(comp, timeframe.period, ta.atr(len), lookahead=barmerge.lookahead_off, gaps=barmerge.gaps_off)
myATR      = ta.atr(len)

atrAvg = math.avg(myATR, nz(benchATR, myATR)) * mult
atrAvg := nz(atrAvg, myATR)
atrAvg := atrAvg <= 0 ? myATR : atrAvg

myMom    = close - close[len]
benchMom = benchClose - benchClose[len]
rrs      = (myMom - benchMom) / atrAvg
rrsMA    = ta.ema(rrs, 3)
rrsPlot  = math.max(math.min(rrsMA, 20), -20)

// ── Colors ──
bullColor = color.new(#00FFFF, 50)   // Aqua 50%
bearColor = color.new(#CC00FF, 50)   // Purple 50%

// ── Area fill (positive = aqua, negative = purple) ──
plot(rrsPlot, "RRS Area", color=rrsPlot >= 0 ? bullColor : bearColor, style=plot.style_area, linewidth=0)

// ── Optional thin line ──
plot(showLine ? rrsPlot : na, "RRS Line", color=#1E90FF, linewidth=1)

// ── Reference lines ──
hline(0,  "Zero Line",      color=color.gray,  linestyle=hline.style_dashed)
hline(2,  "Strong Zone",    color=color.new(#00FFFF, 80), linestyle=hline.style_dotted)
hline(-2, "Weak Zone",      color=color.new(#CC00FF, 80), linestyle=hline.style_dotted)

// Extreme background tint
bgcolor(rrsMA > 4 ? color.new(#00FFFF, 92) : rrsMA < -4 ? color.new(#CC00FF, 92) : na)

// ── Arrows matching area colors ──
bull = ta.crossover(rrsMA, 0) and showArrows
bear = ta.crossunder(rrsMA, 0) and showArrows

plotshape(bull, title="Bullish Cross", location=location.bottom, color=bullColor, style=shape.triangleup,   size=size.small)
plotshape(bear, title="Bearish Cross", location=location.top,    color=bearColor, style=shape.triangledown, size=size.small)

// ── Alerts ──
alertcondition(bull, "RRS Bullish Cross", "Now outperforming the benchmark")
alertcondition(bear, "RRS Bearish Cross", "Now underperforming the benchmark")
