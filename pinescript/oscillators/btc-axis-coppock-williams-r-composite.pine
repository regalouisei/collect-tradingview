// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Rob_Maths

//@version=6
// -----------------------------------------------------------------------------
// SCRIPT: BTC - AXIS: Coppock + Williams %R Composite | RM
// AUTHOR: Rob_Maths
// SHORT:  AXIS | RM
// METHODOLOGY: AXIS (Advanced X-Momentum Intensity Score) is a dual-speed 
//              momentum composite. It anchors a fast oscillator (Williams %R) 
//              to a structural trend engine (Coppock Curve) to identify 
//              precision "Trend-Aligned Dip Buys."
// -----------------------------------------------------------------------------

indicator("BTC - AXIS: Coppock + Williams %R Composite | RM", shorttitle="AXIS | RM", overlay=false, precision=2)

// ==========================================
// 1. INPUTS & CONFIGURATION
// ==========================================
grp_copp = "Coppock Curve (Macro)"
rocLong  = input.int(14, "Long RoC", minval=1, group=grp_copp, tooltip="The long-term Rate of Change lookback. Historically set between 11-14 to capture structural shifts.")
rocShort = input.int(11, "Short RoC", minval=1, group=grp_copp, tooltip="The short-term Rate of Change lookback. Identifies the primary momentum curve.")
wmaLen   = input.int(10, "WMA Smoothing", minval=1, group=grp_copp, tooltip="Smooths out noise to reveal the true momentum direction.")

grp_wr   = "Williams %R (Tactical)"
wrLen    = input.int(14, "Lookback Period", minval=2, group=grp_wr, tooltip="Lookback for the high-low range. Standard is 14; lower is faster.")

grp_comb = "Combination Settings"
wCopp    = input.float(2.0, "Weight: Coppock", step=0.1, group=grp_comb, tooltip="Weight for long-term trend. Higher = slower/smoother.")
wWR      = input.float(1.0, "Weight: Williams %R", step=0.1, group=grp_comb, tooltip="Weight for short-term cycles. Higher = more sensitive.")

grp_vis  = "Visual Settings"
showCopp = input.bool(true,  "Show Coppock Line", group=grp_vis, tooltip="Toggle visibility of the long-term momentum line.")
showWR   = input.bool(true,  "Show Williams %R Line", group=grp_vis, tooltip="Toggle visibility of the short-term oscillator.")
showComb = input.bool(true,  "Show AXIS Composite", group=grp_vis, tooltip="Toggle visibility of the main AXIS signal.")

th_high  = input.float(150.0, "Overheated Threshold", step=10.0, group=grp_vis, tooltip="Upper boundary for market exuberance.")
th_low   = input.float(-150.0, "Capitulation Threshold", step=10.0, group=grp_vis, tooltip="Lower boundary for capitulation zones.")

// ==========================================
// 2. DATA ENGINE
// ==========================================
f_calc_logic() =>
    // A. Coppock Calculation
    _copp = ta.wma(ta.roc(close, rocLong) + ta.roc(close, rocShort), wmaLen)
    
    // B. Williams %R Calculation (Re-centered to 0)
    _hh = ta.highest(high, wrLen)
    _ll = ta.lowest(low, wrLen)
    _range = _hh - _ll
    _raw_wr = (_range == 0) ? 0 : -100 * (_hh - close) / _range
    _centered_wr = _raw_wr + 50 
    
    [_copp, _centered_wr]

// Fetch Daily Values
[d_copp, d_wr] = request.security(syminfo.tickerid, "D", f_calc_logic())

// Calculate Combined Score (AXIS)
axis_score = (d_copp * wCopp) + (d_wr * wWR)

// ==========================================
// 3. PLOTTING & VISUALS
// ==========================================
// Colors
c_copp = color.rgb(37, 99, 235)  // Deep Blue
c_wr   = color.rgb(220, 38, 38)  // Red
c_axis = color.rgb(255, 140, 0)  // Orange
c_bg_g = color.new(color.green, 85)
c_bg_r = color.new(color.red, 85)

// Zero Line (The namesake Axis)
hline(0, "Baseline", color=color.gray, linestyle=hline.style_dotted)

// Plots
plot(d_copp * wCopp, "Weighted Coppock", color=color.new(c_copp, 50), linewidth=1, display = showCopp ? display.all : display.none)
plot(d_wr * wWR,     "Weighted %R",      color=color.new(c_wr, 50),   linewidth=1, display = showWR ? display.all : display.none)
plot(axis_score,     "AXIS Composite",   color=c_axis,                linewidth=2, display = showComb ? display.all : display.none)

// Thresholds
h_top = hline(th_high, "Overheated", color=color.new(c_wr, 50))
h_bot = hline(th_low,  "Capitulation", color=color.new(color.green, 50))

// Background Zones
bg_col = axis_score > th_high ? c_bg_r : axis_score < th_low ? c_bg_g : na
bgcolor(bg_col, title="Regime Shading")

// ==========================================
// 4. STATUS TABLE
// ==========================================
var table info = table.new(position.bottom_right, 2, 2, border_width=1)
if barstate.islast
    regime = axis_score > 0 ? "BULLISH" : "BEARISH"
    reg_col = axis_score > 0 ? color.green : color.red
    
    table.cell(info, 0, 0, "AXIS SCORE", bgcolor=color.gray, text_color=color.white, text_size=size.small)
    table.cell(info, 1, 0, str.tostring(axis_score, "#.1"), bgcolor=color.black, text_color=color.white, text_size=size.small)
    table.cell(info, 0, 1, "REGIME", bgcolor=color.gray, text_color=color.white, text_size=size.small)
    table.cell(info, 1, 1, regime, bgcolor=color.black, text_color=reg_col, text_size=size.small)
