//@version=5
indicator("BTC SOPR Candles - Custom Mid-Line", overlay=false)

// ── Inputs
center = input.float(1.00, "SOPR Center (Middle Line)", step=0.001)
matype = input.string("SMA", "Moving Average Type", options=["SMA", "EMA"])
length = input.int(30, "Moving Average Length", minval=1)

// ── BTC SOPR (standard, all spent outputs)
sopr = request.security("BTC_SOPR", timeframe.period, close)

// ── Moving Average
sopr_ma = matype == "SMA" ? ta.sma(sopr, length) : ta.ema(sopr, length)

// ── Centered oscillator
osc    = sopr - center
osc_ma = sopr_ma - center

// ── Middle line
hline(0, "Center Line", color=color.new(color.white, 60))

// ── Plots (GREEN above center, RED below)
plot(osc, title="BTC SOPR (Centered)", style=plot.style_columns,
     color=(osc >= 0 ? color.green : color.red))

plot(osc_ma, title="BTC SOPR Smoothed", style=plot.style_columns,
     color=(osc_ma >= 0 ? color.green : color.red),
     display=display.none)

// ── Price candle coloring
barcolor(osc >= 0 ? color.green : color.red)
