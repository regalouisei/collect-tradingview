//@version=5
indicator("Diodato LTCO (Original)", shorttitle="LTCO", overlay=false, max_labels_count=500)

// ── Inputs
useUnchData = input.bool(true, "Use Unchanged Issues/Volume?", group="Data Sources")
ltScale     = input.float(5.0, "LTCO Scaling", group="Settings", tooltip="The paper uses a scaling factor of 5 to bring the raw 0-200 value into the ~1000 range.")
showObOsLines = input.bool(true, "Show OB/OS Lines", group="Thresholds")
ltcoObLevel = input.float(762.0, "Overbought Level", group="Thresholds", inline="1")
ltcoOsLevel = input.float(740.0, "Oversold Level", group="Thresholds", inline="1")


// ── Fetch Data
advn = request.security("ADVN", timeframe.period, close)
decn = request.security("DECN", timeframe.period, close)
uvol = request.security("UVOL", timeframe.period, close)
dvol = request.security("DVOL", timeframe.period, close)
uncn = useUnchData ? request.security("UNCH.US", timeframe.period, close) : 0.0
uncv = useUnchData ? request.security("UNCV", timeframe.period, close) : 0.0

// ── Calculation
fAvg5(s) => (ta.sma(s,34) + ta.sma(s,55) + ta.sma(s,89) + ta.sma(s,144) + ta.sma(s,233)) / 5.0
uvA    = fAvg5(uvol)
effVA  = fAvg5(uvol + dvol + (useUnchData ? uncv : 0.0)) - (useUnchData ? fAvg5(uncv) : 0.0)
volBandLT = effVA > 0 ? uvA / effVA : na
advA    = fAvg5(advn)
effIA   = fAvg5(advn + decn + (useUnchData ? uncn : 0.0)) - (useUnchData ? fAvg5(uncn) : 0.0)
brdBandLT = effIA > 0 ? advA / effIA : na
ltco_raw = 100.0 * (volBandLT + brdBandLT)
ltco = ltco_raw * ltScale

// ── Plotting
plot(ltco, "LTCO", color=color.new(color.fuchsia, 0), linewidth=2)
hline(showObOsLines ? ltcoObLevel : na, "Overbought", color=color.new(color.red, 50), linestyle=hline.style_dashed)
hline(showObOsLines ? ltcoOsLevel : na, "Oversold", color=color.new(color.green, 50), linestyle=hline.style_dashed)

bgcolor(ltco >= ltcoObLevel and showObOsLines ? color.new(color.red, 90) : na)
bgcolor(ltco <= ltcoOsLevel and showObOsLines ? color.new(color.green, 90) : na)
