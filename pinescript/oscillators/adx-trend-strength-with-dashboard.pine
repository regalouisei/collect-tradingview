//@version=5
indicator("ADX Trend Strength with Dashboard", "ADX Dashboard", format=format.price, precision=2)

// ============================================
// INPUTS
// ============================================
G_ADX = 'ADX Settings'
adxLength = input.int(14, "ADX Length", minval=1, group=G_ADX)
diLength = input.int(14, "DI Length", minval=1, group=G_ADX)
adxSmoothing = input.int(14, "ADX Smoothing", minval=1, group=G_ADX)

// Visual Settings
G_VISUAL = 'Visual Settings'
showADX = input.bool(true, "Show ADX Line", group=G_VISUAL)
showDI = input.bool(true, "Show +DI / -DI", group=G_VISUAL)
showFill = input.bool(true, "Show DI Fill", group=G_VISUAL)
adxColor = input.color(color.white, "ADX Color", group=G_VISUAL)
plusDIColor = input.color(color.green, "+DI Color", group=G_VISUAL)
minusDIColor = input.color(color.red, "-DI Color", group=G_VISUAL)

// Threshold Levels
G_LEVELS = 'Threshold Levels'
showLevels = input.bool(true, "Show Threshold Lines", group=G_LEVELS)
weakThreshold = input.int(20, "Weak Trend", minval=0, maxval=100, group=G_LEVELS)
strongThreshold = input.int(25, "Strong Trend", minval=0, maxval=100, group=G_LEVELS)
veryStrongThreshold = input.int(40, "Very Strong Trend", minval=0, maxval=100, group=G_LEVELS)
extremeThreshold = input.int(50, "Extreme Trend", minval=0, maxval=100, group=G_LEVELS)

// Table Settings
G_TABLE = 'Dashboard Settings'
showTable = input.bool(true, "Show Dashboard", group=G_TABLE)
tablePosition = input.string("Top Right", "Table Position", 
     options=["Top Left", "Top Center", "Top Right", "Middle Left", "Middle Center", 
              "Middle Right", "Bottom Left", "Bottom Center", "Bottom Right"], 
     group=G_TABLE)
tableSize = input.string("Normal", "Text Size", 
     options=["Tiny", "Small", "Normal", "Large", "Huge"], 
     group=G_TABLE)
tableTransparency = input.int(15, "Table Transparency", minval=0, maxval=100, group=G_TABLE)

// ============================================
// ADX CALCULATIONS
// ============================================
[diPlus, diMinus, adx] = ta.dmi(diLength, adxSmoothing)

// Trend direction
bullishTrend = diPlus > diMinus
bearishTrend = diMinus > diPlus

// Trend strength classification
trendStrength = 
     adx >= extremeThreshold ? "EXTREME" :
     adx >= veryStrongThreshold ? "VERY STRONG" :
     adx >= strongThreshold ? "STRONG" :
     adx >= weakThreshold ? "EMERGING" :
     "WEAK/RANGING"

// Color based on strength
adxZoneColor = 
     adx >= extremeThreshold ? color.new(color.purple, 70) :
     adx >= veryStrongThreshold ? color.new(color.orange, 70) :
     adx >= strongThreshold ? color.new(color.green, 70) :
     adx >= weakThreshold ? color.new(color.yellow, 70) :
     color.new(color.gray, 70)

// ============================================
// PLOTTING
// ============================================

// Threshold levels
hline(showLevels ? weakThreshold : na, "Weak Trend", color=color.new(color.gray, 50), linestyle=hline.style_dotted)
hline(showLevels ? strongThreshold : na, "Strong Trend", color=color.new(color.green, 30), linestyle=hline.style_dashed, linewidth=2)
hline(showLevels ? veryStrongThreshold : na, "Very Strong", color=color.new(color.orange, 30), linestyle=hline.style_dotted)
hline(showLevels ? extremeThreshold : na, "Extreme", color=color.new(color.purple, 30), linestyle=hline.style_dotted)

// ADX Line
plot(showADX ? adx : na, "ADX", color=adxColor, linewidth=2)

// DI Lines
plusDIPlot = plot(showDI ? diPlus : na, "+DI", color=plusDIColor, linewidth=1)
minusDIPlot = plot(showDI ? diMinus : na, "-DI", color=minusDIColor, linewidth=1)

// Fill between DI lines
fill(plusDIPlot, minusDIPlot, 
     color=showFill ? (bullishTrend ? color.new(color.green, 90) : color.new(color.red, 90)) : na,
     title="DI Fill")

// Background color based on ADX strength
bgcolor(adxZoneColor, title="ADX Strength Zone")

// ============================================
// DASHBOARD TABLE
// ============================================

// Helper functions
get_table_position(pos_string) =>
    switch pos_string
        "Top Left" => position.top_left
        "Top Center" => position.top_center
        "Top Right" => position.top_right
        "Middle Left" => position.middle_left
        "Middle Center" => position.middle_center
        "Middle Right" => position.middle_right
        "Bottom Left" => position.bottom_left
        "Bottom Center" => position.bottom_center
        "Bottom Right" => position.bottom_right
        => position.top_right

get_text_size(size_string) =>
    switch size_string
        "Tiny" => size.tiny
        "Small" => size.small
        "Normal" => size.normal
        "Large" => size.large
        "Huge" => size.huge
        => size.normal

var table dashboard = table.new(get_table_position(tablePosition), 2, 9,
     bgcolor=color.new(#000000, tableTransparency), 
     border_width=2, 
     border_color=color.new(color.white, 50))

if showTable and barstate.islast
    text_size = get_text_size(tableSize)
    
    // Header
    table.cell(dashboard, 0, 0, "ADX DASHBOARD", 
         text_color=color.white, text_size=text_size, bgcolor=color.new(#1a1a1a, 0))
    table.cell(dashboard, 1, 0, "", text_color=color.white, text_size=text_size)
    
    // Current ADX Value
    table.cell(dashboard, 0, 1, "ADX Value:", text_color=color.white, text_size=text_size)
    adx_display_color = 
         adx >= strongThreshold ? color.green :
         adx >= weakThreshold ? color.yellow :
         color.red
    table.cell(dashboard, 1, 1, str.tostring(math.round(adx, 2)), 
         text_color=adx_display_color, text_size=text_size)
    
    // Trend Strength
    table.cell(dashboard, 0, 2, "Strength:", text_color=color.white, text_size=text_size)
    strength_color = 
         adx >= extremeThreshold ? color.purple :
         adx >= veryStrongThreshold ? color.orange :
         adx >= strongThreshold ? color.green :
         adx >= weakThreshold ? color.yellow :
         color.gray
    table.cell(dashboard, 1, 2, trendStrength, 
         text_color=strength_color, text_size=text_size)
    
    // Trend Direction
    table.cell(dashboard, 0, 3, "Direction:", text_color=color.white, text_size=text_size)
    trend_direction = bullishTrend ? "BULLISH ↑" : bearishTrend ? "BEARISH ↓" : "NEUTRAL"
    trend_color = bullishTrend ? color.green : bearishTrend ? color.red : color.gray
    table.cell(dashboard, 1, 3, trend_direction, 
         text_color=trend_color, text_size=text_size)
    
    // Separator
    table.cell(dashboard, 0, 4, "───────────", 
         text_color=color.new(color.white, 50), text_size=text_size)
    table.cell(dashboard, 1, 4, "───────────", 
         text_color=color.new(color.white, 50), text_size=text_size)
    
    // Status indicators
    table.cell(dashboard, 0, 5, "Above 25:", text_color=color.white, text_size=text_size)
    above25_text = adx >= 25 ? "✓ YES" : "✗ NO"
    above25_color = adx >= 25 ? color.green : color.red
    table.cell(dashboard, 1, 5, above25_text, 
         text_color=above25_color, text_size=text_size)
    
    table.cell(dashboard, 0, 6, "Below 25:", text_color=color.white, text_size=text_size)
    below25_text = adx < 25 ? "✓ YES" : "✗ NO"
    below25_color = adx < 25 ? color.red : color.gray
    table.cell(dashboard, 1, 6, below25_text, 
         text_color=below25_color, text_size=text_size)
    
    // Trade recommendation
    table.cell(dashboard, 0, 7, "Trade Signal:", text_color=color.white, text_size=text_size)
    trade_signal = 
         adx >= strongThreshold and bullishTrend ? "LONG ✓" :
         adx >= strongThreshold and bearishTrend ? "SHORT ✓" :
         adx >= weakThreshold ? "WAIT ⏸" :
         "NO TREND ✗"
    signal_color = 
         adx >= strongThreshold and bullishTrend ? color.green :
         adx >= strongThreshold and bearishTrend ? color.red :
         adx >= weakThreshold ? color.yellow :
         color.gray
    table.cell(dashboard, 1, 7, trade_signal, 
         text_color=signal_color, text_size=text_size)
    
    // +DI vs -DI
    table.cell(dashboard, 0, 8, "DI Spread:", text_color=color.white, text_size=text_size)
    di_spread = math.abs(diPlus - diMinus)
    spread_strength = di_spread >= 10 ? "STRONG" : di_spread >= 5 ? "MODERATE" : "WEAK"
    spread_color = di_spread >= 10 ? color.green : di_spread >= 5 ? color.yellow : color.gray
    table.cell(dashboard, 1, 8, str.tostring(math.round(di_spread, 1)) + " (" + spread_strength + ")", 
         text_color=spread_color, text_size=text_size)

// ============================================
// ALERTS
// ============================================
alertcondition(ta.crossover(adx, strongThreshold), "ADX Crossed Above 25", "ADX crossed ABOVE 25 - Strong trend forming")
alertcondition(ta.crossunder(adx, strongThreshold), "ADX Crossed Below 25", "ADX crossed BELOW 25 - Trend weakening")
alertcondition(ta.crossover(adx, veryStrongThreshold), "ADX Crossed Above 40", "ADX crossed ABOVE 40 - Very strong trend")
alertcondition(ta.crossover(adx, extremeThreshold), "ADX Crossed Above 50", "ADX crossed ABOVE 50 - EXTREME trend (caution)")

// DI Crossovers
alertcondition(ta.crossover(diPlus, diMinus) and adx >= strongThreshold, "Bullish DI Cross (ADX>25)", "+DI crossed above -DI with strong ADX - BULLISH")
alertcondition(ta.crossunder(diPlus, diMinus) and adx >= strongThreshold, "Bearish DI Cross (ADX>25)", "-DI crossed above +DI with strong ADX - BEARISH")
