// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © AquaTickTrader

//@version=6
//──────────────────────────────────────────────────────────────────────────────
//  [TL5 SMA] SMA-ALMA Momentum System
//──────────────────────────────────────────────────────────────────────────────
//  Author      : AquaTickTrader
//  Version     : 1.2
//  Description :
//      Multi-Moving Average trend framework designed for intraday and swing trading.
//      Combines SMA (8, 20, 50, 77), EMA200, ALMA(30) and RSI momentum bias.
//
//  Core Features:
//      • SMA 8   → Short-term momentum (dynamic multi-condition coloring)
//      • ALMA 30 → Adaptive smoothing trend filter
//      • SMA 20  → Short-term structure reference (hidden by default)
//      • SMA 50  → Medium-term trend reference (hidden by default)
//      • SMA 77  → Higher-timeframe structure reference
//      • EMA 200 → Institutional long-term trend filter
//      • Configurable RSI Background Bias (Simple or Gradient Mode)
//
//──────────────────────────────────────────────────────────────────────────────
//  RSI BACKGROUND LOGIC
//──────────────────────────────────────────────────────────────────────────────
//  • RSI(14) used as market bias engine
//  • User-controlled background mode:
//
//      ▸ Simple Mode (Default - Gradient OFF)
//          - RSI > 50 → Bullish bias (soft green background)
//          - RSI < 50 → Bearish bias (soft red background)
//
//      ▸ Gradient Mode (Toggle ON)
//          - Background intensity scales dynamically with RSI strength
//          - Highlights expansion and capitulation zones
//
//  • Toggle controlled via:
//        show_rsi_gradient_bgcolor (input.bool)
//
//  • Visual enhancement only — no calculation changes
//
//──────────────────────────────────────────────────────────────────────────────
//  CHANGE LOG
//──────────────────────────────────────────────────────────────────────────────
//  Version 1.2:
//  Added user-controlled RSI background toggle allowing switch between
//  simple 50-level bias mode and full gradient heatmap mode. Simplified
//  bgcolor() implementation into a single conditional call. Adjusted
//  bearish gradient transparency levels for smoother scaling.
//  No changes to trading logic or calculations.
//──────────────────────────────────────────────────────────────────────────────

indicator(title="[TL5 SMA] SMA-ALMA Momentum System", overlay=true, timeframe="", timeframe_gaps=true)

// Toggle for RSI gradient background
show_rsi_gradient_bgcolor = input.bool(false, "Enable RSI Gradient Background")

// ==============================================================================
// RSI HEATMAP — MARKET BIAS
// ==============================================================================
rsiLength = 14
rsiValue  = ta.rsi(close, rsiLength)
wmarsi    = ta.wma(rsiValue, 14)

// Gradient heatmap colors
rsiColor =
     rsiValue > 90 ? color.new(color.lime, 10) :
     rsiValue > 80 ? color.new(color.lime, 20) :
     rsiValue > 70 ? color.new(color.lime, 30) :
     rsiValue > 60 ? color.new(color.lime, 70) :
     rsiValue > 55 ? color.new(color.lime, 80) :
     rsiValue < 10 ? color.new(color.red, 20)  :
     rsiValue < 20 ? color.new(color.red, 30) :
     rsiValue < 30 ? color.new(color.red, 40) :
     rsiValue < 40 ? color.new(color.red, 70) :
     rsiValue < 55 ? color.new(color.red, 80) :
                     color.new(color.gray, 0)

// Simple 50-level bias
rsiCol = rsiValue > 50 ? color.new(color.lime, 70) :
         rsiValue < 50 ? color.new(color.red, 70) :
         color.gray

// Apply selected background mode
bgcolor(show_rsi_gradient_bgcolor ? rsiColor : rsiCol)

//──────────────────────────────────────────────────────────────────────────────
// Moving Averages
//──────────────────────────────────────────────────────────────────────────────

// SMA 8 – Short-term momentum
sma8 = ta.sma(close, 8)

// ALMA 30 – Adaptive smoothing filter
alma30 = ta.alma(close, 30, 0.85, 8)

// Plot SMA 8 (dynamic color logic)
plot(
    sma8,
    "SMA 8",
    color =
        sma8 > sma8[1] and sma8 > alma30 and wmarsi > wmarsi[1] ? color.green :
        sma8 < sma8[1] and sma8 < alma30 and wmarsi < wmarsi[1] ? color.red :
        sma8 < sma8[1] and sma8 < alma30 ? color.yellow :
        sma8 > sma8[1] ? color.green :
        sma8 < sma8[1] ? color.red :
        color.gray,
    linewidth = 3
)

// Plot ALMA 30 (momentum adaptive)
plot(
    alma30,
    "ALMA 30",
    color =
        wmarsi > wmarsi[1] and sma8 > alma30 ? color.lime :
        wmarsi < wmarsi[1] and sma8 < alma30 ? color.red :
        sma8 > sma8[1] and sma8 > alma30 ? color.white :
        sma8 < sma8[1] and sma8 < alma30 ? color.yellow :
        color.gray,
    linewidth = 3
)

// SMA 20 – Short-term structure (hidden)
sma20 = ta.sma(close, 20)
plot(sma20, "SMA 20", color=color.blue, linewidth=3, display=display.none)

// SMA 50 – Medium-term trend (hidden)
sma50 = ta.sma(close, 50)
plot(sma50, "SMA 50", color=color.purple, linewidth=3, display=display.none)

// SMA 77 – Long structure reference
sma77 = ta.sma(close, 77)
plot(sma77, "SMA 77", color=color.black, linewidth=3)

// EMA 200 – Institutional long-term filter
ema200 = ta.ema(close, 200)
plot(ema200, "EMA 200", color=color.gray, linewidth=2)
