//@version=6 
indicator("RSI MTF Table - 12 Pairs (1,5,15)", overlay=true)

// === 12 PARİTE GİRİŞİ ===
pair1  = input.symbol("EURUSD", title="Pair 1")
pair2  = input.symbol("GBPUSD", title="Pair 2")
pair3  = input.symbol("XAUUSD", title="Pair 3")
pair4  = input.symbol("USDJPY", title="Pair 4")
pair5  = input.symbol("AUDUSD", title="Pair 5")
pair6  = input.symbol("USDCAD", title="Pair 6")
pair7  = input.symbol("NZDUSD", title="Pair 7")
pair8  = input.symbol("EURGBP", title="Pair 8")
pair9  = input.symbol("EURJPY", title="Pair 9")
pair10 = input.symbol("GBPJPY", title="Pair 10")
pair11 = input.symbol("AUDJPY", title="Pair 11")
pair12 = input.symbol("USDCHF", title="Pair 12")

// === 12 PARİTEYİ ARRAY'E EKLE ===
pairs = array.from(pair1, pair2, pair3, pair4, pair5, pair6, pair7, pair8, pair9, pair10, pair11, pair12)

// === PARAMETRELER ===
len = input.int(14, minval=1, title="Length")
i_posColor = color.lime      // 65+ → YEŞİL
i_negColor = color.red       // 35- → KIRMIZI

// === DOĞRU VE KESİN ÇALIŞAN RSI FONKSİYONU ===
get_rsi(pair, timeframe) =>
    request.security(pair, timeframe, ta.rsi(close, len), barmerge.gaps_off, barmerge.lookahead_on)

// === TABLO ===
var table perfTable = table.new(position.top_right, 4, 13, border_width = 3)

// === ŞEFFAFLIK ===
TRANSP7 = 70
TRANSP89 = 85
TRANSP9 = 90

// === HÜCRE DOLDURMA ===
f_fillCell(_table, _column, _row, _value) =>
    if na(_value)
        table.cell(_table, _column, _row, "—", bgcolor=color.new(color.gray, 90), text_color=color.white, width=6)
    else
        _c_color = _value >= 65 ? i_posColor : _value <= 35 ? i_negColor : color.gray
        _transp = math.abs(_value) >= 80 or math.abs(_value) <= 20 ? TRANSP7 : 
                  (math.abs(_value) < 80 and math.abs(_value) >= 65) or (math.abs(_value) > 20 and math.abs(_value) <= 35) ? TRANSP89 : TRANSP9
        _cellText = str.tostring(_value, "0.00")
        table.cell(_table, _column, _row, _cellText, bgcolor = color.new(_c_color, _transp), text_color = _c_color, width=6)

// === ZAMAN DİLİMLERİ ===
timeframes = array.from("1", "5", "15")

// === TABLO BAŞLIKLARI VE İÇERİK ===
if barstate.islast
    // Zaman dilimleri
    for j = 0 to 2
        tf = array.get(timeframes, j)
        table.cell(perfTable, j+1, 0, tf, bgcolor=color.new(color.gray, 0), text_color=color.white, width=6)

    // Parite isimleri
    for i = 0 to 11
        pair = array.get(pairs, i)
        cleanPair = str.contains(pair, ":") ? array.get(str.split(pair, ":"), 1) : pair
        table.cell(perfTable, 0, i+1, cleanPair, bgcolor=color.new(color.gray, 0), text_color=color.white, width=12)

    // RSI değerleri
    for i = 0 to 11
        for j = 0 to 2
            pair = array.get(pairs, i)
            tf = array.get(timeframes, j)
            rsi_val = get_rsi(pair, tf)
            f_fillCell(perfTable, j+1, i+1, rsi_val)
