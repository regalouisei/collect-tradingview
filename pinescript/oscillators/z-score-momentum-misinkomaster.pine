import TradingView/ta/10
// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © MisinkoMaster

//@version=6
indicator("Z-Score Momentum | MisinkoMaster", "Z-Score Momentum | MisinkoMaster",
     overlay = false)
////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Get User Defined Input
len = input.int(defval = 40, title = "Z-Score Length",
     tooltip = "Changes the length of the Z-Score Momentum.",
     step = 1, minval = 2, group = "Z-Score Momentum | MisinkoMaster")
avgtype = input.string("WMA", title = "Average Type",
     options = ["SMA", "EMA", "WMA", "HMA", "DEMA", "TEMA", "RMA", "ALMA"], 
     group = "Z-Score Momentum | MisinkoMaster",
     tooltip = "Changes the type of average used for the calculation.")
bias = input.bool(defval = true, title = "Use Biased SD?", group = "Z-Score Momentum | MisinkoMaster")
t = input.float(0.1, title = "Treshhold",
     tooltip = "Changes the value that needs to be crossed in order for an Up/Down Trend reversal.
     0 is the recommended value, but encouraged to test out other values :)",
     group = "Z-Score Momentum | MisinkoMaster", step = 0.01)
off = input.float(0.85, title = "ALMA Offset", tooltip = "Changes the offset off the ALMA",
     step = 0.01, minval = 0, group = "ALMA in-use only Settings")
s = input.float(defval = 6.0, title = "ALMA Sigma",
     tooltip = "Changes the Sigma of the ALMA", group = "ALMA in-use only Settings",
     step = 0.5, minval = 0)
plot = input.bool(true, title = "Use Different Plotting?",
     tooltip = "Changes the type of plotting, up to ones preference, no effect on the signals.",
     group = "Plotting")
////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Calculation
//Length
n = math.abs(math.round(len/2))
//Averages
//High
h = switch avgtype
    "SMA" => ta.sma(high, n)
    "EMA" => ta.ema(high, n)
    "WMA" => ta.wma(high, n)
    "HMA" => ta.hma(high, n)
    "DEMA" => ta.dema(high, n)
    "TEMA" => ta.tema(high, n)
    "RMA" => ta.rma(high, n)
    "ALMA" => ta.alma(high, n, off, s)
//Low
l = switch avgtype
    "SMA" => ta.sma(low, n)
    "EMA" => ta.ema(low, n)
    "WMA" => ta.wma(low, n)
    "HMA" => ta.hma(low, n)
    "DEMA" => ta.dema(low, n)
    "TEMA" => ta.tema(low, n)
    "RMA" => ta.rma(low, n)
    "ALMA" => ta.alma(low, n, off, s)
//Slower High
avgh = switch avgtype
    "SMA" => ta.sma(high, len)
    "EMA" => ta.ema(high, len)
    "WMA" => ta.wma(high, len)
    "HMA" => ta.hma(high, len)
    "DEMA" => ta.dema(high, len)
    "TEMA" => ta.tema(high, len)
    "RMA" => ta.rma(high, len)
    "ALMA" => ta.alma(high, len, off, s)
//Slower Low
avgl = switch avgtype
    "SMA" => ta.sma(low, len)
    "EMA" => ta.ema(low, len)
    "WMA" => ta.wma(low, len)
    "HMA" => ta.hma(low, len)
    "DEMA" => ta.dema(low, len)
    "TEMA" => ta.tema(low, len)
    "RMA" => ta.rma(low, len)
    "ALMA" => ta.alma(low, len, off, s)
//Standard Deviation
sdh = ta.stdev(h, len, bias)
sdl = ta.stdev(l, len, bias)
//Z-Score
zh = (h - avgh)/sdh
zl = ((l - avgl)/sdl)*-1
//Final Value => momentum
momentum = zh - zl
////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Trend Logic
var trend = 0

L = ta.crossover(momentum, t)
S = ta.crossunder(momentum, t)

if L and not S
    trend := 1
if S
    trend := -1
////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Plotting
col = color.rgb(0, 255, 255, 100)
colT = color.rgb(0, 255, 255, 100)
if momentum > t
    col := color.rgb(0, 255, 255, 0)
    colT := color.rgb(0, 255, 255, 50)
if momentum < t
    col := color.rgb(255, 0, 255, 0)
    colT := color.rgb(255, 0, 255, 50)
a = plot(momentum, "Z-Score Momentum",color = col, linewidth = 3)
a1 = plot(plot == true ? momentum : na, "Z-Score Momentum",color = col, linewidth = 3, style = plot.style_histogram, display = display.pane)
b = plot(t, color = color.white, display = display.pane)
barcolor(color = col)
fill(a, b, color = colT)
