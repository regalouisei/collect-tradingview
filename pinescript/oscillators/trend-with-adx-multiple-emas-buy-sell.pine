//@version=6
indicator(title="Trend with ADX, multiple EMAs - Buy & Sell", shorttitle="Trend", overlay=true)

// Inputs 
len = input.int(12, title="ADX Length", minval=1)
th = input.float(20, title="Threshold")
len1 = input.int(5, title="FastEMA", minval=1)
len2 = input.int(8, title="SlowEMA", minval=1)

// New EMA Length Inputs
len13 = input.int(13, title="EMA 13 Length", minval=1)
len48 = input.int(48, title="EMA 48 Length", minval=1)
len200 = input.int(200, title="EMA 200 Length", minval=1)

// ADX Calculations
TrueRange = math.max(math.max(high - low, math.abs(high - nz(close[1]))), math.abs(low - nz(close[1])))
DirectionalMovementPlus = high - nz(high[1]) > nz(low[1]) - low ? math.max(high - nz(high[1]), 0) : 0
DirectionalMovementMinus = nz(low[1]) - low > high - nz(high[1]) ? math.max(nz(low[1]) - low, 0) : 0

SmoothedTrueRange = ta.rma(TrueRange, len)
SmoothedDirectionalMovementPlus = ta.rma(DirectionalMovementPlus, len)
SmoothedDirectionalMovementMinus = ta.rma(DirectionalMovementMinus, len)

DIPlus = SmoothedDirectionalMovementPlus / SmoothedTrueRange * 100
DIMinus = SmoothedDirectionalMovementMinus / SmoothedTrueRange * 100
DX = math.abs(DIPlus - DIMinus) / (DIPlus + DIMinus) * 100
ADX = ta.sma(DX, len)

// Background color based on DI comparison
bgcolor(DIPlus > DIMinus ? color.rgb(173, 230, 174) : color.rgb(227, 142, 142))

// Trend signals (ADX based)
trendGreen = DIPlus > DIMinus
trendRed = DIMinus > DIPlus

alertcondition(trendGreen, title="ADX Trend Green Alert", message="ADX Trend Green Alert")
alertcondition(trendRed, title="ADX Trend Red Alert", message="ADX Trend Red Alert")

// EMA calculations
ema1 = ta.ema(close, len1)
ema2 = ta.ema(close, len2)

// New EMA Calculations
ema13 = ta.ema(close, len13)
ema48 = ta.ema(close, len48)
ema200 = ta.ema(close, len200)

plot(ema1, title="FastEMA", color=color.green, linewidth=2)
plot(ema2, title="SlowEMA", color=color.red, linewidth=2)
plot(ema13, title="EMA 13", color=color.new(color.green, 0), linewidth=2)
plot(ema48, title="EMA 48", color=color.new(color.red, 0), linewidth=2)
plot(ema200, title="EMA 200", color=color.new(color.blue, 0), linewidth=2)

// --- VWAP Calculation and Plot ---
vwap = ta.vwap(close)
plot(vwap, title="VWAP", color=color.black, linewidth=2, style=plot.style_circles)

// Buy/Sell conditions (FastEMA vs SlowEMA)
longCond = ta.crossover(ema1, ema2)
shortCond = ta.crossunder(ema1, ema2)

CondIni = 0
CondIni := longCond ? 1 : shortCond ? -1 : CondIni[1]
longCondition = longCond and CondIni[1] == -1
shortCondition = shortCond and CondIni[1] == 1

plotshape(longCondition, title="Buy Signal", text="Buy", textcolor=color.white, style=shape.labelup, size=size.tiny, location=location.belowbar, color=color.new(color.green, 0))
plotshape(shortCondition, title="Sell Signal", text="Sell", textcolor=color.white, style=shape.labeldown, size=size.tiny, location=location.abovebar, color=color.new(color.red, 0))

alertcondition(longCondition, title="Buy Alert", message="Buy Alert")
alertcondition(shortCondition, title="Sell Alert", message="Sell Alert")

// New Trend Buy/Sell Conditions (EMA 13 vs EMA 48)
t_buy_signal = ta.crossover(ema13, ema48)
t_sell_signal = ta.crossunder(ema13, ema48)

plotshape(t_buy_signal, title="Trend Buy Signal", text="TBuy", textcolor=color.white, style=shape.labelup, size=size.small, location=location.belowbar, color=color.new(color.rgb(0, 150, 0), 0)) // Darker green for TBuy
plotshape(t_sell_signal, title="Trend Sell Signal", text="TSell", textcolor=color.white, style=shape.labeldown, size=size.small, location=location.abovebar, color=color.new(color.rgb(150, 0, 0), 0)) // Darker red for TSell

// New Alerts for TBuy/TSell
alertcondition(t_buy_signal, title="TBuy Alert", message="TBuy Signal: EMA 13 crossed above EMA 48")
alertcondition(t_sell_signal, title="TSell Alert", message="TSell Signal: EMA 13 crossed below EMA 48")
