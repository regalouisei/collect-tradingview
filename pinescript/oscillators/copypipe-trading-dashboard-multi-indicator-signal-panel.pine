// This Pine Scriptâ„¢ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© CopyPipe - https://copypipe.io
// 
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
// â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
// â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  
// â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•   â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•  
// â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘        â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
//  â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•        â•šâ•â•   â•šâ•â•     â•šâ•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•
//
// CopyPipe Trading Dashboard v1.0
// Free multi-indicator dashboard for signal traders
// 
// ğŸš€ Automate your TradingView signals â†’ https://copypipe.io
// Connect TradingView alerts to MetaTrader 4/5 automatically!
//
// Features:
// âœ“ RSI with overbought/oversold zones
// âœ“ MACD histogram and signal
// âœ“ Moving average trend detection
// âœ“ Trading session highlights (London, NY, Asia, Sydney)
// âœ“ Daily high/low levels
// âœ“ Signal summary panel
//
// Made with â¤ï¸ by the CopyPipe team

//@version=5
indicator("CopyPipe Trading Dashboard", shorttitle="CopyPipe", overlay=true)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INPUTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Dashboard Settings
grp_dash = "ğŸ“Š Dashboard Settings"
showPanel = input.bool(true, "Show Info Panel", group=grp_dash)
panelPosition = input.string("Top Right", "Panel Position", options=["Top Right", "Top Left", "Bottom Right", "Bottom Left"], group=grp_dash)
panelSize = input.string("Normal", "Panel Size", options=["Small", "Normal", "Large"], group=grp_dash)

// RSI Settings
grp_rsi = "ğŸ“ˆ RSI Settings"
showRSI = input.bool(true, "Show RSI in Panel", group=grp_rsi)
rsiLength = input.int(14, "RSI Length", minval=1, group=grp_rsi)
rsiOverbought = input.int(70, "Overbought Level", group=grp_rsi)
rsiOversold = input.int(30, "Oversold Level", group=grp_rsi)

// MACD Settings
grp_macd = "ğŸ“‰ MACD Settings"
showMACD = input.bool(true, "Show MACD in Panel", group=grp_macd)
macdFast = input.int(12, "Fast Length", group=grp_macd)
macdSlow = input.int(26, "Slow Length", group=grp_macd)
macdSignal = input.int(9, "Signal Length", group=grp_macd)

// Moving Average Settings
grp_ma = "ğŸ“ Moving Averages"
showMAs = input.bool(true, "Show Moving Averages", group=grp_ma)
maFastLen = input.int(20, "Fast MA Length", group=grp_ma)
maSlowLen = input.int(50, "Slow MA Length", group=grp_ma)
maType = input.string("EMA", "MA Type", options=["SMA", "EMA"], group=grp_ma)

// Session Settings
grp_sess = "ğŸŒ Trading Sessions"
showSessions = input.bool(true, "Highlight Sessions", group=grp_sess)
showLondon = input.bool(true, "London (08:00-16:00 GMT)", group=grp_sess)
showNY = input.bool(true, "New York (13:00-21:00 GMT)", group=grp_sess)
showAsia = input.bool(true, "Asia (00:00-09:00 GMT)", group=grp_sess)
showSydney = input.bool(false, "Sydney (21:00-06:00 GMT)", group=grp_sess)

// Level Settings
grp_levels = "ğŸ“ Key Levels"
showDailyHL = input.bool(true, "Show Daily High/Low", group=grp_levels)
showPrevClose = input.bool(true, "Show Previous Close", group=grp_levels)

// Colors
grp_colors = "ğŸ¨ Colors"
bullColor = input.color(color.new(#26a69a, 0), "Bullish Color", group=grp_colors)
bearColor = input.color(color.new(#ef5350, 0), "Bearish Color", group=grp_colors)
neutralColor = input.color(color.new(#808080, 0), "Neutral Color", group=grp_colors)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// RSI
rsiValue = ta.rsi(close, rsiLength)
rsiCondition = rsiValue > rsiOverbought ? "OVERBOUGHT" : rsiValue < rsiOversold ? "OVERSOLD" : "NEUTRAL"
rsiColor = rsiValue > rsiOverbought ? bearColor : rsiValue < rsiOversold ? bullColor : neutralColor

// MACD
[macdLine, signalLine, histLine] = ta.macd(close, macdFast, macdSlow, macdSignal)
macdCondition = macdLine > signalLine ? "BULLISH" : "BEARISH"
macdColor = macdLine > signalLine ? bullColor : bearColor

// Moving Averages
maFast = maType == "EMA" ? ta.ema(close, maFastLen) : ta.sma(close, maFastLen)
maSlow = maType == "EMA" ? ta.ema(close, maSlowLen) : ta.sma(close, maSlowLen)
maTrend = maFast > maSlow ? "UPTREND" : "DOWNTREND"
maColor = maFast > maSlow ? bullColor : bearColor

// Daily Levels
dailyHigh = request.security(syminfo.tickerid, "D", high[1], lookahead=barmerge.lookahead_on)
dailyLow = request.security(syminfo.tickerid, "D", low[1], lookahead=barmerge.lookahead_on)
prevClose = request.security(syminfo.tickerid, "D", close[1], lookahead=barmerge.lookahead_on)

// Session Detection (GMT based)
utcHour = hour(time, "GMT")
isLondon = utcHour >= 8 and utcHour < 16
isNY = utcHour >= 13 and utcHour < 21
isAsia = utcHour >= 0 and utcHour < 9
isSydney = utcHour >= 21 or utcHour < 6

// Overall Signal
bullishSignals = 0
bearishSignals = 0

bullishSignals := bullishSignals + (rsiValue < rsiOversold ? 1 : 0)
bullishSignals := bullishSignals + (macdLine > signalLine ? 1 : 0)
bullishSignals := bullishSignals + (maFast > maSlow ? 1 : 0)

bearishSignals := bearishSignals + (rsiValue > rsiOverbought ? 1 : 0)
bearishSignals := bearishSignals + (macdLine < signalLine ? 1 : 0)
bearishSignals := bearishSignals + (maFast < maSlow ? 1 : 0)

overallSignal = bullishSignals > bearishSignals ? "BULLISH" : bearishSignals > bullishSignals ? "BEARISH" : "NEUTRAL"
overallColor = bullishSignals > bearishSignals ? bullColor : bearishSignals > bullishSignals ? bearColor : neutralColor

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLOTTING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Moving Averages
plot(showMAs ? maFast : na, "Fast MA", color=color.new(#2962FF, 0), linewidth=2)
plot(showMAs ? maSlow : na, "Slow MA", color=color.new(#FF6D00, 0), linewidth=2)

// Daily Levels
plot(showDailyHL ? dailyHigh : na, "Daily High", color=color.new(bearColor, 50), style=plot.style_linebr, linewidth=1)
plot(showDailyHL ? dailyLow : na, "Daily Low", color=color.new(bullColor, 50), style=plot.style_linebr, linewidth=1)
plot(showPrevClose ? prevClose : na, "Prev Close", color=color.new(neutralColor, 50), style=plot.style_linebr, linewidth=1)

// Session Backgrounds
londonBg = showSessions and showLondon and isLondon ? color.new(#1E88E5, 93) : na
nyBg = showSessions and showNY and isNY ? color.new(#43A047, 93) : na
asiaBg = showSessions and showAsia and isAsia ? color.new(#E53935, 93) : na
sydneyBg = showSessions and showSydney and isSydney ? color.new(#8E24AA, 93) : na

bgcolor(londonBg, title="London Session")
bgcolor(nyBg, title="NY Session")
bgcolor(asiaBg, title="Asia Session")
bgcolor(sydneyBg, title="Sydney Session")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INFO PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if showPanel
    // Panel positioning
    var tablePos = panelPosition == "Top Right" ? position.top_right : panelPosition == "Top Left" ? position.top_left : panelPosition == "Bottom Right" ? position.bottom_right : position.bottom_left
    var textSize = panelSize == "Small" ? size.small : panelSize == "Large" ? size.large : size.normal
    
    var table infoPanel = table.new(tablePos, 2, 10, bgcolor=color.new(#1e293b, 10), border_width=1, border_color=color.new(#334155, 0), frame_width=2, frame_color=color.new(#8b5cf6, 0))
    
    // Header
    table.cell(infoPanel, 0, 0, "ğŸš€ CopyPipe", text_color=color.white, text_size=textSize, bgcolor=color.new(#8b5cf6, 0))
    table.cell(infoPanel, 1, 0, "Dashboard", text_color=color.white, text_size=textSize, bgcolor=color.new(#8b5cf6, 0))
    table.merge_cells(infoPanel, 0, 0, 1, 0)
    
    // Overall Signal
    table.cell(infoPanel, 0, 1, "Signal:", text_color=color.gray, text_size=textSize, text_halign=text.align_left)
    table.cell(infoPanel, 1, 1, overallSignal, text_color=overallColor, text_size=textSize, text_halign=text.align_right)
    
    // RSI
    if showRSI
        table.cell(infoPanel, 0, 2, "RSI(" + str.tostring(rsiLength) + "):", text_color=color.gray, text_size=textSize, text_halign=text.align_left)
        table.cell(infoPanel, 1, 2, str.tostring(rsiValue, "#.#") + " " + rsiCondition, text_color=rsiColor, text_size=textSize, text_halign=text.align_right)
    
    // MACD
    if showMACD
        table.cell(infoPanel, 0, 3, "MACD:", text_color=color.gray, text_size=textSize, text_halign=text.align_left)
        table.cell(infoPanel, 1, 3, macdCondition, text_color=macdColor, text_size=textSize, text_halign=text.align_right)
    
    // Trend
    table.cell(infoPanel, 0, 4, "Trend:", text_color=color.gray, text_size=textSize, text_halign=text.align_left)
    table.cell(infoPanel, 1, 4, maTrend, text_color=maColor, text_size=textSize, text_halign=text.align_right)
    
    // Session
    currentSession = isLondon and showLondon ? "ğŸ‡¬ğŸ‡§ London" : isNY and showNY ? "ğŸ‡ºğŸ‡¸ New York" : isAsia and showAsia ? "ğŸŒ Asia" : isSydney and showSydney ? "ğŸ‡¦ğŸ‡º Sydney" : "â€”"
    table.cell(infoPanel, 0, 5, "Session:", text_color=color.gray, text_size=textSize, text_halign=text.align_left)
    table.cell(infoPanel, 1, 5, currentSession, text_color=color.white, text_size=textSize, text_halign=text.align_right)
    
    // Daily High/Low
    if showDailyHL
        table.cell(infoPanel, 0, 6, "D-High:", text_color=color.gray, text_size=textSize, text_halign=text.align_left)
        table.cell(infoPanel, 1, 6, str.tostring(dailyHigh, format.mintick), text_color=bearColor, text_size=textSize, text_halign=text.align_right)
        table.cell(infoPanel, 0, 7, "D-Low:", text_color=color.gray, text_size=textSize, text_halign=text.align_left)
        table.cell(infoPanel, 1, 7, str.tostring(dailyLow, format.mintick), text_color=bullColor, text_size=textSize, text_halign=text.align_right)
    
    // CopyPipe Promo
    table.cell(infoPanel, 0, 8, "", text_size=size.tiny)
    table.cell(infoPanel, 1, 8, "", text_size=size.tiny)
    table.cell(infoPanel, 0, 9, "copypipe.io", text_color=color.new(#8b5cf6, 0), text_size=size.tiny, text_halign=text.align_left)
    table.cell(infoPanel, 1, 9, "Auto-trade! â†’", text_color=color.new(#8b5cf6, 50), text_size=size.tiny, text_halign=text.align_right)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Alert conditions for CopyPipe webhook integration
bullishCross = ta.crossover(maFast, maSlow)
bearishCross = ta.crossunder(maFast, maSlow)
rsiOversoldCross = ta.crossunder(rsiValue, rsiOversold)
rsiOverboughtCross = ta.crossover(rsiValue, rsiOverbought)

alertcondition(bullishCross, "MA Bullish Cross", '{"action": "BUY", "symbol": "{{ticker}}", "price": {{close}}}')
alertcondition(bearishCross, "MA Bearish Cross", '{"action": "SELL", "symbol": "{{ticker}}", "price": {{close}}}')
alertcondition(rsiOversoldCross, "RSI Oversold", '{"action": "BUY", "symbol": "{{ticker}}", "price": {{close}}, "reason": "RSI oversold"}')
alertcondition(rsiOverboughtCross, "RSI Overbought", '{"action": "SELL", "symbol": "{{ticker}}", "price": {{close}}, "reason": "RSI overbought"}')

// Combined signal alerts
bullishConfluence = bullishCross and rsiValue < 50 and macdLine > signalLine
bearishConfluence = bearishCross and rsiValue > 50 and macdLine < signalLine

alertcondition(bullishConfluence, "ğŸš€ Strong BUY Signal", '{"action": "BUY", "symbol": "{{ticker}}", "price": {{close}}, "confluence": true}')
alertcondition(bearishConfluence, "ğŸ”» Strong SELL Signal", '{"action": "SELL", "symbol": "{{ticker}}", "price": {{close}}, "confluence": true}')
