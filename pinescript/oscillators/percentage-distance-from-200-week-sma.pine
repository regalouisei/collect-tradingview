//@version=5
indicator("Percentage Distance from 200-Week SMA", shorttitle="200w SMA %", overlay=false)

// Input
length = input.int(200, "Length", minval=1)

// 200-week SMA (calculated on current chart timeframe)
// → This is intentional in your original — many pros use it this way on daily charts
sma200 = ta.sma(close, length)

// Percentage distance
percentDistance = (close - sma200) / sma200 * 100

// Plot the oscillator (no clamping, no forced anchors → auto-scale works perfectly)
plot(percentDistance, "Percent Distance", color=percentDistance > 10 ? color.red : percentDistance < -10 ? color.fuchsia : color.blue, linewidth=2)

// ——— Your requested levels ———
hline(0,   "Zero",      color=color.gray,   linestyle=hline.style_dotted)
hline(10,  "+10% OB",   color=color.red,     linestyle=hline.style_dashed)
hline(-10, "-10% OS",   color=color.fuchsia, linestyle=hline.style_dashed)

// Light shading for overbought/oversold zones
fill(plot(10), plot(percentDistance), color.new(#e90808, 92))
fill(plot(-10), plot(percentDistance), color.new(#07f83b, 92))

// Your original table (unchanged)
var table percTable = table.new(position.top_right, 2, 1, bgcolor=color.new(#0543ee, 80))
if barstate.islast
    table.cell(percTable, 0, 0, "Above 200w SMA:", text_color=color.white)
    table.cell(percTable, 1, 0, str.tostring(percentDistance, "#.##") + "%", text_color=color.white,bgcolor=percentDistance > 0 ? color.green : color.red)

// Optional label
if barstate.islast
    label.new(bar_index, percentDistance, str.tostring(percentDistance, "#.##") + "%", 
              style=label.style_label_left, color=color.gray, textcolor=color.white, size=size.small)

// Alert
alertcondition(percentDistance > 10,  title="+10% Overbought", message="Price >10% above 200w SMA")
alertcondition(percentDistance < -10, title="-10% Oversold",    message="Price >10% below 200w SMA")
