//@version=6
// Original concept by Glaz. Updated to Pine v6.
indicator("EMA RSI Adaptive (v6)", overlay = true)

// Inputs
emaPeriod = input.int(14, "Base EMA Period", minval = 1)
rsiPeriod = input.int(14, "RSI Period", minval = 1)
showColor = input.bool(false, "Color Change")

// Core calculations
price = close
rsiVolatility = math.abs(ta.rsi(price, rsiPeriod) - 50) + 1.0
mult = (5.0 + 100.0 / rsiPeriod) / (0.06 + 0.92 * rsiVolatility + 0.02 * math.pow(rsiVolatility, 2))
dynamicPeriod = mult * emaPeriod
alpha = 2.0 / (1.0 + dynamicPeriod)

// Adaptive EMA (uses SMA of price as target, matching legacy behavior)
var float ema = na
emaPrev = nz(ema[1], price)  // seed with price on first bar
ema := emaPrev + alpha * (ta.sma(price, emaPeriod) - emaPrev)

// Coloring
colorUp = color.rgb(0, 148, 255)
colorDown = color.rgb(255, 0, 110)
col = showColor ? (ema > nz(ema[1], ema) ? colorUp : colorDown) : colorUp

plot(ema, color = col, title = "Adaptive EMA")
