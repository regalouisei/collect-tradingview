//@version=6
indicator("Goldilocks Pivot Fractals")

// ════════════════════════════════════════════════════════════════════════════════════
// Williams Fractals — Goldilocks Edition
// Created by: NPR21
// Version: 2.0
// Last Updated: December 2024
// 
// Description: Classic Williams Fractals indicator with enhanced visual presentation.
// Identifies swing highs and lows using Bill Williams' fractal pattern recognition.
// Features professional Buy/Sell labels with full customization options.
//
// Features:
// - Classic Williams Fractals algorithm
// - Customizable Buy/Sell text labels
// - Toggle shapes and labels independently
// - Full color and size customization
// - Adjustable label offset positioning
//
// All Rights Reserved
// ════════════════════════════════════════════════════════════════════════════════════

// ===================== Inputs =====================
n               = input.int(title="Periods (n)", defval=2, minval=2)
showLabels      = input.bool(title="Show BUY/SELL Labels", defval=true)
showShapes      = input.bool(title="Show Shapes", defval=true)

// Offset: 8 is optimal for most chart scales
buyOffsetTicks  = input.int(title="BUY offset (ticks)",  defval=8, minval=0)
sellOffsetTicks = input.int(title="SELL offset (ticks)", defval=8, minval=0)

// High-contrast colors
buyLabelBgColor  = input.color(title="BUY label background",  defval=color.rgb(0, 50, 45)) 
sellLabelBgColor = input.color(title="SELL label background", defval=color.rgb(80, 0, 0))  
buyTextColor     = input.color(title="BUY text color",       defval=color.white)  
sellTextColor    = input.color(title="SELL text color",      defval=color.yellow) 
labelSizeOpt     = input.string(title="Label size", defval="normal", options=["tiny","small","normal","large","huge"])

lblSize = labelSizeOpt == "tiny"   ? size.tiny   :
          labelSizeOpt == "small"  ? size.small  :
          labelSizeOpt == "normal" ? size.normal :
          labelSizeOpt == "large"  ? size.large  : size.huge

// ===================== Fractals Logic =====================
upPivot     = ta.pivothigh(high, n, n)
downPivot   = ta.pivotlow(low,  n, n)
upFractal   = not na(upPivot)
downFractal = not na(downPivot)

// ===================== Labels =====================
if showLabels and downFractal
    label.new(
        bar_index - n,
        low[n] - buyOffsetTicks * syminfo.mintick,
        "BUY",
        xloc=xloc.bar_index,
        yloc=yloc.price,
        style=label.style_label_up,
        color=buyLabelBgColor,
        textcolor=buyTextColor,
        size=lblSize
    )

if showLabels and upFractal
    label.new(
        bar_index - n,
        high[n] + sellOffsetTicks * syminfo.mintick,
        "SELL",
        xloc=xloc.bar_index,
        yloc=yloc.price,
        style=label.style_label_down,
        color=sellLabelBgColor,
        textcolor=sellTextColor,
        size=lblSize
    )

// ===================== Arrow Shapes =====================
plotshape(showShapes and upFractal,   title="Sell Arrow", style=shape.arrowdown, location=location.abovebar, offset=-n, color=sellLabelBgColor, size=size.normal)
plotshape(showShapes and downFractal, title="Buy Arrow",  style=shape.arrowup,   location=location.belowbar, offset=-n, color=buyLabelBgColor,  size=size.normal)
