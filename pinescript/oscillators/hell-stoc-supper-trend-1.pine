//@version=6
indicator(title="Stochastic + SuperTrend OB/OS Solid Lines", shorttitle="Stoch+ST+Solid", overlay=false, precision=2)

// ----- Inputs -----
periodK = input.int(5, "K Length")      // %K Length
smoothK = input.int(3, "K Smoothing")  // %K Smoothing

atr_period = input.int(52, "ATR Length")
atr_factor = input.float(2.5, "ATR Factor")
atr_source = input.source(close, "ATR Source")

// ----- SuperTrend Calculation -----
tr = math.max(high - low, math.abs(high - atr_source[1]), math.abs(low - atr_source[1]))
atr = ta.rma(tr, atr_period)

upper_band = close[1] + atr[1] * atr_factor
lower_band = close[1] - atr[1] * atr_factor

upper_band1 = nz(upper_band[1])
lower_band1 = nz(lower_band[1])

upper_band := upper_band < upper_band1 or close[1] > upper_band1 ? upper_band : upper_band1
lower_band := lower_band > lower_band1 or close[1] < lower_band1 ? lower_band : lower_band1

var int trend_direction = na
trend_direction := close > upper_band ? -1 : close < lower_band ? 1 : nz(trend_direction[1], 1)

// ----- Colors -----
bull_color = #ff8c00
bear_color = color.aqua
line_color = trend_direction == 1 ? bull_color : bear_color

// ----- OB/OS Levels -----
OB = 90
OS = 10

// ----- Draw Solid OB/OS Lines -----
var line ob_line = na
var line os_line = na
if na(ob_line)
    ob_line := line.new(x1=bar_index, y1=OB, x2=bar_index + 1000, y2=OB, xloc=xloc.bar_index, extend=extend.right, color=line_color, width=3)
    os_line := line.new(x1=bar_index, y1=OS, x2=bar_index + 1000, y2=OS, xloc=xloc.bar_index, extend=extend.right, color=line_color, width=3)
else
    line.set_color(ob_line, line_color)
    line.set_color(os_line, line_color)

// ----- Middle line -----
plot(50, "Middle Band", color=color.new(#787B86, 50), linewidth=1)

// ----- Stochastic %K Line -----
k = ta.sma(ta.stoch(close, high, low, periodK), smoothK)
plot(k, "%K", color=#2962FF)

// ----- Alerts -----
alertcondition(ta.crossover(k, OS) and trend_direction == 1, title="OS Bullish", message="%K crossed above 10 in bullish trend")
alertcondition(ta.crossunder(k, OB) and trend_direction == 1, title="OB Bullish", message="%K crossed below 90 in bullish trend")
alertcondition(ta.crossunder(k, OB) and trend_direction == -1, title="OB Bearish", message="%K crossed below 90 in bearish trend")
alertcondition(ta.crossover(k, OS) and trend_direction == -1, title="OS Bearish", message="%K crossed above 10 in bearish trend")
