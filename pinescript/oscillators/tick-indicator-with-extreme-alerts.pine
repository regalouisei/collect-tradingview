//@version=5
indicator("TICK Indicator with Extreme Alerts", shorttitle="TICK Pro", overlay=false)

// --- 1. Data Source ---
sym = input.symbol("USI:TICK.US", title="TICK Symbol")

// --- 2. Reference Lines Settings (Default +/- 800) ---
group_lines = "Reference Lines Settings"
val_line_up = input.int(800, title="Upper Reference Level", group=group_lines)
val_line_dn = input.int(-800, title="Lower Reference Level", group=group_lines)
col_lines   = input.color(color.gray, title="Reference Line Color", group=group_lines)

// --- 3. Alert Thresholds Settings (Default +/- 1000) ---
group_alerts = "Alert Thresholds Settings"
val_alert_up = input.int(1000, title="Upper Alert Threshold (>)", group=group_alerts)
val_alert_dn = input.int(-1000, title="Lower Alert Threshold (<)", group=group_alerts)

// Colors: High > Green, Low > Red
col_bg_up    = input.color(color.green, title="Upper Alert Background", group=group_alerts)
col_bg_dn    = input.color(color.red, title="Lower Alert Background", group=group_alerts)

// --- 4. Candle Style ---
group_candle = "Candle Style"
col_up = input.color(color.green, title="Bullish Candle Color", group=group_candle)
col_dn = input.color(color.red, title="Bearish Candle Color", group=group_candle)

// ==========================================
// Calculations & Plotting
// ==========================================

// Request OHLC data
[tOpen, tHigh, tLow, tClose] = request.security(sym, timeframe.period, [open, high, low, close])

// 1. Plot Reference Lines (+/- 800)
hline(val_line_up, "Ref High", color=col_lines, linestyle=hline.style_dashed)
hline(0, "Zero Line", color=color.gray, linestyle=hline.style_solid)
hline(val_line_dn, "Ref Low", color=col_lines, linestyle=hline.style_dashed)

// 2. Plot Candles
c_body = tClose >= tOpen ? col_up : col_dn
plotcandle(tOpen, tHigh, tLow, tClose, title="TICK Candles", color=c_body, wickcolor=c_body, bordercolor=c_body)

// 3. Background Highlight Logic
// Uses High/Low to catch intra-candle spikes
is_extreme_up = tHigh >= val_alert_up
is_extreme_dn = tLow <= val_alert_dn

// Apply background color (85% transparency)
bgcolor(is_extreme_up ? color.new(col_bg_up, 85) : na, title="High Alert BG")
bgcolor(is_extreme_dn ? color.new(col_bg_dn, 85) : na, title="Low Alert BG")

// 4. System Alerts
alertcondition(is_extreme_up, title="TICK Spike Alert", message="TICK hit Extreme High!")
alertcondition(is_extreme_dn, title="TICK Drop Alert", message="TICK hit Extreme Low!")
