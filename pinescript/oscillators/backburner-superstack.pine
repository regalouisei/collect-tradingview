//@version=6
indicator("Backburner Superstack v6", shorttitle="BB Superstack", overlay=true)

//---------------------
// Inputs
//---------------------
rsiLen   = input.int(14, "RSI Length")
rsiLevel = input.int(30, "Oversold level (<)")

//---------------------
// Multi-timeframe RSI
//---------------------
rsi1W  = request.security(syminfo.tickerid, "1W",  ta.rsi(close, rsiLen))
rsi1D  = request.security(syminfo.tickerid, "D",   ta.rsi(close, rsiLen))
rsi12H = request.security(syminfo.tickerid, "720", ta.rsi(close, rsiLen))
rsi4H  = request.security(syminfo.tickerid, "240", ta.rsi(close, rsiLen))
rsi1H  = request.security(syminfo.tickerid, "60",  ta.rsi(close, rsiLen))
rsi30M = request.security(syminfo.tickerid, "30",  ta.rsi(close, rsiLen))
rsi15M = request.security(syminfo.tickerid, "15",  ta.rsi(close, rsiLen))
rsi5M  = request.security(syminfo.tickerid, "5",   ta.rsi(close, rsiLen))

//---------------------
// Oversold conditions
//---------------------
os1W  = rsi1W  < rsiLevel
os1D  = rsi1D  < rsiLevel
os12H = rsi12H < rsiLevel
os4H  = rsi4H  < rsiLevel
os1H  = rsi1H  < rsiLevel
os30M = rsi30M < rsiLevel
os15M = rsi15M < rsiLevel
os5M  = rsi5M  < rsiLevel

//---------------------
// Stack logic: highest TF wins
// (only one of these should be true per bar)
//---------------------
stack1W  = os1W  and os1D  and os12H and os4H  and os1H  and os30M and os15M and os5M
stack1D  = not stack1W  and os1D  and os12H and os4H  and os1H  and os30M and os15M and os5M
stack12H = not stack1W  and not stack1D  and os12H and os4H  and os1H  and os30M and os15M and os5M
stack4H  = not stack1W  and not stack1D  and not stack12H and os4H  and os1H  and os30M and os15M and os5M
stack1H  = not stack1W  and not stack1D  and not stack12H and not stack4H  and os1H  and os30M and os15M and os5M
stack30M = not stack1W  and not stack1D  and not stack12H and not stack4H  and not stack1H  and os30M and os15M and os5M
stack15M = not stack1W  and not stack1D  and not stack12H and not stack4H  and not stack1H  and not stack30M and os15M and os5M
stack5M  = not stack1W  and not stack1D  and not stack12H and not stack4H  and not stack1H  and not stack30M and not stack15M and os5M

//---------------------
// Plots: one label per possible stack
// (because of logic above, at most one prints per bar)
//---------------------
plotshape(stack1W,  "1W SuperStack",  shape.labelup, location.belowbar, color.new(color.purple, 0), 0, "1W",  color.black)
plotshape(stack1D,  "1D SuperStack",  shape.labelup, location.belowbar, color.new(color.blue,   0), 0, "1D",  color.black)
plotshape(stack12H, "12H SuperStack", shape.labelup, location.belowbar, color.new(color.aqua,   0), 0, "12H", color.black)
plotshape(stack4H,  "4H SuperStack",  shape.labelup, location.belowbar, color.new(color.lime,   0), 0, "4H",  color.black)
plotshape(stack1H,  "1H SuperStack",  shape.labelup, location.belowbar, color.new(color.green,  0), 0, "1H",  color.black)
plotshape(stack30M, "30m Stack",      shape.labelup, location.belowbar, color.new(color.yellow, 0), 0, "30m", color.black)
plotshape(stack15M, "15m Stack",      shape.labelup, location.belowbar, color.new(color.orange, 0), 0, "15m", color.black)
plotshape(stack5M,  "5m Only",        shape.labelup, location.belowbar, color.new(color.red,    0), 0, "5m",  color.black)
