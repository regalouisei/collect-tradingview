// As someone who browses through numerous TradingView scripts, I find many ideas/functions that I find useful. However, sometimes I find certain features
// that I don't find useful or that could be added to make something more useful. Because of this I designed this script to collectively emcompass functionality
// of the items/indicators I find useful when looking at an index/equity chart.
//
// A special call out for a couple of the scripts that I've drawn some inspiration from some of their functionality they've built in:
//    • Mr_Minnor author of 1 Indicator to rule them all - https://www.tradingview.com/v/5bUFWaQa/
//    • ChartArt author of Moving Average Cross Alert, Multi-Timeframe (MTR) by (ChartArt) - https://www.tradingview.com/v/bcWGvngm/

// This script was desgined/inspired to keep the chart clean while providing signal context for trend, volatility, price action, and regime conditions.
//
// ---
// Summary of what this script does:
// - Plots a compact, customizable set of SMAs + EMAs for structure and trend layering.
// - Adds Bollinger Bands with expansion/contraction coloring to visualize volatility state.
// - Optionally overlays ADX/DI regime context, including:
//     • an ADX-based “regime fill” (temperature-style colors) on the BB fill
//     • optional DI+ / DI- cross markers for directional shift awareness
//     • expanded ADX regime labels (Dead Chop → Very Strong/Extended)
//     • optional “ADX momentum” (smoothed ADX slope) in the status label to show regime acceleration/decay
// - Provides a small corner “Regime Status Label” that summarizes ADX regime (with numeric ADX) when enabled.
// - Optionally appends Daily ATR (value + momentum) to the same label for range/volatility context that is consistent across intraday timeframes.
//
// Changes requested (Jan 2026):
// 1) Default-enable: ADX/DI regime + ADX momentum in status + Daily ATR in status, and default panel to Bottom Left w/ NORMAL font
// 2) BB centerline style: use a continuous line (no line breaks)
// 3) Fix Inputs vs Style tab override: lock BB plot styling so Style tab can’t override input-selected colors/styles (use editable=false)
// 4) Make BB fill transparency user-controlled
// 5) Added a condensed (4) option for a customizable ADX color fill between the bollinger bands
// 6) Updated main indiacator page chart
//@version=5
indicator("Guac's MAs, BBs, and ADX (SMA/EMA/BB + ADX/DI + Daily ATR)", "MAs, BBs, & ADX", overlay=true, max_labels_count=200)

//====================
// TOGGLES
//====================
gT = "Toggles"
tSMA  = input.bool(true,  "Show SMAs", group=gT, tooltip="Plots your selected SMAs (default 50/200) as structure anchors. Use as higher-timeframe support/resistance and trend context. For swing, use as major trend filters.")
tEMA  = input.bool(true,  "Show EMAs", group=gT, tooltip="Plots your selected EMAs (default 8/21/55) for trend + momentum context. EMA8 is your short-term 'tape' line for timing; EMA21/55 provide trend layering and mean-reversion boundaries.")
tBB   = input.bool(true,  "Show Bollinger Bands", group=gT, tooltip="Shows Bollinger Bands (default 20, 2.1) for volatility structure: expansions often precede continuation, contractions often precede breakouts. Useful for timing + risk framing.")
tADX  = input.bool(true,  "Enable ADX/DI Regime", group=gT, tooltip="Adds trend-strength context using ADX and DI. Helps decide whether to trust breakouts (trend regime) or fade moves (chop regime). Optional DI cross markers can highlight directional shifts.")

//====================
// SMAs
//====================
gS = "SMAs"
s1On = input.bool(true,  "SMA 1 On", group=gS, inline="s1", tooltip="Primary intermediate trend SMA (default 50). Often acts as dynamic support/resistance.")
s1   = input.int(50,     "SMA 1",    group=gS, inline="s1", minval=1)
s1c  = input.color(color.new(color.aqua, 0), "", group=gS, inline="s1")

s2On = input.bool(true,  "SMA 2 On", group=gS, inline="s2", tooltip="Primary long-term trend SMA (default 200). Major structure line watched by many participants.")
s2   = input.int(200,    "SMA 2",    group=gS, inline="s2", minval=1)
s2c  = input.color(color.new(color.orange, 0), "", group=gS, inline="s2")

s3On = input.bool(false, "SMA 3 On", group=gS, inline="s3")
s3   = input.int(10,     "SMA 3",    group=gS, inline="s3", minval=1)
s3c  = input.color(color.new(color.purple, 0), "", group=gS, inline="s3")

s4On = input.bool(false, "SMA 4 On", group=gS, inline="s4")
s4   = input.int(20,     "SMA 4",    group=gS, inline="s4", minval=1)
s4c  = input.color(color.new(color.blue, 0), "", group=gS, inline="s4")

gSS = "SMA Styling"
sDn = input.color(color.new(color.red, 0), "Down Slope Color", group=gSS,
     tooltip="When an SMA is sloping down (SMA < SMA[1]), it changes to this color. Quick visual cue that the SMA's direction has flipped bearish/weakening.")

//====================
// EMAs (STATIC)
//====================
gE = "EMAs"
e1On = input.bool(true,  "EMA 1 On", group=gE, inline="e1", tooltip="Fast EMA (default 8). Useful for entries: trend alignment, pullback timing, and reclaim/break signals.")
e1   = input.int(8,      "EMA 1",    group=gE, inline="e1", minval=1)
e1c  = input.color(color.new(color.purple, 0), "", group=gE, inline="e1")

e2On = input.bool(true,  "EMA 2 On", group=gE, inline="e2")
e2   = input.int(21,     "EMA 2",    group=gE, inline="e2", minval=1, tooltip="Trend layering EMA (default 21). Use as dynamic S/R and to judge trend quality.")
e2c  = input.color(color.new(color.yellow, 0), "", group=gE, inline="e2")

e3On = input.bool(true,  "EMA 3 On", group=gE, inline="e3")
e3   = input.int(55,     "EMA 3",    group=gE, inline="e3", minval=1, tooltip="Trend layering EMA (default 55). Use as dynamic S/R and to judge trend quality.")
e3c  = input.color(color.new(color.white, 0), "", group=gE, inline="e3")

e4On = input.bool(false, "EMA 4 On", group=gE, inline="e4")
e4   = input.int(48,     "EMA 4",    group=gE, inline="e4", minval=1)
e4c  = input.color(color.new(color.teal, 0), "", group=gE, inline="e4")

//====================
// BOLLINGER BANDS
//====================
gB = "Bollinger Bands"
bbLen    = input.int(20,    "BB Length", minval=1, group=gB, tooltip="Lookback period used for BB centerline and volatility (default 20). Shorter = more reactive; longer = smoother.")
bbMult   = input.float(2.1, "BB StdDev", minval=0.001, maxval=50, group=gB, tooltip="Band width multiplier (default 2.1). Higher = wider bands; lower = tighter bands.")
bbFillOn = input.bool(true, "Show BB Fill", group=gB, tooltip="Fills the space between upper/lower BB. Helpful for spotting expansion vs compression.")

bbExp = input.color(color.new(color.green, 0), "Expanding Color", group=gB, inline="bbC", tooltip="Band color changes based on BB bandwidth expanding vs contracting.")
bbCon = input.color(color.new(color.red,   0), "Contracting Color", group=gB, inline="bbC", tooltip="Band color changes based on BB bandwidth expanding vs contracting.")

bbBasisCol = input.color(color.new(color.blue, 0), "Centerline Color", group=gB, tooltip="BB centerline is the SMA of price.")

// Change 4: user-controlled fill transparency (applies to both default fill and ADX-regime fill)
bbFillBaseCol  = input.color(color.rgb(33, 150, 243), "Fill Base Color", group=gB, tooltip="Base fill color used when ADX-based fill is NOT active.")
bbFillTransp   = input.int(95, "Fill Transparency (0=opaque, 100=hidden)", minval=0, maxval=100, group=gB, tooltip="Controls BB fill transparency. Also applies to ADX-coloring fill when enabled.")

//====================
// ADX / DI
//====================
gA = "ADX / DI Regime"
adxLen = input.int(14, "ADX Length", minval=1, group=gA, tooltip="Smoothing length for ADX (trend strength). 14 is a standard baseline.")
diLen  = input.int(14, "DI Length",  minval=1, group=gA, tooltip="Smoothing length for DI+ / DI- (directional pressure). 14 is a standard baseline.")
useAdxFill = input.bool(true, "Use ADX coloring on BB fill", group=gA, tooltip="If ON (and ADX enabled), BB fill reflects ADX regime strength via a temperature-like color scheme.\n\nADX → Fill Color Map (current defaults):\n< 10: #2A6FDB (blue)\n10–13: #3B8DFF (light blue)\n13–17: #6A3DFF (purple)\n17–20: #8F3BFF (violet)\n20–25: #FF3B3B (red)\n25–35: #D61F1F (dark red)\n35–50: #FF8A00 (orange)\n≥ 50: RGB(253, 0, 198) (magenta)\n\nTip: To simplify, you can assign the same color to multiple ranges inside the adxFillColor logic.")
adxFillPalette = input.string("Detailed (8)", "ADX Fill Palette", options=["Detailed (8)", "Condensed (4)"], group=gA, tooltip="Detailed uses 8 ADX bands (more granular). Condensed groups ADX into 4 bands (cleaner, easier to read).")
diCross = input.bool(false, "Show DI+ / DI- cross markers", group=gA, tooltip="Marks DI+ crossing DI- (and vice versa). Useful for directional shifts but can be noisy in chop.")

// ADX momentum options (Change 1: default ON)
showAdxMomentum   = input.bool(true, "Show ADX Momentum in Status", group=gA, tooltip="If ON, adds ADX momentum (smoothed ADX slope). Context-only.")
adxSlopeSmoothLen = input.int(5, "ADX Slope Smoothing", minval=1, group=gA, tooltip="Smoothing for ADX slope. Higher = smoother; lower = more responsive.")
adxSlopeThresh    = input.float(0.05, "ADX Slope Threshold", step=0.01, group=gA, tooltip="Minimum smoothed ADX slope to classify as RISING/FALLING.")

//====================
// DAILY ATR (for status panel)
//====================
gATR = "Daily ATR"
// Change 1: default show ATR in status ON (already was true)
showAtrInStatus   = input.bool(true, "Show Daily ATR in Status", group=gATR, tooltip="Shows Daily ATR (from the Daily timeframe) in the status panel.")
atrLen            = input.int(14, "Daily ATR Length", minval=1, group=gATR)
showAtrMomentum   = input.bool(true, "Show Daily ATR Momentum", group=gATR, tooltip="Shows Daily ATR slope/momentum similar to ADX MOM (smoothed).")
atrSlopeSmoothLen = input.int(5, "ATR Slope Smoothing", minval=1, group=gATR)
atrSlopeThresh    = input.float(0.01, "ATR Slope Threshold", step=0.01, group=gATR)

//====================
// STATUS PANEL (TABLE)
//====================
gR = "Status Panel"
// Change 1: default panel ON, bottom-left, normal size
statusOn = input.bool(true, "Show Status Panel", group=gR, tooltip="Shows a small table anchored to the chart (not to candles).")
statusPosOpt = input.string("Bottom Left", "Panel Position",
     options=["Top Left","Top Center","Top Right","Middle Left","Middle Center","Middle Right","Bottom Left","Bottom Center","Bottom Right"],
     group=gR, tooltip="Where the status panel sits on the chart.")
statusTextSizeOpt = input.string("Normal", "Text Size", options=["Tiny","Small","Normal","Large"], group=gR)
statusTextSize = statusTextSizeOpt == "Tiny" ? size.tiny : statusTextSizeOpt == "Small" ? size.small : statusTextSizeOpt == "Large" ? size.large : size.normal

//====================
// CALCS
//====================
SMA(_len) => ta.sma(close, _len)
EMA(_len) => ta.ema(close, _len)

sma1 = SMA(s1), sma2 = SMA(s2), sma3 = SMA(s3), sma4 = SMA(s4)
ema1 = EMA(e1), ema2 = EMA(e2), ema3 = EMA(e3), ema4 = EMA(e4)

slopeRed(_v, _base, _down) => _v >= _v[1] ? _base : _down

// BB
bbBasis = SMA(bbLen)
bbDev   = bbMult * ta.stdev(close, bbLen)
bbU     = bbBasis + bbDev
bbLw    = bbBasis - bbDev
bbW     = bbU - bbLw
bbUp    = bbW > bbW[1]
bbBandC = bbUp ? bbExp : bbCon

// ADX/DI
[diP, diM, adx] = ta.dmi(diLen, adxLen)
posX = ta.crossover(diP, diM)
negX = ta.crossover(diM, diP)

// ADX regime labels
adxReg =
     adx < 10  ? "Dead Chop" :
     adx < 13  ? "Chop" :
     adx < 17  ? "Early Trend" :
     adx < 20  ? "Weak Trend" :
     adx < 25  ? "Trend" :
     adx < 35  ? "Strong Trend" :
                 "Very Strong/Extended"

// In ADX / DI Regime inputs
adxPalMode = input.string("Detailed (8)", "ADX Fill Palette", options=["Detailed (8)", "Condensed (4)"], group=gA)

cChop   = input.color(color.new(#3b8dff, 0), "Condensed: Chop Color (<13)", group=gA)
cEarly  = input.color(color.new(#6a3dff, 0), "Condensed: Early Trend (13–20)", group=gA)
cTrend  = input.color(color.new(#ff3b3b, 0), "Condensed: Trend (20–35)", group=gA)
cStrong = input.color(color.new(#ff8a00, 0), "Condensed: Strong (≥35)", group=gA)

// Condensed and detailed mapping (detailed by default)
adxFillColor =
     adxPalMode == "Condensed (4)" ?
         (adx < 13 ? color.new(cChop,   bbFillTransp) :
          adx < 20 ? color.new(cEarly,  bbFillTransp) :
          adx < 35 ? color.new(cTrend,  bbFillTransp) :
                     color.new(cStrong, bbFillTransp)) :
         // your existing detailed mapping...
         (adx < 10 ? color.new(#2a6fdb, bbFillTransp) :
          adx < 13 ? color.new(#3b8dff, bbFillTransp) :
          adx < 17 ? color.new(#6a3dff, bbFillTransp) :
          adx < 20 ? color.new(#8f3bff, bbFillTransp) :
          adx < 25 ? color.new(#ff3b3b, bbFillTransp) :
          adx < 35 ? color.new(#d61f1f, bbFillTransp) :
          adx < 50 ? color.new(#ff8a00, bbFillTransp) :
                     color.new(color.rgb(253, 0, 198), bbFillTransp))

// ADX momentum
adxSlope   = adx - adx[1]
adxSlopeSm = ta.ema(adxSlope, adxSlopeSmoothLen)

adxMom = "FLAT"
if adxSlopeSm > adxSlopeThresh
    adxMom := "RISING"
else if adxSlopeSm < -adxSlopeThresh
    adxMom := "FALLING"
else
    adxMom := "FLAT"

// Daily ATR + momentum (computed from Daily TimeFrame)
dailyATR = request.security(syminfo.tickerid, "D", ta.atr(atrLen))
atrSlope = dailyATR - dailyATR[1]
atrSlopeSm = ta.ema(atrSlope, atrSlopeSmoothLen)

atrMom = "FLAT"
if atrSlopeSm > atrSlopeThresh
    atrMom := "RISING"
else if atrSlopeSm < -atrSlopeThresh
    atrMom := "FALLING"
else
    atrMom := "FLAT"

//====================
// PLOTS
//====================
// SMAs
plot((tSMA and s1On) ? sma1 : na, "SMA 50",  color=slopeRed(sma1, s1c, sDn), style=plot.style_circles, linewidth=2)
plot((tSMA and s2On) ? sma2 : na, "SMA 200", color=slopeRed(sma2, s2c, sDn), style=plot.style_circles, linewidth=3)
plot((tSMA and s3On) ? sma3 : na, "SMA 3",   color=slopeRed(sma3, s3c, sDn), style=plot.style_circles)
plot((tSMA and s4On) ? sma4 : na, "SMA 4",   color=slopeRed(sma4, s4c, sDn), style=plot.style_circles)

// EMAs (static)
plot((tEMA and e1On) ? ema1 : na, "EMA 8",  color=e1c, linewidth=3)
plot((tEMA and e2On) ? ema2 : na, "EMA 21", color=e2c, linewidth=1)
plot((tEMA and e3On) ? ema3 : na, "EMA 55", color=e3c, linewidth=1)
plot((tEMA and e4On) ? ema4 : na, "EMA 4",  color=e4c, linewidth=1)

// BB
pU     = plot(tBB ? bbU     : na, title="BB Upper",      color=bbBandC,    linewidth=2)
pL     = plot(tBB ? bbLw    : na, title="BB Lower",      color=bbBandC,    linewidth=2)
pBasis = plot(tBB ? bbBasis : na, title="BB Centerline", color=bbBasisCol, linewidth=1, style=plot.style_line)

// BB fill
bbFillCol = color.new(bbFillBaseCol, bbFillTransp)
fillCol   = (tBB and bbFillOn) ? ((tADX and useAdxFill) ? adxFillColor : bbFillCol) : na
fill(pU, pL, title="BB Fill", color=fillCol)

// DI crosses
plotshape(tADX and diCross and posX, "DI+ Cross", style=shape.circle,  location=location.belowbar, size=size.tiny, color=color.new(color.green, 0), text="DI+")
plotshape(tADX and diCross and negX, "DI- Cross", style=shape.xcross, location=location.abovebar, size=size.tiny, color=color.new(color.red, 0), text="DI-")

//====================
// STATUS PANEL (TABLE)
//====================
pos =
     statusPosOpt == "Top Left"      ? position.top_left :
     statusPosOpt == "Top Center"    ? position.top_center :
     statusPosOpt == "Top Right"     ? position.top_right :
     statusPosOpt == "Middle Left"   ? position.middle_left :
     statusPosOpt == "Middle Center" ? position.middle_center :
     statusPosOpt == "Middle Right"  ? position.middle_right :
     statusPosOpt == "Bottom Left"   ? position.bottom_left :
     statusPosOpt == "Bottom Center" ? position.bottom_center :
                                       position.bottom_right

var table st = table.new(pos, 1, 1, frame_width=1, frame_color=color.new(color.white, 75))

// If position changes, rebuild the table (Pine tables can’t be “moved”; they must be recreated)
var string _lastPos = na
if barstate.isfirst
    _lastPos := statusPosOpt

if statusPosOpt != _lastPos
    table.delete(st)
    st := table.new(pos, 1, 1, frame_width=1, frame_color=color.new(color.white, 75))
    _lastPos := statusPosOpt

adxLine    = "ADX: " + adxReg + " (" + str.tostring(adx, "#.##") + ")"
adxMomLine = showAdxMomentum ? " | MOM: " + adxMom + " (" + str.tostring(adxSlopeSm, "#.##") + ")" : ""
atrLine    = showAtrInStatus ? "\nDaily ATR(" + str.tostring(atrLen) + "): " + str.tostring(dailyATR, "#.##") : ""
atrMomLine = (showAtrInStatus and showAtrMomentum) ? " | MOM: " + atrMom + " (" + str.tostring(atrSlopeSm, "#.##") + ")" : ""

statusTxt = (tADX ? (adxLine + adxMomLine) : "ADX: OFF") + atrLine + atrMomLine

if statusOn
    table.cell(st, 0, 0, statusTxt, text_color=color.white, bgcolor=color.new(color.black, 65), text_size=statusTextSize)
else
    table.cell(st, 0, 0, "", text_color=color.white, bgcolor=color.new(color.black, 100), text_size=statusTextSize)
