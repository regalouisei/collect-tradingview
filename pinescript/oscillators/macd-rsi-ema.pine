//@version=5
strategy("The Reliable Combo: MACD + RSI + 200 EMA", overlay=true, initial_capital=10000, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// -------------------------------------------------------------------------
// 1. INPUTS
// -------------------------------------------------------------------------
// Trend Filter
emaLen = input.int(200, "EMA Length (Trend Filter)")

// MACD Settings
fastLen = input.int(12, "MACD Fast Length")
slowLen = input.int(26, "MACD Slow Length")
sigLen = input.int(9, "MACD Signal Length")

// RSI Settings
rsiLen = input.int(14, "RSI Length")

// -------------------------------------------------------------------------
// 2. CALCULATIONS
// -------------------------------------------------------------------------
emaValue = ta.ema(close, emaLen)
[macdLine, signalLine, hist] = ta.macd(close, fastLen, slowLen, sigLen)
rsiValue = ta.rsi(close, rsiLen)

// -------------------------------------------------------------------------
// 3. STRATEGY LOGIC
// -------------------------------------------------------------------------

// --- LONG CONDITION ---
// 1. Trend is Up (Price > EMA)
// 2. MACD Bullish Crossover (Momentum Starting)
// 3. RSI is Healthy (Between 50 and 70) - Buyers strong, but not exhausted
longCondition = (close > emaValue) and ta.crossover(macdLine, signalLine) and (rsiValue > 50 and rsiValue < 65)

// --- SHORT CONDITION ---
// 1. Trend is Down (Price < EMA)
// 2. MACD Bearish Crossover (Momentum Dropping)
// 3. RSI is Healthy (Between 30 and 50) - Sellers strong, but not exhausted
shortCondition = (close < emaValue) and ta.crossunder(macdLine, signalLine) and (rsiValue < 50 and rsiValue > 35)

// -------------------------------------------------------------------------
// 4. EXECUTION
// -------------------------------------------------------------------------

if (longCondition)
    strategy.entry("Long", strategy.long)

if (shortCondition)
    strategy.entry("Short", strategy.short)

// -------------------------------------------------------------------------
// 5. EXITS (Profit Taking)
// -------------------------------------------------------------------------
// Exit Long if RSI gets too hot (> 75) or Trend Reverses
if (strategy.position_size > 0)
    if (rsiValue > 75 or ta.crossunder(macdLine, signalLine))
        strategy.close("Long", comment="Take Profit")

// Exit Short if RSI gets too cold (< 25) or Trend Reverses
if (strategy.position_size < 0)
    if (rsiValue < 25 or ta.crossover(macdLine, signalLine))
        strategy.close("Short", comment="Take Profit")

// -------------------------------------------------------------------------
// PLOTTING
// -------------------------------------------------------------------------
plot(emaValue, color=color.white, linewidth=2, title="200 EMA")

// Visual Signals
plotshape(longCondition, style=shape.labelup, location=location.belowbar, color=color.green, size=size.small, title="Buy Signal", text="BUY", textcolor=color.white)
plotshape(shortCondition, style=shape.labeldown, location=location.abovebar, color=color.red, size=size.small, title="Sell Signal", text="SELL", textcolor=color.white)
