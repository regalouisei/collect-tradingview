//@version=5
indicator("RSI vs Normalized Price", shorttitle="RSI vs Price", overlay=false)

// === INPUTS ===
rsiLen     = input.int(14, "RSI Length", minval=1)
normLen    = input.int(200, "Normalization Length", minval=10)
showCross  = input.bool(true, "Show Cross Markers?")
showFill   = input.bool(true, "Highlight RSI Leading/Lagging?")

// === CALCULATIONS ===
// RSI
rsiVal = ta.rsi(close, rsiLen)

// Normalize price to a 0–100 range so it can be compared directly with RSI
p_high = ta.highest(close, normLen)
p_low  = ta.lowest(close, normLen)
normPrice = na(p_high) or (p_high == p_low) ? 50.0 : 100 * (close - p_low) / (p_high - p_low)

// Detect crossovers between RSI and normalized price
crossUp   = ta.crossover(rsiVal, normPrice)
crossDown = ta.crossunder(rsiVal, normPrice)

// === PLOTTING ===
// Plot RSI and normalized price lines
rsiPlot = plot(rsiVal, title="RSI", color=color.new(color.green, 0), linewidth=2)
pricePlot = plot(normPrice, title="Normalized Price", color=color.new(color.white, 0), linewidth=2)

// Conditional fill highlighting between RSI and normalized price
fillColor = showFill ? (rsiVal > normPrice ? color.new(color.green, 85) : color.new(color.red, 85)) : na
fill(rsiPlot, pricePlot, color=fillColor)

// === CROSS MARKERS ===
plotshape(showCross and crossUp, title="RSI Crossed Above", location=location.bottom,
     color=color.new(color.green, 0), style=shape.triangleup, size=size.tiny, text="↑")
plotshape(showCross and crossDown, title="RSI Crossed Below", location=location.top,
     color=color.new(color.red, 0), style=shape.triangledown, size=size.tiny, text="↓")

// === HORIZONTAL REFERENCE LINES ===
hline(70, title="Overbought", color=color.gray, linestyle=hline.style_dotted)
hline(30, title="Oversold", color=color.gray, linestyle=hline.style_dotted)
hline(50, title="Midline", color=color.new(color.gray, 70))

// === ALERT CONDITIONS ===
alertcondition(crossUp, title="RSI Crossed Above Normalized Price", message="RSI just crossed above normalized price — RSI leading.")
alertcondition(crossDown, title="RSI Crossed Below Normalized Price", message="RSI just crossed below normalized price — RSI lagging.")
