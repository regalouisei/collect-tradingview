//@version=6
// Author: Simon20cent
// ADX DMI Squeeze — main panel with MA Bias Filter

indicator("ADX DMI Squeeze", shorttitle="ADX_SQZ", overlay=false)

// ───── INPUTS ─────
dmiLength     = input.int(10, "DMI Length", minval=1)
adxSmooth     = input.int(7, "ADX Smoothing", minval=1)
adxMALength   = input.int(10, "ADX MA Length", minval=1)
showZero      = input.bool(true, "Show Zero Line")

// ───── DISPLAY TOGGLES ─────
showHist      = input.bool(true, "Show Histogram")
showADX       = input.bool(true, "Show ADX")
showADXMA     = input.bool(true, "Show ADX MA")

// ───── FILTER TOGGLES ─────
useADXAccel   = input.bool(true, "Require ADX Acceleration")
useVWAPSlope  = input.bool(false, "Require VWAP Slope")
useMABias     = input.bool(false, "Require MA Bias")

// ───── MA BIAS SETTINGS ─────
maType        = input.string("EMA", "MA Type", options=["EMA", "SMA"])
maLength      = input.int(20, "MA Length")

// ───── ADX THRESHOLD LEVELS ─────
showADXLevels = input.bool(true, "Show ADX Levels (15 / 20)")
adxLevel1     = input.int(15, "ADX Level 1", minval=5)
adxLevel2     = input.int(20, "ADX Level 2", minval=5)

// ───── OPTIONAL DMI LINES ─────
showDMI = input.bool(false, "Show DI+ / DI− Lines")

// ───── DMI / ADX ─────
[diPlus, diMinus, adx] = ta.dmi(dmiLength, adxSmooth)
adxMA = ta.sma(adx, adxMALength)
squeezeValue = adx - adxMA

// ───── VWAP ─────
vwap = ta.vwap(hlc3)
vwapUp   = vwap > vwap[1]
vwapDown = vwap < vwap[1]

vwapLongFilter  = useVWAPSlope ? vwapUp   : true
vwapShortFilter = useVWAPSlope ? vwapDown : true

// ───── MA BIAS ─────
maValue = maType == "EMA" ? ta.ema(close, maLength) : ta.sma(close, maLength)

maBull = close > maValue
maBear = close < maValue

maLongFilter  = useMABias ? maBull : true
maShortFilter = useMABias ? maBear : true

// ───── ADX ACCELERATION ─────
adxAccel = adx > adx[1]
adxAccelFilter = useADXAccel ? adxAccel : true

// ───── TREND DIRECTION (DMI) ─────
bullish = diPlus > diMinus
bearish = diMinus > diPlus

// ───── FINAL SIGNAL CONDITIONS ─────
longSignal =
     squeezeValue > 0 and
     bullish and
     adxAccelFilter and
     vwapLongFilter and
     maLongFilter

shortSignal =
     squeezeValue > 0 and
     bearish and
     adxAccelFilter and
     vwapShortFilter and
     maShortFilter

// ───── HISTOGRAM COLOR LOGIC ─────
histColor =
     longSignal  ? color.lime :
     shortSignal ? color.red  :
     color.gray

// ───── HISTOGRAM ─────
plot(showHist ? squeezeValue : na, title="ADX Squeeze Histogram",
     style=plot.style_columns, color=histColor, linewidth=2)

// ───── ZERO LINE ─────
plot(showZero ? 0 : na, title="Zero Line", color=color.gray)

// ───── ADX LINE ─────
plot(showADX ? adx : na, title="ADX", color=color.new(color.blue, 50), linewidth=1)

// ───── ADX MA LINE ─────
plot(showADXMA ? adxMA : na, title="ADX MA", color=color.orange, linewidth=1)

// ───── ADX THRESHOLD LINES ─────
plot(showADXLevels ? adxLevel1 : na, title="ADX Level 15",
     color=color.new(color.gray, 70), linewidth=1, linestyle=plot.linestyle_dashed)

plot(showADXLevels ? adxLevel2 : na, title="ADX Level 20",
     color=color.new(color.gray, 50), linewidth=1, linestyle=plot.linestyle_dashed)

// ───── EARLY ADX ACCELERATION DOT ─────
plotshape(adxAccel and squeezeValue <= 0,
     title="ADX Accel Dot",
     style=shape.circle,
     location=location.bottom,
     color=color.yellow,
     size=size.tiny)

// ───── TRIANGLES ─────
plotshape(longSignal, title="Bullish Expansion",
     style=shape.triangleup,
     location=location.bottom,
     size=size.tiny,
     color=color.lime)

plotshape(shortSignal, title="Bearish Expansion",
     style=shape.triangledown,
     location=location.top,
     size=size.tiny,
     color=color.red)

// ───── OPTIONAL DMI LINES ─────
plot(showDMI ? diPlus : na, title="DI+", color=color.green, linewidth=1)
plot(showDMI ? diMinus : na, title="DI-", color=color.red, linewidth=1)
