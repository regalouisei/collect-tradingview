//@version=5
indicator(title='Small MACD', shorttitle='MACD_S', timeframe='')

// Getting inputs
fast_length = input(title='Fast Length', defval=12)
slow_length = input(title='Slow Length', defval=26)
src = input(title='Source', defval=close)
signal_length = input.int(title='Signal Smoothing', minval=1, maxval=50, defval=9)
sma_source = input(title='Simple MA(Oscillator)', defval=false)
sma_signal = input(title='Simple MA(Signal Line)', defval=false)

// Plot colors
col_grow_above = #9D9EA1
col_grow_below = #E1638D
col_fall_above = #F8F8FF
col_fall_below = #C21949
col_macd = #0094ff
col_signal = #ff6a00
col_upmacd = #4bcbd4
col_dnmacd = #2ca16b

// Calculating
fast_ma = sma_source ? ta.sma(src, fast_length) : ta.ema(src, fast_length)
slow_ma = sma_source ? ta.sma(src, slow_length) : ta.ema(src, slow_length)
macd = fast_ma - slow_ma
signal = sma_signal ? ta.sma(macd, signal_length) : ta.ema(macd, signal_length)
hist = macd - signal

plot(hist, title='Histogram', style=plot.style_columns, color=hist >= 0 ? hist[1] < hist ? col_grow_above : col_fall_above : hist[1] < hist ? col_grow_below : col_fall_below, transp=0)
plot(macd, title='MACD', color=macd[1] < macd ? col_upmacd : col_dnmacd)
//plot(macd, title="MACD", color=col_macd, transp=0)
plot(signal, title='Signal', color=color.new(col_signal, 0))

histoswitch = ta.cross(hist, 0)
alertcondition(histoswitch, title='_Histogram Crossover', message='Histogram Crossover. \n1. Check got MDIV? \n2. Set Price Line. \n3. Wait for weaker notch breakout. Entry')
macdswitch = ta.cross(macd, 0)
alertcondition(macdswitch, title='MACD Crossover', message='MACD Crossover.')

bullhisto = macd > signal
bearhisto = macd < signal
bullmacd = macd > 0
bearmacd = macd < 0

//alertcondition(bearhisto,title = "Bearish Histo", message = "Check M15 no touch other low OB.")
//alertcondition(bullhisto,title = "Bullish Histo", message = "Check M15 no touch other top OB.")

upmacd = macd[1] < macd
dnmacd = macd[1] > macd

uphist = hist[1] < hist
dnhist = hist[1] > hist

alertcondition(upmacd, title='*MACD Up', message='MACD is moving up.')
alertcondition(dnmacd, title='*MACD Down', message='MACD is moving down.')

alertcondition(uphist, title='*histo Up', message='histo is moving up.')
alertcondition(dnhist, title='*histo Down', message='histo is moving down.')

alertcondition(bullmacd, title='S_MACD > 0', message='Small MACD > 0')
alertcondition(bearmacd, title='S_MACD < 0', message='Small MACD < 0')

alertcondition(bullhisto, title='S_Histo > 0', message='Small Histo > 0')
alertcondition(bearhisto, title='S_Histo < 0', message='Small Histo < 0')

alertcondition(histoswitch, title='M5 Histogram Crossover', message='M5 Histogram Crossover. \nCheck for M5 BD for exit')
