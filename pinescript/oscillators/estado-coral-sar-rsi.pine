//@version=5
indicator("Estado Coral + SAR + RSI", overlay=false)

// =====================
// ðŸ”µ CORAL TREND (LazyBear)
// =====================
src = close
sm = input.int(21, title="Smoothing Period")
cd = input.float(0.4, title="Constant D")

di = (sm - 1.0) / 2.0 + 1.0
c1 = 2 / (di + 1.0)
c2 = 1 - c1
c3 = 3.0 * (cd * cd + cd * cd * cd)
c4 = -3.0 * (2.0 * cd * cd + cd + cd * cd * cd)
c5 = 3.0 * cd + 1.0 + cd * cd * cd + 3.0 * cd * cd

var float i1 = na
var float i2 = na
var float i3 = na
var float i4 = na
var float i5 = na
var float i6 = na

i1 := c1 * src + c2 * nz(i1[1])
i2 := c1 * i1 + c2 * nz(i2[1])
i3 := c1 * i2 + c2 * nz(i3[1])
i4 := c1 * i3 + c2 * nz(i4[1])
i5 := c1 * i4 + c2 * nz(i5[1])
i6 := c1 * i5 + c2 * nz(i6[1])

bfr = -cd*cd*cd*i6 + c3*i5 + c4*i4 + c5*i3

coralBull = bfr > bfr[1]
coralBear = bfr < bfr[1]

// =====================
// ðŸ”´ PARABOLIC SAR
// =====================
start = input.float(0.02, title="SAR Start")
increment = input.float(0.02, title="SAR Increment")
maximum = input.float(0.2, title="SAR Maximum")

sarValue = ta.sar(start, increment, maximum)

sarBull = close > sarValue
sarBear = close < sarValue

// =====================
// ðŸŸ£ RSI
// =====================
rsiLength = input.int(14, title="RSI Length")
rsiValue = ta.rsi(close, rsiLength)

rsiBull = rsiValue > 57
rsiBear = rsiValue < 20

// =====================
// ðŸ“Š ESTADO FINAL
// =====================
state =
     coralBull and sarBull and rsiBull ? 1 :
     coralBear and sarBear and rsiBear ? -1 :
     0

stateColor =
     state == 1  ? color.green :
     state == -1 ? color.red :
     color.yellow

// =====================
// ðŸ“‰ PLOT DE BARRAS
// =====================
plot(state,
     title="Estado Tendencia",
     style=plot.style_columns,
     color=stateColor,
     linewidth=3)

hline(0, "Neutral", color=color.gray)
