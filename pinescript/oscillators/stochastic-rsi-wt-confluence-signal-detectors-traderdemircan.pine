// WaveTrend + Stochastic RSI Combined Signals
//@version=6
indicator("Stochastic RSI - WT Confluence Signal Detectors (TraderDemircan)", overlay=false, max_labels_count=500)

n1 = input.int(10, "WT Channel Length", minval=1, group="WaveTrend")
n2 = input.int(21, "WT Average Length", minval=1, group="WaveTrend")
obLevel1 = input.int(60, "Overbougth Levet 1", group="WaveTrend")
obLevel2 = input.int(53, "Overbougth Level 2", group="WaveTrend")
osLevel1 = input.int(-60, "Oversold Level 1", group="WaveTrend")
osLevel2 = input.int(-53, "Oversold Level 2", group="WaveTrend")

smoothK = input.int(3, "K-Smooth", minval=1, group="Stochastic RSI")
smoothD = input.int(3, "D-Smooth", minval=1, group="Stochastic RSI")
lenRSI  = input.int(14, "RSI Period", minval=1, group="Stochastic RSI")
lenStoch= input.int(14, "Stoch Period", minval=1, group="Stochastic RSI")

stoch_oversold = input.int(20, "Stoch Oversold", minval=0, maxval=50, group="Stochastic RSI")
stoch_overbought = input.int(80, "Stoch Overbougth", minval=50, maxval=100, group="Stochastic RSI")

showWTArea = input.bool(true, "Show WT Difference Area", group="G√∂rsel")
showWTCross = input.bool(true, "Show WT Intersection Points", group="G√∂rsel")
colorBarsOnCross = input.bool(true, "Color the Candles at the Intersection", group="G√∂rsel")
showStochSignals = input.bool(true, "Stoch Shows Over Signals", group="G√∂rsel")

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üìà WT CALCULATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
ap = hlc3 
esa = ta.ema(ap, n1)
d = ta.ema(math.abs(ap - esa), n1)
ci = (ap - esa) / (0.015 * d)
tci = ta.ema(ci, n2)
 
wt1 = tci
wt2 = ta.sma(wt1, 4)

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üìà STOCHASTIC RSI CALCULATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
rsi1 = ta.rsi(close, lenRSI)
k = ta.sma(ta.stoch(rsi1, rsi1, rsi1, lenStoch), smoothK)
d_line = ta.sma(k, smoothD)

wt_cross = ta.cross(wt1, wt2)
wt_cross_up = ta.crossover(wt1, wt2)
wt_cross_down = ta.crossunder(wt1, wt2)

wt_in_overbought = wt1 > obLevel2 or wt1 > obLevel1
wt_in_oversold = wt1 < osLevel2 or wt1 < osLevel1

stoch_in_overbought = k > stoch_overbought
stoch_in_oversold = k < stoch_oversold

confluence_sell = wt_cross_down and wt_in_overbought and stoch_in_overbought
confluence_buy = wt_cross_up and wt_in_oversold and stoch_in_oversold

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üé® WT VISUALIZATIOIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// WT Main Levels - WT Ana Seviyeler
hline(0, "Mid Line", color=color.gray, linewidth=1)
hline(80, "WT Max (+80)", color=color.rgb(255, 2, 2), linewidth=1)
hline(-80, "WT Min (-80)", color=color.green, linewidth=1)

// WT Hatlarƒ±
plot(wt1, "WT1", color=color.new(color.green, 0), linewidth=1)
plot(wt2, "WT2", color=color.new(color.red, 0), linewidth=1)

// WT Difference Area - WT Fark Alanƒ±
plot(showWTArea ? wt1 - wt2 : na, "WT Difference", 
     color=color.new(color.blue, 80), 
     style=plot.style_area)

// WT Intersection Points - WT Kesi≈üim Noktalarƒ±
plot(showWTCross and wt_cross ? wt2 : na, 
     "Intersection Out", 
     color=color.black, 
     style=plot.style_circles, 
     linewidth=1)

plot(showWTCross and wt_cross ? wt2 : na, 
     "Intersection In", 
     color=wt2 - wt1 > 0 ? color.rgb(253, 0, 0) : color.lime, 
     style=plot.style_circles, 
     linewidth=1)

// Candle Color - Mum Renklendirme
barcolor(colorBarsOnCross and wt_cross ? (wt2 - wt1 > 0 ? color.rgb(45, 1, 240) : color.yellow) : na, 
         title="Intersection Color")


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// üé® STOCHASTIC RSI G√ñRSELLE≈ûTƒ∞RME (Normalizasyon ile)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Stochastic'i WaveTrend √∂l√ßeƒüine normalize et (-100 ile +100 arasƒ±)
normalize_to_wt(value) =>
    // 0-100'den -100 ile +100'e d√∂n√º≈üt√ºr
    (value - 50) * 2

k_normalized = normalize_to_wt(k)
d_normalized = normalize_to_wt(d_line)

// Normalize edilmi≈ü Stochastic √ßizgileri
plot(k_normalized, "Stoch K (Normalized)", 
     color=color.new(color.orange, 0), 
     linewidth=1, 
     style=plot.style_line)

plot(d_normalized, "Stoch D (Normalized)", 
     color=color.new(color.purple, 0), 
     linewidth=1, 
     style=plot.style_line)

// Stochastic Seviye √áizgileri (0 ve 100'e kar≈üƒ±lƒ±k gelen normalize deƒüerler)
hline(normalize_to_wt(0), "Stoch Min (0)", 
      color=#ff9800, 
      linewidth=1)
hline(normalize_to_wt(100), "Stoch Max (100)", 
      color=#9c27b0, 
      linewidth=1)
