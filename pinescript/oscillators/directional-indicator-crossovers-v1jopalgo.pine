// SPDX-License-Identifier: MPL-2.0
// This Pine Script file is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © 2025 JopAlgo [JopAlgo]
//
// ORIGINAL WORK & ATTRIBUTION
//   Concept: Directional Movement Index (DMI) and Average Directional Index (ADX) by J. Welles Wilder Jr. (1978).
//   This script is an independent implementation in Pine Script v6 based on the publicly documented formulas.

//
// DESIGN CHOICES BY JopAlgo (this work):
//   • DI crossover logic with alert conditions.
//   • Visual dominance zones: shaded green (when +DI > -DI) and red (when -DI > +DI).
//   • Minimal crossover markers (tiny dots) for clarity.
//   • Modern Pine v6 syntax and plotting.
//
// DISCLAIMER
//   Provided “AS IS” for educational purposes only. Not financial advice. Trading involves substantial risk.
//   This work is independent and not affiliated with, sponsored by, or endorsed by TradingView.
//   Redistribution is allowed under MPL-2.0; please keep this header intact.
//
// PUBLISHING NOTE (TradingView)
//   • Category: Open-source script. Keep this header unchanged.
//   • No external links, emails, or promotions in the description.
//   • Title/short title must respect TradingView rules (shorttitle ≤ 10 characters).
//   • Do not imply affiliation with TradingView in title or description.
//@version=6
indicator("Directional Indicator Crossovers v1[JopAlgo]", shorttitle="DIXV1", overlay=false)

// === INPUTS ===
groupCalc   = "Calculation"
dilen       = input.int(20, "DI Length", minval=1, group=groupCalc)   // default 20
adxLen      = input.int(20, "ADX Length", minval=1, group=groupCalc)  // default 20
sMethod     = input.string("EMA", "Smoothing", options=["EMA","Wilder"], group=groupCalc,
             tooltip="EMA = faster & different from the standard Wilder (RMA).")

groupVis    = "Visuals"
showFill    = input.bool(true,  "Shade Control Zones", group=groupVis)
showMarks   = input.bool(true,  "Mark Crossovers", group=groupVis)
showADX     = input.bool(false, "Show ADX Line", group=groupVis)

groupSig    = "Signal Filter"
useAdxFilt  = input.bool(false, "Filter Crossovers by ADX", group=groupSig)
adxThr      = input.float(20.0, "ADX Threshold", minval=0, group=groupSig)

// === Smoother ===
smooth(src, len) =>
    sMethod == "EMA" ? ta.ema(src, len) : ta.rma(src, len)  // Wilder = RMA

// === Directional Movement ===
up   = ta.change(high)
down = -ta.change(low)
plusDM_raw  = (up > down and up > 0)   ? up   : 0.0
minusDM_raw = (down > up and down > 0) ? down : 0.0

tr   = ta.tr
den  = math.max(smooth(tr, dilen), 1e-10)

plusDI  = 100.0 * smooth(plusDM_raw,  dilen) / den
minusDI = 100.0 * smooth(minusDM_raw, dilen) / den

// === ADX (same smoothing for distinct curve vs default Wilder) ===
sumDI = plusDI + minusDI
dx    = sumDI == 0 ? 0.0 : math.abs(plusDI - minusDI) / sumDI
adx   = 100.0 * smooth(dx, adxLen)

// === Signals ===
bullX = ta.crossover(plusDI,  minusDI)
bearX = ta.crossover(minusDI, plusDI)
sigBull = useAdxFilt ? (bullX and adx > adxThr) : bullX
sigBear = useAdxFilt ? (bearX and adx > adxThr) : bearX

// === Plots ===
pPlus  = plot(plusDI,  "+DI", color=color.lime, linewidth=2, style=plot.style_stepline)
pMinus = plot(minusDI, "-DI", color=color.red,  linewidth=2, style=plot.style_stepline)
plot(adx, "ADX", color=color.new(color.white, 0), linewidth=2,
     display = showADX ? display.all : display.none)

// Shade control zones
fill(pPlus,  pMinus, color = (showFill and plusDI  > minusDI) ? color.new(color.lime, 85) : na, title="Bull Zone")
fill(pMinus, pPlus,  color = (showFill and minusDI > plusDI ) ? color.new(color.red,  85) : na, title="Bear Zone")

// Minimal crossover markers (tiny dots)
plotshape(showMarks and sigBull, title="Bullish DI Crossover",  location=location.top,    style=shape.circle, size=size.tiny, color=color.lime)
plotshape(showMarks and sigBear, title="Bearish DI Crossover", location=location.bottom, style=shape.circle, size=size.tiny, color=color.red)

// Alerts
alertcondition(sigBull, "Bullish DI Crossover", "Bullish DI crossover (+DI over -DI).")
alertcondition(sigBear, "Bearish DI Crossover", "Bearish DI crossover (-DI over +DI).")
