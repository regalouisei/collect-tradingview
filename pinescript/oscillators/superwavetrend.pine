// ─────────────────────────────
// SuperWaveTrend
// 作者：BigTrunks
// 版本：1.0
// ─────────────────────────────
//@version=6
indicator(title="WaveTrend with Crosses + HyperWave + Confluence Zones + Thresholds", shorttitle="SuperWaveTrend", overlay=false)

n1 = input.int(10, "Channel Length")
n2 = input.int(21, "Average Length")
obLevel1 = input.int(70, "Over Bought Level 1")
obLevel2 = input.int(60, "Over Bought Level 2")
osLevel1 = input.int(-70, "Over Sold Level 1")
osLevel2 = input.int(-60, "Over Sold Level 2")
hwDelta  = input.int(20, "HyperWave Delta")
thresholdGap = input.float(5.0, "Threshold Gap")

ap = hlc3
esa = ta.ema(ap, n1)
d = ta.ema(math.abs(ap - esa), n1)
ci = (ap - esa) / (0.015 * d)
tci = ta.ema(ci, n2)

wt1 = tci
wt2 = ta.sma(wt1, 4)

// ✅ HyperWave 背景区域
hwUpper = obLevel1 + hwDelta
hwLower = osLevel1 - hwDelta
isHyperUp = wt1 > hwUpper
isHyperDown = wt1 < hwLower
bgcolor(isHyperUp ? color.new(color.fuchsia, 85) : na, title="HyperWave 上升区域")
bgcolor(isHyperDown ? color.new(color.orange, 85) : na, title="HyperWave 下降区域")

// ✅ Confluence Zones 背景
isConfluenceTop = wt1 > obLevel2 and wt1 > wt2
isConfluenceBottom = wt1 < osLevel2 and wt1 < wt2
bgcolor(isConfluenceTop ? color.new(#e7b323, 86) : na, title="Confluence 顶部区域")
bgcolor(isConfluenceBottom ? color.new(#aacadd, 67) : na, title="Confluence 底部区域")

// ✅ Threshold 区域
isInThreshold = math.abs(wt1 - wt2) < thresholdGap
bgcolor(isInThreshold ? color.new(#787b86, 98) : na, title="Threshold 犹豫区域")

// ✅ 主图绘制（参考线）
plot(0, color=color.gray, title="中轴线")
plot(obLevel1, color=color.rgb(251, 149, 149, 21), title="超买线 1")
plot(obLevel2, color=color.rgb(247, 124, 124), title="超买线 2")
plot(osLevel1, color=color.rgb(144, 167, 145), title="超卖线 1")
plot(osLevel2, color=color.rgb(19, 111, 22), title="超卖线 2")

// ✅ 主指标线
plot(wt1, color=color.rgb(132, 210, 134), title="WT 主线 (wt1)")
plot(wt2, color=color.rgb(253, 166, 166), title="WT 信号线 (wt2)")
plot(wt1 - wt2, style=plot.style_area, color=color.new(color.blue, 80), title="WT 面积差 (wt1-wt2)")

// ✅ Cross 点提示
isCross = ta.cross(wt1, wt2)
plot(isCross ? wt2 : na, color=color.black, style=plot.style_circles, linewidth=3, title="交叉点 - 底色")
plot(isCross ? wt2 : na, color=(wt2 - wt1 > 0 ? color.red : color.lime), style=plot.style_circles, linewidth=2, title="交叉点 - 方向色")
barcolor(isCross ? (wt2 - wt1 > 0 ? color.aqua : color.yellow) : na, title="交叉柱体颜色")
