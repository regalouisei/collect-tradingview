//@version=6
indicator("XAUUSD Family Scalping (5min)", overlay = true, max_bars_back = 500)

// === INPUTS ===
len = input.int(30, "Length", group="Core Settings")
scale = input.float(200.0, "Scale (%)", minval=100, group="Core Settings")
signalLen = input.int(20, "Signal Length", group="Core Settings")
overbought = input.float(58, "Overbought", group="Levels")
oversold = input.float(-58, "Oversold", group="Levels")

// === CALCULATIONS ===
mid = ta.sma((high + low) / 2, len)
rng = ta.sma(high - low, len)
body = ta.sma(math.abs(close - open), len)
offset = rng * scale / 100 * (1 + body / math.max(rng, 1e-10))
up = mid + offset
dn = mid - offset
band = math.max(up - dn, 1e-10)
osc = 100 * (close - dn) / band - 50
sig = ta.sma(osc, signalLen)

// === SIGNALS ===
buySignal = ta.crossover(osc, oversold)
sellSignal = ta.crossunder(osc, overbought)

// === COLORS ===
bullColor = color.new(color.lime, 0)
bearColor = color.new(color.red, 0)
neutralColor = color.new(color.gray, 85)

// === BACKGROUND DIRECTION ===
bgcolor(osc > sig ? color.new(bullColor, 90) : osc < sig ? color.new(bearColor, 90) : na)

// === SIGNAL SHAPES ===
plotshape(buySignal, title="Buy", location=location.belowbar, color=color.new(color.lime,0),
     style=shape.triangleup, size=size.large, text="BUY", textcolor=color.white)
plotshape(sellSignal, title="Sell", location=location.abovebar, color=color.new(color.red,0),
     style=shape.triangledown, size=size.large, text="SELL", textcolor=color.white)

// === TREND LINE ===
plot(osc, title="VCO", color=color.new(osc > sig ? color.lime : color.red, 0), linewidth=2)
plot(sig, title="Signal", color=color.new(color.yellow, 0), linewidth=1)
hline(0, "Zero", color=color.new(color.gray, 60))
hline(overbought, "Overbought", color=color.new(color.red, 60), linestyle=hline.style_dotted)
hline(oversold, "Oversold", color=color.new(color.green, 60), linestyle=hline.style_dotted)

// === ALERTS ===
alertcondition(buySignal, title="Buy Signal", message="BUY: Oscillator crossed above oversold (-58)")
alertcondition(sellSignal, title="Sell Signal", message="SELL: Oscillator crossed below overbought (58)")
