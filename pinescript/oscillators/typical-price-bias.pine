//@version=6
indicator("Typical Price Bias", timeframe = "", timeframe_gaps = true)

fastLenInput = input.int(13, "Fast length", minval = 1)
slowLenInput = input.int(26, "Slow length", minval = 1)

oscTypeInput = input.string("EMA", "Oscillator MA type",
     ["NONE","EMA","SMA","RMA","VWMA","WMA","ALMA","SWMA","HMA"],
     display = display.data_window)

ma(float source, int length, simple string maType) =>
    switch maType
        "NONE" => source
        "EMA"  => ta.ema(source, length)
        "SMA"  => ta.sma(source, length)
        "RMA"  => ta.rma(source, length)
        "VWMA" => ta.vwma(source, length)
        "WMA"  => ta.wma(source, length)
        "ALMA" => ta.alma(source, length, 0.85, 6)
        "SWMA" => ta.swma(source)
        "HMA"  => ta.hma(source, length)

den = nz(hl2[1], hl2)
den := den == 0.0 ? 1e-10 : den

fast = (ma(close, fastLenInput, oscTypeInput) - ma(hl2, fastLenInput, oscTypeInput)) / den
base = (ma(close, slowLenInput, oscTypeInput) - ma(hl2, slowLenInput, oscTypeInput)) / den

col = fast >= 0
     ? (fast > fast[1] ? #26a69a : #b2dfdb)
     : (fast > fast[1] ? #ffcdd2 : #ff5252)

hline(0, "Zero", color.new(#787b86, 50))
plot(base, "Baseline", color=color.gray, linewidth=1)
plot(fast, "Fast bias", color=col, linewidth=2)
