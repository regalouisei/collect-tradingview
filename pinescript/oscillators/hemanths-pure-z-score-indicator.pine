// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © GHemanth04

//@version=5
indicator("Hemanth's Pure Z-Score Indicator", overlay=false, shorttitle="Z-Score")

// --- User Inputs ---
length = input.int(20, "Z-Score Length")
upperLevel = input.float(2.0, "Overbought Level")
lowerLevel = input.float(-2.0, "Oversold Level")
useEMA = input.bool(true, "Use EMA instead of SMA for Basis")
smoothLength = input.int(3, "Smooth Z-Score (0 = no smoothing)")
smoothingType = input.string("SMA", "Smoothing Type", options=["SMA", "EMA"])

// --- Colors & Appearance ---
zColor = input.color(color.blue, "Z-Score Line Color")
overColor = input.color(color.red, "Overbought Band Color")
underColor = input.color(color.green, "Oversold Band Color")
meanColor = input.color(color.gray, "Mean Line Color")
bgOpacity = input.int(85, "Highlight Opacity (0-255)", minval=0, maxval=255)

// --- Basis & Std Dev ---
basis = useEMA ? ta.ema(close, length) : ta.sma(close, length)
dev = ta.stdev(close, length)
z = (close - basis) / dev

// --- Optional Smoothing ---
zPlot = smoothLength > 1 ? (smoothingType == "SMA" ? ta.sma(z, smoothLength) : ta.ema(z, smoothLength)) : z

// --- Plot Z-Score ---
plot(zPlot, "Z-Score", color=zColor, linewidth=2)

// --- Key Levels ---
hOB = hline(upperLevel, "Overbought", color=overColor, linestyle=hline.style_dashed)
hMean = hline(0, "Mean", color=meanColor)
hOS = hline(lowerLevel, "Oversold", color=underColor, linestyle=hline.style_dashed)
fill(hOB, hOS, color=color.new(color.gray, bgOpacity))

// --- Highlight extremes ---
bgcolor(zPlot > upperLevel ? color.new(overColor, bgOpacity) : zPlot < lowerLevel ? color.new(underColor, bgOpacity) : na)

// --- Alerts ---
alertcondition(zPlot > upperLevel, "Overbought", "Z-Score crossed above upper level")
alertcondition(zPlot < lowerLevel, "Oversold", "Z-Score crossed below lower level")
alertcondition(ta.crossover(zPlot, 0), "Mean Cross Up", "Z-Score crossed above mean")
alertcondition(ta.crossunder(zPlot, 0), "Mean Cross Down", "Z-Score crossed below mean")
