// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © wjdtks255

// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Gemini_Assistant

//@version=5
indicator("AI Reversal Signals [Customizable]", overlay=true)

// --- [1. 설정 및 언어 선택] ---
// 초기값을 "English"로 설정하여 영어로 시작하게 함
i_lang = input.string("English", "Language / 언어 선택", options=["English", "Korean"])

// 초기값을 false로 설정하여 처음에는 모든 신호가 보이게 함
showOnlyLast = input.bool(false, "Show Only Last Signal? / 최신 신호만 표시", group="Global / 기본 설정")

// --- [2. 리스크 및 로직 설정] ---
rsiLen  = input.int(14, "RSI Length / RSI 길이", group="Logic / 매매 로직")
atrLen  = input.int(14, "ATR Length / ATR 길이", group="Risk / 리스크 관리")
tp1Mult = input.float(1.5, "TP 1 Mult / 익절1 배수", group="Risk / 리스크 관리")
tp2Mult = input.float(3.0, "TP 2 Mult / 익절2 배수", group="Risk / 리스크 관리")
slMult  = input.float(1.5, "SL Mult / 손절 배수", group="Risk / 리스크 관리")

// --- [3. 표시 옵션] ---
showEntry = input.bool(true, "Show Entry / 진입가 표시", group="Display / 화면 표시")
showSL    = input.bool(true, "Show SL / 손절가 표시", group="Display / 화면 표시")
showTP1   = input.bool(true, "Show TP 1 / 익절1 표시", group="Display / 화면 표시")
showTP2   = input.bool(true, "Show TP 2 / 익절2 표시", group="Display / 화면 표시")

// --- [4. 계산 로직] ---
rsiVal = ta.rsi(close, rsiLen)
atrVal = ta.atr(atrLen)
longCond  = ta.crossover(rsiVal, 30) and close > open
shortCond = ta.crossunder(rsiVal, 70) and close < open

var float ep = na, var float sl = na, var float tp1 = na, var float tp2 = na
var label lastLabel = na 

if (longCond or shortCond)
    // 사용자가 체크박스를 켰을 때만 이전 라벨 삭제
    if showOnlyLast and not na(lastLabel)
        label.delete(lastLabel)

    ep  := close
    sl  := longCond ? low - (atrVal * slMult) : high + (atrVal * slMult)
    tp1 := longCond ? close + (atrVal * tp1Mult) : close - (atrVal * tp1Mult)
    tp2 := longCond ? close + (atrVal * tp2Mult) : close - (atrVal * tp2Mult)

    isKo = i_lang == "Korean"
    txt_sig = (longCond ? (isKo ? "매수" : "LONG") : (isKo ? "매도" : "SHORT")) + "\n" +
              (showEntry ? (isKo ? "진입" : "EP") + ": " + str.tostring(ep, "#.#") + "\n" : "") +
              (showSL ? (isKo ? "손절" : "SL") + ": " + str.tostring(sl, "#.#") + "\n" : "") +
              (showTP1 ? (isKo ? "익절1" : "TP1") + ": " + str.tostring(tp1, "#.#") + "\n" : "") +
              (showTP2 ? (isKo ? "익절2" : "TP2") + ": " + str.tostring(tp2, "#.#") : "")
    
    lastLabel := label.new(bar_index, longCond ? low : high, txt_sig, 
                           color=longCond ? color.green : color.red, 
                           textcolor=color.white, 
                           style=longCond ? label.style_label_up : label.style_label_down)

    // 알림 메시지 (언어 설정 연동)
    alert_msg = (longCond ? (isKo ? "매수 신호!" : "LONG Signal!") : (isKo ? "매도 신호!" : "SHORT Signal!")) + " 가격: " + str.tostring(close)
    alert(alert_msg, alert.freq_once_per_bar_close)

// --- [5. 라인 출력] ---
// showOnlyLast가 꺼져 있으면 모든 구간에서 선을 그림
isLastArea = ta.barssince(longCond or shortCond) >= 0
plot_cond = not showOnlyLast or isLastArea

plot(showEntry and plot_cond ? ep : na, "Entry", color.gray, 1, plot.style_linebr)
plot(showTP1   and plot_cond ? tp1 : na, "TP1", color.lime, 1, plot.style_linebr)
plot(showTP2   and plot_cond ? tp2 : na, "TP2", color.green, 2, plot.style_linebr)
plot(showSL    and plot_cond ? sl : na, "SL", color.red, 2, plot.style_linebr)
