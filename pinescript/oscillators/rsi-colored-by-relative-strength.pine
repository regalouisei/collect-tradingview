//@version=6
indicator("RSI Colored by Relative Strength", overlay=true, max_lines_count=500, max_labels_count=500)

// === INPUTS ===
src             = input.source(close, "Source")
benchmarkSymbol = input.symbol("SPY", "Benchmark Symbol (e.g., SPY, QQQ, BTCUSD)")
rsiLength       = input.int(14, "RSI Length", minval=2)
rsSmoothLength  = input.int(20, "RS Smoothing Length", minval=1)
labelSpacing    = input.int(50, "Bars Between Labels", minval=1)
showMarkers     = input.bool(true, "Show Mini Markers Between Labels?")
showBackground  = input.bool(true, "Show RS Gradient Background?")

// === DATA ===
benchmarkClose = request.security(benchmarkSymbol, timeframe.period, close)
rs = src / benchmarkClose
rsSmoothed = ta.sma(rs, rsSmoothLength)
rsi = ta.rsi(src, rsiLength)

// === COLOR LOGIC FOR RSI ===
rsiColor = rsSmoothed > 1 ? color.new(color.lime, 0) : color.new(color.red, 0)

// === GRADIENT BACKGROUND ===
neutralZone = 0.02  // within Â±2% of benchmark = neutral
strength = math.abs(rsSmoothed - 1)
normStrength = math.min(strength / 0.2, 1.0)  // cap at Â±20% deviation
opacity = 97 - (normStrength * 20)
bgColor = rsSmoothed > 1 + neutralZone ? color.new(color.lime, opacity) :
           rsSmoothed < 1 - neutralZone ? color.new(color.red, opacity) :
           color.new(color.gray, 94)
bgcolor(showBackground ? bgColor : na, title="RS Gradient Background")

// === PLOT RSI ===
plot(rsi, title="RSI (RS-colored)", color=rsiColor, linewidth=2)
hline(70, "Overbought", color=color.new(color.gray, 70))
hline(30, "Oversold", color=color.new(color.gray, 70))
hline(50, "Midline", color=color.new(color.gray, 80))

// === TRIGGERS ===
bullishTrigger = ta.crossover(rsi, 50) and rsSmoothed > 1
bearishTrigger = ta.crossunder(rsi, 50) and rsSmoothed < 1

alertcondition(bullishTrigger, title="RSI+RS Bullish Alignment",
     message="RSI crossed above 50 while RS > 1 â€” momentum confirmation")
alertcondition(bearishTrigger, title="RSI+RS Bearish Alignment",
     message="RSI crossed below 50 while RS < 1 â€” downside confirmation")

// === LABEL CONTROL ===
var int lastLabelBar = na

newBullishLabel = bullishTrigger and (na(lastLabelBar) or bar_index - lastLabelBar > labelSpacing)
newBearishLabel = bearishTrigger and (na(lastLabelBar) or bar_index - lastLabelBar > labelSpacing)

// === LABELS ===
if newBullishLabel
    label.new(bar_index, rsi, text="RSI>50 + RS>1 âœ…", 
              style=label.style_label_up, color=color.new(color.lime, 0), textcolor=color.black)
    lastLabelBar := bar_index

if newBearishLabel
    label.new(bar_index, rsi, text="RSI<50 + RS<1 ðŸ”»", 
              style=label.style_label_down, color=color.new(color.red, 0), textcolor=color.white)
    lastLabelBar := bar_index

// === GLOBAL MARKERS ===
plotshape(showMarkers and bullishTrigger, style=shape.triangleup, 
     color=color.new(color.lime, 0), size=size.tiny, title="Bull Marker")
plotshape(showMarkers and bearishTrigger, style=shape.triangledown, 
     color=color.new(color.red, 0), size=size.tiny, title="Bear Marker")

// Â© TylerisTrading
