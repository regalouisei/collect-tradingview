// This source code is subject to the terms of the MIT License
// © 2025 DCAUT

//@version=6
indicator("RSI Bollinger Bands [DCAUT]", "RSI-BB [DCAUT]", overlay=false, timeframe='', timeframe_gaps=true)

// RSI Bollinger Bands
// Combines RSI momentum measurement with Bollinger Bands volatility analysis
// to create adaptive overbought/oversold zones that adjust to market conditions
//
// Signal Interpretation:
// • RSI breaking above upper band (green fill): Strong bullish momentum, dynamic overbought zone
// • RSI breaking below lower band (red fill): Weak bearish momentum, dynamic oversold zone
// • RSI near middle band indicates momentum balance
// • Band squeeze (narrowing width) signals volatility compression and potential breakout
// • Band expansion indicates increasing volatility and trend acceleration
//
// Primary Applications:
// • Adaptive overbought/oversold identification without fixed thresholds
// • Momentum volatility analysis and regime detection
// • Mean reversion trading signals with volatility context
// • Breakout preparation alerts (BB squeeze patterns)
// • Trend strength confirmation when RSI rides upper/lower bands

import DCAUT/TA/3 as dta

// Input parameters
rsiSource       = input.source(close, "RSI Source", tooltip="Price data source for RSI calculation")
rsiLength       = input.int(14, "RSI Length", minval=1, tooltip="Period for RSI calculation - standard is 14")
rsiMaType       = input.enum(dta.MaType.RMA, "RSI MA Type", tooltip="Moving average type for RSI smoothing - RMA is standard")
bbLength        = input.int(20, "BB Length", minval=1, tooltip="Period for Bollinger Bands calculation on RSI - higher values produce smoother bands")
bbMaType        = input.enum(dta.MaType.SMA, "BB MA Type", tooltip="Moving average type for BB basis line - SMA is standard")
bbMultiplier    = input.float(2.0, "BB Multiplier", minval=0.1, step=0.1, tooltip="Standard deviation multiplier - higher values widen the bands")

// Calculate RSI
rsiValue = dta.rsi(rsiSource, rsiLength, rsiMaType)

// Calculate Bollinger Bands on RSI
[bbBasis, bbUpper, bbLower] = dta.bb(rsiValue, bbLength, bbMultiplier, bbMaType)

// Plots
hline(50, "Midline", color=color.new(color.gray, 70), linestyle=hline.style_dotted)

// Bollinger Bands
upperBand = plot(bbUpper, "Upper Band", color=color.new(#787B86, 40), linewidth=1)
basisLine = plot(bbBasis, "Basis", color=color.new(#787B86, 40), linewidth=1)
lowerBand = plot(bbLower, "Lower Band", color=color.new(#787B86, 40), linewidth=1)

// Band fill
fill(upperBand, lowerBand, color=color.new(#787B86, 92), title="Band Fill")

// RSI line and overbought/oversold fills
rsiLine = plot(rsiValue, "RSI", color=#2962FF, linewidth=2)

// Overbought zone (RSI above upper band)
fill(rsiLine, upperBand, color=rsiValue > bbUpper ? color.new(color.green, 70) : na, title="Overbought Fill")

// Oversold zone (RSI below lower band)
fill(rsiLine, lowerBand, color=rsiValue < bbLower ? color.new(color.red, 70) : na, title="Oversold Fill")

// Alert conditions
alertcondition(ta.crossover(rsiValue, bbUpper), title='RSI Overbought', message='RSI crossed above upper band - dynamic overbought zone')
alertcondition(ta.crossunder(rsiValue, bbLower), title='RSI Oversold', message='RSI crossed below lower band - dynamic oversold zone')
alertcondition(ta.crossover(rsiValue, bbBasis), title='RSI Rising Above Basis', message='RSI crossed above middle band - bullish momentum shift')
alertcondition(ta.crossunder(rsiValue, bbBasis), title='RSI Falling Below Basis', message='RSI crossed below middle band - bearish momentum shift')

// Band squeeze detection
bandWidth = bbUpper - bbLower
narrowBand = bandWidth <= ta.lowest(bandWidth[1], 100)
alertcondition(narrowBand, title='Band Squeeze', message='Bollinger Bands squeezed - volatility compression detected')
