//@version=6
indicator("Nuh's Complete Multi-Timeframe Dashboard v4.0 - Unified Power System", overlay=true, max_labels_count=500, max_lines_count=500)

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// Â© 2025 Nuh KoÃ§ - nuhkoc@gmail.com - Multi-Timeframe Power Dashboard
// Uses publicly available technical indicators with custom weighting system
// Free for personal use - Commercial use requires attribution
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// SETTINGS
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Active Timeframes
activeTimeframes = input.int(6, "Active Timeframes", minval=1, maxval=6, group="Timeframes")

// Timeframe Settings
tf1 = input.timeframe("5", "Timeframe 1", group="Timeframes")
tf2 = input.timeframe("15", "Timeframe 2", group="Timeframes") 
tf3 = input.timeframe("60", "Timeframe 3", group="Timeframes")
tf4 = input.timeframe("240", "Timeframe 4", group="Timeframes")
tf5 = input.timeframe("D", "Timeframe 5", group="Timeframes")
tf6 = input.timeframe("W", "Timeframe 6", group="Timeframes")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATOR SELECTION - ORGANIZED BY CATEGORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Trend Indicators
enableTrend = input.bool(true, "Enable Trend (EMA)", group="ğŸ“ˆ Trend Indicators")
enableAlphaTrend = input.bool(true, "Enable Alpha Trend", group="ğŸ“ˆ Trend Indicators")
enableSuperTrend = input.bool(true, "Enable SuperTrend", group="ğŸ“ˆ Trend Indicators")
enableADX = input.bool(true, "Enable ADX", group="ğŸ“ˆ Trend Indicators")
enableDI = input.bool(true, "Enable DI+/DI-", group="ğŸ“ˆ Trend Indicators")

// Momentum Indicators
enableRSI = input.bool(true, "Enable RSI", group="âš¡ Momentum Indicators")
enableStochRSI = input.bool(true, "Enable Stochastic RSI", group="âš¡ Momentum Indicators")
enableMACD = input.bool(true, "Enable MACD", group="âš¡ Momentum Indicators")
enableCCI = input.bool(true, "Enable CCI", group="âš¡ Momentum Indicators")
enableWilliamsR = input.bool(true, "Enable Williams %R", group="âš¡ Momentum Indicators")
enableWaveTrend = input.bool(true, "Enable WaveTrend", group="âš¡ Momentum Indicators")
enableKST = input.bool(true, "Enable KST", group="âš¡ Momentum Indicators")

// Volume Indicators
enableOBV = input.bool(true, "Enable OBV", group="ğŸ“Š Volume Indicators")
enableCMF = input.bool(true, "Enable CMF", group="ğŸ“Š Volume Indicators")
enableVolume = input.bool(true, "Enable Volume", group="ğŸ“Š Volume Indicators")
enableMFI = input.bool(true, "Enable MFI", group="ğŸ“Š Volume Indicators")

// Volatility & Other
enableSqueeze = input.bool(true, "Enable Squeeze Momentum", group="ğŸ¯ Volatility & Other")
enableBollinger = input.bool(true, "Enable Bollinger Bands", group="ğŸ¯ Volatility & Other")
enableATR = input.bool(true, "Enable ATR", group="ğŸ¯ Volatility & Other")
enableVixFix = input.bool(true, "Enable Williams VIX Fix", group="ğŸ¯ Volatility & Other")

// Display Order - 20 Indicators
displayOrder1 = input.string("Trend", "Row 1", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder2 = input.string("Alpha", "Row 2", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder3 = input.string("SuperTrend", "Row 3", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder4 = input.string("RSI", "Row 4", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder5 = input.string("StochRSI", "Row 5", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder6 = input.string("MACD", "Row 6", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder7 = input.string("WaveTrend", "Row 7", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder8 = input.string("OBV", "Row 8", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder9 = input.string("CMF", "Row 9", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder10 = input.string("Volume", "Row 10", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder11 = input.string("MFI", "Row 11", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder12 = input.string("Squeeze", "Row 12", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder13 = input.string("CCI", "Row 13", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder14 = input.string("%R", "Row 14", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder15 = input.string("KST", "Row 15", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder16 = input.string("ADX", "Row 16", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder17 = input.string("DI", "Row 17", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder18 = input.string("Bollinger", "Row 18", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder19 = input.string("ATR", "Row 19", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")
displayOrder20 = input.string("VIX", "Row 20", options=["Trend", "Alpha", "SuperTrend", "ADX", "DI", "RSI", "StochRSI", "MACD", "CCI", "%R", "WaveTrend", "KST", "OBV", "CMF", "Volume", "MFI", "Squeeze", "Bollinger", "ATR", "VIX"], group="Display Order")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INDICATOR PARAMETERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Trend Settings
emaLength = input.int(200, "EMA Period", minval=1, group="Trend Settings")
alphaLength = input.int(14, "Alpha Trend Period", minval=1, group="Trend Settings")
alphaMult = input.float(1.0, "Alpha Multiplier", minval=0.1, group="Trend Settings")
superTrendLength = input.int(10, "SuperTrend ATR Period", minval=1, group="Trend Settings")
superTrendMult = input.float(3.0, "SuperTrend ATR Multiplier", minval=0.1, group="Trend Settings")
adxLength = input.int(14, "ADX Period", minval=1, group="Trend Settings")
adxSmoothing = input.int(14, "ADX Smoothing", minval=1, group="Trend Settings")

// Momentum Settings
rsiLength = input.int(14, "RSI Period", minval=1, group="Momentum Settings")
rsiOverbought = input.float(70, "RSI Overbought", minval=50, maxval=100, group="Momentum Settings")
rsiOversold = input.float(30, "RSI Oversold", minval=0, maxval=50, group="Momentum Settings")
stochRSILength = input.int(14, "Stochastic RSI Period", minval=1, group="Momentum Settings")
stochRSIK = input.int(3, "Stochastic K", minval=1, group="Momentum Settings")
stochRSIOverbought = input.int(80, "StochRSI Overbought", minval=50, maxval=100, group="Momentum Settings")
stochRSIOversold = input.int(20, "StochRSI Oversold", minval=0, maxval=50, group="Momentum Settings")
macdFast = input.int(12, "MACD Fast", minval=1, group="Momentum Settings")
macdSlow = input.int(26, "MACD Slow", minval=1, group="Momentum Settings")
macdSignal = input.int(9, "MACD Signal", minval=1, group="Momentum Settings")
cciLength = input.int(20, "CCI Period", minval=1, group="Momentum Settings")
cciOverbought = input.int(100, "CCI Overbought", minval=50, maxval=200, group="Momentum Settings")
cciOversold = input.int(-100, "CCI Oversold", minval=-200, maxval=-50, group="Momentum Settings")
williamsLength = input.int(14, "Williams %R Period", minval=1, group="Momentum Settings")
williamsOverbought = input.int(-20, "Williams Overbought", minval=-50, maxval=0, group="Momentum Settings")
williamsOversold = input.int(-80, "Williams Oversold", minval=-100, maxval=-50, group="Momentum Settings")
wtChannelLen = input.int(10, "WaveTrend Channel", minval=1, group="Momentum Settings")
wtAverageLen = input.int(21, "WaveTrend Average", minval=1, group="Momentum Settings")
wtOverbought = input.int(60, "WaveTrend Overbought", minval=0, maxval=100, group="Momentum Settings")
wtOversold = input.int(-60, "WaveTrend Oversold", minval=-100, maxval=0, group="Momentum Settings")
kstROC1 = input.int(10, "KST ROC1", minval=1, group="Momentum Settings")
kstROC2 = input.int(15, "KST ROC2", minval=1, group="Momentum Settings")
kstROC3 = input.int(20, "KST ROC3", minval=1, group="Momentum Settings")
kstROC4 = input.int(30, "KST ROC4", minval=1, group="Momentum Settings")
kstSMA1 = input.int(10, "KST SMA1", minval=1, group="Momentum Settings")
kstSMA2 = input.int(10, "KST SMA2", minval=1, group="Momentum Settings")
kstSMA3 = input.int(10, "KST SMA3", minval=1, group="Momentum Settings")
kstSMA4 = input.int(15, "KST SMA4", minval=1, group="Momentum Settings")
kstSignalLength = input.int(9, "KST Signal", minval=1, group="Momentum Settings")

// Volume Settings
obvUseEMA = input.bool(true, "OBV Use EMA", group="Volume Settings")
obvEMALength = input.int(20, "OBV EMA Period", minval=1, group="Volume Settings")
cmfLength = input.int(20, "CMF Period", minval=1, group="Volume Settings")
volumeMALength = input.int(20, "Volume MA Period", minval=1, group="Volume Settings")
volumeThreshold = input.float(1.5, "Volume Threshold", minval=1.0, group="Volume Settings")
mfiLength = input.int(14, "MFI Period", minval=1, group="Volume Settings")
mfiOverbought = input.int(80, "MFI Overbought", minval=50, maxval=100, group="Volume Settings")
mfiOversold = input.int(20, "MFI Oversold", minval=0, maxval=50, group="Volume Settings")

// Volatility Settings
squeezeBBLength = input.int(20, "Squeeze BB Period", minval=1, group="Volatility Settings")
squeezeBBMult = input.float(2.0, "Squeeze BB Mult", minval=0.1, group="Volatility Settings")
squeezeKCLength = input.int(20, "Squeeze KC Period", minval=1, group="Volatility Settings")
squeezeKCMult = input.float(1.5, "Squeeze KC Mult", minval=0.1, group="Volatility Settings")
bbLength = input.int(20, "Bollinger Period", minval=1, group="Volatility Settings")
bbMult = input.float(2.0, "Bollinger Mult", minval=0.1, group="Volatility Settings")
atrLength = input.int(14, "ATR Period", minval=1, group="Volatility Settings")
atrHighThreshold = input.float(1.5, "ATR High Threshold", minval=0.1, group="Volatility Settings")
vixFixLength = input.int(22, "VIX Fix Period", minval=1, group="Volatility Settings")
vixFixStdDev = input.float(2.0, "VIX Fix StdDev", minval=0.1, group="Volatility Settings")
vixFixThreshold = input.int(50, "VIX Fix Threshold", minval=0, maxval=100, group="Volatility Settings")

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// WEIGHTED POWER SYSTEM - INDICATOR WEIGHTS
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

weightingPreset = input.string("Balanced", "Weighting Preset", 
     options=["Balanced", "Trend Focus", "Momentum Focus", "Volume Focus", "Custom"], 
     group="ğŸ¯ Power System", 
     tooltip="Balanced: Equal emphasis\nTrend Focus: Favor trend indicators\nMomentum Focus: Favor momentum\nVolume Focus: Favor volume\nCustom: Your weights")

// Custom weights (grouped logically)
weightTrend = input.int(3, "Trend Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Trend")
weightAlpha = input.int(3, "Alpha Trend Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Trend")
weightSuperTrend = input.int(3, "SuperTrend Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Trend")
weightADX = input.int(2, "ADX Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Trend")
weightDI = input.int(2, "DI Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Trend")

weightRSI = input.int(2, "RSI Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Momentum")
weightStochRSI = input.int(2, "Stochastic RSI Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Momentum")
weightMACD = input.int(3, "MACD Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Momentum")
weightCCI = input.int(2, "CCI Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Momentum")
weightWilliamsR = input.int(2, "Williams %R Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Momentum")
weightWaveTrend = input.int(2, "WaveTrend Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Momentum")
weightKST = input.int(2, "KST Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Momentum")

weightOBV = input.int(3, "OBV Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Volume")
weightCMF = input.int(3, "CMF Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Volume")
weightVolume = input.int(3, "Volume Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Volume")
weightMFI = input.int(2, "MFI Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Volume")

weightSqueeze = input.int(3, "Squeeze Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Volatility")
weightBollinger = input.int(2, "Bollinger Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Volatility")
weightATR = input.int(1, "ATR Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Volatility")
weightVixFix = input.int(2, "VIX Fix Weight", minval=1, maxval=5, group="ğŸ¯ Custom - Volatility")

f_getIndicatorWeight(indicator) =>
    weight = 2
    
    if weightingPreset == "Balanced"
        weight := switch indicator
            "Trend" => 3
            "Alpha" => 3
            "SuperTrend" => 3
            "ADX" => 2
            "DI" => 2
            "RSI" => 2
            "StochRSI" => 2
            "MACD" => 3
            "CCI" => 2
            "%R" => 2
            "WaveTrend" => 2
            "KST" => 2
            "OBV" => 3
            "CMF" => 3
            "Volume" => 3
            "MFI" => 2
            "Squeeze" => 3
            "Bollinger" => 2
            "ATR" => 1
            "VIX" => 2
            => 2
    
    else if weightingPreset == "Trend Focus"
        weight := switch indicator
            "Trend" => 5
            "Alpha" => 5
            "SuperTrend" => 5
            "ADX" => 4
            "DI" => 4
            "RSI" => 1
            "StochRSI" => 1
            "MACD" => 2
            "CCI" => 1
            "%R" => 1
            "WaveTrend" => 1
            "KST" => 2
            "OBV" => 2
            "CMF" => 2
            "Volume" => 2
            "MFI" => 1
            "Squeeze" => 3
            "Bollinger" => 1
            "ATR" => 1
            "VIX" => 2
            => 2
    
    else if weightingPreset == "Momentum Focus"
        weight := switch indicator
            "Trend" => 1
            "Alpha" => 1
            "SuperTrend" => 1
            "ADX" => 2
            "DI" => 2
            "RSI" => 5
            "StochRSI" => 5
            "MACD" => 5
            "CCI" => 4
            "%R" => 4
            "WaveTrend" => 5
            "KST" => 4
            "OBV" => 2
            "CMF" => 2
            "Volume" => 2
            "MFI" => 3
            "Squeeze" => 3
            "Bollinger" => 3
            "ATR" => 1
            "VIX" => 2
            => 2
    
    else if weightingPreset == "Volume Focus"
        weight := switch indicator
            "Trend" => 2
            "Alpha" => 2
            "SuperTrend" => 2
            "ADX" => 1
            "DI" => 1
            "RSI" => 2
            "StochRSI" => 2
            "MACD" => 2
            "CCI" => 2
            "%R" => 2
            "WaveTrend" => 2
            "KST" => 2
            "OBV" => 5
            "CMF" => 5
            "Volume" => 5
            "MFI" => 4
            "Squeeze" => 3
            "Bollinger" => 2
            "ATR" => 1
            "VIX" => 2
            => 2
    
    else if weightingPreset == "Custom"
        weight := switch indicator
            "Trend" => weightTrend
            "Alpha" => weightAlpha
            "SuperTrend" => weightSuperTrend
            "ADX" => weightADX
            "DI" => weightDI
            "RSI" => weightRSI
            "StochRSI" => weightStochRSI
            "MACD" => weightMACD
            "CCI" => weightCCI
            "%R" => weightWilliamsR
            "WaveTrend" => weightWaveTrend
            "KST" => weightKST
            "OBV" => weightOBV
            "CMF" => weightCMF
            "Volume" => weightVolume
            "MFI" => weightMFI
            "Squeeze" => weightSqueeze
            "Bollinger" => weightBollinger
            "ATR" => weightATR
            "VIX" => weightVixFix
            => 2
    
    weight

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// TIMEFRAME WEIGHTING
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

tfWeightingStyle = input.string("Day Trading", "Timeframe Priority", 
     options=["Scalping", "Day Trading", "Swing Trading", "Equal Weight", "Custom"], 
     group="â±ï¸ Timeframe Weights")

tfWeightCustom = input.float(1.0, "Universal TF Weight", 
     minval=0.5, maxval=3.0, step=0.1, 
     group="â±ï¸ Timeframe Weights")

f_getTimeframeWeight(tfIndex) =>
    weight = 1.0
    
    if tfWeightingStyle == "Scalping"
        weight := switch tfIndex
            0 => 3.0
            1 => 2.5
            2 => 1.5
            3 => 1.0
            4 => 0.7
            5 => 0.5
            => 1.0
    
    else if tfWeightingStyle == "Day Trading"
        weight := switch tfIndex
            0 => 1.5
            1 => 2.0
            2 => 2.5
            3 => 2.0
            4 => 1.2
            5 => 0.8
            => 1.0
    
    else if tfWeightingStyle == "Swing Trading"
        weight := switch tfIndex
            0 => 0.5
            1 => 0.7
            2 => 1.2
            3 => 2.0
            4 => 2.5
            5 => 3.0
            => 1.0
    
    else if tfWeightingStyle == "Equal Weight"
        weight := 1.0
    
    else if tfWeightingStyle == "Custom"
        weight := tfWeightCustom
    
    weight

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// ALERT SETTINGS
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

useChartTimeframe = input.bool(false, "Use Only Chart Timeframe", group="Alert Settings")

alertBullishPowerThreshold = input.float(60.0, "Min Bullish Power %", minval=50, maxval=100, step=5, group="Alert Settings - Power")
alertBearishPowerThreshold = input.float(60.0, "Min Bearish Power %", minval=50, maxval=100, step=5, group="Alert Settings - Power")
exitPowerThreshold = input.float(35.0, "Exit Power Threshold %", minval=20, maxval=60, step=5, group="Alert Settings - Power")

useLegacyAlerts = input.bool(false, "Use Legacy Count-Based", group="Alert Settings - Legacy")
alertTimeframeCount = input.int(4, "Min Aligned TFs (Legacy)", minval=2, maxval=6, group="Alert Settings - Legacy")
alertIndicatorCount = input.int(10, "Min Indicators (Legacy)", minval=5, maxval=20, group="Alert Settings - Legacy")
exitTimeframeCount = input.int(2, "Exit TF Break (Legacy)", minval=1, maxval=6, group="Alert Settings - Legacy")
exitIndicatorThreshold = input.int(7, "Exit Indicator (Legacy)", minval=4, maxval=20, group="Alert Settings - Legacy")

// Display Settings
panelPosition = input.string("Top Right", "Panel Position", 
     options=["Top Left", "Top Right", "Bottom Left", "Bottom Right", "Middle Right"], 
     group="Display Settings")
panelSize = input.string("Small", "Panel Size", options=["Small", "Normal", "Large"], group="Display Settings")
showPowerRow = input.bool(true, "Show TF Power Scores", group="Display Settings")

// Colors
colorVeryBullish = input.color(#00FF00, "Very Bullish", group="Colors")
colorBullish = input.color(#88FF88, "Bullish", group="Colors")
colorNeutral = input.color(#FFAA00, "Neutral", group="Colors")
colorBearish = input.color(#FF8888, "Bearish", group="Colors")
colorVeryBearish = input.color(#FF0000, "Very Bearish", group="Colors")
colorBG = input.color(color.new(#000000, 10), "Background", group="Colors")
colorText = input.color(#FFFFFF, "Text", group="Colors")
colorHeader = input.color(#00BFFF, "Header", group="Colors")

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// COUNT ACTIVE INDICATORS
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

totalActiveIndicators = 0
if enableTrend
    totalActiveIndicators += 1
if enableAlphaTrend
    totalActiveIndicators += 1
if enableSuperTrend
    totalActiveIndicators += 1
if enableADX
    totalActiveIndicators += 1
if enableDI
    totalActiveIndicators += 1
if enableRSI
    totalActiveIndicators += 1
if enableStochRSI
    totalActiveIndicators += 1
if enableMACD
    totalActiveIndicators += 1
if enableCCI
    totalActiveIndicators += 1
if enableWilliamsR
    totalActiveIndicators += 1
if enableWaveTrend
    totalActiveIndicators += 1
if enableKST
    totalActiveIndicators += 1
if enableOBV
    totalActiveIndicators += 1
if enableCMF
    totalActiveIndicators += 1
if enableVolume
    totalActiveIndicators += 1
if enableMFI
    totalActiveIndicators += 1
if enableSqueeze
    totalActiveIndicators += 1
if enableBollinger
    totalActiveIndicators += 1
if enableATR
    totalActiveIndicators += 1
if enableVixFix
    totalActiveIndicators += 1

activeDirectionalIndicators = totalActiveIndicators - (enableADX ? 1 : 0) - (enableATR ? 1 : 0)

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// CALCULATION FUNCTIONS - ALL 20 INDICATORS
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

f_alphaTrend() =>
    if not enableAlphaTrend
        int(na)
    else
        atr_val = ta.atr(alphaLength)
        upT = low - atr_val * alphaMult
        downT = high + atr_val * alphaMult
        var float AlphaTrend = na
        AlphaTrend := hlc3 > nz(AlphaTrend[1]) ? math.max(upT, nz(AlphaTrend[1])) : math.min(downT, nz(AlphaTrend[1]))
        signal = hlc3 > AlphaTrend ? 1 : -1
        signal

f_superTrend() =>
    if not enableSuperTrend
        int(na)
    else
        atr_val = ta.atr(superTrendLength)
        hl_avg = (high + low) / 2
        upper_band = hl_avg + superTrendMult * atr_val
        lower_band = hl_avg - superTrendMult * atr_val
        var float up_trend = na
        var float down_trend = na
        up_trend := close[1] > up_trend[1] ? math.max(lower_band, up_trend[1]) : lower_band
        down_trend := close[1] < down_trend[1] ? math.min(upper_band, down_trend[1]) : upper_band
        var int trend_direction = 1
        trend_direction := close > down_trend[1] ? 1 : close < up_trend[1] ? -1 : trend_direction[1]
        trend_direction

f_calcOBV() =>
    if not enableOBV
        [float(na), int(na)]
    else
        obv_val = ta.cum(math.sign(ta.change(close)) * volume)
        obv_trend = int(na)
        if obvUseEMA
            obv_ema = ta.ema(obv_val, obvEMALength)
            obv_trend := obv_val > obv_ema ? 1 : obv_val < obv_ema ? -1 : 0
        else
            obv_change = ta.change(obv_val)
            obv_trend := obv_change > 0 ? 1 : obv_change < 0 ? -1 : 0
        [obv_val, obv_trend]

f_calcCMF() =>
    if not enableCMF
        [float(na), int(na)]
    else
        mfv = ((close - low) - (high - close)) / (high - low) * volume
        cmf_val = ta.sma(mfv, cmfLength) / ta.sma(volume, cmfLength)
        cmf_signal = cmf_val > 0.1 ? 1 : cmf_val < -0.1 ? -1 : 0
        [cmf_val, cmf_signal]

f_calcMACD() =>
    if not enableMACD
        [float(na), float(na), int(na)]
    else
        [macd_line, signal_line, hist] = ta.macd(close, macdFast, macdSlow, macdSignal)
        macd_signal = macd_line > signal_line ? 1 : macd_line < signal_line ? -1 : 0
        [macd_line, signal_line, macd_signal]

f_calcBollinger() =>
    if not enableBollinger
        [float(na), float(na), float(na), int(na)]
    else
        basis = ta.sma(close, bbLength)
        dev = bbMult * ta.stdev(close, bbLength)
        upper = basis + dev
        lower = basis - dev
        bb_position = close > upper ? -1 : close < lower ? 1 : 0
        [basis, upper, lower, bb_position]

f_calcATR() =>
    if not enableATR
        [float(na), int(na)]
    else
        atr_val = ta.atr(atrLength)
        atr_sma = ta.sma(atr_val, atrLength)
        atr_level = atr_val / atr_sma
        atr_signal = atr_level > atrHighThreshold ? 1 : atr_level < 0.7 ? -1 : 0
        [atr_val, atr_signal]

f_calcCCI() =>
    if not enableCCI
        [float(na), int(na)]
    else
        cci_val = ta.cci(close, cciLength)
        cci_signal = cci_val < cciOversold ? 1 : cci_val > cciOverbought ? -1 : 0
        [cci_val, cci_signal]

f_calcWilliamsR() =>
    if not enableWilliamsR
        [float(na), int(na)]
    else
        upper = ta.highest(williamsLength)
        lower = ta.lowest(williamsLength)
        wr_val = -100 * (upper - close) / (upper - lower)
        wr_signal = wr_val < williamsOversold ? 1 : wr_val > williamsOverbought ? -1 : 0
        [wr_val, wr_signal]

f_calcVolume() =>
    if not enableVolume
        [float(na), int(na)]
    else
        vol_ma = ta.sma(volume, volumeMALength)
        vol_ratio = volume / vol_ma
        vol_signal = vol_ratio > volumeThreshold ? (close > close[1] ? 1 : -1) : 0
        [vol_ratio, vol_signal]

f_calcMFI() =>
    if not enableMFI
        [float(na), int(na)]
    else
        mfi_val = ta.mfi(close, mfiLength)
        mfi_signal = mfi_val < mfiOversold ? 1 : mfi_val > mfiOverbought ? -1 : 0
        [mfi_val, mfi_signal]

f_calcKST() =>
    if not enableKST
        [float(na), float(na), int(na)]
    else
        rocma1 = ta.sma(ta.roc(close, kstROC1), kstSMA1)
        rocma2 = ta.sma(ta.roc(close, kstROC2), kstSMA2)
        rocma3 = ta.sma(ta.roc(close, kstROC3), kstSMA3)
        rocma4 = ta.sma(ta.roc(close, kstROC4), kstSMA4)
        kst_line = rocma1 + rocma2 * 2 + rocma3 * 3 + rocma4 * 4
        kst_signal_line = ta.sma(kst_line, kstSignalLength)
        kst_signal = kst_line > kst_signal_line ? 1 : kst_line < kst_signal_line ? -1 : 0
        [kst_line, kst_signal_line, kst_signal]

f_calc_all_indicators() =>
    trend = int(na)
    if enableTrend
        ema_val = ta.ema(close, emaLength)
        trend := close > ema_val ? 1 : close < ema_val ? -1 : 0
    
    rsi_val = enableRSI ? ta.rsi(close, rsiLength) : float(na)
    
    adx_val = float(na)
    di_diff = float(na)
    if enableADX or enableDI
        [di_plus, di_minus, adx] = ta.dmi(adxLength, adxSmoothing)
        adx_val := enableADX ? adx : float(na)
        di_diff := enableDI ? (di_plus - di_minus) : float(na)
    
    sqz_status = int(na)
    sqz_mom = float(na)
    if enableSqueeze
        basis = ta.sma(close, squeezeBBLength)
        dev = ta.stdev(close, squeezeBBLength)
        upper_bb = basis + squeezeBBMult * dev
        lower_bb = basis - squeezeBBMult * dev
        ma = ta.sma(close, squeezeKCLength)
        range_ma = ta.sma(ta.tr, squeezeKCLength)
        upper_kc = ma + range_ma * squeezeKCMult
        lower_kc = ma - range_ma * squeezeKCMult
        sqz_on = (lower_bb > lower_kc) and (upper_bb < upper_kc)
        sqz_off = (lower_bb < lower_kc) and (upper_bb > upper_kc)
        sqz_status := sqz_on ? 1 : sqz_off ? -1 : 0
        sqz_mom := ta.linreg(close - math.avg(math.avg(ta.highest(high, squeezeKCLength), ta.lowest(low, squeezeKCLength)), ta.sma(close, squeezeKCLength)), squeezeKCLength, 0)
    
    wt1 = float(na)
    if enableWaveTrend
        ap = hlc3
        esa = ta.ema(ap, wtChannelLen)
        d = ta.ema(math.abs(ap - esa), wtChannelLen)
        ci = (ap - esa) / (0.015 * d)
        wt1 := ta.ema(ci, wtAverageLen)
    
    stoch_k = float(na)
    if enableStochRSI
        rsi_for_stoch = ta.rsi(close, stochRSILength)
        rsi_lowest = ta.lowest(rsi_for_stoch, stochRSILength)
        rsi_highest = ta.highest(rsi_for_stoch, stochRSILength)
        stoch_rsi = rsi_highest != rsi_lowest ? ((rsi_for_stoch - rsi_lowest) / (rsi_highest - rsi_lowest) * 100) : 50
        stoch_k := ta.sma(stoch_rsi, stochRSIK)
    
    vix_fix = float(na)
    vix_signal = int(na)
    if enableVixFix
        highest_close = ta.highest(close, vixFixLength)
        vix_fix := ((highest_close - low) / highest_close) * 100
        vix_fix_std = ta.stdev(vix_fix, vixFixLength)
        vix_fix_mean = ta.sma(vix_fix, vixFixLength)
        vix_fix_upper = vix_fix_mean + vixFixStdDev * vix_fix_std
        vix_signal := vix_fix >= vix_fix_upper ? 1 : vix_fix >= vixFixThreshold ? 0 : -1
    
    [obv_val, obv_trend] = f_calcOBV()
    [cmf_val, cmf_signal] = f_calcCMF()
    [macd_line, macd_signal_line, macd_signal] = f_calcMACD()
    [bb_basis, bb_upper, bb_lower, bb_position] = f_calcBollinger()
    [atr_val, atr_signal] = f_calcATR()
    [cci_val, cci_signal] = f_calcCCI()
    [wr_val, wr_signal] = f_calcWilliamsR()
    [vol_ratio, vol_signal] = f_calcVolume()
    [mfi_val, mfi_signal] = f_calcMFI()
    [kst_line, kst_signal_line, kst_signal] = f_calcKST()
    
    [trend, rsi_val, adx_val, di_diff, sqz_status, sqz_mom, wt1, stoch_k, vix_fix, vix_signal,
     obv_val, obv_trend, cmf_val, cmf_signal, macd_line, macd_signal_line, macd_signal,
     bb_basis, bb_upper, bb_lower, bb_position, atr_val, atr_signal, cci_val, cci_signal,
     wr_val, wr_signal, vol_ratio, vol_signal, mfi_val, mfi_signal, kst_line, kst_signal_line, kst_signal]

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// ARRAYS FOR MULTI-TIMEFRAME DATA
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var alpha_array = array.new<float>(6, na)
var super_array = array.new<float>(6, na)
var trend_array = array.new<float>(6, na)
var rsi_array = array.new<float>(6, na)
var adx_array = array.new<float>(6, na)
var di_diff_array = array.new<float>(6, na)
var sqz_status_array = array.new<float>(6, na)
var sqz_mom_array = array.new<float>(6, na)
var wt_array = array.new<float>(6, na)
var stoch_array = array.new<float>(6, na)
var vix_array = array.new<float>(6, na)
var vix_sig_array = array.new<float>(6, na)
var obv_array = array.new<float>(6, na)
var obv_trend_array = array.new<float>(6, na)
var cmf_array = array.new<float>(6, na)
var cmf_signal_array = array.new<float>(6, na)
var macd_array = array.new<float>(6, na)
var macd_signal_array = array.new<float>(6, na)
var macd_trend_array = array.new<float>(6, na)
var bb_basis_array = array.new<float>(6, na)
var bb_upper_array = array.new<float>(6, na)
var bb_lower_array = array.new<float>(6, na)
var bb_position_array = array.new<float>(6, na)
var atr_array = array.new<float>(6, na)
var atr_signal_array = array.new<float>(6, na)
var cci_array = array.new<float>(6, na)
var cci_signal_array = array.new<float>(6, na)
var wr_array = array.new<float>(6, na)
var wr_signal_array = array.new<float>(6, na)
var vol_ratio_array = array.new<float>(6, na)
var vol_signal_array = array.new<float>(6, na)
var mfi_array = array.new<float>(6, na)
var mfi_signal_array = array.new<float>(6, na)
var kst_array = array.new<float>(6, na)
var kst_signal_array = array.new<float>(6, na)
var kst_trend_array = array.new<float>(6, na)

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// PART 2 - TIMEFRAME DATA COLLECTION & CALCULATIONS
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// TF1 Data Collection
if activeTimeframes >= 1
    if enableAlphaTrend
        alpha_tf1 = request.security(syminfo.tickerid, tf1, f_alphaTrend(), lookahead=barmerge.lookahead_off)
        array.set(alpha_array, 0, alpha_tf1)
    if enableSuperTrend
        super_tf1 = request.security(syminfo.tickerid, tf1, f_superTrend(), lookahead=barmerge.lookahead_off)
        array.set(super_array, 0, super_tf1)
    
    [trend_tf1, rsi_tf1, adx_tf1, di_diff_tf1, sqz_status_tf1, sqz_mom_tf1, wt_tf1, stoch_tf1, vix_tf1, vix_sig_tf1,
     obv_tf1, obv_trend_tf1, cmf_tf1, cmf_signal_tf1, macd_tf1, macd_signal_tf1, macd_trend_tf1,
     bb_basis_tf1, bb_upper_tf1, bb_lower_tf1, bb_position_tf1, atr_tf1, atr_signal_tf1, cci_tf1, cci_signal_tf1,
     wr_tf1, wr_signal_tf1, vol_ratio_tf1, vol_signal_tf1, mfi_tf1, mfi_signal_tf1, kst_tf1, kst_signal_tf1, kst_trend_tf1] = request.security(syminfo.tickerid, tf1, f_calc_all_indicators(), lookahead=barmerge.lookahead_off)
    
    array.set(trend_array, 0, trend_tf1)
    array.set(rsi_array, 0, rsi_tf1)
    array.set(adx_array, 0, adx_tf1)
    array.set(di_diff_array, 0, di_diff_tf1)
    array.set(sqz_status_array, 0, sqz_status_tf1)
    array.set(sqz_mom_array, 0, sqz_mom_tf1)
    array.set(wt_array, 0, wt_tf1)
    array.set(stoch_array, 0, stoch_tf1)
    array.set(vix_array, 0, vix_tf1)
    array.set(vix_sig_array, 0, vix_sig_tf1)
    array.set(obv_array, 0, obv_tf1)
    array.set(obv_trend_array, 0, obv_trend_tf1)
    array.set(cmf_array, 0, cmf_tf1)
    array.set(cmf_signal_array, 0, cmf_signal_tf1)
    array.set(macd_array, 0, macd_tf1)
    array.set(macd_signal_array, 0, macd_signal_tf1)
    array.set(macd_trend_array, 0, macd_trend_tf1)
    array.set(bb_basis_array, 0, bb_basis_tf1)
    array.set(bb_upper_array, 0, bb_upper_tf1)
    array.set(bb_lower_array, 0, bb_lower_tf1)
    array.set(bb_position_array, 0, bb_position_tf1)
    array.set(atr_array, 0, atr_tf1)
    array.set(atr_signal_array, 0, atr_signal_tf1)
    array.set(cci_array, 0, cci_tf1)
    array.set(cci_signal_array, 0, cci_signal_tf1)
    array.set(wr_array, 0, wr_tf1)
    array.set(wr_signal_array, 0, wr_signal_tf1)
    array.set(vol_ratio_array, 0, vol_ratio_tf1)
    array.set(vol_signal_array, 0, vol_signal_tf1)
    array.set(mfi_array, 0, mfi_tf1)
    array.set(mfi_signal_array, 0, mfi_signal_tf1)
    array.set(kst_array, 0, kst_tf1)
    array.set(kst_signal_array, 0, kst_signal_tf1)
    array.set(kst_trend_array, 0, kst_trend_tf1)

// TF2 Data Collection
if activeTimeframes >= 2
    if enableAlphaTrend
        alpha_tf2 = request.security(syminfo.tickerid, tf2, f_alphaTrend(), lookahead=barmerge.lookahead_off)
        array.set(alpha_array, 1, alpha_tf2)
    if enableSuperTrend
        super_tf2 = request.security(syminfo.tickerid, tf2, f_superTrend(), lookahead=barmerge.lookahead_off)
        array.set(super_array, 1, super_tf2)
    
    [trend_tf2, rsi_tf2, adx_tf2, di_diff_tf2, sqz_status_tf2, sqz_mom_tf2, wt_tf2, stoch_tf2, vix_tf2, vix_sig_tf2,
     obv_tf2, obv_trend_tf2, cmf_tf2, cmf_signal_tf2, macd_tf2, macd_signal_tf2, macd_trend_tf2,
     bb_basis_tf2, bb_upper_tf2, bb_lower_tf2, bb_position_tf2, atr_tf2, atr_signal_tf2, cci_tf2, cci_signal_tf2,
     wr_tf2, wr_signal_tf2, vol_ratio_tf2, vol_signal_tf2, mfi_tf2, mfi_signal_tf2, kst_tf2, kst_signal_tf2, kst_trend_tf2] = request.security(syminfo.tickerid, tf2, f_calc_all_indicators(), lookahead=barmerge.lookahead_off)
    
    array.set(trend_array, 1, trend_tf2)
    array.set(rsi_array, 1, rsi_tf2)
    array.set(adx_array, 1, adx_tf2)
    array.set(di_diff_array, 1, di_diff_tf2)
    array.set(sqz_status_array, 1, sqz_status_tf2)
    array.set(sqz_mom_array, 1, sqz_mom_tf2)
    array.set(wt_array, 1, wt_tf2)
    array.set(stoch_array, 1, stoch_tf2)
    array.set(vix_array, 1, vix_tf2)
    array.set(vix_sig_array, 1, vix_sig_tf2)
    array.set(obv_array, 1, obv_tf2)
    array.set(obv_trend_array, 1, obv_trend_tf2)
    array.set(cmf_array, 1, cmf_tf2)
    array.set(cmf_signal_array, 1, cmf_signal_tf2)
    array.set(macd_array, 1, macd_tf2)
    array.set(macd_signal_array, 1, macd_signal_tf2)
    array.set(macd_trend_array, 1, macd_trend_tf2)
    array.set(bb_basis_array, 1, bb_basis_tf2)
    array.set(bb_upper_array, 1, bb_upper_tf2)
    array.set(bb_lower_array, 1, bb_lower_tf2)
    array.set(bb_position_array, 1, bb_position_tf2)
    array.set(atr_array, 1, atr_tf2)
    array.set(atr_signal_array, 1, atr_signal_tf2)
    array.set(cci_array, 1, cci_tf2)
    array.set(cci_signal_array, 1, cci_signal_tf2)
    array.set(wr_array, 1, wr_tf2)
    array.set(wr_signal_array, 1, wr_signal_tf2)
    array.set(vol_ratio_array, 1, vol_ratio_tf2)
    array.set(vol_signal_array, 1, vol_signal_tf2)
    array.set(mfi_array, 1, mfi_tf2)
    array.set(mfi_signal_array, 1, mfi_signal_tf2)
    array.set(kst_array, 1, kst_tf2)
    array.set(kst_signal_array, 1, kst_signal_tf2)
    array.set(kst_trend_array, 1, kst_trend_tf2)

// TF3 Data Collection
if activeTimeframes >= 3
    if enableAlphaTrend
        alpha_tf3 = request.security(syminfo.tickerid, tf3, f_alphaTrend(), lookahead=barmerge.lookahead_off)
        array.set(alpha_array, 2, alpha_tf3)
    if enableSuperTrend
        super_tf3 = request.security(syminfo.tickerid, tf3, f_superTrend(), lookahead=barmerge.lookahead_off)
        array.set(super_array, 2, super_tf3)
    
    [trend_tf3, rsi_tf3, adx_tf3, di_diff_tf3, sqz_status_tf3, sqz_mom_tf3, wt_tf3, stoch_tf3, vix_tf3, vix_sig_tf3,
     obv_tf3, obv_trend_tf3, cmf_tf3, cmf_signal_tf3, macd_tf3, macd_signal_tf3, macd_trend_tf3,
     bb_basis_tf3, bb_upper_tf3, bb_lower_tf3, bb_position_tf3, atr_tf3, atr_signal_tf3, cci_tf3, cci_signal_tf3,
     wr_tf3, wr_signal_tf3, vol_ratio_tf3, vol_signal_tf3, mfi_tf3, mfi_signal_tf3, kst_tf3, kst_signal_tf3, kst_trend_tf3] = request.security(syminfo.tickerid, tf3, f_calc_all_indicators(), lookahead=barmerge.lookahead_off)
    
    array.set(trend_array, 2, trend_tf3)
    array.set(rsi_array, 2, rsi_tf3)
    array.set(adx_array, 2, adx_tf3)
    array.set(di_diff_array, 2, di_diff_tf3)
    array.set(sqz_status_array, 2, sqz_status_tf3)
    array.set(sqz_mom_array, 2, sqz_mom_tf3)
    array.set(wt_array, 2, wt_tf3)
    array.set(stoch_array, 2, stoch_tf3)
    array.set(vix_array, 2, vix_tf3)
    array.set(vix_sig_array, 2, vix_sig_tf3)
    array.set(obv_array, 2, obv_tf3)
    array.set(obv_trend_array, 2, obv_trend_tf3)
    array.set(cmf_array, 2, cmf_tf3)
    array.set(cmf_signal_array, 2, cmf_signal_tf3)
    array.set(macd_array, 2, macd_tf3)
    array.set(macd_signal_array, 2, macd_signal_tf3)
    array.set(macd_trend_array, 2, macd_trend_tf3)
    array.set(bb_basis_array, 2, bb_basis_tf3)
    array.set(bb_upper_array, 2, bb_upper_tf3)
    array.set(bb_lower_array, 2, bb_lower_tf3)
    array.set(bb_position_array, 2, bb_position_tf3)
    array.set(atr_array, 2, atr_tf3)
    array.set(atr_signal_array, 2, atr_signal_tf3)
    array.set(cci_array, 2, cci_tf3)
    array.set(cci_signal_array, 2, cci_signal_tf3)
    array.set(wr_array, 2, wr_tf3)
    array.set(wr_signal_array, 2, wr_signal_tf3)
    array.set(vol_ratio_array, 2, vol_ratio_tf3)
    array.set(vol_signal_array, 2, vol_signal_tf3)
    array.set(mfi_array, 2, mfi_tf3)
    array.set(mfi_signal_array, 2, mfi_signal_tf3)
    array.set(kst_array, 2, kst_tf3)
    array.set(kst_signal_array, 2, kst_signal_tf3)
    array.set(kst_trend_array, 2, kst_trend_tf3)

// TF4 Data Collection
if activeTimeframes >= 4
    if enableAlphaTrend
        alpha_tf4 = request.security(syminfo.tickerid, tf4, f_alphaTrend(), lookahead=barmerge.lookahead_off)
        array.set(alpha_array, 3, alpha_tf4)
    if enableSuperTrend
        super_tf4 = request.security(syminfo.tickerid, tf4, f_superTrend(), lookahead=barmerge.lookahead_off)
        array.set(super_array, 3, super_tf4)
    
    [trend_tf4, rsi_tf4, adx_tf4, di_diff_tf4, sqz_status_tf4, sqz_mom_tf4, wt_tf4, stoch_tf4, vix_tf4, vix_sig_tf4,
     obv_tf4, obv_trend_tf4, cmf_tf4, cmf_signal_tf4, macd_tf4, macd_signal_tf4, macd_trend_tf4,
     bb_basis_tf4, bb_upper_tf4, bb_lower_tf4, bb_position_tf4, atr_tf4, atr_signal_tf4, cci_tf4, cci_signal_tf4,
     wr_tf4, wr_signal_tf4, vol_ratio_tf4, vol_signal_tf4, mfi_tf4, mfi_signal_tf4, kst_tf4, kst_signal_tf4, kst_trend_tf4] = request.security(syminfo.tickerid, tf4, f_calc_all_indicators(), lookahead=barmerge.lookahead_off)
    
    array.set(trend_array, 3, trend_tf4)
    array.set(rsi_array, 3, rsi_tf4)
    array.set(adx_array, 3, adx_tf4)
    array.set(di_diff_array, 3, di_diff_tf4)
    array.set(sqz_status_array, 3, sqz_status_tf4)
    array.set(sqz_mom_array, 3, sqz_mom_tf4)
    array.set(wt_array, 3, wt_tf4)
    array.set(stoch_array, 3, stoch_tf4)
    array.set(vix_array, 3, vix_tf4)
    array.set(vix_sig_array, 3, vix_sig_tf4)
    array.set(obv_array, 3, obv_tf4)
    array.set(obv_trend_array, 3, obv_trend_tf4)
    array.set(cmf_array, 3, cmf_tf4)
    array.set(cmf_signal_array, 3, cmf_signal_tf4)
    array.set(macd_array, 3, macd_tf4)
    array.set(macd_signal_array, 3, macd_signal_tf4)
    array.set(macd_trend_array, 3, macd_trend_tf4)
    array.set(bb_basis_array, 3, bb_basis_tf4)
    array.set(bb_upper_array, 3, bb_upper_tf4)
    array.set(bb_lower_array, 3, bb_lower_tf4)
    array.set(bb_position_array, 3, bb_position_tf4)
    array.set(atr_array, 3, atr_tf4)
    array.set(atr_signal_array, 3, atr_signal_tf4)
    array.set(cci_array, 3, cci_tf4)
    array.set(cci_signal_array, 3, cci_signal_tf4)
    array.set(wr_array, 3, wr_tf4)
    array.set(wr_signal_array, 3, wr_signal_tf4)
    array.set(vol_ratio_array, 3, vol_ratio_tf4)
    array.set(vol_signal_array, 3, vol_signal_tf4)
    array.set(mfi_array, 3, mfi_tf4)
    array.set(mfi_signal_array, 3, mfi_signal_tf4)
    array.set(kst_array, 3, kst_tf4)
    array.set(kst_signal_array, 3, kst_signal_tf4)
    array.set(kst_trend_array, 3, kst_trend_tf4)

// TF5 Data Collection
if activeTimeframes >= 5
    if enableAlphaTrend
        alpha_tf5 = request.security(syminfo.tickerid, tf5, f_alphaTrend(), lookahead=barmerge.lookahead_off)
        array.set(alpha_array, 4, alpha_tf5)
    if enableSuperTrend
        super_tf5 = request.security(syminfo.tickerid, tf5, f_superTrend(), lookahead=barmerge.lookahead_off)
        array.set(super_array, 4, super_tf5)
    
    [trend_tf5, rsi_tf5, adx_tf5, di_diff_tf5, sqz_status_tf5, sqz_mom_tf5, wt_tf5, stoch_tf5, vix_tf5, vix_sig_tf5,
     obv_tf5, obv_trend_tf5, cmf_tf5, cmf_signal_tf5, macd_tf5, macd_signal_tf5, macd_trend_tf5,
     bb_basis_tf5, bb_upper_tf5, bb_lower_tf5, bb_position_tf5, atr_tf5, atr_signal_tf5, cci_tf5, cci_signal_tf5,
     wr_tf5, wr_signal_tf5, vol_ratio_tf5, vol_signal_tf5, mfi_tf5, mfi_signal_tf5, kst_tf5, kst_signal_tf5, kst_trend_tf5] = request.security(syminfo.tickerid, tf5, f_calc_all_indicators(), lookahead=barmerge.lookahead_off)
    
    array.set(trend_array, 4, trend_tf5)
    array.set(rsi_array, 4, rsi_tf5)
    array.set(adx_array, 4, adx_tf5)
    array.set(di_diff_array, 4, di_diff_tf5)
    array.set(sqz_status_array, 4, sqz_status_tf5)
    array.set(sqz_mom_array, 4, sqz_mom_tf5)
    array.set(wt_array, 4, wt_tf5)
    array.set(stoch_array, 4, stoch_tf5)
    array.set(vix_array, 4, vix_tf5)
    array.set(vix_sig_array, 4, vix_sig_tf5)
    array.set(obv_array, 4, obv_tf5)
    array.set(obv_trend_array, 4, obv_trend_tf5)
    array.set(cmf_array, 4, cmf_tf5)
    array.set(cmf_signal_array, 4, cmf_signal_tf5)
    array.set(macd_array, 4, macd_tf5)
    array.set(macd_signal_array, 4, macd_signal_tf5)
    array.set(macd_trend_array, 4, macd_trend_tf5)
    array.set(bb_basis_array, 4, bb_basis_tf5)
    array.set(bb_upper_array, 4, bb_upper_tf5)
    array.set(bb_lower_array, 4, bb_lower_tf5)
    array.set(bb_position_array, 4, bb_position_tf5)
    array.set(atr_array, 4, atr_tf5)
    array.set(atr_signal_array, 4, atr_signal_tf5)
    array.set(cci_array, 4, cci_tf5)
    array.set(cci_signal_array, 4, cci_signal_tf5)
    array.set(wr_array, 4, wr_tf5)
    array.set(wr_signal_array, 4, wr_signal_tf5)
    array.set(vol_ratio_array, 4, vol_ratio_tf5)
    array.set(vol_signal_array, 4, vol_signal_tf5)
    array.set(mfi_array, 4, mfi_tf5)
    array.set(mfi_signal_array, 4, mfi_signal_tf5)
    array.set(kst_array, 4, kst_tf5)
    array.set(kst_signal_array, 4, kst_signal_tf5)
    array.set(kst_trend_array, 4, kst_trend_tf5)

// TF6 Data Collection
if activeTimeframes >= 6
    if enableAlphaTrend
        alpha_tf6 = request.security(syminfo.tickerid, tf6, f_alphaTrend(), lookahead=barmerge.lookahead_off)
        array.set(alpha_array, 5, alpha_tf6)
    if enableSuperTrend
        super_tf6 = request.security(syminfo.tickerid, tf6, f_superTrend(), lookahead=barmerge.lookahead_off)
        array.set(super_array, 5, super_tf6)
    
    [trend_tf6, rsi_tf6, adx_tf6, di_diff_tf6, sqz_status_tf6, sqz_mom_tf6, wt_tf6, stoch_tf6, vix_tf6, vix_sig_tf6,
     obv_tf6, obv_trend_tf6, cmf_tf6, cmf_signal_tf6, macd_tf6, macd_signal_tf6, macd_trend_tf6,
     bb_basis_tf6, bb_upper_tf6, bb_lower_tf6, bb_position_tf6, atr_tf6, atr_signal_tf6, cci_tf6, cci_signal_tf6,
     wr_tf6, wr_signal_tf6, vol_ratio_tf6, vol_signal_tf6, mfi_tf6, mfi_signal_tf6, kst_tf6, kst_signal_tf6, kst_trend_tf6] = request.security(syminfo.tickerid, tf6, f_calc_all_indicators(), lookahead=barmerge.lookahead_off)
    
    array.set(trend_array, 5, trend_tf6)
    array.set(rsi_array, 5, rsi_tf6)
    array.set(adx_array, 5, adx_tf6)
    array.set(di_diff_array, 5, di_diff_tf6)
    array.set(sqz_status_array, 5, sqz_status_tf6)
    array.set(sqz_mom_array, 5, sqz_mom_tf6)
    array.set(wt_array, 5, wt_tf6)
    array.set(stoch_array, 5, stoch_tf6)
    array.set(vix_array, 5, vix_tf6)
    array.set(vix_sig_array, 5, vix_sig_tf6)
    array.set(obv_array, 5, obv_tf6)
    array.set(obv_trend_array, 5, obv_trend_tf6)
    array.set(cmf_array, 5, cmf_tf6)
    array.set(cmf_signal_array, 5, cmf_signal_tf6)
    array.set(macd_array, 5, macd_tf6)
    array.set(macd_signal_array, 5, macd_signal_tf6)
    array.set(macd_trend_array, 5, macd_trend_tf6)
    array.set(bb_basis_array, 5, bb_basis_tf6)
    array.set(bb_upper_array, 5, bb_upper_tf6)
    array.set(bb_lower_array, 5, bb_lower_tf6)
    array.set(bb_position_array, 5, bb_position_tf6)
    array.set(atr_array, 5, atr_tf6)
    array.set(atr_signal_array, 5, atr_signal_tf6)
    array.set(cci_array, 5, cci_tf6)
    array.set(cci_signal_array, 5, cci_signal_tf6)
    array.set(wr_array, 5, wr_tf6)
    array.set(wr_signal_array, 5, wr_signal_tf6)
    array.set(vol_ratio_array, 5, vol_ratio_tf6)
    array.set(vol_signal_array, 5, vol_signal_tf6)
    array.set(mfi_array, 5, mfi_tf6)
    array.set(mfi_signal_array, 5, mfi_signal_tf6)
    array.set(kst_array, 5, kst_tf6)
    array.set(kst_signal_array, 5, kst_signal_tf6)
    array.set(kst_trend_array, 5, kst_trend_tf6)

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// CHART TIMEFRAME DATA
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

chart_alpha = enableAlphaTrend ? f_alphaTrend() : int(na)
chart_super = enableSuperTrend ? f_superTrend() : int(na)
[chart_trend, chart_rsi, chart_adx, chart_di_diff, chart_sqz_status, chart_sqz_mom, chart_wt, chart_stoch, chart_vix, chart_vix_sig,
 chart_obv, chart_obv_trend, chart_cmf, chart_cmf_signal, chart_macd, chart_macd_signal, chart_macd_trend,
 chart_bb_basis, chart_bb_upper, chart_bb_lower, chart_bb_position, chart_atr, chart_atr_signal, chart_cci, chart_cci_signal,
 chart_wr, chart_wr_signal, chart_vol_ratio, chart_vol_signal, chart_mfi, chart_mfi_signal, chart_kst, chart_kst_signal, chart_kst_trend] = f_calc_all_indicators()

chart_bullish_cnt = 0
chart_bearish_cnt = 0
chart_bullish_weight = 0.0
chart_bearish_weight = 0.0
chart_total_weight = 0.0

if enableTrend
    w = f_getIndicatorWeight("Trend")
    chart_total_weight += w
    if chart_trend == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_trend == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableAlphaTrend
    w = f_getIndicatorWeight("Alpha")
    chart_total_weight += w
    if chart_alpha == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_alpha == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableSuperTrend
    w = f_getIndicatorWeight("SuperTrend")
    chart_total_weight += w
    if chart_super == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_super == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableRSI
    w = f_getIndicatorWeight("RSI")
    chart_total_weight += w
    if chart_rsi < 45
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_rsi > 55
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableStochRSI
    w = f_getIndicatorWeight("StochRSI")
    chart_total_weight += w
    if chart_stoch < stochRSIOversold
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_stoch > stochRSIOverbought
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableMACD
    w = f_getIndicatorWeight("MACD")
    chart_total_weight += w
    if chart_macd_trend == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_macd_trend == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableDI
    w = f_getIndicatorWeight("DI")
    chart_total_weight += w
    if chart_di_diff > 0
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_di_diff < 0
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableSqueeze
    w = f_getIndicatorWeight("Squeeze")
    chart_total_weight += w
    if chart_sqz_mom > 0
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_sqz_mom < 0
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableWaveTrend
    w = f_getIndicatorWeight("WaveTrend")
    chart_total_weight += w
    if chart_wt < 0
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_wt > 0
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableCCI
    w = f_getIndicatorWeight("CCI")
    chart_total_weight += w
    if chart_cci_signal == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_cci_signal == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableWilliamsR
    w = f_getIndicatorWeight("%R")
    chart_total_weight += w
    if chart_wr_signal == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_wr_signal == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableKST
    w = f_getIndicatorWeight("KST")
    chart_total_weight += w
    if chart_kst_trend == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_kst_trend == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableOBV
    w = f_getIndicatorWeight("OBV")
    chart_total_weight += w
    if chart_obv_trend == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_obv_trend == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableCMF
    w = f_getIndicatorWeight("CMF")
    chart_total_weight += w
    if chart_cmf_signal == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_cmf_signal == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableVolume
    w = f_getIndicatorWeight("Volume")
    chart_total_weight += w
    if chart_vol_signal == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_vol_signal == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableMFI
    w = f_getIndicatorWeight("MFI")
    chart_total_weight += w
    if chart_mfi_signal == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_mfi_signal == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableBollinger
    w = f_getIndicatorWeight("Bollinger")
    chart_total_weight += w
    if chart_bb_position == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_bb_position == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

if enableVixFix
    w = f_getIndicatorWeight("VIX")
    chart_total_weight += w
    if chart_vix_sig == 1
        chart_bullish_cnt += 1
        chart_bullish_weight += w
    else if chart_vix_sig == -1
        chart_bearish_cnt += 1
        chart_bearish_weight += w

chart_bullish_power = chart_total_weight > 0 ? (chart_bullish_weight / chart_total_weight) * 100 : 0.0
chart_bearish_power = chart_total_weight > 0 ? (chart_bearish_weight / chart_total_weight) * 100 : 0.0
chart_net_power = chart_bullish_power - chart_bearish_power

var bullishCount_array = array.new<int>(6, 0)
var bearishCount_array = array.new<int>(6, 0)
var confluenceScore_array = array.new<float>(6, 0.0)
var bullishPower_array = array.new<float>(6, 0.0)
var bearishPower_array = array.new<float>(6, 0.0)
var netPower_array = array.new<float>(6, 0.0)

for i = 0 to activeTimeframes - 1
    bullish_cnt = 0
    bearish_cnt = 0
    bullish_weight = 0.0
    bearish_weight = 0.0
    total_weight = 0.0
    
    if enableTrend
        w = f_getIndicatorWeight("Trend")
        total_weight += w
        if array.get(trend_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(trend_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableAlphaTrend
        w = f_getIndicatorWeight("Alpha")
        total_weight += w
        if array.get(alpha_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(alpha_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableSuperTrend
        w = f_getIndicatorWeight("SuperTrend")
        total_weight += w
        if array.get(super_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(super_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableRSI
        w = f_getIndicatorWeight("RSI")
        total_weight += w
        rsi_v = array.get(rsi_array, i)
        if rsi_v < 45
            bullish_cnt += 1
            bullish_weight += w
        else if rsi_v > 55
            bearish_cnt += 1
            bearish_weight += w
    
    if enableStochRSI
        w = f_getIndicatorWeight("StochRSI")
        total_weight += w
        stoch_v = array.get(stoch_array, i)
        if stoch_v < stochRSIOversold
            bullish_cnt += 1
            bullish_weight += w
        else if stoch_v > stochRSIOverbought
            bearish_cnt += 1
            bearish_weight += w
    
    if enableMACD
        w = f_getIndicatorWeight("MACD")
        total_weight += w
        if array.get(macd_trend_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(macd_trend_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableDI
        w = f_getIndicatorWeight("DI")
        total_weight += w
        if array.get(di_diff_array, i) > 0
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(di_diff_array, i) < 0
            bearish_cnt += 1
            bearish_weight += w
    
    if enableSqueeze
        w = f_getIndicatorWeight("Squeeze")
        total_weight += w
        if array.get(sqz_mom_array, i) > 0
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(sqz_mom_array, i) < 0
            bearish_cnt += 1
            bearish_weight += w
    
    if enableWaveTrend
        w = f_getIndicatorWeight("WaveTrend")
        total_weight += w
        if array.get(wt_array, i) < 0
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(wt_array, i) > 0
            bearish_cnt += 1
            bearish_weight += w
    
    if enableCCI
        w = f_getIndicatorWeight("CCI")
        total_weight += w
        if array.get(cci_signal_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(cci_signal_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableWilliamsR
        w = f_getIndicatorWeight("%R")
        total_weight += w
        if array.get(wr_signal_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(wr_signal_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableKST
        w = f_getIndicatorWeight("KST")
        total_weight += w
        if array.get(kst_trend_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(kst_trend_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableOBV
        w = f_getIndicatorWeight("OBV")
        total_weight += w
        if array.get(obv_trend_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(obv_trend_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableCMF
        w = f_getIndicatorWeight("CMF")
        total_weight += w
        if array.get(cmf_signal_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(cmf_signal_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableVolume
        w = f_getIndicatorWeight("Volume")
        total_weight += w
        if array.get(vol_signal_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(vol_signal_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableMFI
        w = f_getIndicatorWeight("MFI")
        total_weight += w
        if array.get(mfi_signal_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(mfi_signal_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableBollinger
        w = f_getIndicatorWeight("Bollinger")
        total_weight += w
        if array.get(bb_position_array, i) == 1
            bullish_cnt += 1
            bullish_weight += w
        else if array.get(bb_position_array, i) == -1
            bearish_cnt += 1
            bearish_weight += w
    
    if enableVixFix
        w = f_getIndicatorWeight("VIX")
        total_weight += w
        vix_sig = array.get(vix_sig_array, i)
        if vix_sig == 1
            bullish_cnt += 1
            bullish_weight += w
        else if vix_sig == -1
            bearish_cnt += 1
            bearish_weight += w
    
    array.set(bullishCount_array, i, bullish_cnt)
    array.set(bearishCount_array, i, bearish_cnt)
    
    bullish_power = total_weight > 0 ? (bullish_weight / total_weight) * 100 : 0.0
    bearish_power = total_weight > 0 ? (bearish_weight / total_weight) * 100 : 0.0
    net_power = bullish_power - bearish_power
    
    array.set(bullishPower_array, i, bullish_power)
    array.set(bearishPower_array, i, bearish_power)
    array.set(netPower_array, i, net_power)
    
    if activeDirectionalIndicators > 0
        confluence = ((bullish_cnt - bearish_cnt) / activeDirectionalIndicators) * 100
        array.set(confluenceScore_array, i, confluence)
    else
        array.set(confluenceScore_array, i, 0.0)

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// OVERALL MARKET POWER (WEIGHTED ACROSS TIMEFRAMES)
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

f_calculateOverallMarketPower() =>
    totalWeightedBullish = 0.0
    totalWeightedBearish = 0.0
    totalTFWeight = 0.0
    
    for i = 0 to activeTimeframes - 1
        bullPower = array.get(bullishPower_array, i)
        bearPower = array.get(bearishPower_array, i)
        tfWeight = f_getTimeframeWeight(i)
        
        totalWeightedBullish += bullPower * tfWeight
        totalWeightedBearish += bearPower * tfWeight
        totalTFWeight += tfWeight
    
    overallBullishPower = totalTFWeight > 0 ? totalWeightedBullish / totalTFWeight : 0.0
    overallBearishPower = totalTFWeight > 0 ? totalWeightedBearish / totalTFWeight : 0.0
    overallNetPower = overallBullishPower - overallBearishPower
    
    [overallBullishPower, overallBearishPower, overallNetPower]

[overall_bull_power, overall_bear_power, overall_net_power] = f_calculateOverallMarketPower()

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// GRADIENT COLOR FUNCTIONS
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

f_getGradientColor(score) =>
    if score >= 75
        colorVeryBullish
    else if score >= 50
        color.rgb(0, 255, 0, math.round((75 - score) / 25 * 100))
    else if score >= 25
        color.rgb(136, 255, 136, math.round((50 - score) / 25 * 50))
    else if score > -25
        colorNeutral
    else if score > -50
        color.rgb(255, 136, 136, math.round((score + 50) / 25 * 50))
    else if score > -75
        color.rgb(255, 0, 0, math.round((score + 75) / 25 * 100))
    else
        colorVeryBearish

f_getPowerColor(power) =>
    if power >= 75
        colorVeryBullish
    else if power >= 60
        colorBullish
    else if power >= 40
        colorNeutral
    else if power >= 25
        colorBearish
    else
        colorVeryBearish

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// ALERT TRACKING
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var array<bool> longEntryTFs = array.new<bool>(6, false)
var array<bool> shortEntryTFs = array.new<bool>(6, false)
var bool inLongPosition = false
var bool inShortPosition = false

tf_labels = array.from(tf1, tf2, tf3, tf4, tf5, tf6)

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// ALERT CONDITIONS - CHART TIMEFRAME MODE
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

longEntryCondition_chart = false
shortEntryCondition_chart = false
longExitCondition_chart = false
shortExitCondition_chart = false

if useChartTimeframe
    if useLegacyAlerts
        longEntryCondition_chart := chart_bullish_cnt >= alertIndicatorCount and not inLongPosition
        shortEntryCondition_chart := chart_bearish_cnt >= alertIndicatorCount and not inShortPosition
        longExitCondition_chart := inLongPosition and chart_bullish_cnt < exitIndicatorThreshold
        shortExitCondition_chart := inShortPosition and chart_bearish_cnt < exitIndicatorThreshold
    else
        longEntryCondition_chart := chart_bullish_power >= alertBullishPowerThreshold and not inLongPosition
        shortEntryCondition_chart := chart_bearish_power >= alertBearishPowerThreshold and not inShortPosition
        longExitCondition_chart := inLongPosition and chart_bullish_power < exitPowerThreshold
        shortExitCondition_chart := inShortPosition and chart_bearish_power < exitPowerThreshold
    
    if longEntryCondition_chart
        inLongPosition := true
        inShortPosition := false
    
    if shortEntryCondition_chart
        inShortPosition := true
        inLongPosition := false
    
    if longExitCondition_chart
        inLongPosition := false
    
    if shortExitCondition_chart
        inShortPosition := false

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// ALERT CONDITIONS - MULTI TIMEFRAME MODE
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

longEntryCondition_multi = false
shortEntryCondition_multi = false
longExitCondition_multi = false
shortExitCondition_multi = false

if not useChartTimeframe
    if useLegacyAlerts
        bullishTimeframes = 0
        bearishTimeframes = 0
        
        for i = 0 to activeTimeframes - 1
            bull_cnt = array.get(bullishCount_array, i)
            bear_cnt = array.get(bearishCount_array, i)
            
            if bull_cnt >= alertIndicatorCount
                bullishTimeframes += 1
                
            if bear_cnt >= alertIndicatorCount
                bearishTimeframes += 1
        
        longEntryCondition_multi := bullishTimeframes >= alertTimeframeCount and not inLongPosition
        shortEntryCondition_multi := bearishTimeframes >= alertTimeframeCount and not inShortPosition
        
        if longEntryCondition_multi
            for i = 0 to activeTimeframes - 1
                bull_cnt = array.get(bullishCount_array, i)
                array.set(longEntryTFs, i, bull_cnt >= alertIndicatorCount)
            
            inLongPosition := true
            inShortPosition := false
        
        if shortEntryCondition_multi
            for i = 0 to activeTimeframes - 1
                bear_cnt = array.get(bearishCount_array, i)
                array.set(shortEntryTFs, i, bear_cnt >= alertIndicatorCount)
            
            inShortPosition := true
            inLongPosition := false
        
        brokenTFsCount_long = 0
        if inLongPosition
            for i = 0 to activeTimeframes - 1
                if array.get(longEntryTFs, i)
                    bull_cnt = array.get(bullishCount_array, i)
                    if bull_cnt < exitIndicatorThreshold
                        brokenTFsCount_long += 1
        
        longExitCondition_multi := inLongPosition and brokenTFsCount_long >= exitTimeframeCount
        
        brokenTFsCount_short = 0
        if inShortPosition
            for i = 0 to activeTimeframes - 1
                if array.get(shortEntryTFs, i)
                    bear_cnt = array.get(bearishCount_array, i)
                    if bear_cnt < exitIndicatorThreshold
                        brokenTFsCount_short += 1
        
        shortExitCondition_multi := inShortPosition and brokenTFsCount_short >= exitTimeframeCount
    
    else
        longEntryCondition_multi := overall_bull_power >= alertBullishPowerThreshold and not inLongPosition
        shortEntryCondition_multi := overall_bear_power >= alertBearishPowerThreshold and not inShortPosition
        
        longExitCondition_multi := inLongPosition and overall_bull_power < exitPowerThreshold
        shortExitCondition_multi := inShortPosition and overall_bear_power < exitPowerThreshold
    
    if longEntryCondition_multi
        inLongPosition := true
        inShortPosition := false
    
    if shortEntryCondition_multi
        inShortPosition := true
        inLongPosition := false
    
    if longExitCondition_multi
        inLongPosition := false
    
    if shortExitCondition_multi
        inShortPosition := false

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// WUNDERTRADING ALERTS
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alertcondition(longEntryCondition_chart or longEntryCondition_multi, "LONG Entry", "ENTER-LONG_Bybit_{{ticker}}_Strategy_{{interval}}_BotID")
alertcondition(shortEntryCondition_chart or shortEntryCondition_multi, "SHORT Entry", "ENTER-SHORT_Bybit_{{ticker}}_Strategy_{{interval}}_BotID")
alertcondition(longExitCondition_chart or longExitCondition_multi, "LONG Exit", "EXIT-LONG_Bybit_{{ticker}}_Strategy_{{interval}}_BotID")
alertcondition(shortExitCondition_chart or shortExitCondition_multi, "SHORT Exit", "EXIT-SHORT_Bybit_{{ticker}}_Strategy_{{interval}}_BotID")

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// PART 4 - DISPLAY HELPER FUNCTION - ALL 20 INDICATORS
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

f_displayIndicator(indicatorName, current_row, table_ref, table_sz) =>
    row = current_row
    
    if indicatorName == "Trend" and enableTrend
        table.cell(table_ref, 0, row, "Trend (EMA" + str.tostring(emaLength) + ")", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            t_val = array.get(trend_array, i)
            t_text = t_val == 1 ? "BULLISH" : t_val == -1 ? "BEARISH" : "NEUTRAL"
            t_color = t_val == 1 ? colorVeryBullish : t_val == -1 ? colorVeryBearish : colorNeutral
            table.cell(table_ref, i + 1, row, t_text, text_color=t_color, text_size=table_sz, bgcolor=color.new(t_color, 85))
        row += 1
    
    else if indicatorName == "Alpha" and enableAlphaTrend
        table.cell(table_ref, 0, row, "Alpha Trend", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            alpha_v = array.get(alpha_array, i)
            alpha_text = alpha_v == 1 ? "BULLISH" : alpha_v == -1 ? "BEARISH" : "NEUTRAL"
            alpha_color = alpha_v == 1 ? colorVeryBullish : alpha_v == -1 ? colorVeryBearish : colorNeutral
            table.cell(table_ref, i + 1, row, alpha_text, text_color=alpha_color, text_size=table_sz, bgcolor=color.new(alpha_color, 85))
        row += 1
    
    else if indicatorName == "SuperTrend" and enableSuperTrend
        table.cell(table_ref, 0, row, "SuperTrend", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            super_v = array.get(super_array, i)
            super_text = super_v == 1 ? "BULLISH" : super_v == -1 ? "BEARISH" : "NEUTRAL"
            super_color = super_v == 1 ? colorVeryBullish : super_v == -1 ? colorVeryBearish : colorNeutral
            table.cell(table_ref, i + 1, row, super_text, text_color=super_color, text_size=table_sz, bgcolor=color.new(super_color, 85))
        row += 1
    
    else if indicatorName == "RSI" and enableRSI
        table.cell(table_ref, 0, row, "RSI(" + str.tostring(rsiLength) + ")", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            rsi_v = array.get(rsi_array, i)
            rsi_text = rsi_v >= 80 ? "EXTREME OB" : rsi_v >= 70 ? "OVERBOUGHT" : rsi_v >= 55 ? "BEARISH" : rsi_v > 45 ? "NEUTRAL" : rsi_v > 30 ? "BULLISH" : rsi_v > 20 ? "OVERSOLD" : "EXTREME OS"
            rsi_color = rsi_v >= 80 ? colorVeryBearish : rsi_v >= 70 ? colorBearish : rsi_v >= 55 ? colorBearish : rsi_v > 45 ? colorNeutral : rsi_v > 30 ? colorBullish : rsi_v > 20 ? colorBullish : colorVeryBullish
            display_text = str.tostring(rsi_v, "#.#") + "\n" + rsi_text
            table.cell(table_ref, i + 1, row, display_text, text_color=rsi_color, text_size=table_sz, bgcolor=color.new(rsi_color, 85))
        row += 1
    
    else if indicatorName == "StochRSI" and enableStochRSI
        table.cell(table_ref, 0, row, "Stoch RSI", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            stoch_v = array.get(stoch_array, i)
            stoch_text = stoch_v >= 90 ? "EXTREME OB" : stoch_v >= stochRSIOverbought ? "OVERBOUGHT" : stoch_v >= 50 ? "BEARISH" : stoch_v > stochRSIOversold ? "BULLISH" : stoch_v > 10 ? "OVERSOLD" : "EXTREME OS"
            stoch_color = stoch_v >= 90 ? colorVeryBearish : stoch_v >= stochRSIOverbought ? colorBearish : stoch_v >= 50 ? colorBearish : stoch_v > stochRSIOversold ? colorBullish : stoch_v > 10 ? colorBullish : colorVeryBullish
            display_text = str.tostring(stoch_v, "#.#") + "\n" + stoch_text
            table.cell(table_ref, i + 1, row, display_text, text_color=stoch_color, text_size=table_sz, bgcolor=color.new(stoch_color, 85))
        row += 1
    
    else if indicatorName == "MACD" and enableMACD
        table.cell(table_ref, 0, row, "MACD", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            macd_trend = array.get(macd_trend_array, i)
            macd_text = macd_trend == 1 ? "BULLISH" : macd_trend == -1 ? "BEARISH" : "NEUTRAL"
            macd_color = macd_trend == 1 ? colorVeryBullish : macd_trend == -1 ? colorVeryBearish : colorNeutral
            table.cell(table_ref, i + 1, row, macd_text, text_color=macd_color, text_size=table_sz, bgcolor=color.new(macd_color, 85))
        row += 1
    
    else if indicatorName == "WaveTrend" and enableWaveTrend
        table.cell(table_ref, 0, row, "WaveTrend", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            wt_v = array.get(wt_array, i)
            wt_text = wt_v >= 80 ? "EXTREME OB" : wt_v >= wtOverbought ? "OVERBOUGHT" : wt_v > 0 ? "BEARISH" : wt_v > wtOversold ? "BULLISH" : wt_v > -80 ? "OVERSOLD" : "EXTREME OS"
            wt_color = wt_v >= 80 ? colorVeryBearish : wt_v >= wtOverbought ? colorBearish : wt_v > 0 ? colorBearish : wt_v > wtOversold ? colorBullish : wt_v > -80 ? colorBullish : colorVeryBullish
            display_text = str.tostring(wt_v, "#.#") + "\n" + wt_text
            table.cell(table_ref, i + 1, row, display_text, text_color=wt_color, text_size=table_sz, bgcolor=color.new(wt_color, 85))
        row += 1
    
    else if indicatorName == "OBV" and enableOBV
        table.cell(table_ref, 0, row, "OBV", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            obv_trend = array.get(obv_trend_array, i)
            obv_text = obv_trend == 1 ? "BULLISH" : obv_trend == -1 ? "BEARISH" : "NEUTRAL"
            obv_color = obv_trend == 1 ? colorVeryBullish : obv_trend == -1 ? colorVeryBearish : colorNeutral
            table.cell(table_ref, i + 1, row, obv_text, text_color=obv_color, text_size=table_sz, bgcolor=color.new(obv_color, 85))
        row += 1
    
    else if indicatorName == "CMF" and enableCMF
        table.cell(table_ref, 0, row, "CMF(" + str.tostring(cmfLength) + ")", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            cmf_v = array.get(cmf_array, i)
            cmf_text = cmf_v > 0.2 ? "STRONG BUY" : cmf_v > 0.1 ? "BULLISH" : cmf_v > -0.1 ? "NEUTRAL" : cmf_v > -0.2 ? "BEARISH" : "STRONG SELL"
            cmf_color = cmf_v > 0.2 ? colorVeryBullish : cmf_v > 0.1 ? colorBullish : cmf_v > -0.1 ? colorNeutral : cmf_v > -0.2 ? colorBearish : colorVeryBearish
            display_text = str.tostring(cmf_v, "#.##") + "\n" + cmf_text
            table.cell(table_ref, i + 1, row, display_text, text_color=cmf_color, text_size=table_sz, bgcolor=color.new(cmf_color, 85))
        row += 1
    
    else if indicatorName == "Volume" and enableVolume
        table.cell(table_ref, 0, row, "Volume", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            vol_ratio = array.get(vol_ratio_array, i)
            vol_sig = array.get(vol_signal_array, i)
            vol_text = vol_ratio > 2.0 ? "EXTREME" : vol_ratio > volumeThreshold ? (vol_sig == 1 ? "HIGH BUY" : vol_sig == -1 ? "HIGH SELL" : "HIGH") : vol_ratio > 1.0 ? "NORMAL" : "LOW"
            vol_color = vol_sig == 1 ? colorVeryBullish : vol_sig == -1 ? colorVeryBearish : vol_ratio > volumeThreshold ? colorNeutral : colorBearish
            display_text = str.tostring(vol_ratio, "#.#") + "x\n" + vol_text
            table.cell(table_ref, i + 1, row, display_text, text_color=vol_color, text_size=table_sz, bgcolor=color.new(vol_color, 85))
        row += 1
    
    else if indicatorName == "MFI" and enableMFI
        table.cell(table_ref, 0, row, "MFI(" + str.tostring(mfiLength) + ")", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            mfi_v = array.get(mfi_array, i)
            mfi_text = mfi_v >= 90 ? "EXTREME OB" : mfi_v >= mfiOverbought ? "OVERBOUGHT" : mfi_v >= 50 ? "BEARISH" : mfi_v > mfiOversold ? "BULLISH" : mfi_v > 10 ? "OVERSOLD" : "EXTREME OS"
            mfi_color = mfi_v >= 90 ? colorVeryBearish : mfi_v >= mfiOverbought ? colorBearish : mfi_v >= 50 ? colorBearish : mfi_v > mfiOversold ? colorBullish : mfi_v > 10 ? colorBullish : colorVeryBullish
            display_text = str.tostring(mfi_v, "#.#") + "\n" + mfi_text
            table.cell(table_ref, i + 1, row, display_text, text_color=mfi_color, text_size=table_sz, bgcolor=color.new(mfi_color, 85))
        row += 1
    
    else if indicatorName == "Squeeze" and enableSqueeze
        table.cell(table_ref, 0, row, "Squeeze", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            sqz_st = array.get(sqz_status_array, i)
            sqz_m = array.get(sqz_mom_array, i)
            status_text = sqz_st == 1 ? "ON" : "FIRED"
            signal_text = ""
            sqz_color = colorNeutral
            if sqz_st == 1
                if sqz_m > 0
                    signal_text := "BULL BUILD"
                    sqz_color := color.new(colorBullish, 30)
                else
                    signal_text := "BEAR BUILD"
                    sqz_color := color.new(colorBearish, 30)
            else
                if sqz_m > 0
                    signal_text := "BULLISH"
                    sqz_color := colorVeryBullish
                else
                    signal_text := "BEARISH"
                    sqz_color := colorVeryBearish
            display_text = status_text + "\n" + signal_text
            table.cell(table_ref, i + 1, row, display_text, text_color=sqz_color, text_size=table_sz, bgcolor=color.new(sqz_color, 85))
        row += 1
    
    else if indicatorName == "CCI" and enableCCI
        table.cell(table_ref, 0, row, "CCI(" + str.tostring(cciLength) + ")", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            cci_v = array.get(cci_array, i)
            cci_text = cci_v < -200 ? "EXTREME OS" : cci_v < cciOversold ? "OVERSOLD" : cci_v < 0 ? "BULLISH" : cci_v < cciOverbought ? "BEARISH" : cci_v < 200 ? "OVERBOUGHT" : "EXTREME OB"
            cci_color = cci_v < -200 ? colorVeryBullish : cci_v < cciOversold ? colorBullish : cci_v < 0 ? colorBullish : cci_v < cciOverbought ? colorBearish : cci_v < 200 ? colorBearish : colorVeryBearish
            display_text = str.tostring(cci_v, "#.#") + "\n" + cci_text
            table.cell(table_ref, i + 1, row, display_text, text_color=cci_color, text_size=table_sz, bgcolor=color.new(cci_color, 85))
        row += 1
    
    else if indicatorName == "%R" and enableWilliamsR
        table.cell(table_ref, 0, row, "%R(" + str.tostring(williamsLength) + ")", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            wr_v = array.get(wr_array, i)
            wr_text = wr_v < -90 ? "EXTREME OS" : wr_v < williamsOversold ? "OVERSOLD" : wr_v < -50 ? "BULLISH" : wr_v < williamsOverbought ? "BEARISH" : wr_v < -10 ? "OVERBOUGHT" : "EXTREME OB"
            wr_color = wr_v < -90 ? colorVeryBullish : wr_v < williamsOversold ? colorBullish : wr_v < -50 ? colorBullish : wr_v < williamsOverbought ? colorBearish : wr_v < -10 ? colorBearish : colorVeryBearish
            display_text = str.tostring(wr_v, "#.#") + "\n" + wr_text
            table.cell(table_ref, i + 1, row, display_text, text_color=wr_color, text_size=table_sz, bgcolor=color.new(wr_color, 85))
        row += 1
    
    else if indicatorName == "KST" and enableKST
        table.cell(table_ref, 0, row, "KST", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            kst_trend = array.get(kst_trend_array, i)
            kst_text = kst_trend == 1 ? "BULLISH" : kst_trend == -1 ? "BEARISH" : "NEUTRAL"
            kst_color = kst_trend == 1 ? colorVeryBullish : kst_trend == -1 ? colorVeryBearish : colorNeutral
            table.cell(table_ref, i + 1, row, kst_text, text_color=kst_color, text_size=table_sz, bgcolor=color.new(kst_color, 85))
        row += 1
    
    else if indicatorName == "ADX" and enableADX
        table.cell(table_ref, 0, row, "ADX(" + str.tostring(adxLength) + ")", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            adx_v = array.get(adx_array, i)
            adx_text = adx_v >= 50 ? "VERY STRONG" : adx_v >= 25 ? "STRONG" : adx_v >= 20 ? "MODERATE" : "WEAK"
            adx_color = adx_v >= 50 ? colorVeryBullish : adx_v >= 25 ? colorBullish : adx_v >= 20 ? colorNeutral : colorBearish
            display_text = str.tostring(adx_v, "#.#") + "\n" + adx_text
            table.cell(table_ref, i + 1, row, display_text, text_color=adx_color, text_size=table_sz, bgcolor=color.new(adx_color, 85))
        row += 1
    
    else if indicatorName == "DI" and enableDI
        table.cell(table_ref, 0, row, "DI Diff", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            di_v = array.get(di_diff_array, i)
            di_text = di_v > 10 ? "STRONG DI+" : di_v > 0 ? "DI+ UP" : di_v > -10 ? "DI- DOWN" : "STRONG DI-"
            di_color = di_v > 10 ? colorVeryBullish : di_v > 0 ? colorBullish : di_v > -10 ? colorBearish : colorVeryBearish
            display_text = str.tostring(di_v, "#.#") + "\n" + di_text
            table.cell(table_ref, i + 1, row, display_text, text_color=di_color, text_size=table_sz, bgcolor=color.new(di_color, 85))
        row += 1
    
    else if indicatorName == "Bollinger" and enableBollinger
        table.cell(table_ref, 0, row, "Bollinger", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            bb_pos = array.get(bb_position_array, i)
            bb_text = bb_pos == 1 ? "OVERSOLD" : bb_pos == -1 ? "OVERBOUGHT" : "NORMAL"
            bb_color = bb_pos == 1 ? colorVeryBullish : bb_pos == -1 ? colorVeryBearish : colorNeutral
            table.cell(table_ref, i + 1, row, bb_text, text_color=bb_color, text_size=table_sz, bgcolor=color.new(bb_color, 85))
        row += 1
    
    else if indicatorName == "ATR" and enableATR
        table.cell(table_ref, 0, row, "ATR(" + str.tostring(atrLength) + ")", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            atr_sig = array.get(atr_signal_array, i)
            atr_text = atr_sig == 1 ? "HIGH VOL" : atr_sig == -1 ? "LOW VOL" : "NORMAL VOL"
            atr_color = atr_sig == 1 ? colorVeryBullish : atr_sig == -1 ? colorBearish : colorNeutral
            table.cell(table_ref, i + 1, row, atr_text, text_color=atr_color, text_size=table_sz, bgcolor=color.new(atr_color, 85))
        row += 1
    
    else if indicatorName == "VIX" and enableVixFix
        table.cell(table_ref, 0, row, "VIX Fix", text_color=colorHeader, text_size=table_sz, bgcolor=color.new(colorBG, 50))
        for i = 0 to activeTimeframes - 1
            vix_v = array.get(vix_array, i)
            vix_sig = array.get(vix_sig_array, i)
            vix_text = vix_sig == 1 ? "PANIC BOTTOM" : vix_v >= vixFixThreshold ? "DIP FORMING" : vix_v >= 30 ? "MODERATE" : "CALM"
            vix_color = vix_sig == 1 ? colorVeryBullish : vix_v >= vixFixThreshold ? colorBullish : vix_v >= 30 ? colorNeutral : colorBearish
            display_text = str.tostring(vix_v, "#.#") + "\n" + vix_text
            table.cell(table_ref, i + 1, row, display_text, text_color=vix_color, text_size=table_sz, bgcolor=color.new(vix_color, 85))
        row += 1
    
    row

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// TABLE DISPLAY
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

table_pos = switch panelPosition
    "Top Left" => position.top_left
    "Top Right" => position.top_right
    "Bottom Left" => position.bottom_left
    "Bottom Right" => position.bottom_right
    "Middle Right" => position.middle_right
    => position.top_right

table_size = switch panelSize
    "Small" => size.small
    "Normal" => size.normal
    "Large" => size.large
    => size.small

row_count = 1 + totalActiveIndicators + (showPowerRow ? 1 : 0) + 2

var table dashboard_table = table.new(table_pos, activeTimeframes + 1, row_count, bgcolor=colorBG, border_width=2, border_color=colorHeader, frame_width=2, frame_color=colorHeader)

if barstate.islast
    current_row = 0
    
    table.cell(dashboard_table, 0, current_row, "Timeframe", text_color=colorHeader, text_size=table_size, bgcolor=color.new(colorHeader, 85))
    for i = 0 to activeTimeframes - 1
        table.cell(dashboard_table, i + 1, current_row, array.get(tf_labels, i), text_color=colorText, text_size=table_size, bgcolor=color.new(colorHeader, 90))
    current_row += 1
    
    current_row := f_displayIndicator(displayOrder1, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder2, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder3, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder4, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder5, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder6, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder7, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder8, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder9, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder10, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder11, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder12, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder13, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder14, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder15, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder16, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder17, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder18, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder19, current_row, dashboard_table, table_size)
    current_row := f_displayIndicator(displayOrder20, current_row, dashboard_table, table_size)
    
    // Individual TF Power Scores - COMPACT
    if showPowerRow
        table.cell(dashboard_table, 0, current_row, "TF POWER", text_color=colorHeader, text_size=table_size, bgcolor=color.new(colorHeader, 70))
        for i = 0 to activeTimeframes - 1
            net_pow = array.get(netPower_array, i)
            tf_weight = f_getTimeframeWeight(i)
            
            power_text = (net_pow > 0 ? "+" : "") + str.tostring(net_pow, "#.0") + "%"
            weight_text = "W:" + str.tostring(tf_weight, "#.#")
            full_text = power_text + "\n" + weight_text
            
            power_color = f_getPowerColor(math.abs(net_pow))
            table.cell(dashboard_table, i + 1, current_row, full_text, text_color=colorText, text_size=table_size, bgcolor=color.new(power_color, 85))
        current_row += 1
    
    // Legacy Confluence Row
    summary_label = "CONF (" + str.tostring(activeDirectionalIndicators) + ")"
    table.cell(dashboard_table, 0, current_row, summary_label, text_color=colorHeader, text_size=table_size, bgcolor=color.new(colorHeader, 70))
    for i = 0 to activeTimeframes - 1
        confluence = array.get(confluenceScore_array, i)
        bull_cnt = array.get(bullishCount_array, i)
        bear_cnt = array.get(bearishCount_array, i)
        
        score_text = (confluence > 0 ? "+" : "") + str.tostring(confluence, "#.0") + "%"
        count_text = "B:" + str.tostring(bull_cnt) + " S:" + str.tostring(bear_cnt)
        summary_text = score_text + "\n" + count_text
        
        summary_color = f_getGradientColor(confluence)
        table.cell(dashboard_table, i + 1, current_row, summary_text, text_color=colorText, text_size=table_size, bgcolor=color.new(summary_color, 85))
    current_row += 1
    
    // Overall Market Power - HORIZONTAL
    final_row = current_row
    table.cell(dashboard_table, 0, final_row, "MARKET POWER", text_color=colorHeader, text_size=table_size, bgcolor=color.new(colorHeader, 60))
    
    market_status = overall_net_power > 50 ? "STRONG BULL" : overall_net_power > 20 ? "BULLISH" : overall_net_power > -20 ? "NEUTRAL" : overall_net_power > -50 ? "BEARISH" : "STRONG BEAR"
    overall_color = overall_net_power > 50 ? colorVeryBullish : overall_net_power > 20 ? colorBullish : overall_net_power > -20 ? colorNeutral : overall_net_power > -50 ? colorBearish : colorVeryBearish
    
    market_power_text = market_status + " | " + (overall_net_power > 0 ? "+" : "") + str.tostring(overall_net_power, "#.0") + "% | "
    market_power_text += "B:" + str.tostring(overall_bull_power, "#.0") + "% S:" + str.tostring(overall_bear_power, "#.0") + "%"
    
    table.cell(dashboard_table, 1, final_row, market_power_text, text_color=colorText, text_size=table_size, bgcolor=color.new(overall_color, 70))
    table.merge_cells(dashboard_table, 1, final_row, activeTimeframes, final_row)

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// END OF CODE - 2025 Nuh Koc
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
