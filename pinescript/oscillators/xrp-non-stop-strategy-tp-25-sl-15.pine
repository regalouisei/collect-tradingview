//@version=5
strategy(
     "XRP Non-Stop Strategy (TP 25% / SL 15%)",
     overlay         = true,
     initial_capital = 10000,
     commission_type = strategy.commission.percent,
     commission_value= 0.1,
     pyramiding      = 0,
     margin_long     = 100,
     process_orders_on_close = true)

// =====================
// XRP ONLY FILTER
// =====================
xrpOnly  = input.bool(true, "Limit to XRP only?")
isXRP    = str.contains(str.upper(syminfo.ticker), "XRP")
canTrade = not xrpOnly or isXRP

// =====================
// FIXED TAKE PROFIT & STOP LOSS
// =====================
tpPerc = 25.0   // TAKE PROFIT 25%
slPerc = 15.0   // STOP LOSS 15%

// Trend filter (optional for smoother entries)
useTrendFilter = input.bool(true, "Use EMA trend filter?")
fastEmaLen     = input.int(20, "Fast EMA", minval = 1)
slowEmaLen     = input.int(50, "Slow EMA", minval = 1)

fastEMA = ta.ema(close, fastEmaLen)
slowEMA = ta.ema(close, slowEmaLen)

bullTrend = not useTrendFilter or fastEMA > slowEMA

// =====================
// NON-STOP LONG ENTRY
// =====================
if canTrade and bullTrend and strategy.position_size == 0
    strategy.entry("XRP Long", strategy.long)

// =====================
// CALCULATE TP & SL
// =====================
var float longStop = na
var float longTP   = na

if strategy.position_size > 0
    entryPrice = strategy.position_avg_price

    longStop := entryPrice * (1 - slPerc / 100.0)  // 15% SL
    longTP   := entryPrice * (1 + tpPerc / 100.0)  // 25% TP

    strategy.exit(
         "XRP Long Exit",
         from_entry = "XRP Long",
         stop  = longStop,
         limit = longTP)

// =====================
// PLOT TP & SL LINES
// =====================
plot(longTP,   title="Take Profit 25%", color=color.new(color.green, 0), style=plot.style_linebr)
plot(longStop, title="Stop Loss 15%",   color=color.new(color.red,   0), style=plot.style_linebr)

// Entry/Exit markers
longEntry = strategy.position_size > 0 and strategy.position_size[1] <= 0
longExit  = strategy.position_size == 0 and strategy.position_size[1] > 0

plotshape(longEntry,
     title     = "BUY",
     style     = shape.triangleup,
     location  = location.belowbar,
     size      = size.large,
     color     = color.new(color.green, 0),
     text      = "BUY")

plotshape(longExit,
     title     = "EXIT",
     style     = shape.triangledown,
     location  = location.abovebar,
     size      = size.large,
     color     = color.new(color.red, 0),
     text      = "EXIT")

// =====================
// ALERTS
// =====================
alertcondition(longEntry, title="XRP BUY",  message="XRP BUY → New long position opened.")
alertcondition(longExit,  title="XRP EXIT", message="XRP EXIT → Position closed (TP 25% or SL 15%).")
