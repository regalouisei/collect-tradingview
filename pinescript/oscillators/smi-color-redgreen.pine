//@version=5
indicator("SMI Couleur Rouge/Vert", shorttitle="SMI_Color", overlay=false)

//-----------------------------
// ðŸ”§ INPUTS
//-----------------------------
kLen     = input.int(10, "Percent K Length", minval=1)
dLen     = input.int(3,  "Percent D Length", minval=1)
emaLen   = input.int(10, "EMA Signal Length", minval=1)
smooth   = input.int(5,  "Smoothing Period", minval=1)

obLevel  = input.float(40,  "Overbought", minval=-100, maxval=100)
osLevel  = input.float(-40, "Oversold",  minval=-100, maxval=100)

//-----------------------------
// ðŸ“Œ RANGE CALCULATIONS
//-----------------------------
ll   = ta.lowest(low,  kLen)
hh   = ta.highest(high, kLen)
diff = hh - ll
rdiff = close - (hh + ll) / 2

avgRel  = ta.ema(rdiff, dLen)
avgDiff = ta.ema(diff,  dLen)

//-----------------------------
// ðŸ“Œ SMI + LISSAGE
//-----------------------------
SMI_raw = avgDiff != 0 ? (avgRel / (avgDiff / 2) * 100) : 0
SMI     = ta.sma(SMI_raw, smooth)

SMI_ema = ta.ema(SMI, emaLen)

//-----------------------------
// ðŸŽ¨ COULEURS DYNAMIQUES
//-----------------------------
smiColor = SMI > SMI[1] ? color.green : color.red

//-----------------------------
// ðŸ“Œ PLOTS
//-----------------------------
plot(SMI,     "SMI", color=smiColor, linewidth=2)
plot(SMI_ema, "EMA", color=color.new(color.red, 0), linewidth=1)

//-----------------------------
// ðŸ“Œ Zones Overbought / Oversold
//-----------------------------
h_ob = hline(obLevel, "Overbought", color=color.gray)
h_os = hline(osLevel, "Oversold",  color=color.gray)

// Surachat dynamique
p_ob1 = plot(obLevel, display=display.none)
p_ob2 = plot(SMI > obLevel ? SMI : obLevel, display=display.none)

// Survente dynamique
p_os1 = plot(osLevel, display=display.none)
p_os2 = plot(SMI < osLevel ? SMI : osLevel, display=display.none)

fill(p_ob1, p_ob2, color=color.new(color.red,   60), title="Zone Overbought")
fill(p_os1, p_os2, color=color.new(color.green, 60), title="Zone Oversold")
