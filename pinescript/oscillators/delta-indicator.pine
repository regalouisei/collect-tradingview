//@version=6
indicator("Delta Indicator", shorttitle="Delta")

// --- General Inputs ---
indicator_type = input.string("RSI Delta", "Indicator Type", options = ["RSI Delta", "MACD Delta", "Stochastic Delta"])

// --- RSI Inputs ---
rsi_len = input.int(14, title="RSI Length", group="RSI Settings")
rsi_ma_len = input.int(14, title="RSI MA Length", group="RSI Settings")
rsi_ma_type = input.string("SMA", "RSI MA Type", options = ["SMA", "EMA", "WMA", "RMA"], group="RSI Settings")

// --- MACD Inputs ---
macd_fast_len = input.int(12, title="Fast Length", group="MACD Settings")
macd_slow_len = input.int(26, title="Slow Length", group="MACD Settings")
macd_signal_len = input.int(9, title="Signal Length", group="MACD Settings")

// --- Stochastic Inputs ---
stoch_k_len = input.int(14, title="%K Length", group="Stochastic Settings")
stoch_k_smooth = input.int(1, title="%K Smoothing", group="Stochastic Settings")
stoch_d_smooth = input.int(3, title="%D Smoothing", group="Stochastic Settings")


// --- Calculations ---

// Function for calculating a generic moving average
ma(source, length, type) =>
    switch type
        "SMA" => ta.sma(source, length)
        "EMA" => ta.ema(source, length)
        "WMA" => ta.wma(source, length)
        "RMA" => ta.rma(source, length)

// Calculate RSI Delta
rsi = ta.rsi(close, rsi_len)
rsi_ma = ma(rsi, rsi_ma_len, rsi_ma_type)
rsi_delta = rsi - rsi_ma

// Calculate MACD Delta (this is the MACD Histogram)
[_, _, macd_delta] = ta.macd(close, macd_fast_len, macd_slow_len, macd_signal_len)

// Calculate Stochastic Delta
stoch_k_raw = ta.stoch(close, high, low, stoch_k_len)
stoch_k_smoothed = ta.sma(stoch_k_raw, stoch_k_smooth) // This is the %K line
stoch_d = ta.sma(stoch_k_smoothed, stoch_d_smooth)   // This is the %D line
stoch_delta = stoch_k_smoothed - stoch_d

// --- Select which delta to display based on user input ---
delta_to_plot = switch indicator_type
    "RSI Delta"        => rsi_delta
    "MACD Delta"       => macd_delta
    "Stochastic Delta" => stoch_delta

// --- Plotting ---
plot_color = delta_to_plot > 0 ? color.new(color.green, 20) : color.new(color.red, 20)


plot(delta_to_plot, title="Delta", color=plot_color, style=plot.style_histogram)
hline(0, "Zero", color.gray)
