//@version=5
strategy("Supertrend (4, 22) Sell Backtest (Reversed)", overlay=true, initial_capital=10000, default_qty_type=strategy.percent_of_equity, default_qty_value=100)

// 1. Inputs
atrPeriod = input.int(4, title="ATR Length", minval=1)
factor = input.float(22.0, title="Factor", minval=0.01, step=0.1)

// 2. Supertrend Calculation
[supertrend, direction] = ta.supertrend(factor, atrPeriod)

// 3. Signal Logic (Reversed for Selling)
// Enter a Short position when the direction changes to positive (red/bearish trend)
sellSignal = direction > 0 and direction[1] < 0
// Exit a Short position when the direction changes to negative (green/bullish trend)
exitSignal = direction < 0 and direction[1] > 0

// 4. Strategy Execution
if (sellSignal)
    // Enter Short position
    strategy.entry("Short", strategy.short)

if (exitSignal)
    // Close Short position
    strategy.close("Short")

// 5. Visuals
plot(direction < 0 ? supertrend : na, "Up Trend", color = color.green, style = plot.style_linebr, linewidth=2)
plot(direction > 0 ? supertrend : na, "Down Trend", color = color.red, style = plot.style_linebr, linewidth=2)

plotshape(sellSignal, title="Sell Entry", location=location.abovebar, color=color.red, style=shape.triangledown, size=size.normal)
plotshape(exitSignal, title="Exit Position", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small)
