//@version=6
indicator("150MA Distance + Slope + Scaled Z-Score", overlay=false)

// === Inputs ===
maLen = input.int(150, "MA Length", minval=1)
lookbackForSlope = input.int(1, "Slope Lookback Bars")
showZscore = input.bool(true, "Show Z-Score")

// === 150-Day Moving Average ===
ma = ta.sma(close, maLen)

// === Distance From MA ===
dist_pct = ((close - ma) / ma) * 100

// Z-score calculation
std_dev = ta.stdev(close, maLen)
zscore = showZscore ? ((close - ma) / std_dev) : na

// scale Z-score for display
z_scaled = zscore * input.float(10.0, "Z-Score Scale Factor")

// === Slope & Angle ===
slope = (ma - ma[lookbackForSlope]) / lookbackForSlope

// Convert slope to angle (degrees)
const float rad2deg = 180.0 / math.pi
angle_deg = math.atan(slope) * rad2deg

// === Plot ===
plot(dist_pct, title="Distance %", color=color.blue)
plot(angle_deg, title="MA Slope (Â°)", color=color.green)
plot(z_scaled, title="Z-Score (Scaled)", color=color.orange)

// Zero baseline
hline(0, "Zero", color=color.gray)
