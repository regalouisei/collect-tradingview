//@version=6
indicator("Momentum Checklist", shorttitle="Momentum", overlay=true)

//-----------------------------------------------------------------------------
// INPUTS
//-----------------------------------------------------------------------------

// DMI/ADX Settings
lensig = input.int(14, "ADX Smoothing", minval=1, group="DMI Settings")
len = input.int(14, "DI Length", minval=1, group="DMI Settings")

// MFI Settings
mfi_length = input.int(14, "MFI Length", minval=1, group="MFI Settings")

// Dashboard Settings
dash_loc = input.string('Top Right', 'Dashboard Location', 
  options=['Top Right', 'Top Left', 'Bottom Right', 'Bottom Left'], group='Dashboard')
text_size = input.string('Normal', 'Dashboard Size', 
  options=['Tiny', 'Small', 'Normal'], group='Dashboard')

//-----------------------------------------------------------------------------
// CALCULATE DMI/ADX
//-----------------------------------------------------------------------------

up = ta.change(high)
down = -ta.change(low)
plusDM = na(up) ? na : (up > down and up > 0 ? up : 0)
minusDM = na(down) ? na : (down > up and down > 0 ? down : 0)
trur = ta.rma(ta.tr, len)
plus = fixnan(100 * ta.rma(plusDM, len) / trur)
minus = fixnan(100 * ta.rma(minusDM, len) / trur)
sum = plus + minus
adx = 100 * ta.rma(math.abs(plus - minus) / (sum == 0 ? 1 : sum), lensig)

//-----------------------------------------------------------------------------
// CALCULATE MFI
//-----------------------------------------------------------------------------

mfi_source = hlc3
mfi_upper = math.sum(volume * (ta.change(mfi_source) <= 0 ? 0 : mfi_source), mfi_length)
mfi_lower = math.sum(volume * (ta.change(mfi_source) >= 0 ? 0 : mfi_source), mfi_length)
mfi = 100.0 - (100.0 / (1.0 + mfi_upper / mfi_lower))

//-----------------------------------------------------------------------------
// TRADING BIAS
//-----------------------------------------------------------------------------

// Determine bias based on DI+/DI-
bias = plus > 25 and minus < 20 ? "LONG" : 
  minus > 25 and plus < 20 ? "SHORT" : 
  "NEUTRAL"

bias_color = bias == "LONG" ? color.rgb(0, 200, 100) : 
  bias == "SHORT" ? color.rgb(255, 60, 60) : 
  color.rgb(255, 180, 0)

//-----------------------------------------------------------------------------
// TABLE SETUP
//-----------------------------------------------------------------------------

var table_position = dash_loc == 'Top Left' ? position.top_left : 
  dash_loc == 'Bottom Right' ? position.bottom_right : 
  dash_loc == 'Bottom Left' ? position.bottom_left : 
  position.top_right

var table_size = text_size == 'Tiny' ? size.tiny : 
  text_size == 'Small' ? size.small : 
  size.normal

var tb = table.new(table_position, 2, 6,
  bgcolor = color.rgb(20, 25, 35),
  border_color = color.rgb(60, 65, 75),
  border_width = 1,
  frame_color = color.rgb(60, 65, 75),
  frame_width = 1)

//-----------------------------------------------------------------------------
// POPULATE TABLE
//-----------------------------------------------------------------------------

if barstate.isfirst
    // Header
    table.cell(tb, 0, 0, 'Momentum Checklist', text_color=color.white, text_size=table_size, bgcolor=color.rgb(30, 35, 50))
    table.merge_cells(tb, 0, 0, 1, 0)
    
    // Labels
    table.cell(tb, 0, 1, 'ADX', text_color=color.rgb(200, 200, 200), text_size=table_size)
    table.cell(tb, 0, 2, 'DI+', text_color=color.rgb(200, 200, 200), text_size=table_size)
    table.cell(tb, 0, 3, 'DI-', text_color=color.rgb(200, 200, 200), text_size=table_size)
    table.cell(tb, 0, 4, 'MFI', text_color=color.rgb(200, 200, 200), text_size=table_size)
    table.cell(tb, 0, 5, 'Bias', text_color=color.rgb(200, 200, 200), text_size=table_size)

if barstate.islast
    // ADX
    adx_status = adx >= 20 ? "✅ " + str.tostring(adx, "#.##") : str.tostring(adx, "#.##")
    adx_bg = adx >= 20 ? color.rgb(0, 150, 70) : color.rgb(25, 30, 40)
    table.cell(tb, 1, 1, adx_status, 
      bgcolor=adx_bg,
      text_color=color.white, 
      text_size=table_size)
    
    // DI+
    di_plus_status = str.tostring(plus, "#.##")
    di_plus_bg = plus > 25 and minus < 20 ? color.rgb(0, 150, 70) : color.rgb(25, 30, 40)
    di_plus_text_color = plus > 25 and minus < 20 ? color.white : color.rgb(100, 200, 130)
    table.cell(tb, 1, 2, di_plus_status, 
      bgcolor=di_plus_bg,
      text_color=di_plus_text_color, 
      text_size=table_size)
    
    // DI-
    di_minus_status = str.tostring(minus, "#.##")
    di_minus_bg = minus > 25 and plus < 20 ? color.rgb(200, 50, 50) : color.rgb(25, 30, 40)
    di_minus_text_color = minus > 25 and plus < 20 ? color.white : color.rgb(255, 100, 100)
    table.cell(tb, 1, 3, di_minus_status, 
      bgcolor=di_minus_bg,
      text_color=di_minus_text_color, 
      text_size=table_size)
    
    // MFI
    mfi_status = mfi > 50 ? "✅ " + str.tostring(mfi, "#.##") : "⚠️ " + str.tostring(mfi, "#.##")
    mfi_bg = mfi > 50 ? color.rgb(0, 150, 70) : color.rgb(200, 80, 0)
    table.cell(tb, 1, 4, mfi_status, 
      bgcolor=mfi_bg,
      text_color=color.white, 
      text_size=table_size)
    
    // Bias
    table.cell(tb, 1, 5, bias, 
      bgcolor=bias_color,
      text_color=color.white, 
      text_size=table_size)
