//@version=5
indicator("Z-Score Distortion Lab", shorttitle="Z-Lab ðŸ”¬", overlay=false, precision=2)

// --- Color Palette (Premium Lab Style) ---
color_skew = color.new(#ccff00, 0)   // Neon Lime
color_kurt = color.new(#00e5ff, 0)   // Bright Aqua
color_alert = color.new(#ff5252, 0)  // Red Alert
color_bg    = color.new(#ff5252, 90) // Soft Red Transparent

// --- Settings ---
length = input.int(30, title="Rolling Period (Diagnostic Window)", minval=5)
src    = input.source(close, title="Source Data")

// --- Input Alerts (Customizable) ---
k_limit = input.float(2.0, title="Kurtosis Threshold (Risk)", step=0.1)
s_high  = input.float(1.0, title="Positive Skew (Up Bias)", step=0.1)
s_low   = input.float(-1.0, title="Negative Skew (Down Bias)", step=0.1)

// --- Calculations ---
mean = ta.sma(src, length)
std  = ta.stdev(src, length)
z    = (src - mean) / std

skew = ta.sma(math.pow(z, 3), length)
kurt = ta.sma(math.pow(z, 4), length) - 3

// --- Plotting Logic ---
hline(0, "Normal", color=color.new(color.gray, 60), linestyle=hline.style_dashed)
s_up_line   = hline(s_high, "Skew Upper Bound", color=color.new(color_skew, 70), linestyle=hline.style_dotted)
s_down_line = hline(s_low, "Skew Lower Bound", color=color.new(color_skew, 70), linestyle=hline.style_dotted)
k_limit_line = hline(k_limit, "Risk Threshold", color=color.new(color_kurt, 70), linestyle=hline.style_dotted)

plot(skew, title="Skewness (Bias)", color=color_skew, linewidth=2)
plot(kurt, title="Kurtosis (Fat Tail)", color=color_kurt, linewidth=2)

// --- ðŸŽ¯ Visual Indicators (à¸ˆà¸¸à¸”à¸—à¸µà¹ˆà¸šà¸­à¸ªà¸ªà¸±à¹ˆà¸‡à¹à¸à¹‰à¹„à¸‚) ---

// 1. à¸ªà¸²à¸¡à¹€à¸«à¸¥à¸µà¹ˆà¸¢à¸¡à¸ªà¸µà¹à¸”à¸‡ à¸ªà¸³à¸«à¸£à¸±à¸š Extreme Kurtosis (High Risk)
plotshape(ta.crossover(kurt, k_limit), title="Kurtosis Alert", style=shape.triangleup, location=location.top, color=color_alert, size=size.small, text="RISK", textcolor=color_alert)

// 2. à¸¥à¸¹à¸à¸¨à¸£à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§ à¸ªà¸³à¸«à¸£à¸±à¸š Positive Skew (à¹à¸£à¸‡à¹€à¸«à¸§à¸µà¹ˆà¸¢à¸‡à¸‚à¸¶à¹‰à¸™)
plotshape(ta.crossover(skew, s_high), title="Positive Skew Arrow", style=shape.arrowup, location=location.bottom, color=color_skew, size=size.small)

// 3. à¸¥à¸¹à¸à¸¨à¸£à¸ªà¸µà¸ªà¹‰à¸¡ à¸ªà¸³à¸«à¸£à¸±à¸š Negative Skew (à¹à¸£à¸‡à¹€à¸«à¸§à¸µà¹ˆà¸¢à¸‡à¸¥à¸‡)
plotshape(ta.crossunder(skew, s_low), title="Negative Skew Arrow", style=shape.arrowdown, location=location.bottom, color=color.orange, size=size.small)

// --- Background High Risk Zone ---
bgcolor(kurt > k_limit ? color_bg : na, title="High Risk Zone")

// --- Alerts ---
alertcondition(kurt > k_limit, "Extreme Kurtosis", "Z-Lab ðŸ”¬: High Risk Detected!")
alertcondition(ta.crossunder(skew, s_low), "Negative Skew", "Z-Lab ðŸ”¬: Downside Bias!")
alertcondition(ta.crossover(skew, s_high), "Positive Skew", "Z-Lab ðŸ”¬: Upside Bias!")
