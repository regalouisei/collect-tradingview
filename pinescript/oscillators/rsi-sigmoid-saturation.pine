//@version=5
indicator("RSI Sigmoid (Saturation)", shorttitle="RSI-Sig", overlay=false)

// User Settings
rsiPeriod = input.int(50, "RSI Period", minval=1, maxval=200)
sigmoidK = input.float(0.5, "Sigmoid Coefficient (k)", minval=0.01, maxval=0.5, step=0.01, 
     tooltip="Low value = smooth saturation, High value = sharp saturation")

// Sigmoid levels
oversoldLevel = input.int(30, "Oversold Level", minval=0, maxval=50)
overboughtLevel = input.int(70, "Overbought Level", minval=50, maxval=100)

// RSI Calculation
rsiValue = ta.rsi(close, rsiPeriod)

// CORRECT Sigmoid Transformation - With Saturation
centered = rsiValue - 50
x = sigmoidK * centered
expPos = math.exp(x)
expNeg = math.exp(-x)
tanhValue = (expPos - expNeg) / (expPos + expNeg)
rsiSigmoid = (tanhValue * 50) + 50

// Plot Drawings
plot(rsiSigmoid, "RSI Sigmoid (Saturated)", color=color.new(#2962FF, 0), linewidth=3)
plot(rsiValue, "RSI Normal", color=color.new(#FF6D00, 50), linewidth=2, style=plot.style_circles)

// Reference lines
hline(50, "Middle Line", color=color.new(color.gray, 50), linestyle=hline.style_solid, linewidth=2)
hline(oversoldLevel, "Oversold", color=color.new(color.green, 50), linestyle=hline.style_dashed)
hline(overboughtLevel, "Overbought", color=color.new(color.red, 50), linestyle=hline.style_dashed)

// Saturation zones
hline(10, "Lower Saturation", color=color.new(color.green, 70), linestyle=hline.style_dotted)
hline(90, "Upper Saturation", color=color.new(color.red, 70), linestyle=hline.style_dotted)

// Background
bgcolor(rsiSigmoid > 90 ? color.new(color.red, 85) : na, title="Upper Saturation")
bgcolor(rsiSigmoid < 10 ? color.new(color.green, 85) : na, title="Lower Saturation")
bgcolor(rsiSigmoid > overboughtLevel and rsiSigmoid <= 90 ? color.new(color.red, 92) : na)
bgcolor(rsiSigmoid < oversoldLevel and rsiSigmoid >= 10 ? color.new(color.green, 92) : na)

// Difference
diff = rsiValue - rsiSigmoid
plot(diff, "Difference (Normal - Sigmoid)", color=color.new(color.purple, 70), linewidth=1, style=plot.style_area)

// âš¡ Signals based on 50 line
bullishSignal = ta.crossover(rsiSigmoid, 50)
bearishSignal = ta.crossunder(rsiSigmoid, 50)

plotshape(bullishSignal, "Strong Buy", shape.triangleup, location.bottom, color.new(color.lime, 0), size=size.normal)
plotshape(bearishSignal, "Strong Sell", shape.triangledown, location.top, color.new(color.red, 0), size=size.normal)

// Info table
var table infoTable = table.new(position.top_right, 2, 4, bgcolor=color.new(color.black, 80), border_width=1)

if barstate.islast
    table.cell(infoTable, 0, 0, "RSI Normal:", text_color=color.orange, text_size=size.small)
    table.cell(infoTable, 1, 0, str.tostring(rsiValue, "#.##"), text_color=color.white, text_size=size.small)
    
    table.cell(infoTable, 0, 1, "RSI Sigmoid:", text_color=color.blue, text_size=size.small)
    table.cell(infoTable, 1, 1, str.tostring(rsiSigmoid, "#.##"), text_color=color.white, text_size=size.small)
    
    table.cell(infoTable, 0, 2, "Difference:", text_color=color.purple, text_size=size.small)
    table.cell(infoTable, 1, 2, str.tostring(diff, "#.##"), text_color=color.white, text_size=size.small)
    
    table.cell(infoTable, 0, 3, "Status:", text_color=color.gray, text_size=size.small)
    status = rsiSigmoid > 90 ? "UPPER SAT!" : rsiSigmoid < 10 ? "LOWER SAT!" : rsiSigmoid > 50 ? "UP" : "DOWN"
    statusColor = rsiSigmoid > 90 or rsiSigmoid < 10 ? color.yellow : rsiSigmoid > 50 ? color.green : color.red
    table.cell(infoTable, 1, 3, status, text_color=statusColor, text_size=size.small)

// Alerts
alertcondition(bullishSignal, "Above 50 - BUY", "RSI sigmoid crossed above 50 line - buy signal!")
alertcondition(bearishSignal, "Below 50 - SELL", "RSI sigmoid crossed below 50 line - sell signal!")
