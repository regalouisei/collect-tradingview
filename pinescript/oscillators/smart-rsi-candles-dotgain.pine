// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © DotGain

//@version=6
indicator(title = 'Smart RSI Candles', shorttitle = 'Smart RSI Candles', overlay = true)

// --- Inputs ---
src = close
len = input.int(14, minval = 1, title = 'Length')

// --- Upper Levels ---
u1_on = input.bool(true, title = 'On/Off', group = 'Upper Levels')
upper1 = input.int(60, title = '#1 Value', group = 'Upper Levels')

u2_on = input.bool(true, title = 'On/Off', group = 'Upper Levels')
upper2 = input.int(70, title = '#2 Value', group = 'Upper Levels')

u3_on = input.bool(true, title = 'On/Off', group = 'Upper Levels')
upper3 = input.int(80, title = '#3 Value', group = 'Upper Levels')

// --- Lower Levels ---
l1_on = input.bool(true, title = 'On/Off', group = 'Lower Levels')
lower1 = input.int(40, title = '#1 Value', group = 'Lower Levels')

l2_on = input.bool(true, title = 'On/Off', group = 'Lower Levels')
lower2 = input.int(30, title = '#2 Value', group = 'Lower Levels')

l3_on = input.bool(true, title = 'On/Off', group = 'Lower Levels')
lower3 = input.int(20, title = '#3 Value', group = 'Lower Levels')

// --- RSI ---
up = ta.rma(math.max(ta.change(src), 0), len)
down = ta.rma(-math.min(ta.change(src), 0), len)
rsi = down == 0 ? 100 : up == 0 ? 0 : 100 - 100 / (1 + up / down)

// --- Bar coloring logic ---
barColor =
     (u3_on and rsi > upper3) ? color.rgb(37, 33, 243) :
     (u2_on and rsi > upper2) ? color.rgb(22, 163, 74) :
     (u1_on and rsi > upper1) ? color.rgb(74, 222, 128) :
     (l3_on and rsi < lower3) ? color.rgb(47, 33, 243) :
     (l2_on and rsi < lower2) ? color.rgb(185, 28, 28) :
     (l1_on and rsi < lower1) ? color.rgb(239, 68, 68) :
     na

barcolor(barColor)
