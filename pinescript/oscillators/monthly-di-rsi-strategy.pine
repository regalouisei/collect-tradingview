// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © Ganamurthy

//@version=6
strategy("Monthly DI+ & RSI Strategy", overlay=true)

// --- 1. Inputs ---
// DMI Settings
adxLen = input.int(14, title="ADX Smoothing")
diLen = input.int(14, title="DI Length")

// RSI Settings
rsiLen = input.int(6, title="RSI Length")
rsiSmaLen = input.int(14, title="RSI SMA Length") // The Moving Average of the RSI

// --- 2. Calculations ---
// Calculate DMI (DI+ and DI-)
[diplus, diminus, adx] = ta.dmi(diLen, adxLen)

// Calculate RSI and its SMA
rsiValue = ta.rsi(close, rsiLen)
rsiSma = ta.sma(rsiValue, rsiSmaLen)

// --- 3. Entry Conditions ---
// Condition 1: DI+ crosses over DI- AND RSI is already above its SMA
cond1 = ta.crossover(diplus, diminus) and (rsiValue > rsiSma)

// Condition 2: RSI crosses over its SMA AND DI+ is already above DI-
cond2 = ta.crossover(rsiValue, rsiSma) and (diplus > diminus)

// Combine Buy Logic
longCondition = cond1 or cond2

// --- 4. Exit Condition (Stop Loss) ---
// SL: DI- crosses over DI+ (Trend has reversed to bearish)
exitCondition = ta.crossover(diminus, diplus)

// --- 5. Execution ---
if (longCondition)
    strategy.entry("Long Buy", strategy.long)

if (exitCondition)
    strategy.close("Long Buy", comment="SL Hit")

// --- 6. Visuals (Optional) ---
// Plot Buy Signals on the main chart for easy visibility
plotshape(longCondition, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small, title="Buy Signal")
plotshape(exitCondition, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small, title="Exit Signal")
