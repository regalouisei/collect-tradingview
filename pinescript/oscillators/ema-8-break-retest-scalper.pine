//@version=5
indicator("EMA 8 Break & Retest Scalper", overlay=true)

// === INPUTS ===
emaLength = input.int(8, "EMA Length")
swingLen  = input.int(5, "Structure Swing Length")
wickRatio = input.float(1.2, "Min Wick/Body Ratio", step=0.1)

// === EMA ===
ema8 = ta.ema(close, emaLength)
plot(ema8, color=color.blue, linewidth=2)

// === STRUKTUR (Swing High / Low) ===
swingHigh = ta.highest(high, swingLen)
swingLow  = ta.lowest(low, swingLen)

// Strukturbruch
bullBreak = close > swingHigh[1]
bearBreak = close < swingLow[1]

// === WICK ANALYSE ===
body      = math.abs(close - open)
lowerWick = math.min(open, close) - low
upperWick = high - math.max(open, close)

bullWick = lowerWick > body * wickRatio
bearWick = upperWick > body * wickRatio

// === RETEST LOGIK ===
pullbackLong  = low <= ema8 and close > ema8
pullbackShort = high >= ema8 and close < ema8

// === TREND RICHTUNG EMA ===
emaUp   = ema8 > ema8[1]
emaDown = ema8 < ema8[1]

// === LONG SETUP ===
longSetup =
     bullBreak and
     pullbackLong and
     emaUp and
     bullWick and
     close > open

// === SHORT SETUP ===
shortSetup =
     bearBreak and
     pullbackShort and
     emaDown and
     bearWick and
     close < open

// === SIGNALS ===
plotshape(longSetup, title="LONG", location=location.belowbar,
     color=color.green, style=shape.triangleup, size=size.small)

plotshape(shortSetup, title="SHORT", location=location.abovebar,
     color=color.red, style=shape.triangledown, size=size.small)

// Alerts
alertcondition(longSetup, title="Long Signal", message="EMA Retest Long")
alertcondition(shortSetup, title="Short Signal", message="EMA Retest Short")
