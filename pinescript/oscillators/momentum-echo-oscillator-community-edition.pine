//@version=5
// ╔══════════════════════════════════════════════════════════════════════════════════╗
// ║  MOMENTUM ECHO OSCILLATOR [OPEN SOURCE]                                          ║
// ║  ------------------------------------------------------------------------------  ║
// ║  An enhanced momentum oscillator that uses 'Echo' weights to capture both        ║
// ║  immediate price velocity and historical momentum harmonics.                     ║
// ╚══════════════════════════════════════════════════════════════════════════════════╝

indicator("Momentum Echo Oscillator [Community Edition]", shorttitle="MEO Echo", timeframe="", format=format.price, precision=2)

// --- INPUTS ---
src = input.source(close, "Price Source")
primary_len = input.int(10, "Main Momentum Length", minval=1)

grp_echo = "Echo (Harmonic) Settings"
echo1_lookback = input.int(5, "Echo 1 Offset", minval=1, group=grp_echo)
echo1_weight   = input.float(0.25, "Echo 1 Power", minval=0, maxval=1, step=0.05, group=grp_echo)
echo2_lookback = input.int(10, "Echo 2 Offset", minval=1, group=grp_echo)
echo2_weight   = input.float(0.15, "Echo 2 Power", minval=0, maxval=1, step=0.05, group=grp_echo)

grp_signal = "Signal Smoothing"
sig_len = input.int(9, "Signal Line Length", minval=1, group=grp_signal)
ob_level = input.float(2.5, "Overbought", group=grp_signal)
os_level = input.float(-2.5, "Oversold", group=grp_signal)

// --- CALCULATIONS ---

// Primary Momentum: Standard ROC-like base
mom = src - src[primary_len]

// Echoes: Historical momentum values that 'echo' back into the current calculation
echo1 = mom[echo1_lookback]
echo2 = mom[echo2_lookback]

// Weighted Momentum Calculation
// Total weight is distributed between primary and echoes
primary_weight = 1.0 - echo1_weight - echo2_weight
meo_raw = (mom * primary_weight) + (echo1 * echo1_weight) + (echo2 * echo2_weight)

// Normalization (optional but helps scaling)
meo_final = ta.ema(meo_raw, 3)
signal_line = ta.ema(meo_final, sig_len)
histogram = meo_final - signal_line

// --- VISUALIZATION ---

// Zero Line
hline(0, "Neutral Zone", color=color.new(color.gray, 50), linestyle=hline.style_dotted)

// OB/OS Levels
ob_p = hline(ob_level, "Overbought", color=color.new(color.red, 40))
os_p = hline(os_level, "Oversold", color=color.new(color.green, 40))
fill(ob_p, os_p, color.new(color.blue, 96), title="Comfort Zone")

// Histogram Coloring (Momentum Strength)
hist_col = histogram >= 0 ? (histogram[1] < histogram ? #00ffcc : #00bfa5) : (histogram[1] < histogram ? #ff5252 : #d32f2f)
plot(histogram, "Momentum Delta", color=color.new(hist_col, 30), style=plot.style_histogram, linewidth=3)

// MEO Lines
plot(meo_final, "MEO Engine", color=#2196f3, linewidth=2)
plot(signal_line, "Trigger Line", color=color.new(#ff9800, 20), linewidth=1)

// Crossover Highlights (Circles on the zero line)
plotshape(ta.crossover(meo_final, signal_line), "Bullish Cross", shape.circle, location.absolute, color=#00ffcc, size=size.tiny, offset=0)
plotshape(ta.crossunder(meo_final, signal_line), "Bearish Cross", shape.circle, location.absolute, color=#ff5252, size=size.tiny, offset=0)
