//@version=5
indicator("MACD 12-26-9 2. Koyu Sinyal FIX", overlay=true)

// MACD
[macdLine, signalLine, hist] = ta.macd(close, 12, 26, 9)

// Histogram yön
isUp   = hist > hist[1]
isDown = hist < hist[1]

isPos = hist > 0
isNeg = hist < 0

// Sayaçlar
var int upCount = 0
var int downCount = 0
var bool readyForBuy = false
var bool readyForSell = false

buySignal = false
sellSignal = false

// --- AL MANTIĞI ---
if isPos
    if isDown
        readyForBuy := true
        upCount := 0
    if isUp and readyForBuy
        upCount += 1
        if upCount == 2
            buySignal := true
else
    readyForBuy := false
    upCount := 0

// --- SAT MANTIĞI ---
if isNeg
    if isUp
        readyForSell := true
        downCount := 0
    if isDown and readyForSell
        downCount += 1
        if downCount == 2
            sellSignal := true
else
    readyForSell := false
    downCount := 0

// Çizimler
plotshape(buySignal, style=shape.labelup, location=location.belowbar,
     color=color.green, text="AL")

plotshape(sellSignal, style=shape.labeldown, location=location.abovebar,
     color=color.red, text="SAT")
