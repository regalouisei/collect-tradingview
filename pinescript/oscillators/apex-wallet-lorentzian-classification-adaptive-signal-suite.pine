//@version=5
indicator("www.Apex-Wallet.fr - Lorentzian Classification", overlay=true)

// ============================ INPUTS ============================
// Le mode de trading définit toujours les périodes dynamiquement [cite: 2]
mode = input.string("Day-Trading", "Mode de Trading", options=["Scalping", "Day-Trading", "Swing-Trading"])

// ============================ AUTOMATISATION ============================
// La source est maintenant fixée sur 'close' (Clôture) par défaut
src = close 

// Périodes adaptatives basées sur le mode sélectionné [cite: 3, 6, 7]
int lookbackPeriod = mode == "Scalping" ? 7 : mode == "Swing-Trading" ? 21 : 14
int adxPeriod      = mode == "Scalping" ? 10 : mode == "Swing-Trading" ? 20 : 14
int smoothLen      = mode == "Scalping" ? 3 : mode == "Swing-Trading" ? 7 : 5

// --- FONCTIONS ---
f_adx(len) =>
    [plus, minus, adxValue] = ta.dmi(len, len)
    adxValue

// --- FEATURES (Utilisant la source automatique) ---
f1 = ta.rsi(src, lookbackPeriod)
f2 = ta.cci(src, lookbackPeriod)
f3 = f_adx(adxPeriod)
f4 = ta.mfi(src, lookbackPeriod)
f5 = ta.roc(src, lookbackPeriod)

// --- LOGIQUE DE SIGNAL ---
float signalSum = 0.0
signalSum += (f1 > 50 ? 1 : -1)
signalSum += (f2 > 0 ? 1 : -1)
signalSum += (f3 > 20 ? 1 : 0)
signalSum += (f5 > 0 ? 1 : -1)

float finalSignal = ta.ema(signalSum, smoothLen)

buySignal  = ta.crossover(finalSignal, 0.5)
sellSignal = ta.crossunder(finalSignal, -0.5)

// ============================ AFFICHAGE ============================
plotshape(buySignal,  title="BUY",  style=shape.labelup,   location=location.belowbar, color=color.green, text="BUY",  textcolor=color.white, size=size.small)
plotshape(sellSignal, title="SELL", style=shape.labeldown, location=location.abovebar, color=color.red,   text="SELL", textcolor=color.white, size=size.small)

// ============================ ALERTES ============================
alertcondition(buySignal,  title="Alerte Achat",  message="Signal d'achat Lorentzian détecté")
alertcondition(sellSignal, title="Alerte Vente", message="Signal de vente Lorentzian détecté")
