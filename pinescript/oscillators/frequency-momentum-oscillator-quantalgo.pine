// This script is licensed under Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International
// https://creativecommons.org/licenses/by-nc-sa/4.0/
// Â© QuantAlgo

//@version=6
indicator("Frequency Momentum Oscillator [QuantAlgo]", overlay=false)

//              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              //
//              â•‘      USER-DEFINED SETTINGS     â•‘              //
//              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              //

var string frequency_settings = 'â•â•â•â•â•â• Frequency Analysis Settings â•â•â•â•â•â•'
var string visual_settings = 'â•â•â•â•â•â•â•â• Visualization Settings â•â•â•â•â•â•â•â•'

tooltip_frequency_period = 'Number of bars used for frequency analysis calculations. Lower values (16-24) make the indicator more responsive to recent price changes and regime shifts but may produce more noise and false signals in choppy markets. Higher values (32-50) provide smoother, more stable readings with reduced noise but react slower to genuine market changes. Optimal for most timeframes at 32 periods.'
tooltip_smoothing = 'Smoothing period applied to the final signal output. Lower values (2-3) create highly responsive signals that react quickly to changes but generate more whipsaws and false reversals. Higher values (5-10) produce smoother signals with fewer false signals but with delayed reaction to market shifts. Recommended 3-5 for intraday charts, 5-7 for daily charts.'
tooltip_preset = 'Select a predefined configuration optimized for different trading styles and market conditions.'
tooltip_preset_details = 'Default (32, 3): Balanced configuration with moderate smoothing. Suitable for most timeframes and general trading applications. Offers good balance between responsiveness and noise reduction.\n\nFast Response (24, 2): Aggressive setup for active trading and scalping. Shorter analysis period captures rapid changes while minimal smoothing ensures immediate signal generation. Best for 1-5min charts where quick entries are critical. Expect more signals but also more false positives in ranging markets.\n\nSmooth Trend (40, 5): Conservative configuration for position trading and swing trading. Extended analysis period provides robust long-term trend identification while heavy smoothing filters market noise. Ideal for 4h-daily charts where trend persistence is more important than timing precision. Reduces whipsaws significantly but may lag major reversals.'
tooltip_confirmed_bars = 'Use confirmed (closed) bar data only or include current (live) bar data. When enabled, calculations use only completed bars, ignoring the current forming bar. This eliminates repainting and ensures signals don\'t shift as the current bar develops. Recommended for backtesting, alerts, and automated trading to ensure consistent, reliable signals. When disabled, includes real-time data from the current bar for immediate updates. Enable this for dependable historical analysis and accurate alert triggers.'
tooltip_show_labels = 'Enable/disable signal labels that display current directional bias (LONG/SHORT). Labels appear at the signal line position on the most recent bar. LONG indicates positive momentum with persistent directional movement. SHORT indicates negative momentum with persistent downward movement. Labels update in real-time based on signal position relative to zero line.'
tooltip_bar_coloring = 'Enable/disable coloring of price bars on the main chart based on the current signal direction. When enabled, bars are colored using the bullish color when the signal is positive and bearish color when the signal is negative. This provides an immediate visual reference of the indicator\'s directional bias directly on the price chart without needing to look at the indicator pane.'
tooltip_color_preset = 'Pre-configured color schemes optimized for different chart themes and visual preferences. Classic: Traditional green/red for intuitive bullish/bearish recognition. Aqua: Blue/orange combination reducing eye strain during extended analysis. Cosmic: Modern aqua/purple theme optimized for dark mode. Custom: Full personalization to match your specific chart theme or preference. Each preset maintains strong contrast for instant signal identification.'
tooltip_bullish_color = 'Color for positive momentum signals indicating persistent upward price movement. Represents market conditions where directional movement is dominant. Green traditionally signals bullish conditions and uptrend regimes. Choose colors with high contrast against your chart background for optimal visibility. This color fills the positive signal area and the upper reference line.'
tooltip_bearish_color = 'Color for negative momentum signals indicating persistent downward price movement. Represents market conditions where directional decline is dominant. Red conventionally signals bearish conditions and downtrend regimes. Ensure strong contrast with both chart background and bullish color. This color fills the negative signal area and the lower reference line.'

frequencyPeriod = input.int(32, 'Frequency Analysis Period', group=frequency_settings, tooltip=tooltip_frequency_period)
smoothingPeriod = input.int(3, 'Signal Smoothing Period', group=frequency_settings, tooltip=tooltip_smoothing)

presetConfig = input.string('Default', 'Preconfigured Preset', options=['Default', 'Fast Response', 'Smooth Trend'], group=frequency_settings, tooltip=tooltip_preset + '\n\n' + tooltip_preset_details)

if presetConfig == 'Fast Response'
    frequencyPeriod := 24
    smoothingPeriod := 2
    smoothingPeriod
else if presetConfig == 'Smooth Trend'
    frequencyPeriod := 40
    smoothingPeriod := 5
    smoothingPeriod

useConfirmedBars = input.bool(false, 'Use Confirmed Bars Only', group=frequency_settings, tooltip=tooltip_confirmed_bars)

showLabels = input.bool(true, 'Show Signal Labels', group=visual_settings, tooltip=tooltip_show_labels)
enableBarColoring = input.bool(false, 'Enable Bar Coloring', group=visual_settings, tooltip=tooltip_bar_coloring)

colorPreset = input.string('Custom', 'Color Preset', options=['Classic', 'Aqua', 'Cosmic', 'Custom'], group=visual_settings, tooltip=tooltip_color_preset)
bullishColorInput = input.color(#00ffaa, 'Bullish Signal Color', group=visual_settings, tooltip=tooltip_bullish_color)
bearishColorInput = input.color(#ff0000, 'Bearish Signal Color', group=visual_settings, tooltip=tooltip_bearish_color)

[bullishColor, bearishColor] = switch colorPreset
    'Classic' => [#00ff00, #ff0000]
    'Aqua' => [#00bfff, #ff8c00]
    'Cosmic' => [#49ffce, #9932cc]
    'Custom' => [bullishColorInput, bearishColorInput]

//              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              //
//              â•‘       FREQUENCY ANALYSIS       â•‘              //
//              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              //

dataOffset = useConfirmedBars ? 1 : 0

detrendedPrice = close[dataOffset] - ta.sma(close[dataOffset], frequencyPeriod)

lowFreqPower = 0.0
midFreqPower = 0.0
highFreqPower = 0.0

for k = 1 to 8
    cosSum = 0.0
    sinSum = 0.0
    for n = 0 to frequencyPeriod - 1
        angle = 2 * math.pi * k * n / frequencyPeriod
        cosSum := cosSum + detrendedPrice[n] * math.cos(angle)
        sinSum := sinSum + detrendedPrice[n] * math.sin(angle)
    power = (cosSum * cosSum + sinSum * sinSum) / frequencyPeriod
    
    if k <= 2
        lowFreqPower := lowFreqPower + power
    else if k <= 4
        midFreqPower := midFreqPower + power
    else
        highFreqPower := highFreqPower + power

//              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              //
//              â•‘      SIGNAL CONSTRUCTION       â•‘              //
//              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              //

totalPower = lowFreqPower + midFreqPower + highFreqPower
lowFreqNorm = totalPower > 0 ? (lowFreqPower / totalPower) * 100 : 33.33
highFreqNorm = totalPower > 0 ? (highFreqPower / totalPower) * 100 : 33.33

smoothLow = ta.ema(lowFreqNorm, smoothingPeriod)
smoothHigh = ta.ema(highFreqNorm, smoothingPeriod)

spectralBalance = smoothLow - smoothHigh
momentum = ta.change(close[dataOffset], frequencyPeriod/2)
compositeSignal = spectralBalance * math.sign(momentum)
finalSignal = ta.ema(compositeSignal, smoothingPeriod)

isLong = finalSignal > 0
isShort = finalSignal < 0

longSignal = not isLong[1] and isLong
shortSignal = not isShort[1] and isShort

signalPositive = math.max(finalSignal, 0)
signalNegative = math.min(finalSignal, 0)

//              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              //
//              â•‘         VISUALIZATION          â•‘              //
//              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              //

p_zero = plot(0, 'Zero Line', color=color.new(color.gray, 100))
p_pos = plot(signalPositive, 'Bullish Signal', color=color.new(bullishColor, 0), linewidth=2, style=plot.style_stepline_diamond)
p_neg = plot(signalNegative, 'Bearish Signal', color=color.new(bearishColor, 0), linewidth=2, style=plot.style_stepline_diamond)

fill(p_zero, p_pos, color=color.new(bullishColor, 70), title='Bullish Zone')
fill(p_zero, p_neg, color=color.new(bearishColor, 70), title='Bearish Zone')

hline(0, 'Zero Line', color=color.gray, linewidth=1, display=display.none)

plot(25, 'Upper Reference', color=color.new(bullishColor, 80), linewidth=1, style=plot.style_circles)
plot(-25, 'Lower Reference', color=color.new(bearishColor, 80), linewidth=1, style=plot.style_circles)

barColor = enableBarColoring ? (finalSignal > 0 ? bullishColor : bearishColor) : na
barcolor(barColor, title='Signal Bar Color')

//              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              //
//              â•‘          SIGNAL LABELS         â•‘              //
//              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              //

var label signalLabel = na
if barstate.islast and showLabels
    labelText = finalSignal > 0 ? 'ğ‘³ğ’ğ’ğ’ˆ' : 'ğ‘ºğ’‰ğ’ğ’“ğ’•'
    labelColor = finalSignal > 0 ? bullishColor : bearishColor
    labelTextColor = finalSignal > 0 ? color.rgb(0, 0, 0) : color.white
    label.delete(signalLabel)
    signalLabel := label.new(bar_index, finalSignal, labelText, color=labelColor, textcolor=labelTextColor, style=label.style_label_left, size=size.normal)

//              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              //
//              â•‘             ALERTS             â•‘              //
//              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              //

alertcondition(longSignal, title='Long Signal', message='Frequency Momentum Oscillator: Signal changed to LONG {{exchange}}:{{ticker}}')
alertcondition(shortSignal, title='Short Signal', message='Frequency Momentum Oscillator: Signal changed to SHORT {{exchange}}:{{ticker}}')
alertcondition(longSignal or shortSignal, title='Signal Change', message='Frequency Momentum Oscillator: Signal changed - Check chart {{exchange}}:{{ticker}}')

//              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              //
//              â•‘           CREATED BY           â•‘              //
//              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              //

// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
//â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•    â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—
//â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
//â–ˆâ–ˆâ•‘â–„â–„ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
//â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
// â•šâ•â•â–€â–€â•â•  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•       â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•
