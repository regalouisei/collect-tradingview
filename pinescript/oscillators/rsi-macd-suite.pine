// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © aaboomar

//@version=6
indicator(title="RSI & MACD Suite", shorttitle="RSI+MACD", format=format.price, precision=2, timeframe="", timeframe_gaps=true)

// ============================================================================
// RSI Settings
// ============================================================================
RSI_GROUP = "RSI Settings"
rsiLength = input.int(14, minval=1, title="Length", group=RSI_GROUP)
rsiSource = input.source(close, "Source", group=RSI_GROUP)

// ============================================================================
// MACD Settings
// ============================================================================
MACD_GROUP = "MACD Settings"
macdSource = input.source(close, "Source", group=MACD_GROUP)
fastLength = input.int(12, "Fast Length", minval=1, group=MACD_GROUP)
slowLength = input.int(26, "Slow Length", minval=1, group=MACD_GROUP)
signalLength = input.int(9, "Signal Length", minval=1, group=MACD_GROUP)
oscType = input.string("EMA", "Oscillator MA Type", options=["EMA", "SMA"], group=MACD_GROUP)
sigType = input.string("EMA", "Signal MA Type", options=["EMA", "SMA"], group=MACD_GROUP)

// ============================================================================
// Input Validation
// ============================================================================
if fastLength >= slowLength
    runtime.error("MACD Fast length must be less than Slow length")

// ============================================================================
// RSI Calculation
// ============================================================================
change = ta.change(rsiSource)
up = ta.rma(math.max(change, 0), rsiLength)
down = ta.rma(-math.min(change, 0), rsiLength)
rsi = down == 0 ? 100 : up == 0 ? 0 : 100 - (100 / (1 + up / down))

// ============================================================================
// RSI Plots
// ============================================================================
rsiPlot = plot(rsi, "RSI - Line", color=color.yellow, linewidth=2)
rsiUpperBand = hline(70, "RSI - Upper Band (70)", color=color.white, linestyle=hline.style_solid)
midline = hline(50, "RSI - Middle Band (50)", color=color.new(color.white, 50), linestyle=hline.style_solid)
rsiLowerBand = hline(30, "RSI - Lower Band (30)", color=color.white, linestyle=hline.style_solid)

fill(rsiUpperBand, rsiLowerBand, color=color.rgb(126, 87, 194, 90), title="RSI - Background Fill")

midLinePlot = plot(50, color=na, editable=false, display=display.none)
fill(rsiPlot, midLinePlot, 100, 70, 
     top_color=color.new(color.green, 0), 
     bottom_color=color.new(color.green, 100), 
     title="RSI - Overbought Gradient")
fill(rsiPlot, midLinePlot, 30, 0, 
     top_color=color.new(color.red, 100), 
     bottom_color=color.new(color.red, 0), 
     title="RSI - Oversold Gradient")

// ============================================================================
// MACD Calculation
// ============================================================================

// @function Calculates an EMA or SMA of a source series
// @param source The data series to calculate the moving average on
// @param length The period length for the moving average
// @param maType The type of moving average ("EMA" or "SMA")
// @returns The calculated moving average value
ma(float source, int length, simple string maType) =>
    switch maType
        "EMA" => ta.ema(source, length)
        "SMA" => ta.sma(source, length)

maFast = ma(macdSource, fastLength, oscType)
maSlow = ma(macdSource, slowLength, oscType)
macd = maFast - maSlow
signal = ma(macd, signalLength, sigType)
hist = macd - signal

// ============================================================================
// MACD Plots
// ============================================================================
hColor = hist >= 0 ? #26a69a : #ff5252

hline(0, "MACD - Zero Line", color=#787b8680, linestyle=hline.style_solid)
plot(hist, "MACD - Histogram", color=hColor, style=plot.style_columns)
plot(macd, "MACD - Line", color=color.blue, linewidth=2)
plot(signal, "MACD - Signal Line", color=#ff6d00, linewidth=2)

// ============================================================================
// Alert Conditions
// ============================================================================

// RSI Alerts
alertcondition(ta.crossover(rsi, 70), "RSI Overbought", "RSI crossed above 70 (Overbought)")
alertcondition(ta.crossunder(rsi, 30), "RSI Oversold", "RSI crossed below 30 (Oversold)")
alertcondition(ta.cross(rsi, 50), "RSI Midline Cross", "RSI crossed the 50 midline")

// MACD Alerts
alertcondition(ta.crossover(macd, signal), "MACD Bullish Cross", "MACD line crossed above Signal line (Bullish)")
alertcondition(ta.crossunder(macd, signal), "MACD Bearish Cross", "MACD line crossed below Signal line (Bearish)")
alertcondition(ta.crossover(hist, 0), "MACD Histogram Bullish", "MACD Histogram crossed above zero (Bullish momentum)")
alertcondition(ta.crossunder(hist, 0), "MACD Histogram Bearish", "MACD Histogram crossed below zero (Bearish momentum)")
