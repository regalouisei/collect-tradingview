//@version=5
indicator("T3 MACD BB", overlay=false, precision=2)

// ─────────────────────────────────────────────────────────────────────────────
// Inputs (match your screenshot)
// ─────────────────────────────────────────────────────────────────────────────
groupInp = "Inputs"
bbLen   = input.int(10, "BB Periods", minval=1, group=groupInp)
bbMult  = input.float(1.0, "Deviations", minval=0.0, step=0.1, group=groupInp)
fastLen = input.int(12, "MACD Fast Length", minval=1, group=groupInp)
slowLen = input.int(26, "MACD Slow Length", minval=1, group=groupInp)
sigLen  = input.int(9,  "MACD Signal Length", minval=1, group=groupInp)

// ─────────────────────────────────────────────────────────────────────────────
// T3 (Tillson) smoother
// Note: vFactor is a common default; if you need it to match closer,
// change vFactor below (typical range: 0.6–0.8).
// ─────────────────────────────────────────────────────────────────────────────
vFactor = 0.70

t3(_src, _len, _v) =>
    e1 = ta.ema(_src, _len)
    e2 = ta.ema(e1,   _len)
    e3 = ta.ema(e2,   _len)
    e4 = ta.ema(e3,   _len)
    e5 = ta.ema(e4,   _len)
    e6 = ta.ema(e5,   _len)
    c1 = -_v * _v * _v
    c2 =  3 * _v * _v + 3 * _v * _v * _v
    c3 = -6 * _v * _v - 3 * _v - 3 * _v * _v * _v
    c4 =  1 + 3 * _v + 3 * _v * _v + _v * _v * _v
    c1 * e6 + c2 * e5 + c3 * e4 + c4 * e3

// ─────────────────────────────────────────────────────────────────────────────
// MACD line → T3 smooth (single line), then BB around it
// ─────────────────────────────────────────────────────────────────────────────
macdRaw = ta.ema(close, fastLen) - ta.ema(close, slowLen)
macdT3  = t3(macdRaw, sigLen, vFactor)

basis = ta.sma(macdT3, bbLen)
dev   = bbMult * ta.stdev(macdT3, bbLen)
upper = basis + dev
lower = basis - dev

// ─────────────────────────────────────────────────────────────────────────────
// Colors (picked to match your screenshot vibe)
// ─────────────────────────────────────────────────────────────────────────────
colUp     = color.rgb(0, 230, 118)      // bright green
colDown   = color.rgb(255, 82, 82)      // bright red
colBand   = color.rgb(190, 190, 190)    // light gray
colFill   = color.new(color.rgb(33, 73, 170), 75) // deep blue fill (transparent)
colZero   = color.rgb(245, 166, 35)     // orange zero line
colMarker = color.rgb(40, 120, 255)     // blue markers

lineCol = macdT3 > macdT3[1] ? colUp : colDown

// ─────────────────────────────────────────────────────────────────────────────
// Plots
// ─────────────────────────────────────────────────────────────────────────────
hline(0, "Zero", color=colZero, linewidth=2)

// Bands + fill
pU = plot(upper, "Upper Band", color=colBand, linewidth=2)
pB = plot(basis, "Mid Band",   color=colBand, linewidth=2)
pL = plot(lower, "Lower Band", color=colBand, linewidth=2)
fill(pU, pL, title="Band Fill", color=colFill)

// Main MACD line + “dots” look
plot(macdT3, "T3 MACD", color=lineCol, linewidth=3)
plot(macdT3, "T3 MACD Dots", color=lineCol, linewidth=2, style=plot.style_circles)

// Blue dot markers on bands + zero line (visual match to screenshot)
plot(upper, "Upper Markers", color=colMarker, linewidth=3, style=plot.style_circles)
plot(basis, "Mid Markers",   color=colMarker, linewidth=3, style=plot.style_circles)
plot(lower, "Lower Markers", color=colMarker, linewidth=3, style=plot.style_circles)
plot(0,     "Zero Markers",  color=colMarker, linewidth=3, style=plot.style_circles)
