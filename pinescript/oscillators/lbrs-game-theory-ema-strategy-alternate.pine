// © YourTradingViewUsername
//@version=6
strategy("Game Theory EMA Strategy",
     overlay=true,
     initial_capital=10000,
     commission_type=strategy.commission.percent,
     commission_value=0.05,
     slippage=1,
     pyramiding=0)

// ───────── INPUTS ─────────
emaFast  = input.int(9, "Fast EMA")
emaSlow  = input.int(21, "Slow EMA")
emaTrend = input.int(50, "Trend EMA")

atrPeriod = input.int(14, "ATR Period")
atrMult   = input.float(1.2, "ATR Stop Multiplier")
rr        = input.float(1.5, "Risk : Reward")

adxLen    = input.int(14, "ADX Length")
adxThresh = input.int(20, "ADX Threshold")
useADX    = input.bool(true, "Use ADX Filter")

maxTradesPerDay = input.int(5, "Max Trades Per Day")
maxDailyLossPct = input.float(2.0, "Max Daily Loss %")

// ───────── INDICATORS ─────────
ema_fast  = ta.ema(close, emaFast)
ema_slow  = ta.ema(close, emaSlow)
ema_trend = ta.ema(close, emaTrend)

atr = ta.atr(atrPeriod)
[_, _, adx] = ta.dmi(adxLen, adxLen)

rsi = ta.rsi(close, 14)

// ───────── UTILITY EDGE MODEL ─────────
utility = (rsi - 50) / 50
buyer_edge  = utility > 0.1
seller_edge = utility < -0.1
equilibrium = math.abs(utility) < 0.1

// ───────── TREND CONDITIONS ─────────
emaCrossUp   = ta.crossover(ema_fast, ema_slow)
emaCrossDown = ta.crossunder(ema_fast, ema_slow)

uptrend   = close > ema_trend
downtrend = close < ema_trend

strongTrend = adx > adxThresh

// ───────── DAILY CONTROL ─────────
var int tradesToday = 0
var float dayStartEquity = na

newDay = time("D") != time("D")[1]

if newDay
    tradesToday := 0
    dayStartEquity := strategy.equity


if na(dayStartEquity)
    dayStartEquity := strategy.equity

dailyDrawdown = (strategy.equity - dayStartEquity) / dayStartEquity * 100
dailyAllowed = dailyDrawdown > -maxDailyLossPct

// ───────── ENTRY CONDITIONS ─────────
longCond =
     emaCrossUp and
     uptrend and
     buyer_edge and
     not equilibrium and
     (not useADX or strongTrend) and
     tradesToday < maxTradesPerDay and
     dailyAllowed

shortCond =
     emaCrossDown and
     downtrend and
     seller_edge and
     not equilibrium and
     (not useADX or strongTrend) and
     tradesToday < maxTradesPerDay and
     dailyAllowed

// ───────── RISK MODEL (2% EQUITY) ─────────
riskPct = 2.0
riskCapital = strategy.equity * riskPct / 100

longStopDist  = atr * atrMult
shortStopDist = atr * atrMult

longQty  = riskCapital / longStopDist
shortQty = riskCapital / shortStopDist

// ───────── EXECUTION ─────────
if longCond and strategy.position_size == 0
    strategy.entry("Long", strategy.long, qty=longQty)
    tradesToday += 1

if shortCond and strategy.position_size == 0
    strategy.entry("Short", strategy.short, qty=shortQty)
    tradesToday += 1

if strategy.position_size > 0
    stopLevel = strategy.position_avg_price - longStopDist
    targetLevel = strategy.position_avg_price + longStopDist * rr
    strategy.exit("Long Exit", "Long", stop=stopLevel, limit=targetLevel)

if strategy.position_size < 0
    stopLevel = strategy.position_avg_price + shortStopDist
    targetLevel = strategy.position_avg_price - shortStopDist * rr
    strategy.exit("Short Exit", "Short", stop=stopLevel, limit=targetLevel)

// ───────── VISUALS (CLEAN) ─────────
plot(ema_fast, color=color.blue)
plot(ema_slow, color=color.red)
plot(ema_trend, color=color.orange)

plotshape(longCond, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small)
plotshape(shortCond, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small)
