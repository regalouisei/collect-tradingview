//@version=5
indicator("KillZones + ICT NY Midnight Open (Combined)", shorttitle="KillZones + NY Open", overlay=true, max_bars_back=5000, max_boxes_count=500, max_labels_count=500, max_lines_count=500)

//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// IMPORTS (Kill Zones)
//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
import TFlab/SessionAndKillZoneLibrary_TradingFinder/1 as Sess
import TFlab/AlertSenderLibrary_TradingFinder/1 as AlertSender

//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GLOBAL SETTINGS
//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ShowMoreInfo  = input.bool(false, "Show More Info", group="Global")
ColorMoreInfo = input.color(#0c3299, "More Info Color", group="Global")
AlertSwitch   = input.string("On", "Send Alert", options=["On","Off"], group="Alert")

//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ASIA SESSION
//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
showAsiaSess = input.bool(true, "Asia Session", group="Asia")
asiaSessTime = input.session("2300-0600", "Asia Session Time", group="Asia")
asiaColor    = input.color(#da6e0a, "Asia Color", group="Asia")
showAsiaKill = input.bool(true, "Asia Kill Zone", group="Asia")
asiaKillTime = input.session("2300-0355", "Asia Kill Time", group="Asia")

//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// LONDON SESSION
//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
showLondonSess = input.bool(true, "London Session", group="London")
londonSessTime = input.session("0700-1425", "London Session Time", group="London")
londonColor    = input.color(#850244, "London Color", group="London")
showLondonKill = input.bool(true, "London Kill Zone", group="London")
londonKillTime = input.session("0700-0955", "London Kill Time", group="London")

//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// NEW YORK AM SESSION
//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
showNYamSess = input.bool(true, "NY AM Session", group="NY AM")
nyamSessTime = input.session("1430-1925", "NY AM Session Time", group="NY AM")
nyamColor    = input.color(#008b85, "NY AM Color", group="NY AM")
showNYamKill = input.bool(true, "NY AM Kill Zone", group="NY AM")
nyamKillTime = input.session("1430-1655", "NY AM Kill Time", group="NY AM")

//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// NEW YORK PM SESSION
//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
showNYpmSess = input.bool(true, "NY PM Session", group="NY PM")
nypmSessTime = input.session("1930-2255", "NY PM Session Time", group="NY PM")
nypmColor    = input.color(#750cff, "NY PM Color", group="NY PM")
showNYpmKill = input.bool(true, "NY PM Kill Zone", group="NY PM")
nypmKillTime = input.session("1930-2055", "NY PM Kill Time", group="NY PM")

//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// SESSION DETECTORS
//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[_, _, _, _, _, _, lowA, highA]     = Sess.SessionDetector("Asia", asiaSessTime, asiaKillTime, showAsiaSess, showAsiaKill, "Kill Zone", ShowMoreInfo, asiaColor, ColorMoreInfo)
[_, _, _, _, _, _, lowL, highL]     = Sess.SessionDetector("London", londonSessTime, londonKillTime, showLondonSess, showLondonKill, "Kill Zone", ShowMoreInfo, londonColor, ColorMoreInfo)
[_, _, _, _, _, _, lowNYa, highNYa] = Sess.SessionDetector("NY AM", nyamSessTime, nyamKillTime, showNYamSess, showNYamKill, "Kill Zone", ShowMoreInfo, nyamColor, ColorMoreInfo)
[_, _, _, _, _, _, lowNYp, highNYp] = Sess.SessionDetector("NY PM", nypmSessTime, nypmKillTime, showNYpmSess, showNYpmKill, "Kill Zone", ShowMoreInfo, nypmColor, ColorMoreInfo)

//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ALERT LOGIC
//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
alertCond = lowA or highA or lowL or highL or lowNYa or highNYa or lowNYp or highNYp

alertMsg =
     lowA    ? "Asia Kill Zone LOW touched" :
     highA   ? "Asia Kill Zone HIGH touched" :
     lowL    ? "London Kill Zone LOW touched" :
     highL   ? "London Kill Zone HIGH touched" :
     lowNYa  ? "NY AM Kill Zone LOW touched" :
     highNYa ? "NY AM Kill Zone HIGH touched" :
     lowNYp  ? "NY PM Kill Zone LOW touched" :
     highNYp ? "NY PM Kill Zone HIGH touched" : ""

AlertSender.AlertSender(alertCond, AlertSwitch, "Kill Zone Alert", "signal", "", "Full", "Once Per Bar", "UTC", "Off", alertMsg, open, high, low, close, 0,0,0,0,0)

//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ICT NY MIDNIGHT OPEN (00:00 NEW YORK – DST SAFE)
//━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
nySession = input.session("0000-0001:1234567", "NY Midnight Session", group="NY Open")
nyTZ      = "America/New_York"

showVLine = input.bool(true, "Show Vertical Line", group="NY Open")
vColor    = input.color(#00b9d0, "Vertical Line Color", group="NY Open")
showHLine = input.bool(true, "Show Horizontal Line", group="NY Open")
hColor    = input.color(#0064ff, "Horizontal Line Color", group="NY Open")

nyMid = time("1", nySession, nyTZ)

var float nyOpen = na

if nyMid and not nyMid[1]
    nyOpen := open

if showHLine and nyMid and not nyMid[1]
    line.new(nyMid, nyOpen, nyMid + 86400000, nyOpen, xloc.bar_time, extend.none, hColor, line.style_dotted, 2)
    label.new(nyMid + 86400000, nyOpen, "NY Midnight Open", xloc.bar_time, yloc.price, textcolor=hColor, style=label.style_none)

if showVLine and nyMid and not nyMid[1]
    line.new(nyMid, high, nyMid, low, xloc.bar_time, extend.both, vColor, line.style_solid, 1)
