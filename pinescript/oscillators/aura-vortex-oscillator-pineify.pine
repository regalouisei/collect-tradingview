// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© Pineify

//======================================================================//
//                    ____  _            _  __                          //
//                   |  _ \(_)_ __   ___(_)/ _|_   _                    //
//                   | |_) | | '_ \ / _ \ | |_| | | |                   //
//                   |  __/| | | | |  __/ |  _| |_| |                   //
//                   |_|   |_|_| |_|\___|_|_|  \__, |                   //
//                                             |___/                    //
//======================================================================//


//@version=6
indicator("Aura Vortex Oscillator [Pineify]", shorttitle="Aura Vortex", overlay=false, precision=2)

// 
//------------------------------------------------------------------------------
// Settings
//------------------------------------------------------------------------------
len = input.int(20, "Vortex Sensitivity", minval=5, tooltip="Base period for momentum calculation")
preGain = input.float(2.0, "Vortex Intensity", minval=0.1, step=0.1, tooltip="Amplifies the 'squarification' of the signal")
smooth = input.int(8, "Aura Smoothing", minval=1)
meshEnabled = input.bool(true, "Enable Vortex Mesh", tooltip="Displays layered oscillators for a depth effect")

// Colors
bullColor = input.color(#00ffbb, "Bullish Aura", inline="color")
bearColor = input.color(#ff0055, "Bearish Aura", inline="color")
neutColor = input.color(#787b86, "Neutral", inline="color")

//------------------------------------------------------------------------------
// Logic: Sigmoid Normalized Adaptive Momentum
//------------------------------------------------------------------------------
// Source: Inspired by ArcTan Oscillator and Adaptive Momentum
vortex_calc(src, length, intensity) =>
    // Adaptive component: use standard deviation to normalize price delta
    ma = ta.sma(src, length)
    z = (src - ma) / ta.stdev(src, length)
    // Sigmoid normalization via ArcTan
    os = math.atan(z * intensity) * 63.66 // Scale to approx -100 to 100
    os

// Base Signal
mainSignal = vortex_calc(close, len, preGain)
smoothed = ta.ema(mainSignal, smooth)

//------------------------------------------------------------------------------
// Visualization: The Vortex Mesh (Layered Transparency)
//------------------------------------------------------------------------------
// We plot 10 layers with incremental smoothing to create the "Aura" effect
plot_aura(index) =>
    s = ta.ema(mainSignal, smooth + index * 2)
    css = s > 0 ? color.new(bullColor, 90 - index * 5) : color.new(bearColor, 90 - index * 5)
    s

// Layering the Mesh
m1 = plot(meshEnabled ? plot_aura(1) : na, color=color.new(bullColor, 95), display=display.none, editable=false)
m2 = plot(meshEnabled ? plot_aura(2) : na, color=color.new(bullColor, 95), display=display.none, editable=false)
m3 = plot(meshEnabled ? plot_aura(4) : na, color=color.new(bullColor, 95), display=display.none, editable=false)
m4 = plot(meshEnabled ? plot_aura(6) : na, color=color.new(bullColor, 95), display=display.none, editable=false)
m5 = plot(meshEnabled ? plot_aura(8) : na, color=color.new(bullColor, 95), display=display.none, editable=false)

// Dynamic Fill for the "Vortex" effect
fillColor = smoothed > 0 ? color.new(bullColor, 75) : color.new(bearColor, 75)
fill(m1, m5, color=fillColor, title="Vortex Aura Fill")

// Main Signal Line (The "Pulse")
plot(smoothed, "Vortex Pulse", color=smoothed > 0 ? bullColor : bearColor, linewidth=3)
plot(smoothed, "Glow Core", color=color.new(color.white, 50), linewidth=1)

// Zero Line and Thresholds
hline(0, "Equilibrium", color=color.new(neutColor, 50), linestyle=hline.style_dashed)
hline(50, "Upper Boundary", color=color.new(bullColor, 80))
hline(-50, "Lower Boundary", color=color.new(bearColor, 80))

// Signals: Convergence Dots
crossUp = ta.crossover(smoothed, 0)
crossDown = ta.crossunder(smoothed, 0)

plotshape(crossUp ? 0 : na, "Bullish Reversal", shape.circle, location.absolute, bullColor, size=size.tiny)
plotshape(crossDown ? 0 : na, "Bearish Reversal", shape.circle, location.absolute, bearColor, size=size.tiny)

// Background highlighting for extreme states
bgcolor(smoothed > 50 ? color.new(bullColor, 95) : smoothed < -50 ? color.new(bearColor, 95) : na)
