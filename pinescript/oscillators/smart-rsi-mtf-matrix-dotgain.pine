// © DotGain
// Inspired by © xdecow
//@version=6
indicator('Smart RSI MTF Matrix', overlay = false, shorttitle = 'RSI Matrix')

// --- Settings ---
g_sig = 'Signal Settings'
g_col = 'Colors'

ob_lvl = input.int(70, 'Overbought (>70)', minval=51, maxval=100, group=g_sig)
os_lvl = input.int(30, 'Oversold (<30)', minval=0, maxval=49, group=g_sig)

c_ob  = input.color(color.red, 'Overbought Color', group=g_col)
c_os  = input.color(color.green, 'Oversold Color', group=g_col)
c_neu = input.color(color.rgb(80, 80, 80), 'Neutral Color', group=g_col)

// --- Helper: Color Logic ---
f_color(_val, _transp) =>
    color c = color.new(c_neu, _transp)
    if not na(_val)
        if _val > ob_lvl
            c := color.new(c_ob, _transp)
        else if _val < os_lvl
            c := color.new(c_os, _transp)
    c

// --- RSI Slots (Inputs & Calculation) ---

// Row 1: 5m (Bottom) - 90% Transparency
en1  = input.bool(true, 'Enabled', group='Row 1 (10% Vis)', inline='1')
tf1  = input.timeframe('5', '', group='Row 1 (10% Vis)', inline='1')
src1 = input.source(close, '', group='Row 1 (10% Vis)', inline='1')
rsi1 = en1 ? request.security(syminfo.tickerid, tf1, ta.rsi(src1, 14)) : na

// Row 2: 15m - 80% Transparency
en2  = input.bool(true, 'Enabled', group='Row 2 (20% Vis)', inline='2')
tf2  = input.timeframe('15', '', group='Row 2 (20% Vis)', inline='2')
src2 = input.source(close, '', group='Row 2 (20% Vis)', inline='2')
rsi2 = en2 ? request.security(syminfo.tickerid, tf2, ta.rsi(src2, 14)) : na

// Row 3: 1h - 70% Transparency
en3  = input.bool(true, 'Enabled', group='Row 3 (30% Vis)', inline='3')
tf3  = input.timeframe('60', '', group='Row 3 (30% Vis)', inline='3')
src3 = input.source(close, '', group='Row 3 (30% Vis)', inline='3')
rsi3 = en3 ? request.security(syminfo.tickerid, tf3, ta.rsi(src3, 14)) : na

// Row 4: 4h - 60% Transparency
en4  = input.bool(true, 'Enabled', group='Row 4 (40% Vis)', inline='4')
tf4  = input.timeframe('240', '', group='Row 4 (40% Vis)', inline='4')
src4 = input.source(close, '', group='Row 4 (40% Vis)', inline='4')
rsi4 = en4 ? request.security(syminfo.tickerid, tf4, ta.rsi(src4, 14)) : na

// Row 5: 1D - 50% Transparency
en5  = input.bool(true, 'Enabled', group='Row 5 (50% Vis)', inline='5')
tf5  = input.timeframe('D', '', group='Row 5 (50% Vis)', inline='5')
src5 = input.source(close, '', group='Row 5 (50% Vis)', inline='5')
rsi5 = en5 ? request.security(syminfo.tickerid, tf5, ta.rsi(src5, 14)) : na

// Row 6: 1W - 40% Transparency
en6  = input.bool(true, 'Enabled', group='Row 6 (60% Vis)', inline='6')
tf6  = input.timeframe('W', '', group='Row 6 (60% Vis)', inline='6')
src6 = input.source(close, '', group='Row 6 (60% Vis)', inline='6')
rsi6 = en6 ? request.security(syminfo.tickerid, tf6, ta.rsi(src6, 14)) : na

// Row 7: 1M - 30% Transparency
en7  = input.bool(true, 'Enabled', group='Row 7 (70% Vis)', inline='7')
tf7  = input.timeframe('1M', '', group='Row 7 (70% Vis)', inline='7')
src7 = input.source(close, '', group='Row 7 (70% Vis)', inline='7')
rsi7 = en7 ? request.security(syminfo.tickerid, tf7, ta.rsi(src7, 14)) : na

// Row 8: 3M - 20% Transparency
en8  = input.bool(true, 'Enabled', group='Row 8 (80% Vis)', inline='8')
tf8  = input.timeframe('3M', '', group='Row 8 (80% Vis)', inline='8')
src8 = input.source(close, '', group='Row 8 (80% Vis)', inline='8')
rsi8 = en8 ? request.security(syminfo.tickerid, tf8, ta.rsi(src8, 14)) : na

// Row 9: 6M - 10% Transparency
en9  = input.bool(true, 'Enabled', group='Row 9 (90% Vis)', inline='9')
tf9  = input.timeframe('6M', '', group='Row 9 (90% Vis)', inline='9')
src9 = input.source(close, '', group='Row 9 (90% Vis)', inline='9')
rsi9 = en9 ? request.security(syminfo.tickerid, tf9, ta.rsi(src9, 14)) : na

// Row 10: 12M (Top) - 0% Transparency
en10 = input.bool(true, 'Enabled', group='Row 10 (100% Vis)', inline='10')
tf10 = input.timeframe('12M', '', group='Row 10 (100% Vis)', inline='10')
src10 = input.source(close, '', group='Row 10 (100% Vis)', inline='10')
rsi10 = en10 ? request.security(syminfo.tickerid, tf10, ta.rsi(src10, 14)) : na

// --- Matrix Plotting ---
w = 4
s = plot.style_circles

plot(en1 ? 1 : na, 'RSI 1', f_color(rsi1, 90), w, s)
plot(en2 ? 2 : na, 'RSI 2', f_color(rsi2, 80), w, s)
plot(en3 ? 3 : na, 'RSI 3', f_color(rsi3, 70), w, s)
plot(en4 ? 4 : na, 'RSI 4', f_color(rsi4, 60), w, s)
plot(en5 ? 5 : na, 'RSI 5', f_color(rsi5, 50), w, s)
plot(en6 ? 6 : na, 'RSI 6', f_color(rsi6, 40), w, s)
plot(en7 ? 7 : na, 'RSI 7', f_color(rsi7, 30), w, s)
plot(en8 ? 8 : na, 'RSI 8', f_color(rsi8, 20), w, s)
plot(en9 ? 9 : na, 'RSI 9', f_color(rsi9, 10), w, s)
plot(en10 ? 10 : na, 'RSI 10', f_color(rsi10, 0), w, s)

// --- Labels ---
f_lbl(_y, _txt, _en) =>
    if barstate.islast and _en
        label.new(bar_index + 1, _y, _txt, xloc.bar_index, yloc.price, color(na), label.style_none, chart.fg_color, size.small, text.align_left)

f_lbl(1, tf1, en1), f_lbl(2, tf2, en2), f_lbl(3, tf3, en3), f_lbl(4, tf4, en4), f_lbl(5, tf5, en5)
f_lbl(6, tf6, en6), f_lbl(7, tf7, en7), f_lbl(8, tf8, en8), f_lbl(9, tf9, en9), f_lbl(10, tf10, en10)
