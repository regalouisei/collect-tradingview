//@version=5
indicator("Indicador Maestro: 8 en 1 Personalizable", overlay=true, max_labels_count=500)

// --- GRUPOS DE CONFIGURACIÓN ---
grp_ma   = "1. Medias Móviles"
grp_bb   = "2. Bandas Bollinger"
grp_kc   = "3. Canales Keltner"
grp_aoac = "4. Bill Williams (AO/AC)"
grp_osc  = "5. Osciladores (Tabla)"

// --- 1. MEDIAS MÓVILES ---
show_ma = input.bool(true, "Mostrar Medias", group=grp_ma)
ma1_len = input.int(9, "MA Rápida", group=grp_ma)
ma2_len = input.int(21, "MA Lenta", group=grp_ma)
ma1 = ta.ema(close, ma1_len)
ma2 = ta.ema(close, ma2_len)
plot(show_ma ? ma1 : na, color=color.blue, title="MA Rápida")
plot(show_ma ? ma2 : na, color=color.orange, title="MA Lenta")

// --- 2. BANDAS BOLLINGER ---
show_bb = input.bool(false, "Mostrar Bollinger", group=grp_bb)
bb_len  = input.int(20, "Periodo BB", group=grp_bb)
bb_mult = input.float(2.0, "Desviación BB", group=grp_bb)
[bb_mid, bb_upp, bb_low] = ta.bb(close, bb_len, bb_mult)
p_bb1 = plot(show_bb ? bb_upp : na, color=color.new(color.gray, 70))
p_bb2 = plot(show_bb ? bb_low : na, color=color.new(color.gray, 70))
fill(p_bb1, p_bb2, color=show_bb ? color.new(color.blue, 95) : na)

// --- 3. CANALES DE KELTNER ---
show_kc = input.bool(false, "Mostrar Keltner", group=grp_kc)
kc_len  = input.int(20, "Periodo KC", group=grp_kc)
kc_mult = input.float(1.5, "Multiplicador ATR", group=grp_kc)
kc_ma   = ta.ema(close, kc_len)
kc_range = ta.atr(kc_len) * kc_mult
p_kc1 = plot(show_kc ? kc_ma + kc_range : na, color=color.new(color.purple, 70))
p_kc2 = plot(show_kc ? kc_ma - kc_range : na, color=color.new(color.purple, 70))

// --- 4. CÁLCULOS AO y AC ---
ao = ta.sma(hl2, 5) - ta.sma(hl2, 34)
ac = ao - ta.sma(ao, 5)
ao_up = ao > ao[1]
ac_up = ac > ac[1]

// --- 5. RSI y MACD ---
rsi_val = ta.rsi(close, 14)
[macd_line, signal_line, _] = ta.macd(close, 12, 26, 9)

// --- 6. TABLA DE MONITOREO ---
var table panel = table.new(position.top_right, 2, 5, border_width = 1, frame_color=color.gray)

if barstate.islast
    // Encabezados
    table.cell(panel, 0, 0, "Indicador", bgcolor=color.black, text_color=color.white)
    table.cell(panel, 1, 0, "Estado", bgcolor=color.black, text_color=color.white)
    
    // Fila AO
    table.cell(panel, 0, 1, "AO (Asombroso)", text_color=color.white, bgcolor=color.new(color.gray, 20))
    table.cell(panel, 1, 1, ao_up ? "SUBIENDO" : "BAJANDO", bgcolor = ao_up ? color.green : color.red)
    
    // Fila AC (Aceleración)
    table.cell(panel, 0, 2, "AC (Aceleración)", text_color=color.white, bgcolor=color.new(color.gray, 20))
    table.cell(panel, 1, 2, ac_up ? "FUERZA +" : "FUERZA -", bgcolor = ac_up ? color.green : color.red)
    
    // Fila RSI
    table.cell(panel, 0, 3, "RSI", text_color=color.white, bgcolor=color.new(color.gray, 20))
    table.cell(panel, 1, 3, str.tostring(math.round(rsi_val, 1)), bgcolor = rsi_val > 70 ? color.red : rsi_val < 30 ? color.green : color.gray)
    
    // Fila MACD
    macd_bull = macd_line > signal_line
    table.cell(panel, 0, 4, "MACD", text_color=color.white, bgcolor=color.new(color.gray, 20))
    table.cell(panel, 1, 4, macd_bull ? "ALCISTA" : "BAJISTA", bgcolor = macd_bull ? color.blue : color.orange)
