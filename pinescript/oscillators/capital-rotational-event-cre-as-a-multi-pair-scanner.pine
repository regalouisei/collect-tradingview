//@version=6
indicator("Capital Rotational Event (CRE) – Multi Pair Scanner", overlay=false)

// ─────────────────────────────
// INPUTS
// ─────────────────────────────
lead = input.symbol("SPY", "Capital Source (Lead Asset)")

r1 = input.symbol("GLD", "Receiver 1")
r2 = input.symbol("TLT", "Receiver 2")
r3 = input.symbol("USO", "Receiver 3")
r4 = input.symbol("XLE", "Receiver 4")

lenRS  = input.int(14, "RS Length")
lenMom = input.int(9, "Momentum Length")

// ─────────────────────────────
// FUNCTION: CRE LOGIC
// ─────────────────────────────
creCalc(receiver) =>
    pLead = request.security(lead, timeframe.period, close)
    pRecv = request.security(receiver, timeframe.period, close)

    rs = ta.sma(pRecv / pLead, lenRS)
    mom = ta.sma(ta.change(rs), lenMom)

    bull = rs > ta.sma(rs, lenRS) and mom > 0
    bear = rs < ta.sma(rs, lenRS) and mom < 0

    bull ? 1 : bear ? -1 : 0

// ─────────────────────────────
// CALCULATE ROTATION
// ─────────────────────────────
sig1 = creCalc(r1)
sig2 = creCalc(r2)
sig3 = creCalc(r3)
sig4 = creCalc(r4)

// ─────────────────────────────
// VISUAL OUTPUT
// ─────────────────────────────
plot(sig1, title="CRE 1", color=color.green)
plot(sig2, title="CRE 2", color=color.blue)
plot(sig3, title="CRE 3", color=color.orange)
plot(sig4, title="CRE 4", color=color.purple)


// ─────────────────────────────
// DOMINANT ROTATION BACKGROUND
// ─────────────────────────────
dominant =
     sig1 == 1 ? 1 :
     sig2 == 1 ? 2 :
     sig3 == 1 ? 3 :
     sig4 == 1 ? 4 :
     0

bgColor = (
    dominant > 0 ? color.new(color.green, 88) : na
)

bgcolor(bgColor)
