//@version=6
indicator("Apex 200 SMA HUD v6", overlay=true)

// --- INPUTS ---
smaLength  = input.int(200, title="SMA Length")
apexPct    = input.float(0.3, title="Apex Deviation (%)")
scoutPct   = input.float(0.2, title="Scout Deviation (%)")

// --- CALCULATIONS ---
vSMA = ta.sma(close, smaLength)
currentDist = ((close - vSMA) / vSMA) * 100

// Calculate Bands
apexUpper  = vSMA * (1 + (apexPct / 100))
apexLower  = vSMA * (1 - (apexPct / 100))
scoutUpper = vSMA * (1 + (scoutPct / 100))
scoutLower = vSMA * (1 - (scoutPct / 100))

// --- PLOTTING ---
plot(vSMA, color=color.gray, title="200 SMA", linewidth=1)

// Plotting Apex (Solid Lines)
plot(apexUpper, color=color.red, title="Apex Upper", linewidth=2)
plot(apexLower, color=color.green, title="Apex Lower", linewidth=2)

// Plotting Scout (Dashed Lines - Using "purple" for v6 compatibility)
plot(scoutUpper, color=color.aqua, title="Scout Upper", style=plot.style_linebr)
plot(scoutLower, color=color.purple, title="Scout Lower", style=plot.style_linebr)

// --- LIVE % DISTANCE LABEL ---
var label distLabel = label.new(bar_index, high, text="", color=color.black, textcolor=color.white, style=label.style_label_down, size=size.large)
if barstate.islast
    label.set_xy(distLabel, bar_index, high + (high * 0.001))
    labelText = "Dist from 200 SMA: " + str.tostring(currentDist, "#.##") + "%"
    label.set_text(distLabel, labelText)

    // Change label color based on stretch
    if math.abs(currentDist) >= apexPct
        label.set_color(distLabel, color.red)
    else if math.abs(currentDist) >= scoutPct
        label.set_color(distLabel, color.orange)
    else
        label.set_color(distLabel, color.black)

// --- ALERT LOGIC ---
if ta.crossover(high, apexUpper)
    alert("APEX SELL REACHED - Check Cipher B Red Dot", alert.freq_once_per_bar)

if ta.crossunder(low, apexLower)
    alert("APEX BUY REACHED - Check Cipher B Green Dot", alert.freq_once_per_bar)
