// © DotGain
// Inspired by © xdecow

// Smart RSI MTF
// Multi-Timeframe RSI Signals Overlay with slot-based transparency.

//@version=6
indicator('Smart RSI MTF', overlay = true, shorttitle = 'Smart RSI')

// ==============================================
// --- Groups & Inputs ---
// ==============================================

g_signals = 'Signal Settings'
i_threshold_ob = input.int(70, 'Overbought Threshold (>70)', minval = 51, maxval = 100, group = g_signals)
i_threshold_os = input.int(30, 'Oversold Threshold (<30)', minval = 0, maxval = 49, group = g_signals)

// Default Symbol: Label
i_symbol_type = input.string('Label', 'Signal Symbol Shape', options = ['Label', 'Diamond', 'Circle', 'Square', 'Triangle', 'Cross'], group = g_signals)

g_colors = 'Colors'
c_base_ob = input.color(color.red, 'Base Color Overbought (Red)', group = g_colors)
c_base_os = input.color(color.green, 'Base Color Oversold (Green)', group = g_colors)

// ==============================================
// --- Symbol Logic ---
// ==============================================

s_ob = switch i_symbol_type
    'Label' => shape.labeldown
    'Diamond' => shape.diamond
    'Circle' => shape.circle
    'Square' => shape.square
    'Triangle' => shape.triangledown
    'Cross' => shape.xcross
    => shape.labeldown

s_os = switch i_symbol_type
    'Label' => shape.labelup
    'Diamond' => shape.diamond
    'Circle' => shape.circle
    'Square' => shape.square
    'Triangle' => shape.triangleup
    'Cross' => shape.xcross
    => shape.labelup


// ==============================================
// --- RSI Inputs (10 Slots) ---
// ==============================================

// Slot 1: 5 min
g_rsi1 = 'RSI #1 (10% Visibility)'
i_rsi1_enabled = input.bool(true, title = 'Enabled', group = g_rsi1)
i_rsi1_tf = input.timeframe('5', 'Timeframe', group = g_rsi1)
i_rsi1_len = input.int(14, 'Length', minval = 1, group = g_rsi1)
i_rsi1_src = input.source(close, 'Source', group = g_rsi1)
v_rsi1 = i_rsi1_enabled ? request.security(syminfo.tickerid, i_rsi1_tf, ta.rsi(i_rsi1_src, i_rsi1_len)) : na

// Slot 2: 15 min
g_rsi2 = 'RSI #2 (20% Visibility)'
i_rsi2_enabled = input.bool(true, title = 'Enabled', group = g_rsi2)
i_rsi2_tf = input.timeframe('15', 'Timeframe', group = g_rsi2)
i_rsi2_len = input.int(14, 'Length', minval = 1, group = g_rsi2)
i_rsi2_src = input.source(close, 'Source', group = g_rsi2)
v_rsi2 = i_rsi2_enabled ? request.security(syminfo.tickerid, i_rsi2_tf, ta.rsi(i_rsi2_src, i_rsi2_len)) : na

// Slot 3: 1 hour
g_rsi3 = 'RSI #3 (30% Visibility)'
i_rsi3_enabled = input.bool(true, title = 'Enabled', group = g_rsi3)
i_rsi3_tf = input.timeframe('60', 'Timeframe', group = g_rsi3)
i_rsi3_len = input.int(14, 'Length', minval = 1, group = g_rsi3)
i_rsi3_src = input.source(close, 'Source', group = g_rsi3)
v_rsi3 = i_rsi3_enabled ? request.security(syminfo.tickerid, i_rsi3_tf, ta.rsi(i_rsi3_src, i_rsi3_len)) : na

// Slot 4: 4 hours
g_rsi4 = 'RSI #4 (40% Visibility)'
i_rsi4_enabled = input.bool(true, title = 'Enabled', group = g_rsi4)
i_rsi4_tf = input.timeframe('240', 'Timeframe', group = g_rsi4)
i_rsi4_len = input.int(14, 'Length', minval = 1, group = g_rsi4)
i_rsi4_src = input.source(close, 'Source', group = g_rsi4)
v_rsi4 = i_rsi4_enabled ? request.security(syminfo.tickerid, i_rsi4_tf, ta.rsi(i_rsi4_src, i_rsi4_len)) : na

// Slot 5: 1 day
g_rsi5 = 'RSI #5 (50% Visibility)'
i_rsi5_enabled = input.bool(true, title = 'Enabled', group = g_rsi5)
i_rsi5_tf = input.timeframe('D', 'Timeframe', group = g_rsi5)
i_rsi5_len = input.int(14, 'Length', minval = 1, group = g_rsi5)
i_rsi5_src = input.source(close, 'Source', group = g_rsi5)
v_rsi5 = i_rsi5_enabled ? request.security(syminfo.tickerid, i_rsi5_tf, ta.rsi(i_rsi5_src, i_rsi5_len)) : na

// Slot 6: 1 week
g_rsi6 = 'RSI #6 (60% Visibility)'
i_rsi6_enabled = input.bool(true, title = 'Enabled', group = g_rsi6)
i_rsi6_tf = input.timeframe('W', 'Timeframe', group = g_rsi6)
i_rsi6_len = input.int(14, 'Length', minval = 1, group = g_rsi6)
i_rsi6_src = input.source(close, 'Source', group = g_rsi6)
v_rsi6 = i_rsi6_enabled ? request.security(syminfo.tickerid, i_rsi6_tf, ta.rsi(i_rsi6_src, i_rsi6_len)) : na

// Slot 7: 1 month
g_rsi7 = 'RSI #7 (70% Visibility)'
i_rsi7_enabled = input.bool(true, title = 'Enabled', group = g_rsi7)
i_rsi7_tf = input.timeframe('1M', 'Timeframe', group = g_rsi7)
i_rsi7_len = input.int(14, 'Length', minval = 1, group = g_rsi7)
i_rsi7_src = input.source(close, 'Source', group = g_rsi7)
v_rsi7 = i_rsi7_enabled ? request.security(syminfo.tickerid, i_rsi7_tf, ta.rsi(i_rsi7_src, i_rsi7_len)) : na

// Slot 8: 3 months
g_rsi8 = 'RSI #8 (80% Visibility)'
i_rsi8_enabled = input.bool(true, title = 'Enabled', group = g_rsi8)
i_rsi8_tf = input.timeframe('3M', 'Timeframe', group = g_rsi8)
i_rsi8_len = input.int(14, 'Length', minval = 1, group = g_rsi8)
i_rsi8_src = input.source(close, 'Source', group = g_rsi8)
v_rsi8 = i_rsi8_enabled ? request.security(syminfo.tickerid, i_rsi8_tf, ta.rsi(i_rsi8_src, i_rsi8_len)) : na

// Slot 9: 6 months
g_rsi9 = 'RSI #9 (90% Visibility)'
i_rsi9_enabled = input.bool(true, title = 'Enabled', group = g_rsi9)
i_rsi9_tf = input.timeframe('6M', 'Timeframe', group = g_rsi9)
i_rsi9_len = input.int(14, 'Length', minval = 1, group = g_rsi9)
i_rsi9_src = input.source(close, 'Source', group = g_rsi9)
v_rsi9 = i_rsi9_enabled ? request.security(syminfo.tickerid, i_rsi9_tf, ta.rsi(i_rsi9_src, i_rsi9_len)) : na

// Slot 10: 12 months
g_rsi10 = 'RSI #10 (100% Visibility)'
i_rsi10_enabled = input.bool(true, title = 'Enabled', group = g_rsi10)
i_rsi10_tf = input.timeframe('12M', 'Timeframe', group = g_rsi10)
i_rsi10_len = input.int(14, 'Length', minval = 1, group = g_rsi10)
i_rsi10_src = input.source(close, 'Source', group = g_rsi10)
v_rsi10 = i_rsi10_enabled ? request.security(syminfo.tickerid, i_rsi10_tf, ta.rsi(i_rsi10_src, i_rsi10_len)) : na


// ==============================================
// --- Helper Functions (Color by Slot) ---
// ==============================================

// New function: Colors depend on RSI value and a specific transparency passed as argument
f_getColorForSlot(_rsiValue, _transparency) =>
    color returnColor = na

    if not na(_rsiValue)
        if _rsiValue > i_threshold_ob
            returnColor := color.new(c_base_ob, _transparency)
            returnColor
        else if _rsiValue < i_threshold_os
            returnColor := color.new(c_base_os, _transparency)
            returnColor

    returnColor


// ==============================================
// --- Signal Plotting ---
// ==============================================
// Visibility Mapping:
// 10% Visibility = 90 Transparency
// 20% Visibility = 80 Transparency
// ...
// 100% Visibility = 0 Transparency

// RSI #1 (10% Vis -> 90 Transp)
c_rsi1 = i_rsi1_enabled ? f_getColorForSlot(v_rsi1, 90) : na
plotshape(i_rsi1_enabled and not na(v_rsi1) and v_rsi1 > i_threshold_ob, title = 'RSI 1 OB', style = s_ob, location = location.abovebar, color = c_rsi1, size = size.tiny)
plotshape(i_rsi1_enabled and not na(v_rsi1) and v_rsi1 < i_threshold_os, title = 'RSI 1 OS', style = s_os, location = location.belowbar, color = c_rsi1, size = size.tiny)

// RSI #2 (20% Vis -> 80 Transp)
c_rsi2 = i_rsi2_enabled ? f_getColorForSlot(v_rsi2, 80) : na
plotshape(i_rsi2_enabled and not na(v_rsi2) and v_rsi2 > i_threshold_ob, title = 'RSI 2 OB', style = s_ob, location = location.abovebar, color = c_rsi2, size = size.tiny)
plotshape(i_rsi2_enabled and not na(v_rsi2) and v_rsi2 < i_threshold_os, title = 'RSI 2 OS', style = s_os, location = location.belowbar, color = c_rsi2, size = size.tiny)

// RSI #3 (30% Vis -> 70 Transp)
c_rsi3 = i_rsi3_enabled ? f_getColorForSlot(v_rsi3, 70) : na
plotshape(i_rsi3_enabled and not na(v_rsi3) and v_rsi3 > i_threshold_ob, title = 'RSI 3 OB', style = s_ob, location = location.abovebar, color = c_rsi3, size = size.tiny)
plotshape(i_rsi3_enabled and not na(v_rsi3) and v_rsi3 < i_threshold_os, title = 'RSI 3 OS', style = s_os, location = location.belowbar, color = c_rsi3, size = size.tiny)

// RSI #4 (40% Vis -> 60 Transp)
c_rsi4 = i_rsi4_enabled ? f_getColorForSlot(v_rsi4, 60) : na
plotshape(i_rsi4_enabled and not na(v_rsi4) and v_rsi4 > i_threshold_ob, title = 'RSI 4 OB', style = s_ob, location = location.abovebar, color = c_rsi4, size = size.tiny)
plotshape(i_rsi4_enabled and not na(v_rsi4) and v_rsi4 < i_threshold_os, title = 'RSI 4 OS', style = s_os, location = location.belowbar, color = c_rsi4, size = size.tiny)

// RSI #5 (50% Vis -> 50 Transp)
c_rsi5 = i_rsi5_enabled ? f_getColorForSlot(v_rsi5, 50) : na
plotshape(i_rsi5_enabled and not na(v_rsi5) and v_rsi5 > i_threshold_ob, title = 'RSI 5 OB', style = s_ob, location = location.abovebar, color = c_rsi5, size = size.tiny)
plotshape(i_rsi5_enabled and not na(v_rsi5) and v_rsi5 < i_threshold_os, title = 'RSI 5 OS', style = s_os, location = location.belowbar, color = c_rsi5, size = size.tiny)

// RSI #6 (60% Vis -> 40 Transp)
c_rsi6 = i_rsi6_enabled ? f_getColorForSlot(v_rsi6, 40) : na
plotshape(i_rsi6_enabled and not na(v_rsi6) and v_rsi6 > i_threshold_ob, title = 'RSI 6 OB', style = s_ob, location = location.abovebar, color = c_rsi6, size = size.tiny)
plotshape(i_rsi6_enabled and not na(v_rsi6) and v_rsi6 < i_threshold_os, title = 'RSI 6 OS', style = s_os, location = location.belowbar, color = c_rsi6, size = size.tiny)

// RSI #7 (70% Vis -> 30 Transp)
c_rsi7 = i_rsi7_enabled ? f_getColorForSlot(v_rsi7, 30) : na
plotshape(i_rsi7_enabled and not na(v_rsi7) and v_rsi7 > i_threshold_ob, title = 'RSI 7 OB', style = s_ob, location = location.abovebar, color = c_rsi7, size = size.tiny)
plotshape(i_rsi7_enabled and not na(v_rsi7) and v_rsi7 < i_threshold_os, title = 'RSI 7 OS', style = s_os, location = location.belowbar, color = c_rsi7, size = size.tiny)

// RSI #8 (80% Vis -> 20 Transp)
c_rsi8 = i_rsi8_enabled ? f_getColorForSlot(v_rsi8, 20) : na
plotshape(i_rsi8_enabled and not na(v_rsi8) and v_rsi8 > i_threshold_ob, title = 'RSI 8 OB', style = s_ob, location = location.abovebar, color = c_rsi8, size = size.tiny)
plotshape(i_rsi8_enabled and not na(v_rsi8) and v_rsi8 < i_threshold_os, title = 'RSI 8 OS', style = s_os, location = location.belowbar, color = c_rsi8, size = size.tiny)

// RSI #9 (90% Vis -> 10 Transp)
c_rsi9 = i_rsi9_enabled ? f_getColorForSlot(v_rsi9, 10) : na
plotshape(i_rsi9_enabled and not na(v_rsi9) and v_rsi9 > i_threshold_ob, title = 'RSI 9 OB', style = s_ob, location = location.abovebar, color = c_rsi9, size = size.tiny)
plotshape(i_rsi9_enabled and not na(v_rsi9) and v_rsi9 < i_threshold_os, title = 'RSI 9 OS', style = s_os, location = location.belowbar, color = c_rsi9, size = size.tiny)

// RSI #10 (100% Vis -> 0 Transp)
c_rsi10 = i_rsi10_enabled ? f_getColorForSlot(v_rsi10, 0) : na
plotshape(i_rsi10_enabled and not na(v_rsi10) and v_rsi10 > i_threshold_ob, title = 'RSI 10 OB', style = s_ob, location = location.abovebar, color = c_rsi10, size = size.tiny)
plotshape(i_rsi10_enabled and not na(v_rsi10) and v_rsi10 < i_threshold_os, title = 'RSI 10 OS', style = s_os, location = location.belowbar, color = c_rsi10, size = size.tiny)
