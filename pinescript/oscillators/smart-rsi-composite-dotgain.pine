// Â© DotGain

// Smart RSI Composite (MACD Style)
// Aggregates multiple timeframes into a single Momentum Histogram.

//@version=6
indicator('Smart RSI Composite [Histogram]', overlay = false, shorttitle = 'RSI Comp')

// ==============================================
// --- Settings ---
// ==============================================

g_colors = 'Colors'
c_bull_strong = input.color(color.new(#006400, 0), 'Bullish Strong (Avg > 60)', group = g_colors)
c_bull_weak = input.color(color.new(color.lime, 40), 'Bullish Weak (Avg > 50)', group = g_colors)
c_bear_weak = input.color(color.new(color.red, 40), 'Bearish Weak (Avg < 50)', group = g_colors)
c_bear_strong = input.color(color.new(#8b0000, 0), 'Bearish Strong (Avg < 40)', group = g_colors)

// ==============================================
// --- RSI Inputs (10 Slots) ---
// ==============================================

g_slots = 'Slots'

i_rsi1_enabled = input.bool(true, 'RSI 1', group = g_slots)
i_rsi1_tf = input.timeframe('5', '', inline = '1', group = g_slots)
v_rsi1 = i_rsi1_enabled ? request.security(syminfo.tickerid, i_rsi1_tf, ta.rsi(close, 14)) : na

i_rsi2_enabled = input.bool(true, 'RSI 2', group = g_slots)
i_rsi2_tf = input.timeframe('15', '', inline = '2', group = g_slots)
v_rsi2 = i_rsi2_enabled ? request.security(syminfo.tickerid, i_rsi2_tf, ta.rsi(close, 14)) : na

i_rsi3_enabled = input.bool(true, 'RSI 3', group = g_slots)
i_rsi3_tf = input.timeframe('60', '', inline = '3', group = g_slots)
v_rsi3 = i_rsi3_enabled ? request.security(syminfo.tickerid, i_rsi3_tf, ta.rsi(close, 14)) : na

i_rsi4_enabled = input.bool(true, 'RSI 4', group = g_slots)
i_rsi4_tf = input.timeframe('240', '', inline = '4', group = g_slots)
v_rsi4 = i_rsi4_enabled ? request.security(syminfo.tickerid, i_rsi4_tf, ta.rsi(close, 14)) : na

i_rsi5_enabled = input.bool(true, 'RSI 5', group = g_slots)
i_rsi5_tf = input.timeframe('D', '', inline = '5', group = g_slots)
v_rsi5 = i_rsi5_enabled ? request.security(syminfo.tickerid, i_rsi5_tf, ta.rsi(close, 14)) : na

i_rsi6_enabled = input.bool(true, 'RSI 6', group = g_slots)
i_rsi6_tf = input.timeframe('W', '', inline = '6', group = g_slots)
v_rsi6 = i_rsi6_enabled ? request.security(syminfo.tickerid, i_rsi6_tf, ta.rsi(close, 14)) : na

i_rsi7_enabled = input.bool(true, 'RSI 7', group = g_slots)
i_rsi7_tf = input.timeframe('1M', '', inline = '7', group = g_slots)
v_rsi7 = i_rsi7_enabled ? request.security(syminfo.tickerid, i_rsi7_tf, ta.rsi(close, 14)) : na

i_rsi8_enabled = input.bool(true, 'RSI 8', group = g_slots)
i_rsi8_tf = input.timeframe('3M', '', inline = '8', group = g_slots)
v_rsi8 = i_rsi8_enabled ? request.security(syminfo.tickerid, i_rsi8_tf, ta.rsi(close, 14)) : na

i_rsi9_enabled = input.bool(true, 'RSI 9', group = g_slots)
i_rsi9_tf = input.timeframe('6M', '', inline = '9', group = g_slots)
v_rsi9 = i_rsi9_enabled ? request.security(syminfo.tickerid, i_rsi9_tf, ta.rsi(close, 14)) : na

i_rsi10_enabled = input.bool(true, 'RSI 10', group = g_slots)
i_rsi10_tf = input.timeframe('12M', '', inline = '10', group = g_slots)
v_rsi10 = i_rsi10_enabled ? request.security(syminfo.tickerid, i_rsi10_tf, ta.rsi(close, 14)) : na

// ==============================================
// --- Calculation: Average RSI ---
// ==============================================

// Helper to sum up values avoiding NA
f_add(_currentSum, _currentCount, _val) =>
    if not na(_val)
        [_currentSum + _val, _currentCount + 1]
    else
        [_currentSum, _currentCount]

[s0, c0] = f_add(0.0, 0, v_rsi1)
[s1, c1] = f_add(s0, c0, v_rsi2)
[s2, c2] = f_add(s1, c1, v_rsi3)
[s3, c3] = f_add(s2, c2, v_rsi4)
[s4, c4] = f_add(s3, c3, v_rsi5)
[s5, c5] = f_add(s4, c4, v_rsi6)
[s6, c6] = f_add(s5, c5, v_rsi7)
[s7, c7] = f_add(s6, c6, v_rsi8)
[s8, c8] = f_add(s7, c7, v_rsi9)
[s9, c9] = f_add(s8, c8, v_rsi10)

// Calculate Average
avg_rsi = c9 > 0 ? s9 / c9 : na

// ==============================================
// --- Plotting (Histogram Only) ---
// ==============================================

// Determine Color based on Strength
col_hist = na(avg_rsi) ? color.gray : avg_rsi > 60 ? c_bull_strong : avg_rsi > 50 ? c_bull_weak : avg_rsi < 40 ? c_bear_strong : c_bear_weak

// Plot Center Line (50 is the new 0)
hline(50, 'Center Line', color = color.gray, linestyle = hline.style_dotted)
hline(70, 'OB Zone', color = color.gray, linestyle = hline.style_dashed)
hline(30, 'OS Zone', color = color.gray, linestyle = hline.style_dashed)

// Plot Histogram
// We plot the actual Average RSI value as columns
plot(avg_rsi, title = 'Composite RSI Histogram', style = plot.style_columns, color = col_hist, histbase = 50)
