//@version=5
indicator("Diodato STCO (Original)", shorttitle="STCO", overlay=false, max_labels_count=500)

// ── Inputs
useUnchData = input.bool(true, "Use Unchanged Issues/Volume?", group="Data Sources")
showObOsLines = input.bool(true, "Show OB/OS Lines", group="Thresholds")
stcoObLevel = input.float(160.0, "Overbought Level", group="Thresholds", inline="1")
stcoOsLevel = input.float(140.0, "Oversold Level", group="Thresholds", inline="1")

// ── Fetch Data
advn = request.security("ADVN", timeframe.period, close)
decn = request.security("DECN", timeframe.period, close)
uvol = request.security("UVOL", timeframe.period, close)
dvol = request.security("DVOL", timeframe.period, close)
uncn = useUnchData ? request.security("UNCH.US", timeframe.period, close) : 0.0
uncv = useUnchData ? request.security("UNCV", timeframe.period, close) : 0.0

// ── Calculation
uv10    = ta.sma(uvol, 10)
dv10    = ta.sma(dvol, 10)
uncv10  = useUnchData ? ta.sma(uncv, 10) : 0.0
effV10  = (uv10 + dv10 + uncv10) - uncv10
volBandST = effV10 > 0 ? uv10 / effV10 : na
adv10   = ta.sma(advn, 10)
dec10   = ta.sma(decn, 10)
uncn10  = useUnchData ? ta.sma(uncn, 10) : 0.0
effI10  = (adv10 + dec10 + uncn10) - uncn10
brdBandST = effI10 > 0 ? adv10 / effI10 : na
stco = 100.0 * (volBandST + brdBandST)

// ── Plotting
plot(stco, "STCO", color=color.new(color.teal, 0), linewidth=2)
hline(showObOsLines ? stcoObLevel : na, "Overbought", color=color.new(color.red, 50), linestyle=hline.style_dashed)
hline(showObOsLines ? stcoOsLevel : na, "Oversold", color=color.new(color.green, 50), linestyle=hline.style_dashed)

bgcolor(stco >= stcoObLevel and showObOsLines ? color.new(color.red, 90) : na)
bgcolor(stco <= stcoOsLevel and showObOsLines ? color.new(color.green, 90) : na)
