//@version=5
indicator("SIDD EMA RSI Sup Trend Signal Table", shorttitle="SIDDEMARSISupTrendTable", overlay=true)

// Define Timeframes for the Table
t1 = input.timeframe("5", "Time Frame 1")
t2 = input.timeframe("15", "Time Frame 2")
t3 = input.timeframe("60", "Time Frame 3")
t4 = input.timeframe("240", "Time Frame 4")
t5 = input.timeframe("1D", "Time Frame 5")
t6 = input.timeframe("1W", "Time Frame 6")

// Define Colors with 50% opacity for Bullish, Bearish, and Neutral states
green = input.color(color.new(#00ffbb, 50), "Bullish Color (50% opacity)")
red = input.color(color.new(#ff1100, 50), "Bearish Color (50% opacity)")
neutral = input.color(color.new(color.gray, 50), "Neutral Color (50% opacity)")  // Customizable Neutral color

// EMA 50 and EMA 200 plot settings
ema50_color = input.color(color.blue, "EMA 50 Color")
ema50_width = input.int(1, "EMA 50 Line Width", minval=1)

ema200_color = input.color(color.purple, "EMA 200 Color")
ema200_width = input.int(1, "EMA 200 Line Width", minval=1)

// Plot EMA 50 and EMA 200 on the chart
ema50 = ta.ema(close, 50)
ema200 = ta.ema(close, 200)

//plot(ema50, title="EMA 50", color=ema50_color, linewidth=ema50_width)
//plot(ema200, title="EMA 200", color=ema200_color, linewidth=ema200_width)

//---------------super trend---------
atrPeriod = input(10, "ATR Length")
factor = input.float(3.0, "Factor", step = 0.01)

[supertrend, direction] = ta.supertrend(factor, atrPeriod)

yuseksup = ta.sma(supertrend,1)
sartsuper= direction < 0 ? 1 : direction > 0 ? -1 : na

fontsiyonsuper()=>
    sartsuper
    
fonstuperrenk(x) => x=="Bullish" ? color.green : x== "Bearish" ? color.red : na


supertrend1 = request.security(syminfo.ticker, t1, fontsiyonsuper())
supertrend2 = request.security(syminfo.ticker, t2, fontsiyonsuper())
supertrend3 = request.security(syminfo.ticker, t3, fontsiyonsuper())
supertrend4 = request.security(syminfo.ticker, t4, fontsiyonsuper())
supertrend5 = request.security(syminfo.ticker, t5, fontsiyonsuper())
supertrend6 = request.security(syminfo.ticker, t6, fontsiyonsuper())

uptrend1 = supertrend1 == 1 ? "Bullish"   : supertrend1 == -1 ? "Bearish"  : na
uptrend2 = supertrend2 == 1 ? "Bullish"   : supertrend2 == -1 ? "Bearish"  : na
uptrend3 = supertrend3 == 1 ? "Bullish"   : supertrend3 == -1 ? "Bearish"  : na
uptrend4 = supertrend4 == 1 ? "Bullish"   : supertrend4 == -1 ? "Bearish"  : na
uptrend5 = supertrend5 == 1 ? "Bullish"   : supertrend5 == -1 ? "Bearish"  : na
uptrend6 = supertrend6 == 1 ? "Bullish"   : supertrend6 == -1 ? "Bearish"  : na
/////////////////////////////////////////////////////

// Dropdown to set table position
table_position = input.string("Top Right", "Table Position", options=["Top Left", "Top Right", "Bottom Left", "Bottom Right"])

// Map position to actual constants
position_mapping = table_position == "Top Left" ? position.top_left : 
                   table_position == "Top Right" ? position.top_right : 
                   table_position == "Bottom Left" ? position.bottom_left : position.bottom_right

// Dropdown for table size with refined smaller options
table_size = input.string("Extra Small", "Table Size", options=["Extra Small", "Small", "Normal"])

// Set row height based on refined table size for more compact dimensions
row_height = table_size == "Extra Small" ? 5 : table_size == "Small" ? 10 : 13

// Manual color inputs for text and border with higher opacity for visibility
user_text_color = input(color.new(color.white, 0), "Text Color")  // default black with no opacity
user_border_color = input(color.new(color.white, 0), "Border Color")  // default black with no opacity

// Function to determine trend based on EMA 50 and EMA 200, with "Neutral" handling///////////////////////////
get_trend() =>
    na(ema200) ? "Neutral" : (ema50 > ema200 ? "Bullish" : "Bearish")

// Fetch EMA trend for each timeframe
s1 = request.security(syminfo.tickerid, t1, get_trend())
s2 = request.security(syminfo.tickerid, t2, get_trend())
s3 = request.security(syminfo.tickerid, t3, get_trend())
s4 = request.security(syminfo.tickerid, t4, get_trend())
s5 = request.security(syminfo.tickerid, t5, get_trend())
s6 = request.security(syminfo.tickerid, t6, get_trend())


//RSI//////////////////////////////////////

len = input.int(14, minval=1, title="Length")
up = ta.rma(math.max(ta.change(close), 0), len)
down= ta.rma(math.min(ta.change(close), 0), len)

vsi5m = request.security(syminfo.tickerid,t1, ta.rsi(close,len))
vsi15m = request.security(syminfo.tickerid, t2, ta.rsi(close,len))
vsi1h = request.security(syminfo.tickerid, t3, ta.rsi(close,len))
vsi4h = request.security(syminfo.tickerid, t4, ta.rsi(close,len))
vsid = request.security(syminfo.tickerid, t5, ta.rsi(close,len))
vsiw = request.security(syminfo.tickerid, t6, ta.rsi(close,len))

get_RSI_trend(r1) =>
    na(r1) ? "Neutral" : (r1 > 55 ? "Bullish" : "Bearish")

rs1 = request.security(syminfo.tickerid, t1, get_RSI_trend(vsi5m))
rs2 = request.security(syminfo.tickerid, t2, get_RSI_trend(vsi15m))
rs3 = request.security(syminfo.tickerid, t3, get_RSI_trend(vsi1h))
rs4 = request.security(syminfo.tickerid, t4, get_RSI_trend(vsi4h))
rs5 = request.security(syminfo.tickerid, t5, get_RSI_trend(vsid))
rs6 = request.security(syminfo.tickerid, t6, get_RSI_trend(vsid))

// Display table with custom colors and size, with improved border visibility
if barstate.islast
    // Create table with defined position and outer border
    var table data_table = table.new(position=position_mapping, columns=4, rows=7, bgcolor=#00000000, border_width=1, border_color=user_border_color)
    
    // Header Row
    table.cell(data_table, column=0, row=0, text="Time Frame", text_color=user_text_color, text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=1, row=0, text="EMA", text_color=user_text_color, text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=2, row=0, text="RSI", text_color=user_text_color, text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=3, row=0, text="Super Trend", text_color=user_text_color, text_halign=text.align_center, height=row_height)

    // Data Rows
    table.cell(data_table, column=0, row=1, text=t1, text_color=user_text_color, text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=1, row=1, text=s1, text_color=user_text_color, bgcolor=s1 == "Bullish" ? green : (s1 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=2, row=1, text=rs1, text_color=user_text_color, bgcolor=rs1 == "Bullish" ? green : (rs1 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=3, row=1, text=uptrend1, text_color=user_text_color, bgcolor=uptrend1 == "Bullish" ? green : (uptrend1 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)

    table.cell(data_table, column=0, row=2, text=t2, text_color=user_text_color, text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=1, row=2, text=s2, text_color=user_text_color, bgcolor=s2 == "Bullish" ? green : (s2 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=2, row=2, text=rs2, text_color=user_text_color, bgcolor=rs2 == "Bullish" ? green : (rs2 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=3, row=2, text=uptrend2, text_color=user_text_color, bgcolor=uptrend2 == "Bullish" ? green : (uptrend2 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)

    table.cell(data_table, column=0, row=3, text=t3, text_color=user_text_color, text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=1, row=3, text=s3, text_color=user_text_color, bgcolor=s3 == "Bullish" ? green : (s3 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=2, row=3, text=rs3, text_color=user_text_color, bgcolor=rs3 == "Bullish" ? green : (rs3 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=3, row=3, text=uptrend3, text_color=user_text_color, bgcolor=uptrend3 == "Bullish" ? green : (uptrend3 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)

    table.cell(data_table, column=0, row=4, text=t4, text_color=user_text_color, text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=1, row=4, text=s4, text_color=user_text_color, bgcolor=s4 == "Bullish" ? green : (s4 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=2, row=4, text=rs4, text_color=user_text_color, bgcolor=rs4 == "Bullish" ? green : (rs4 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=3, row=4, text=uptrend4, text_color=user_text_color, bgcolor=uptrend4 == "Bullish" ? green : (uptrend4 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)

    table.cell(data_table, column=0, row=5, text=t5, text_color=user_text_color, text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=1, row=5, text=s5, text_color=user_text_color, bgcolor=s5 == "Bullish" ? green : (s5 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=2, row=5, text=rs5, text_color=user_text_color, bgcolor=rs5 == "Bullish" ? green : (rs5 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=3, row=5, text=uptrend5, text_color=user_text_color, bgcolor=uptrend5 == "Bullish" ? green : (uptrend5 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)

    table.cell(data_table, column=0, row=6, text=t6, text_color=user_text_color, text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=1, row=6, text=s6, text_color=user_text_color, bgcolor=s6 == "Bullish" ? green : (s6 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=2, row=6, text=rs6, text_color=user_text_color, bgcolor=rs6 == "Bullish" ? green : (rs6 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
    table.cell(data_table, column=3, row=6, text=uptrend6, text_color=user_text_color, bgcolor=uptrend6 == "Bullish" ? green : (uptrend6 == "Bearish" ? red : neutral), text_halign=text.align_center, height=row_height)
