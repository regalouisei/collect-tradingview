// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at [https://mozilla.org/MPL/2.0/](https://mozilla.org/MPL/2.0/)
// © WoonieWant

//@version=6
indicator('Stacked 3 Stochastics [Bull/Bear Signals]', shorttitle = 'Stacked 3 Stoch', overlay = false)

// ==========================================
// 1. Stochastic 1 (Top Layer: 5-3-3)
// ==========================================
grp_st1 = 'Stoch 1 (Top - Fast)'
show_st1 = input.bool(true, 'Show Stoch 1', group = grp_st1)
k_len1 = input.int(5, 'K Length', minval = 1, inline = 'st1', group = grp_st1)
k_smo1 = input.int(3, 'K Smooth', minval = 1, inline = 'st1', group = grp_st1)
d_smo1 = input.int(3, 'D Smooth', minval = 1, inline = 'st1', group = grp_st1)
col_k1 = input.color(color.new(color.aqua, 0), 'K Color', inline = 'st1_c', group = grp_st1)
wid_k1 = input.int(1, 'Width', minval = 1, inline = 'st1_c', group = grp_st1)
col_d1 = input.color(color.new(color.blue, 0), 'D Color', inline = 'st1_c', group = grp_st1)

// Calculation & Offset
offset1 = 250
k1 = ta.sma(ta.stoch(close, high, low, k_len1), k_smo1)
d1 = ta.sma(k1, d_smo1)

// Plotting
plot(show_st1 ? k1 + offset1 : na, 'Stoch 1 %K', color = col_k1, linewidth = math.max(1, math.max(1, wid_k1)))
plot(show_st1 ? d1 + offset1 : na, 'Stoch 1 %D', color = col_d1, linewidth = 1)

// Guidelines
h1_top = hline(offset1 + 80, 'Stoch 1 Upper', color = color.new(color.gray, 70), linestyle = hline.style_dotted)
h1_bot = hline(offset1 + 20, 'Stoch 1 Lower', color = color.new(color.gray, 70), linestyle = hline.style_dotted)
fill(h1_top, h1_bot, color = show_st1 ? color.new(color.blue, 95) : na, title = 'Stoch 1 Bg')

// Separator
hline(offset1 - 12.5, 'Separator 1-2', color = color.new(color.white, 80), linestyle = hline.style_solid, linewidth = 1)


// ==========================================
// 2. Stochastic 2 (Middle Layer: 10-6-6)
// ==========================================
grp_st2 = 'Stoch 2 (Middle)'
show_st2 = input.bool(true, 'Show Stoch 2', group = grp_st2)
k_len2 = input.int(10, 'K Length', minval = 1, inline = 'st2', group = grp_st2)
k_smo2 = input.int(6, 'K Smooth', minval = 1, inline = 'st2', group = grp_st2)
d_smo2 = input.int(6, 'D Smooth', minval = 1, inline = 'st2', group = grp_st2)
col_k2 = input.color(color.new(color.orange, 0), 'K Color', inline = 'st2_c', group = grp_st2)
wid_k2 = input.int(1, 'Width', minval = 1, inline = 'st2_c', group = grp_st2)
col_d2 = input.color(color.new(color.red, 0), 'D Color', inline = 'st2_c', group = grp_st2)

// Calculation & Offset
offset2 = 125
k2 = ta.sma(ta.stoch(close, high, low, k_len2), k_smo2)
d2 = ta.sma(k2, d_smo2)

// Plotting
plot(show_st2 ? k2 + offset2 : na, 'Stoch 2 %K', color = col_k2, linewidth = math.max(1, math.max(1, wid_k2)))
plot(show_st2 ? d2 + offset2 : na, 'Stoch 2 %D', color = col_d2, linewidth = 1)

// Guidelines
h2_top = hline(offset2 + 80, 'Stoch 2 Upper', color = color.new(color.gray, 70), linestyle = hline.style_dotted)
h2_bot = hline(offset2 + 20, 'Stoch 2 Lower', color = color.new(color.gray, 70), linestyle = hline.style_dotted)
fill(h2_top, h2_bot, color = show_st2 ? color.new(color.orange, 95) : na, title = 'Stoch 2 Bg')

// Separator
hline(offset2 - 12.5, 'Separator 2-3', color = color.new(color.white, 80), linestyle = hline.style_solid, linewidth = 1)


// ==========================================
// 3. Stochastic 3 (Bottom Layer: 20-12-12)
// ==========================================
grp_st3 = 'Stoch 3 (Bottom - Slow)'
show_st3 = input.bool(true, 'Show Stoch 3', group = grp_st3)
k_len3 = input.int(20, 'K Length', minval = 1, inline = 'st3', group = grp_st3)
k_smo3 = input.int(12, 'K Smooth', minval = 1, inline = 'st3', group = grp_st3)
d_smo3 = input.int(12, 'D Smooth', minval = 1, inline = 'st3', group = grp_st3)
col_k3 = input.color(color.new(color.lime, 0), 'K Color', inline = 'st3_c', group = grp_st3)
wid_k3 = input.int(1, 'Width', minval = 1, inline = 'st3_c', group = grp_st3)
col_d3 = input.color(color.new(color.green, 0), 'D Color', inline = 'st3_c', group = grp_st3)

// Calculation & Offset
k3 = ta.sma(ta.stoch(close, high, low, k_len3), k_smo3)
d3 = ta.sma(k3, d_smo3)

// Plotting
plot(show_st3 ? k3 : na, 'Stoch 3 %K', color = col_k3, linewidth = math.max(1, math.max(1, wid_k3)))
plot(show_st3 ? d3 : na, 'Stoch 3 %D', color = col_d3, linewidth = 1)

// Guidelines
h3_top = hline(80, 'Stoch 3 Upper', color = color.new(color.gray, 70), linestyle = hline.style_dotted)
h3_bot = hline(20, 'Stoch 3 Lower', color = color.new(color.gray, 70), linestyle = hline.style_dotted)
fill(h3_top, h3_bot, color = show_st3 ? color.new(color.lime, 95) : na, title = 'Stoch 3 Bg')


// ==========================================
// Signal Highlight Logic (Bullish & Bearish)
// ==========================================
grp_sig = 'Signal Highlights'

// Inputs for Toggles
show_sig_bull = input.bool(true, 'Highlight: All Stoch K > D (Bullish)', group = grp_sig)
show_sig_bear = input.bool(true, 'Highlight: All Stoch K < D (Bearish)', group = grp_sig)

// Conditions
all_bullish = k1 > d1 and k2 > d2 and k3 > d3
all_bearish = k1 < d1 and k2 < d2 and k3 < d3

// 1. Bullish Highlight (Light Green)
bgcolor(show_sig_bull and all_bullish ? color.new(color.green, 85) : na, title = 'Bg All Bullish')

// 2. Bearish Highlight (Light Red)
bgcolor(show_sig_bear and all_bearish ? color.new(color.red, 85) : na, title = 'Bg All Bearish')


// ==========================================
// Labels
// ==========================================
if barstate.islast
    // Layer 1
    label.new(bar_index + 5, offset1 + 50, 'Stoch 1\n(5-3-3)', color = color.new(color.black, 100), style = label.style_none, textcolor = col_k1, size = size.small)
    label.new(bar_index + 1, offset1 + 80, '80', color = color.new(color.black, 100), style = label.style_none, textcolor = color.gray, size = size.tiny)
    label.new(bar_index + 1, offset1 + 20, '20', color = color.new(color.black, 100), style = label.style_none, textcolor = color.gray, size = size.tiny)

    // Layer 2
    label.new(bar_index + 5, offset2 + 50, 'Stoch 2\n(10-6-6)', color = color.new(color.black, 100), style = label.style_none, textcolor = col_k2, size = size.small)
    label.new(bar_index + 1, offset2 + 80, '80', color = color.new(color.black, 100), style = label.style_none, textcolor = color.gray, size = size.tiny)
    label.new(bar_index + 1, offset2 + 20, '20', color = color.new(color.black, 100), style = label.style_none, textcolor = color.gray, size = size.tiny)

    // Layer 3
    label.new(bar_index + 5, 50, 'Stoch 3\n(20-12-12)', color = color.new(color.black, 100), style = label.style_none, textcolor = col_k3, size = size.small)
    label.new(bar_index + 1, 80, '80', color = color.new(color.black, 100), style = label.style_none, textcolor = color.gray, size = size.tiny)
    label.new(bar_index + 1, 20, '20', color = color.new(color.black, 100), style = label.style_none, textcolor = color.gray, size = size.tiny)
