// This Pine ScriptÂ® code is subject to the terms of the Mozilla Public License 2.0 
// https://mozilla.org/MPL/2.0/
// Â© AquaTickTrader

//@version=6
// ==============================================================================
//  Sk M Sir Ji â€” Multi-ALMA Trend + RSI/Bollinger Bias Heatmap
// ------------------------------------------------------------------------------
//  DESCRIPTION:
//  This indicator provides a structural trend-mapping system based on multiple 
//  ALMA (Arnaud Legoux Moving Average) lines of increasing lengths, combined with 
//  a dynamic background heatmap driven by RSI and Bollinger Band conditions.
//
//  FEATURE SET:
//  â€¢ 8 ALMA moving averages (short â†’ long)
//  â€¢ Color-coded ALMA trend direction (Green = rising, Red = falling)
//  â€¢ RSI(14)-based bias highlights
//  â€¢ Bollinger Band volatility-based bias highlights
//  â€¢ Background Heatmap for momentum & volatility confirmation
//  â€¢ User-selectable MA type for Bollinger base
//
//  BACKGROUND HEATMAP LOGIC:
//      ðŸ”´ RED   = RSI(14) < 50  OR  low < Lower Bollinger Band (20)
//      ðŸŸ¢ GREEN = RSI(14) > 50  OR  high > Upper Bollinger Band (20)
//
//  ALMA TREND COLOR LOGIC:
//      Green = Current ALMA > Previous ALMA
//      Red   = Current ALMA < Previous ALMA
//
//  COMPONENTS INCLUDED:
//      â€¢ SMA / EMA / RMA(SMMA) / WMA / VWMA selectable BB basis
//      â€¢ ALMA lengths: 12, 18, 30, 40, 70, 112, 250, 525
//      â€¢ Optional visibility on selected ALMAs
//
//  AUTHOR: Â©AquaTickTrader
// ==============================================================================

indicator("Sk M Sir Ji", overlay=true, timeframe="", timeframe_gaps=true)


// ==============================================================================
// INPUTS â€” Bollinger Band & MA Settings
// ------------------------------------------------------------------------------
length = input.int(20, "Basis Length", minval=1)
maType = input.string("SMA", "Basis MA Type", 
     options = ["SMA", "EMA", "SMMA (RMA)", "WMA", "VWMA"])
src = input(close, "Source")
mult = input.float(2.0, "Std Dev Multiplier", minval=0.001, maxval=50)


// ==============================================================================
// FUNCTION â€” Custom MA Selector
// ------------------------------------------------------------------------------
ma(source, length, _type) =>
    switch _type
        "SMA" => ta.sma(source, length)
        "EMA" => ta.ema(source, length)
        "SMMA (RMA)" => ta.rma(source, length)
        "WMA" => ta.wma(source, length)
        "VWMA" => ta.vwma(source, length)


// ==============================================================================
// BOLLINGER BAND CALCULATION
// ------------------------------------------------------------------------------
basis = ma(src, length, maType)
dev   = mult * ta.stdev(src, length)
upper = basis + dev
lower = basis - dev

plot(upper, "BB Upper", color=color.white)
plot(lower, "BB Lower", color=color.white)


// ==============================================================================
// RSI & BACKGROUND BIAS HEATMAP
// ------------------------------------------------------------------------------
rsi = ta.rsi(close, 14)

// ðŸ”´ Weakness Conditions
bgcolor((rsi < 50) or (low < lower)  
     ? color.new(color.red, 70) 
     : na)

// ðŸŸ¢ Strength Conditions
bgcolor((rsi > 50) or (high > upper) 
     ? color.new(color.lime, 70)
     : na)


// ==============================================================================
// ALMA TREND SYSTEM â€” 8 Moving Averages
// ------------------------------------------------------------------------------

// ALMA 12 (hidden by default)
len1 = input.int(12, "ALMA Length 1")
alma1 = ta.alma(close, len1, 0.85, 8)
plot(alma1, "ALMA 12", color = alma1 > alma1[1] ? color.green : color.red, 
     linewidth=2, display=display.none)

// ALMA 18 (hidden by default)
len2 = input.int(18, "ALMA Length 2")
alma2 = ta.alma(close, len2, 0.85, 8)
plot(alma2, "ALMA 18", color = alma2 > alma2[1] ? color.green : color.red, 
     linewidth=2, display=display.none)

// ALMA 30 (main)
len3 = input.int(30, "ALMA Length 3")
alma3 = ta.alma(close, len3, 0.85, 8)
plot(alma3, "ALMA 30", color = alma3 > alma3[1] ? color.green : color.red, 
     linewidth=3)

// ALMA 40
len4 = input.int(40, "ALMA Length 4")
alma4 = ta.alma(close, len4, 0.85, 8)
plot(alma4, "ALMA 40", color = alma4 > alma4[1] ? color.green : color.red, 
     linewidth=2)

// ALMA 70
len5 = input.int(70, "ALMA Length 5")
alma5 = ta.alma(close, len5, 0.85, 8)
plot(alma5, "ALMA 70", color = alma5 > alma5[1] ? color.green : color.red, 
     linewidth=2)

// ALMA 112 (hidden)
len6 = input.int(112, "ALMA Length 6")
alma6 = ta.alma(close, len6, 0.85, 8)
plot(alma6, "ALMA 112", color = alma6 > alma6[1] ? color.green : color.red, 
     linewidth=2, display=display.none)

// ALMA 250 (hidden)
len7 = input.int(250, "ALMA Length 7")
alma7 = ta.alma(close, len7, 0.85, 8)
plot(alma7, "ALMA 250", color = alma7 > alma7[1] ? color.green : color.red, 
     linewidth=2, display=display.none)

// ALMA 525 (hidden)
len8 = input.int(525, "ALMA Length 8")
alma8 = ta.alma(close, len8, 0.85, 8)
plot(alma8, "ALMA 525", color = alma8 > alma8[1] ? color.green : color.red, 
     linewidth=2, display=display.none)


// ==============================================================================
// END OF SCRIPT
// ------------------------------------------------------------------------------
