//@version=6
indicator(
     title          = "Stochastic RSI (adjustable fast line color)",
     shorttitle     = "Stoch RSI",
     format         = format.price,
     precision      = 2,
     timeframe      = "",
     timeframe_gaps = true
)

// ── INPUTS ─────────────────────────────────────────────────────────────────────
smoothK   = input.int (3,  "K",          minval = 1)
smoothD   = input.int (3,  "D",          minval = 1)
lengthRSI = input.int (14, "RSI Length", minval = 1)
lengthStoch = input.int(14, "Stochastic Length", minval = 1)
src       = input (close, title = "RSI Source")

// colours for the fast line – user‑adjustable
fastUpColor   = input.color(color.new(#2962FF, 0),  "Fast line colour (K > D)")
fastDownColor = input.color(color.new(#FF6D00, 0),  "Fast line colour (K < D)")

// ── CALCULATIONS ───────────────────────────────────────────────────────────────
rsi1 = ta.rsi(src, lengthRSI)

// Stochastic of the RSI
stochRsi = ta.stoch(rsi1, rsi1, rsi1, lengthStoch)

// Smoothed %K and %D
k = ta.sma(stochRsi, smoothK)
d = ta.sma(k, smoothD)

// ── PLOTS ─────────────────────────────────────────────────────────────────────
// Fast line – colour changes depending on its relation to the slow line
plot(
     series = k,
     title  = "K",
     color  = k > d ? fastUpColor : fastDownColor,
     linewidth = 2
)

// Slow line – keep the original colour (you can also make it adjustable if you wish)
plot(
     series = d,
     title  = "D",
     color  = #f4f1ef,
     linewidth = 2
)

// ── HORIZONTAL LEVELS & BACKGROUND ─────────────────────────────────────────────
h0 = hline(80, "Upper Band", color = #787B86)
hline(50, "Middle Band", color = color.new(#787B86, 50))
h1 = hline(20, "Lower Band", color = #787B86)

// Background fill between the two bands
fill(h0, h1, color = color.rgb(33, 150, 243, 90), title = "Background")
