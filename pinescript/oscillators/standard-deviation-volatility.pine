//@version=5
// 標準偏差（Standard Deviation）を計算・表示するインジケーター
indicator("Standard Deviation Volatility", shorttitle="StDev", overlay=false)

// -----------------------------------------------------------------------------
// パラメーター設定
// -----------------------------------------------------------------------------

// 計算期間
length = input.int(20, title="期間", minval=1) 
// 計算に使う価格（終値、高値など）
source = input.source(close, title="計算ソース")
// ボラティリティのレベルを示すための水平線
lineValue = input.float(0.5, title="基準線", step=0.01)

// -----------------------------------------------------------------------------
// 標準偏差の計算
// -----------------------------------------------------------------------------

// ta.stdev関数を使用して標準偏差を計算します
// 標準偏差は、価格が平均からどれだけ散らばっているかを示します
stdev = ta.stdev(source, length)

// -----------------------------------------------------------------------------
// プロット（描画）
// -----------------------------------------------------------------------------

// 標準偏差のラインをプロット
plot(stdev, title="StDev", color=color.blue, linewidth=2)

// ボラティリティの強弱を判断するための基準線をプロット
hline(lineValue, title="基準線", color=color.red, linestyle=hline.style_dashed)

// 背景色のハイライト（オプション：ボラティリティが高いエリアを色付け）
// 標準偏差が基準線を超えたら、背景を黄色でハイライト
bgcolor(stdev > lineValue ? color.new(color.yellow, 90) : na)
