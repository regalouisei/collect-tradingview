//@version=5
indicator("Stoch Cross OB/OS Signals Clean", overlay=false, max_labels_count=500)

// === INPUTS ===
stochK      = input.int(14, "Stoch %K Period")
stochD      = input.int(3,  "Stoch %D Period")
stochSmooth = input.int(3,  "Stoch Smooth")
obLevel     = input.int(80, "Overbought Level")
osLevel     = input.int(20, "Oversold Level")
symOB       = input.string("▼", "Symbol for OB Cross")  // down triangle
symOS       = input.string("▲", "Symbol for OS Cross")  // up triangle
sizeInput   = input.int(2, "Symbol Size (1-4)", minval=1, maxval=4)

// === MAP INPUT SIZE TO ENUM ===
getLabelSize(sz) =>
    (sz == 1 ? size.small : 
     sz == 2 ? size.normal : 
     sz == 3 ? size.large : 
     size.huge)

labelSize = getLabelSize(sizeInput)


// === CALCULATE STOCH ===
stochKVal       = ta.stoch(close, high, low, stochK)
stochDVal       = ta.sma(stochKVal, stochD)
stochSmoothLine = ta.sma(stochDVal, stochSmooth)

// === CROSS DETECTION ===
crossUp   = ta.crossover(stochKVal, stochSmoothLine)
crossDown = ta.crossunder(stochKVal, stochSmoothLine)

// === OVERBOUGHT / OVERSOLD CONDITIONS ===
isOB = stochKVal > obLevel
isOS = stochKVal < osLevel

// === PLOT SYMBOLS ===
if crossUp and isOS
    label.new(bar_index, stochKVal, symOS, xloc=xloc.bar_index, yloc=yloc.price, color=color.red, textcolor=color.white, size=labelSize)

if crossDown and isOB
    label.new(bar_index, stochKVal, symOB, xloc=xloc.bar_index, yloc=yloc.price, color=color.green, textcolor=color.white, size=labelSize)

// === PLOT STOCH LINES ===
plot(stochKVal, "Stoch %K", color=color.orange, linewidth=2)
plot(stochSmoothLine, "Stoch %D", color=color.yellow, linewidth=2)

// === HORIZONTAL LEVELS ===
hline(obLevel, "Overbought", color=color.red, linestyle=hline.style_solid)
hline(osLevel, "Oversold", color=color.green, linestyle=hline.style_solid)
