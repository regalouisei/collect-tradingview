//@version=5
indicator(
     "RSI with 3 Separate Smoothing Averages",
     shorttitle = "RSI + 3xMA",
     overlay = false,
     max_lines_count = 6
         )

// ──────────────────────────────────────
// ── INPUTS
// ──────────────────────────────────────
rsiLen = input.int(14, "RSI Length", minval = 1)

// Smoothing 1
show1 = input.bool(true, "Show Smoothing 1")
len1  = input.int(3, "Smoothing 1 Length", minval = 1)
type1 = input.string(
     "SMA",
     "Smoothing 1 Type",
     options = ["SMA", "EMA", "WMA", "RMA", "HMA"]
                 )

// Smoothing 2
show2 = input.bool(true, "Show Smoothing 2")
len2  = input.int(5, "Smoothing 2 Length", minval = 1)
type2 = input.string(
     "EMA",
     "Smoothing 2 Type",
     options = ["SMA", "EMA", "WMA", "RMA", "HMA"]
                 )

// Smoothing 3
show3 = input.bool(true, "Show Smoothing 3")
len3  = input.int(7, "Smoothing 3 Length", minval = 1)
type3 = input.string(
     "WMA",
     "Smoothing 3 Type",
     options = ["SMA", "EMA", "WMA", "RMA", "HMA"]
                 )

// ──────────────────────────────────────
// ── MA FUNCTION
// ──────────────────────────────────────
f_ma(src, length, maType) =>
    switch maType
        "SMA" => ta.sma(src, length)
        "EMA" => ta.ema(src, length)
        "WMA" => ta.wma(src, length)
        "RMA" => ta.rma(src, length)
        "HMA" => ta.hma(src, length)

// ──────────────────────────────────────
// ── CALCULATIONS
// ──────────────────────────────────────
rsiRaw = ta.rsi(close, rsiLen)

sm1 = f_ma(rsiRaw, len1, type1)
sm2 = f_ma(rsiRaw, len2, type2)
sm3 = f_ma(rsiRaw, len3, type3)

// ──────────────────────────────────────
// ── PLOTTING
// ──────────────────────────────────────
plot(rsiRaw, "Raw RSI", color = color.black, linewidth = 2, display = display.none)

p1 = plot(show1 ? sm1 : na, "Smoothing 1", color = color.blue, linewidth = 2)
p2 = plot(show2 ? sm2 : na, "Smoothing 2", color = color.orange, linewidth = 2)
p3 = plot(show3 ? sm3 : na, "Smoothing 3", color = color.red, linewidth = 2)

// Hidden plots for fill
h70_plot = plot(70, "OB Level", color = color.new(color.red, 100), display = display.none)
h30_plot = plot(30, "OS Level", color = color.new(color.green, 100), display = display.none)

// Visible reference lines
hline(70, "Overbought", color = color.red, linestyle = hline.style_dashed)
hline(30, "Oversold", color = color.green, linestyle = hline.style_dashed)
hline(50, "Midline", color = color.black, linestyle = hline.style_dotted)

// Fill zone
fill(h70_plot, h30_plot, color = color.new(color.blue, 95), title = "Overbought/Oversold Zone")

// ──────────────────────────────────────
// ── LEGEND
// ──────────────────────────────────────
var table legend = table.new(position.top_right, 1, 4, bgcolor = color.new(color.black, 75))
if barstate.islast
    table.cell(legend, 0, 0, "RSI (" + str.tostring(rsiLen) + ")", text_color = color.black)
    table.cell(legend, 0, 1, show1 ? type1 + "(" + str.tostring(len1) + ")" : "—", text_color = color.blue)
    table.cell(legend, 0, 2, show2 ? type2 + "(" + str.tostring(len2) + ")" : "—", text_color = color.orange)
    table.cell(legend, 0, 3, show3 ? type3 + "(" + str.tostring(len3) + ")" : "—", text_color = color.red)
