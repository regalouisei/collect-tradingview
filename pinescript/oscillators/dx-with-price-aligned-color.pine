//@version=5
indicator("DX with Price-Aligned Color", overlay=false)

// Inputs
dxLength  = input.int(14, "DX Length")
smaLength = input.int(5, "DX SMA Length")

// Directional Movement
upMove   = high - high[1]
downMove = low[1] - low

plusDM  = (upMove > downMove and upMove > 0) ? upMove : 0
minusDM = (downMove > upMove and downMove > 0) ? downMove : 0

tr = ta.rma(ta.tr(true), dxLength)

plusDI  = 100 * ta.rma(plusDM, dxLength) / tr
minusDI = 100 * ta.rma(minusDM, dxLength) / tr

dx = 100 * math.abs(plusDI - minusDI) / (plusDI + minusDI)

// SMA of DX
dxSma = ta.sma(dx, smaLength)

// ðŸ”¹ PRICE DIRECTION
priceUp   = close > close[1]
priceDown = close < close[1]

// ðŸ”¹ DX SLOPE
dxRising  = dx > dx[1]
dxFalling = dx < dx[1]

// ðŸ”¹ FINAL COLOR LOGIC (THIS IS THE FIX)
dxColor =
     dxRising and priceUp   ? color.lime :   // Bullish strength
     dxRising and priceDown ? color.red  :   // Bearish strength
     dxFalling              ? color.red  :   // Weakening
                              color.gray

// Plots
plot(dx, title="DX", color=dxColor, linewidth=2)
plot(dxSma, title="DX SMA", color=color.blue, linewidth=2)

// Reference levels
hline(20, "No Trend", color=color.gray)
hline(25, "Trend Threshold", color=color.red)
hline(40, "Strong Trend", color=color.green)
