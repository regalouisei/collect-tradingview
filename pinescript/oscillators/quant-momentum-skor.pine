// This Pine ScriptÂ® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© kashmehmet

//@version=6
indicator('ðŸ”¥ QUANT MOMENTUM SKOR', overlay = false, precision = 0)

// ==================== AYARLAR ====================

// Genel Ayarlar
generalGroup = 'âš™ï¸ GENEL AYARLAR'
showScoreLabel = input.bool(true, 'Skor Etiketini GÃ¶ster', group = generalGroup)
showComponents = input.bool(true, 'BileÅŸenleri GÃ¶ster', group = generalGroup)
alertThreshold = input.int(70, 'Alert EÅŸik DeÄŸeri', minval = 50, maxval = 95, group = generalGroup, tooltip = 'Bu skorun Ã¼zerinde alert verir')

// Momentum AyarlarÄ±
momentumGroup = 'ðŸ“ˆ MOMENTUM AYARLARI'
rocPeriod = input.int(20, 'ROC Periyodu', minval = 5, group = momentumGroup)
rsiPeriod = input.int(14, 'RSI Periyodu', minval = 5, group = momentumGroup)
macdFast = input.int(12, 'MACD HÄ±zlÄ±', minval = 5, group = momentumGroup)
macdSlow = input.int(26, 'MACD YavaÅŸ', minval = 10, group = momentumGroup)
macdSignal = input.int(9, 'MACD Sinyal', minval = 5, group = momentumGroup)

// Trend AyarlarÄ±
trendGroup = 'ðŸ“Š TREND AYARLARI'
adxPeriod = input.int(14, 'ADX Periyodu', minval = 5, group = trendGroup)
adxSmooth = input.int(14, 'ADX Smoothing', minval = 5, group = trendGroup)
emaPeriod = input.int(20, 'EMA Periyodu', minval = 5, group = trendGroup)

// Hacim AyarlarÄ±
volumeGroup = 'ðŸ’° HACÄ°M AYARLARI'
volumePeriod = input.int(20, 'Hacim MA Periyodu', minval = 5, group = volumeGroup)

// AÄŸÄ±rlÄ±klar
weightGroup = 'âš–ï¸ AÄžIRLIKLAR (Toplam 100 olmalÄ±)'
weightPrice = input.int(25, 'Fiyat Momentum AÄŸÄ±rlÄ±ÄŸÄ±', minval = 0, maxval = 100, group = weightGroup)
weightRSI = input.int(20, 'RSI Momentum AÄŸÄ±rlÄ±ÄŸÄ±', minval = 0, maxval = 100, group = weightGroup)
weightMACD = input.int(20, 'MACD Momentum AÄŸÄ±rlÄ±ÄŸÄ±', minval = 0, maxval = 100, group = weightGroup)
weightTrend = input.int(20, 'Trend GÃ¼cÃ¼ AÄŸÄ±rlÄ±ÄŸÄ±', minval = 0, maxval = 100, group = weightGroup)
weightVolume = input.int(15, 'Hacim Momentum AÄŸÄ±rlÄ±ÄŸÄ±', minval = 0, maxval = 100, group = weightGroup)

// ==================== FÄ°YAT MOMENTUM ====================

// Rate of Change (ROC)
roc = ta.roc(close, rocPeriod)
rocNormalized = (roc + 100) / 2 // -100 ile +100 arasÄ± deÄŸeri 0-100'e normalize et
rocScore = math.max(0, math.min(100, rocNormalized))

// ==================== RSI MOMENTUM ====================

rsi = ta.rsi(close, rsiPeriod)
// RSI'Ä± momentum olarak deÄŸerlendir: 50'nin Ã¼zeri yÃ¼kseliÅŸ, altÄ± dÃ¼ÅŸÃ¼ÅŸ
// 30-70 arasÄ± normalize edelim
rsiMomentum = rsi
rsiScore = math.max(0, math.min(100, rsiMomentum))

// ==================== MACD MOMENTUM ====================

[macdLine, signalLine, histLine] = ta.macd(close, macdFast, macdSlow, macdSignal)
macdHistNormalized = ta.stoch(histLine, histLine, histLine, 50) // MACD histogramÄ±nÄ± 0-100'e normalize et
macdScore = math.max(0, math.min(100, macdHistNormalized))

// MACD Trend Direction
macdBullish = macdLine > signalLine
macdBearish = macdLine < signalLine

// ==================== TREND GÃœCÃœ (ADX) ====================

// ADX Calculation
[diPlus, diMinus, adx] = ta.dmi(adxPeriod, adxSmooth)

// ADX 0-100 arasÄ± zaten, ama trend yÃ¶nÃ¼nÃ¼ de ekleyelim
trendDirection = diPlus > diMinus ? 1 : -1
adxWithDirection = adx * (trendDirection > 0 ? 1 : 0.3) // DÃ¼ÅŸÃ¼ÅŸ trendinde ADX skorunu azalt
trendScore = math.max(0, math.min(100, adxWithDirection))

// EMA Trend
ema = ta.ema(close, emaPeriod)
priceAboveEMA = close > ema
emaTrendScore = priceAboveEMA ? 100 : 0

// Combined Trend Score
combinedTrendScore = trendScore * 0.7 + emaTrendScore * 0.3

// ==================== HACÄ°M MOMENTUM ====================

// Hacim OrtalamasÄ±
volumeMA = ta.sma(volume, volumePeriod)
volumeRatio = volume / volumeMA

// Volume momentum: Hacim arttÄ±kÃ§a skor artar
volumeMomentum = math.min(volumeRatio * 50, 100) // 2x hacimde 100 puan
volumeScore = math.max(0, math.min(100, volumeMomentum))

// ==================== TOPLAM AÄžIRLIK KONTROLÃœ ====================

totalWeight = weightPrice + weightRSI + weightMACD + weightTrend + weightVolume
normalizedWeightPrice = weightPrice / totalWeight * 100
normalizedWeightRSI = weightRSI / totalWeight * 100
normalizedWeightMACD = weightMACD / totalWeight * 100
normalizedWeightTrend = weightTrend / totalWeight * 100
normalizedWeightVolume = weightVolume / totalWeight * 100

// ==================== FÄ°NAL MOMENTUM SKORU ====================

momentumScore = rocScore * normalizedWeightPrice / 100 + rsiScore * normalizedWeightRSI / 100 + macdScore * normalizedWeightMACD / 100 + combinedTrendScore * normalizedWeightTrend / 100 + volumeScore * normalizedWeightVolume / 100

// Skoru 0-100 arasÄ± tut
finalScore = math.max(0, math.min(100, momentumScore))

// ==================== SKOR SEVÄ°YELERÄ° ====================

// Skor Renkleri
scoreColor = finalScore >= 80 ? color.new(color.lime, 0) : finalScore >= 70 ? color.new(color.green, 0) : finalScore >= 60 ? color.new(color.yellow, 0) : finalScore >= 50 ? color.new(color.orange, 0) : color.new(color.red, 0) // Ultra Strong finalScore >= 70 ? color.new(color.green, 0) :     // Strong finalScore >= 60 ? color.new(color.yellow, 0) :    // Moderate finalScore >= 50 ? color.new(color.orange, 0) :    // Weak color.new(color.red, 0)                             // Very Weak

scoreBgColor = finalScore >= 80 ? color.new(color.lime, 90) : finalScore >= 70 ? color.new(color.green, 90) : finalScore >= 60 ? color.new(color.yellow, 90) : finalScore >= 50 ? color.new(color.orange, 90) : color.new(color.red, 90)

// Skor Etiketi
scoreLabel = finalScore >= 80 ? 'ðŸ”¥ðŸ”¥ðŸ”¥ ULTRA STRONG' : finalScore >= 70 ? 'ðŸ”¥ðŸ”¥ STRONG' : finalScore >= 60 ? 'ðŸ”¥ MODERATE' : finalScore >= 50 ? 'âš ï¸ WEAK' : 'âŒ VERY WEAK'

// ==================== GÃ–RSEL PLOT ====================

// Ana Skor Ã‡izgisi
plot(finalScore, 'Momentum Skor', color = scoreColor, linewidth = 3)

// Referans Ã‡izgileri
hline(80, 'Ultra Strong', color = color.new(color.lime, 50), linestyle = hline.style_dashed)
hline(70, 'Strong', color = color.new(color.green, 50), linestyle = hline.style_dashed)
hline(60, 'Moderate', color = color.new(color.yellow, 50), linestyle = hline.style_dashed)
hline(50, 'Weak', color = color.new(color.orange, 50), linestyle = hline.style_dashed)

// Arka Plan Rengi
bgcolor(scoreBgColor, title = 'Skor Arka Plan')

// BileÅŸenler (Opsiyonel)
plot(showComponents ? rocScore : na, 'Fiyat Momentum', color = color.new(color.blue, 70), linewidth = 1)
plot(showComponents ? rsiScore : na, 'RSI Momentum', color = color.new(color.purple, 70), linewidth = 1)
plot(showComponents ? macdScore : na, 'MACD Momentum', color = color.new(color.orange, 70), linewidth = 1)
plot(showComponents ? combinedTrendScore : na, 'Trend GÃ¼cÃ¼', color = color.new(color.aqua, 70), linewidth = 1)
plot(showComponents ? volumeScore : na, 'Hacim Momentum', color = color.new(color.fuchsia, 70), linewidth = 1)

// ==================== BÄ°LGÄ° TABLOSU ====================

var table scoreTable = table.new(position.top_right, 2, 12, bgcolor = color.new(color.black, 85), border_width = 2, border_color = scoreColor)

if barstate.islast and showScoreLabel
    // BaÅŸlÄ±k
    table.cell(scoreTable, 0, 0, 'ðŸ”¥ MOMENTUM SKOR', text_color = color.white, text_size = size.normal, bgcolor = scoreColor)
    table.cell(scoreTable, 1, 0, str.tostring(finalScore, '#'), text_color = color.white, text_size = size.large, bgcolor = scoreColor)

    // Skor Durumu
    table.cell(scoreTable, 0, 1, 'Durum', text_color = color.gray, text_size = size.small)
    table.cell(scoreTable, 1, 1, scoreLabel, text_color = color.white, text_size = size.small)

    // BoÅŸluk
    table.cell(scoreTable, 0, 2, 'â”â”â”â”â”â”â”â”â”â”', text_color = color.gray, text_size = size.tiny)
    table.cell(scoreTable, 1, 2, 'â”â”â”â”â”â”â”â”â”â”', text_color = color.gray, text_size = size.tiny)

    // BileÅŸenler
    table.cell(scoreTable, 0, 3, 'ðŸ“Š BÄ°LEÅžENLER', text_color = color.aqua, text_size = size.small)
    table.cell(scoreTable, 1, 3, 'SKOR', text_color = color.aqua, text_size = size.small)

    // Fiyat Momentum
    priceColor = rocScore >= 70 ? color.new(color.green, 70) : rocScore >= 50 ? color.new(color.yellow, 70) : color.new(color.red, 70)
    table.cell(scoreTable, 0, 4, 'Fiyat Momentum', text_color = color.white, text_size = size.tiny)
    table.cell(scoreTable, 1, 4, str.tostring(rocScore, '#'), text_color = color.white, text_size = size.tiny, bgcolor = priceColor)

    // RSI
    rsiColor = rsiScore >= 70 ? color.new(color.green, 70) : rsiScore >= 50 ? color.new(color.yellow, 70) : color.new(color.red, 70)
    table.cell(scoreTable, 0, 5, 'RSI Momentum', text_color = color.white, text_size = size.tiny)
    table.cell(scoreTable, 1, 5, str.tostring(rsiScore, '#'), text_color = color.white, text_size = size.tiny, bgcolor = rsiColor)

    // MACD
    macdColor = macdScore >= 70 ? color.new(color.green, 70) : macdScore >= 50 ? color.new(color.yellow, 70) : color.new(color.red, 70)
    table.cell(scoreTable, 0, 6, 'MACD Momentum', text_color = color.white, text_size = size.tiny)
    table.cell(scoreTable, 1, 6, str.tostring(macdScore, '#'), text_color = color.white, text_size = size.tiny, bgcolor = macdColor)

    // Trend
    trendColor = combinedTrendScore >= 70 ? color.new(color.green, 70) : combinedTrendScore >= 50 ? color.new(color.yellow, 70) : color.new(color.red, 70)
    table.cell(scoreTable, 0, 7, 'Trend GÃ¼cÃ¼', text_color = color.white, text_size = size.tiny)
    table.cell(scoreTable, 1, 7, str.tostring(combinedTrendScore, '#'), text_color = color.white, text_size = size.tiny, bgcolor = trendColor)

    // Hacim
    volColor = volumeScore >= 70 ? color.new(color.green, 70) : volumeScore >= 50 ? color.new(color.yellow, 70) : color.new(color.red, 70)
    table.cell(scoreTable, 0, 8, 'Hacim Momentum', text_color = color.white, text_size = size.tiny)
    table.cell(scoreTable, 1, 8, str.tostring(volumeScore, '#'), text_color = color.white, text_size = size.tiny, bgcolor = volColor)

    // BoÅŸluk
    table.cell(scoreTable, 0, 9, '', text_size = size.tiny)
    table.cell(scoreTable, 1, 9, '', text_size = size.tiny)

    // Ek Bilgi
    table.cell(scoreTable, 0, 10, 'RSI', text_color = color.gray, text_size = size.tiny)
    table.cell(scoreTable, 1, 10, str.tostring(rsi, '#.#'), text_color = color.white, text_size = size.tiny)

    table.cell(scoreTable, 0, 11, 'ADX', text_color = color.gray, text_size = size.tiny)
    table.cell(scoreTable, 1, 11, str.tostring(adx, '#.#'), text_color = color.white, text_size = size.tiny)

// ==================== ALERTLER ====================

// YÃ¼ksek Skor Alert
highScoreAlert = ta.crossover(finalScore, alertThreshold)
alertcondition(highScoreAlert, title = 'ðŸ”¥ YÃ¼ksek Momentum Skoru', message = '{{ticker}} iÃ§in yÃ¼ksek momentum skoru tespit edildi! ðŸ”¥')

// Ultra Strong Alert
ultraStrongAlert = ta.crossover(finalScore, 80)
alertcondition(ultraStrongAlert, title = 'ðŸ”¥ðŸ”¥ðŸ”¥ Ultra Strong Momentum', message = '{{ticker}} ULTRA STRONG momentum tespit edildi! ðŸš€ðŸš€ðŸš€')

// Strong Alert
strongAlert = ta.crossover(finalScore, 70) and finalScore < 80
alertcondition(strongAlert, title = 'ðŸ”¥ðŸ”¥ Strong Momentum', message = '{{ticker}} STRONG momentum tespit edildi! ðŸš€ðŸš€')

// Weak Alert (DÃ¼ÅŸÃ¼ÅŸ)
weakAlert = ta.crossunder(finalScore, 50)
alertcondition(weakAlert, title = 'âš ï¸ ZayÄ±f Momentum', message = '{{ticker}} momentum zayÄ±fladÄ±! Dikkatli ol! âš ï¸')

// ==================== LABEL GÃ–STERÄ°MÄ° ====================

// YÃ¼ksek skorlarda label gÃ¶ster
if showScoreLabel and finalScore >= alertThreshold and barstate.islast
    label.new(bar_index, finalScore, text = scoreLabel + '\n' + str.tostring(finalScore, '#'), color = scoreColor, textcolor = color.white, style = label.style_label_left, size = size.normal)
