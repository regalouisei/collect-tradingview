//@version=5
indicator("EMA 1 & SALMA + Tillson T3 Sinyal Paneli", overlay=true)

// --- Girdiler ---
salma_len = input.int(15, title="SALMA Periyodu")
ema_len   = input.int(1, title="EMA Periyodu (Fiyat)")
rsi_len   = input.int(14, title="RSI Periyodu")
// Tillson T3 Girdileri
t3_len    = input.int(8, title="Tillson T3 Periyodu")
t3_factor = input.float(0.7, title="Tillson T3 Katsayısı (Volume Factor)")

// --- Tillson T3 Fonksiyonu ---
t3_calc(src, len, v_factor) =>
    ema1 = ta.ema(src, len)
    ema2 = ta.ema(ema1, len)
    ema3 = ta.ema(ema2, len)
    ema4 = ta.ema(ema3, len)
    ema5 = ta.ema(ema4, len)
    ema6 = ta.ema(ema5, len)
    c1 = -v_factor * v_factor * v_factor
    c2 = 3 * v_factor * v_factor + 3 * v_factor * v_factor * v_factor
    c3 = -6 * v_factor * v_factor - 3 * v_factor - 3 * v_factor * v_factor * v_factor
    c4 = 1 + 3 * v_factor + v_factor * v_factor * v_factor + 3 * v_factor * v_factor
    t3 = c1 * ema6 + c2 * ema5 + c3 * ema4 + c4 * ema3
    t3

// --- Hesaplamalar ---
float salma = ta.sma(ta.sma(close, salma_len), 5) 
float ema1  = ta.ema(close, ema_len)
float rsi   = ta.rsi(close, rsi_len)
float t3    = t3_calc(close, t3_len, t3_factor)

// --- Sinyal Koşulları (Tillson Filtreli) ---
// BUY: Kesişim + RSI > 50 + Fiyat T3 Üzerinde
longCondition  = ta.crossover(ema1, salma) and rsi > 50 and close > t3
// SELL: Kesişim + RSI < 50 + Fiyat T3 Altında
shortCondition = ta.crossunder(ema1, salma) and rsi < 50 and close < t3

// --- Grafik Görselleştirme ---
plot(salma, color=color.new(color.gray, 0), linewidth=2, title="SALMA")
plot(ema1, color=color.blue, linewidth=1, title="EMA 1")
plot(t3, color=color.new(color.orange, 0), linewidth=2, title="Tillson T3")

// BUY/SELL Sinyal Okları
plotshape(series=longCondition, title="BUY Sinyali", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small, text="BUY")
plotshape(series=shortCondition, title="SELL Sinyali", location=location.abovebar, color=color.red, style=shape.triangledown, size=size.small, text="SELL")

// --- Alarm Kurulum Altyapısı ---
alertcondition(longCondition, title="BUY Sinyali (T3 Filtreli)", message="BUY Sinyali Geldi! T3 Üzerinde - Hedef: %2 Kar Al")
alertcondition(shortCondition, title="SELL Sinyali (T3 Filtreli)", message="SELL Sinyali Geldi! T3 Altında - Hedef: %2 Kar Al")
