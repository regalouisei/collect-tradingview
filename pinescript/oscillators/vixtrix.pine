// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © NathanielJens – 2025

//@version=6
indicator("VixTrix w/ MA-Smoothed RMS Bands", shorttitle="VixTrix Pro", overlay=false)

// ───── INPUTS
pd = input.int(34, "Core Lookback", minval=2, group="Core Settings")
mult = input.float(1.2, "Band Multiplier", step=0.1, group="Band Settings")

// ───── MA TYPE SELECTOR FOR RMS SMOOTHING
ma_type = input.string("WMA", "RMS Smoothing MA", 
     options=["SMA", "EMA", "WMA", "HMA", "VWMA"], group="Band Settings")
lb = input.int(21, "Smoothing Length", minval=2, group="Band Settings")

// ───── CORE OSCILLATOR
vixBear = (ta.highest(close, pd) - low)  / ta.highest(close, pd)  * 100
vixBull = (high - ta.lowest(close, pd)) / ta.lowest(close, pd)    * 100
osc = vixBear - vixBull

// ───── MA FUNCTIONS
ma(series, length, type) =>
    switch type
        "SMA"  => ta.sma(series, length)
        "EMA"  => ta.ema(series, length)
        "WMA"  => ta.wma(series, length)
        "HMA"  => ta.hma(series, length)
        "VWMA" => ta.vwma(series, length)
        => ta.sma(series, length)

// ───── SYMMETRIC RMS BANDS WITH SELECTABLE SMOOTHING
dev_squared = math.pow(osc, 2)
rms_ma = ma(dev_squared, lb, ma_type)
rms = math.sqrt(rms_ma)
upperBand = mult * rms
lowerBand = -mult * rms

// ───── SIGNALS
top_signal    = osc >= upperBand and close < open and osc > osc[1]
bottom_signal = osc <= lowerBand and close > open and osc < osc[1]

// ───── PLOTTING
col = bottom_signal ? #00c200 : 
      top_signal    ? #c90000 : 
      color.new(#888888, 60)

plot(osc, "VixTrix", color=col, style=plot.style_columns, linewidth=4)
plot(upperBand, "Upper RMS", color=#ffd700, linewidth=2)
plot(lowerBand, "Lower RMS", color=#ffd700, linewidth=2)
hline(0, "Zero", color=color.gray, linestyle=hline.style_dashed)

// Background highlights
bgcolor(bottom_signal ? color.new(#00ff00, 85) : top_signal ? color.new(#ff0000, 85) : na)

// Bar coloring
barcolor(bottom_signal ? #00ff00 : top_signal ? #ff0000 : na)

// ───── ALERTS 
alertcondition(bottom_signal, "VixTrix → Potential Bottom", "Strong Buy Zone")
alertcondition(top_signal,    "VixTrix → Potential Top",    "Strong Sell Zone")
