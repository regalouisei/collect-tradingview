//@version=6

// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/

// True Momentum Oscillator

// by SparkyFlary

indicator(title = 'Koosha Dab\'s True Momentum Oscillator', overlay = false)



length = input(14, title = 'Length')

calcLength = input(5, title = 'Calc length')

smoothLength = input(3, title = 'Smooth length')

lengthType = input.string('EMA', title = 'Length moving average type', options = ['EMA', 'SMA', 'RMA'])

calcLengthType = input.string('EMA', title = 'Calc length moving average type', options = ['EMA', 'SMA', 'RMA'])

smoothLengthType = input.string('EMA', title = 'Smooth length moving average type', options = ['EMA', 'SMA', 'RMA'])

// Timeframe selection for oscillator calculation

timeframeOption = input.string('Chart', title = 'Calculation Timeframe', options = ['Chart', 'Daily', '3D', '5D', 'Weekly', 'Monthly'])

// Convert timeframe option to TradingView timeframe string

getTimeframe() =>

    string result = ''

    if timeframeOption == 'Chart'

        result := ''
        result


    else if timeframeOption == 'Daily'
        result := '1D'
        result


    else if timeframeOption == '3D'
        result := '3D'
        result


    else if timeframeOption == '5D'
        result := '5D'
        result


    else if timeframeOption == 'Weekly'
        result := '1W'
        result


    else if timeframeOption == 'Monthly'
        result := '1M'
        result

    result

calcTimeframe = getTimeframe()

//function for choosing moving averages

f_ma(type, src, len) =>

    float result = 0

    if type == 'EMA'

        result := ta.ema(src, len)
        result

    if type == 'SMA'

        result := ta.sma(src, len)
        result

    if type == 'RMA'

        result := ta.rma(src, len)
        result

    result



// Calculate oscillator on selected timeframe

// Function to calculate momentum sum - used within security() for different timeframes

calcMomentumSumFunc(srcClose, srcOpen, len) =>

    float sum = 0.0

    for i = 0 to len by 1

        sum := sum + (srcClose > srcOpen[i] ? 1 : srcClose < srcOpen[i] ? -1 : 0)
        sum

    sum

// Get momentum data based on selected timeframe

data = calcTimeframe == '' ? calcMomentumSumFunc(close, open, length) : request.security(syminfo.tickerid, calcTimeframe, calcMomentumSumFunc(close, open, length), lookahead = barmerge.lookahead_off)

// Use current chart timeframe


// Calculate on selected timeframe using security()




MA = f_ma(lengthType, data, calcLength)

Main = f_ma(calcLengthType, MA, smoothLength)

Signal = f_ma(smoothLengthType, Main, smoothLength)

ob = hline(math.round(length * .7), title = 'overbought cutoff line', color = color.gray, linestyle = hline.style_solid)

os = hline(-math.round(length * .7), title = 'oversold cutoff line', color = color.gray, linestyle = hline.style_solid)

upper = hline(length, title = 'upper line', color = color.red, linestyle = hline.style_solid)

lower = hline(-length, title = 'lower line', color = color.green, linestyle = hline.style_solid)

zero = hline(0, title = 'zero line', color = color.gray, linestyle = hline.style_solid)

mainPlot = plot(Main, title = 'main line', color = Main > Signal ? color.green : color.red, linewidth = 2)

signalPlot = plot(Signal, title = 'signal line', color = Main > Signal ? color.green : color.red)

crossPlot = plot(ta.cross(Main, Signal) ? Main : na, title = 'crossover dot', color = Main > Signal ? color.green : color.red, style = plot.style_circles, linewidth = 3)

fill(mainPlot, signalPlot, title = 'main and signal area', color = Main > Signal ? color.green : color.red)

fill(ob, upper, title = 'overbought zone', color = color.new(color.red, 90))

fill(os, lower, title = 'oversold zone', color = color.new(color.green, 90))
