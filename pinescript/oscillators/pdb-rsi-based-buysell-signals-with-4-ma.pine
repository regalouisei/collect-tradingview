//@version=5
indicator("PDB - RSI Based Buy/Sell signals with 4 MA", overlay=true)

// === INPUTS ===
rsiLength = input.int(14, "RSI Length")
rsiOversold = input.int(30, "RSI Oversold")
rsiOverbought = input.int(70, "RSI Overbought")

maType = input.string("SMA", "MA Type", options=["SMA", "EMA"])
ma20len = input.int(20, "MA 20 Length")
ma50len = input.int(50, "MA 50 Length")
ma100len = input.int(100, "MA 100 Length")
ma200len = input.int(200, "MA 200 Length")

// === MA FUNCTION ===
ma(source, length) =>
    maType == "SMA" ? ta.sma(source, length) : ta.ema(source, length)

// === MOVING AVERAGES ===
ma20  = ma(close, ma20len)
ma50  = ma(close, ma50len)
ma100 = ma(close, ma100len)
ma200 = ma(close, ma200len)

// === MARKET STRUCTURE ===
bullStructure = ma20 > ma50 and ma50 > ma100 and ma100 > ma200
bearStructure = ma20 < ma50 and ma50 < ma100 and ma100 < ma200

// === RSI CALCULATION ===
rsi = ta.rsi(close, rsiLength)

// === CANDLE PATTERNS ===
upperWick = high - math.max(open, close)
body = math.abs(open - close)
lowerWick = math.min(open, close) - low

toppingCandle  = upperWick > (body * 1.5) and upperWick > lowerWick and close < open
bottomingCandle = lowerWick > (body * 1.5) and lowerWick > upperWick and close > open

// === SIGNAL LOGIC BASED ON RSI ZONES ===
// Buy: RSI below oversold 
buySignal  = rsi < rsiOversold
// Sell: RSI above overbought (70)
sellSignal = rsi > rsiOverbought

// Optional: combine with candle patterns and MA structure
// buySignal  := buySignal and bottomingCandle and close < ma20 and bearStructure
// sellSignal := sellSignal and toppingCandle  and close > ma20 and bullStructure

// === PLOT SIGNALS ===
plotshape(buySignal,  title="Buy Signal",  location=location.belowbar, style=shape.arrowup,   size=size.small, color=color.green, text="Buy")
plotshape(sellSignal, title="Sell Signal", location=location.abovebar, style=shape.arrowdown, size=size.small, color=color.red,   text="Sell")

// === PLOT MOVING AVERAGES ===
plot(ma20,  color=color.red,    linewidth=2, title="MA 20")
plot(ma50,  color=color.yellow, linewidth=2, title="MA 50")
plot(ma100, color=color.purple, linewidth=2, title="MA 100")
plot(ma200, color=color.white,  linewidth=2, title="MA 200")
