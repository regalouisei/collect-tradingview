//@version=5
indicator("MTF RSI + Stoch RSI Panel", overlay=true)

// USER TIMEFRAMES
tf1 = input.timeframe("3", "3m")
tf2 = input.timeframe("6", "6m")
tf3 = input.timeframe("9", "9m")
tf4 = input.timeframe("27", "27m")
tf5 = input.timeframe("60", "60m")
tf6 = input.timeframe("180", "3H")
tf7 = input.timeframe("540", "9H")
tf8 = input.timeframe("1D", "1D")
tf9 = input.timeframe("3D", "3D")

rsiLen = 14
stochLen = 14
smoothK = 3

// RSI
rsi1 = request.security(syminfo.tickerid, tf1, ta.rsi(close, rsiLen))
rsi2 = request.security(syminfo.tickerid, tf2, ta.rsi(close, rsiLen))
rsi3 = request.security(syminfo.tickerid, tf3, ta.rsi(close, rsiLen))
rsi4 = request.security(syminfo.tickerid, tf4, ta.rsi(close, rsiLen))
rsi5 = request.security(syminfo.tickerid, tf5, ta.rsi(close, rsiLen))
rsi6 = request.security(syminfo.tickerid, tf6, ta.rsi(close, rsiLen))
rsi7 = request.security(syminfo.tickerid, tf7, ta.rsi(close, rsiLen))
rsi8 = request.security(syminfo.tickerid, tf8, ta.rsi(close, rsiLen))
rsi9 = request.security(syminfo.tickerid, tf9, ta.rsi(close, rsiLen))

// STOCH RSI (single-line only)
st1 = request.security(syminfo.tickerid, tf1, ta.sma(ta.stoch(ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), stochLen), smoothK))
st2 = request.security(syminfo.tickerid, tf2, ta.sma(ta.stoch(ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), stochLen), smoothK))
st3 = request.security(syminfo.tickerid, tf3, ta.sma(ta.stoch(ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), stochLen), smoothK))
st4 = request.security(syminfo.tickerid, tf4, ta.sma(ta.stoch(ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), stochLen), smoothK))
st5 = request.security(syminfo.tickerid, tf5, ta.sma(ta.stoch(ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), stochLen), smoothK))
st6 = request.security(syminfo.tickerid, tf6, ta.sma(ta.stoch(ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), stochLen), smoothK))
st7 = request.security(syminfo.tickerid, tf7, ta.sma(ta.stoch(ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), stochLen), smoothK))
st8 = request.security(syminfo.tickerid, tf8, ta.sma(ta.stoch(ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), stochLen), smoothK))
st9 = request.security(syminfo.tickerid, tf9, ta.sma(ta.stoch(ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), ta.rsi(close, rsiLen), stochLen), smoothK))

// DIRECTION (last 3 values, Â±5)
dir1 = st1>st1[1] and st1[1]>st1[2] and math.abs(st1-st1[2])>5 ? 1 : st1<st1[1] and st1[1]<st1[2] and math.abs(st1-st1[2])>5 ? -1 : 0
dir2 = st2>st2[1] and st2[1]>st2[2] and math.abs(st2-st2[2])>5 ? 1 : st2<st2[1] and st2[1]<st2[2] and math.abs(st2-st2[2])>5 ? -1 : 0
dir3 = st3>st3[1] and st3[1]>st3[2] and math.abs(st3-st3[2])>5 ? 1 : st3<st3[1] and st3[1]<st3[2] and math.abs(st3-st3[2])>5 ? -1 : 0
dir4 = st4>st4[1] and st4[1]>st4[2] and math.abs(st4-st4[2])>5 ? 1 : st4<st4[1] and st4[1]<st4[2] and math.abs(st4-st4[2])>5 ? -1 : 0
dir5 = st5>st5[1] and st5[1]>st5[2] and math.abs(st5-st5[2])>5 ? 1 : st5<st5[1] and st5[1]<st5[2] and math.abs(st5-st5[2])>5 ? -1 : 0
dir6 = st6>st6[1] and st6[1]>st6[2] and math.abs(st6-st6[2])>5 ? 1 : st6<st6[1] and st6[1]<st6[2] and math.abs(st6-st6[2])>5 ? -1 : 0
dir7 = st7>st7[1] and st7[1]>st7[2] and math.abs(st7-st7[2])>5 ? 1 : st7<st7[1] and st7[1]<st7[2] and math.abs(st7-st7[2])>5 ? -1 : 0
dir8 = st8>st8[1] and st8[1]>st8[2] and math.abs(st8-st8[2])>5 ? 1 : st8<st8[1] and st8[1]<st8[2] and math.abs(st8-st8[2])>5 ? -1 : 0
dir9 = st9>st9[1] and st9[1]>st9[2] and math.abs(st9-st9[2])>5 ? 1 : st9<st9[1] and st9[1]<st9[2] and math.abs(st9-st9[2])>5 ? -1 : 0

// TABLE
var table t = table.new(position.top_right, 4, 10, border_width=1)

if barstate.islast
    table.cell(t,0,0,"TF",bgcolor=color.black,text_color=color.white)
    table.cell(t,1,0,"RSI",bgcolor=color.black,text_color=color.white)
    table.cell(t,2,0,"Stoch",bgcolor=color.black,text_color=color.white)
    table.cell(t,3,0,"Dir",bgcolor=color.black,text_color=color.white)

    table.cell(t,0,1,tf1), table.cell(t,1,1,str.tostring(rsi1,"#.0"),text_color=rsi1<=30?color.green:rsi1>=70?color.red:color.white), table.cell(t,2,1,str.tostring(st1,"#.0"),text_color=st1<=20?color.green:st1>=25 and st1<=40?color.orange:st1>=55 and st1<=70?color.orange:st1>=80?color.red:color.white), table.cell(t,3,1,dir1==1?"^":dir1==-1?"v":"-",text_color=dir1==1?color.green:dir1==-1?color.red:color.gray)
    table.cell(t,0,2,tf2), table.cell(t,1,2,str.tostring(rsi2,"#.0"),text_color=rsi2<=30?color.green:rsi2>=70?color.red:color.white), table.cell(t,2,2,str.tostring(st2,"#.0"),text_color=st2<=20?color.green:st2>=25 and st2<=40?color.orange:st2>=55 and st2<=70?color.orange:st2>=80?color.red:color.white), table.cell(t,3,2,dir2==1?"^":dir2==-1?"v":"-",text_color=dir2==1?color.green:dir2==-1?color.red:color.gray)
    table.cell(t,0,3,tf3), table.cell(t,1,3,str.tostring(rsi3,"#.0"),text_color=rsi3<=30?color.green:rsi3>=70?color.red:color.white), table.cell(t,2,3,str.tostring(st3,"#.0"),text_color=st3<=20?color.green:st3>=25 and st3<=40?color.orange:st3>=55 and st3<=70?color.orange:st3>=80?color.red:color.white), table.cell(t,3,3,dir3==1?"^":dir3==-1?"v":"-",text_color=dir3==1?color.green:dir3==-1?color.red:color.gray)
    table.cell(t,0,4,tf4), table.cell(t,1,4,str.tostring(rsi4,"#.0"),text_color=rsi4<=30?color.green:rsi4>=70?color.red:color.white), table.cell(t,2,4,str.tostring(st4,"#.0"),text_color=st4<=20?color.green:st4>=25 and st4<=40?color.orange:st4>=55 and st4<=70?color.orange:st4>=80?color.red:color.white), table.cell(t,3,4,dir4==1?"^":dir4==-1?"v":"-",text_color=dir4==1?color.green:dir4==-1?color.red:color.gray)
    table.cell(t,0,5,tf5), table.cell(t,1,5,str.tostring(rsi5,"#.0"),text_color=rsi5<=30?color.green:rsi5>=70?color.red:color.white), table.cell(t,2,5,str.tostring(st5,"#.0"),text_color=st5<=20?color.green:st5>=25 and st5<=40?color.orange:st5>=55 and st5<=70?color.orange:st5>=80?color.red:color.white), table.cell(t,3,5,dir5==1?"^":dir5==-1?"v":"-",text_color=dir5==1?color.green:dir5==-1?color.red:color.gray)
    table.cell(t,0,6,tf6), table.cell(t,1,6,str.tostring(rsi6,"#.0"),text_color=rsi6<=30?color.green:rsi6>=70?color.red:color.white), table.cell(t,2,6,str.tostring(st6,"#.0"),text_color=st6<=20?color.green:st6>=25 and st6<=40?color.orange:st6>=55 and st6<=70?color.orange:st6>=80?color.red:color.white), table.cell(t,3,6,dir6==1?"^":dir6==-1?"v":"-",text_color=dir6==1?color.green:dir6==-1?color.red:color.gray)
    table.cell(t,0,7,tf7), table.cell(t,1,7,str.tostring(rsi7,"#.0"),text_color=rsi7<=30?color.green:rsi7>=70?color.red:color.white), table.cell(t,2,7,str.tostring(st7,"#.0"),text_color=st7<=20?color.green:st7>=25 and st7<=40?color.orange:st7>=55 and st7<=70?color.orange:st7>=80?color.red:color.white), table.cell(t,3,7,dir7==1?"^":dir7==-1?"v":"-",text_color=dir7==1?color.green:dir7==-1?color.red:color.gray)
    table.cell(t,0,8,tf8), table.cell(t,1,8,str.tostring(rsi8,"#.0"),text_color=rsi8<=30?color.green:rsi8>=70?color.red:color.white), table.cell(t,2,8,str.tostring(st8,"#.0"),text_color=st8<=20?color.green:st8>=25 and st8<=40?color.orange:st8>=55 and st8<=70?color.orange:st8>=80?color.red:color.white), table.cell(t,3,8,dir8==1?"^":dir8==-1?"v":"-",text_color=dir8==1?color.green:dir8==-1?color.red:color.gray)
    table.cell(t,0,9,tf9), table.cell(t,1,9,str.tostring(rsi9,"#.0"),text_color=rsi9<=30?color.green:rsi9>=70?color.red:color.white), table.cell(t,2,9,str.tostring(st9,"#.0"),text_color=st9<=20?color.green:st9>=25 and st9<=40?color.orange:st9>=55 and st9<=70?color.orange:st9>=80?color.red:color.white), table.cell(t,3,9,dir9==1?"^":dir9==-1?"v":"-",text_color=dir9==1?color.green:dir9==-1?color.red:color.gray)
