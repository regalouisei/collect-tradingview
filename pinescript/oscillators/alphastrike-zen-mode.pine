// This Pine ScriptÂ® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
//@version=6
indicator("AlphaStrike: Zen Mode [BestTrader]", overlay=true, shorttitle="AlphaZen")

// --- INPUTS ---
group_trend   = "Trend Settings"
atrPeriod     = input.int(10, "ATR Period", group=group_trend)
factor        = input.float(3.5, "SuperTrend Factor", group=group_trend)

group_rev     = "Reversal Settings"
rsiLength     = input.int(14, "RSI Length", group=group_rev)
bbLength      = input.int(20, "Bollinger Length", group=group_rev)
bbMult        = input.float(2.0, "Bollinger Multiplier", group=group_rev)

group_risk    = "Risk Management"
accSize       = input.float(10000, "Account Size ($)", group=group_risk)
riskPerTrade  = input.float(1.0, "Risk Per Trade (%)", group=group_risk)

// --- CALCULATIONS ---

// 1. Trend Logic (SuperTrend)
[superTrend, direction] = ta.supertrend(factor, atrPeriod)

// 2. Reversal Logic
[middle, upper, lower] = ta.bb(close, bbLength, bbMult)
rsiVal = ta.rsi(close, rsiLength)

// 3. Invisible Support & Resistance (For Calculator Only)
// We find the Swing Lows/Highs to calculate Risk, but we DO NOT draw them.
pivotLen = 10
ph = ta.pivothigh(high, pivotLen, pivotLen)
pl = ta.pivotlow(low, pivotLen, pivotLen)

var float nearestSupport = na
var float nearestResistance = na
if not na(pl)
    nearestSupport := pl
if not na(ph)
    nearestResistance := ph

// 4. Signal Generation
bullishBreakout = ta.crossover(close, superTrend)
bearishBreakout = ta.crossunder(close, superTrend)

isPinBarBullish = (close > open) and ((open - low) > (close - open) * 2)
isPinBarBearish = (close < open) and ((high - open) > (open - close) * 2)

buyReversal = low <= lower and rsiVal < 35 and isPinBarBullish
sellReversal = high >= upper and rsiVal > 65 and isPinBarBearish

// --- VISUALS (SIMPLIFIED) ---

// 1. The Trend Line (Clean & Simple)
plot(superTrend, "Trend Line", color = direction < 0 ? color.green : color.red, linewidth=2)

// 2. The Signals (Minimalist)
// Circles = Reversals (Early/Risky)
plotshape(buyReversal, title="Buy Reversal", location=location.belowbar, color=color.blue, style=shape.circle, size=size.small)
plotshape(sellReversal, title="Sell Reversal", location=location.abovebar, color=color.orange, style=shape.circle, size=size.small)

// Triangles = Breakouts (Trend Confirmation)
plotshape(bullishBreakout, title="Buy Breakout", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small)
plotshape(bearishBreakout, title="Sell Breakout", location=location.abovebar, color=color.red, style=shape.triangledown, size=size.small)

// Dynamic Candle Color (Subtle)
barcolor(buyReversal ? color.blue : sellReversal ? color.orange : na)

// --- SMART DASHBOARD (THE BRAIN) ---
// Logic: 
// If Uptrend (Green Line): Stop is the Green Line. Target is Open.
// If Downtrend (Red Line) & Buying Reversal: Stop is nearest Support (Invisible Green). Target is Red Line.

float activeStop = na
float activeTarget = na

if direction < 0 // Bullish Trend
    activeStop := superTrend
    activeTarget := na // Blue Sky
else // Bearish Trend
    activeStop := nearestSupport // Use the invisible swing low
    if na(activeStop)
        activeStop := ta.lowest(low, 10) // Fallback
    activeTarget := superTrend // The Red line is your target

distToStop = close - activeStop
riskAmount    = accSize * (riskPerTrade / 100)
posSize       = riskAmount / math.abs(distToStop)

// Table Display
var table riskTable = table.new(position.bottom_right, 2, 4, border_width=1)
if barstate.islast
    table.cell(riskTable, 0, 0, "ZEN TRADER", bgcolor=color.gray, text_color=color.white)
    table.cell(riskTable, 1, 0, "LEVELS", bgcolor=color.gray, text_color=color.white)
    
    // Row 1: The Goal
    table.cell(riskTable, 0, 1, "Take Profit ($)", bgcolor=color.black, text_color=color.white)
    table.cell(riskTable, 1, 1, na(activeTarget) ? "OPEN" : str.tostring(activeTarget, "#"), bgcolor=color.black, text_color=color.green)
    
    // Row 2: The Risk
    table.cell(riskTable, 0, 2, "Stop Loss ($)", bgcolor=color.black, text_color=color.white)
    table.cell(riskTable, 1, 2, str.tostring(activeStop, "#.##"), bgcolor=color.black, text_color=color.red)

    // Row 3: The Action
    table.cell(riskTable, 0, 3, "MAX SIZE", bgcolor=color.blue, text_color=color.white)
    table.cell(riskTable, 1, 3, str.tostring(posSize, "#.####"), bgcolor=color.black, text_color=color.yellow)
