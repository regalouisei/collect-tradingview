// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © lothodl56

// This Script helps you find the "Narrow State" as stated in Oliver Velez' videos. Ideally used with 
// the 20MA and the 200MA, as suggested by him.

//@version=5
indicator("MA Distance Tracker (S&P 500)", overlay=false, precision=2)

// --- Inputs ---
ma20_source = input.source(close, title="20 MA Source")
ma200_source = input.source(close, title="200 MA Source")

// --- Calculation ---
ma20 = ta.sma(ma20_source, 20)
ma200 = ta.sma(ma200_source, 200)

// Calculate absolute distance in points
dist = math.abs(ma20 - ma200)

// --- Logic & Coloring ---
// Green: Narrow State (< 8 points)
// Yellow: Warning/Transition (8 - 15 points)
// Gray: Neutral (15 - 30 points)
// Red: Extended/Wide (>= 30 points)
bar_color = dist < 8 ? color.new(color.green, 0) : 
             dist <= 15 ? color.new(color.yellow, 0) : 
             dist >= 30 ? color.new(color.red, 0) : 
             color.new(color.gray, 50)

// --- Plotting ---
// Plot the distance as a histogram for easy visual tracking
plot(dist, title="Point Distance", style=plot.style_histogram, color=bar_color, linewidth=3)

// Add horizontal reference lines
hline(8, "Ultra Narrow (8pts)", color=color.green, linestyle=hline.style_dotted)
hline(15, "Narrow Limit (15pts)", color=color.yellow, linestyle=hline.style_dotted)
hline(30, "Wide State (30pts)", color=color.red, linestyle=hline.style_dashed)

// --- Labels (Optional) ---
var label d_label = na
label.delete(d_label)
d_label := label.new(bar_index, dist, 
     text="Dist: " + str.tostring(dist, "#.##") + " pts", 
     color=color.black, 
     textcolor=color.white, 
     style=label.style_label_left,
     size=size.small)
