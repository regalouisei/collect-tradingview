//@version=5
indicator("ANOVA MACD", shorttitle="ANOVA MACD", overlay=false)

// Import the community library
import Steversteves/SPTS_StatsPakLib/4 as spts

// Define input parameters for the MACD
fastLength = input.int(12, title="Fast Length")
slowLength = input.int(26, title="Slow Length")
signalSmoothing = input.int(9, title="Signal Smoothing")

// Get ANOVA data using the library function
[sig, anova] = spts.ANOVA(close[1], high[1], low[1], fastLength)

// Calculate the MACD using the ANOVA data
macd = ta.ema(anova, fastLength) - ta.ema(anova, slowLength)
signalLine = ta.ema(macd, signalSmoothing)
macdHist = macd - signalLine

// Plot the MACD line, Signal line, and Histogram
plot(macd, color=color.blue, title="MACD Line")
plot(signalLine, color=color.orange, title="Signal Line")
plot(macdHist, color=color.red, title="MACD Histogram", style=plot.style_histogram)
