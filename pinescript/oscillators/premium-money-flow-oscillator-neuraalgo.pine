// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © NeuraAlgo


//@version=6
indicator("Premium Money Flow Oscillator [NeuraAlgo]", overlay=false, max_lines_count=500, max_labels_count=500, max_bars_back=5000)


// INPUT GROPS
groupCore   = "Core Engine"
groupSmooth = "Smoothing System"
groupVis    = "Premium Visuals"
groupMTF    = "MTF System"
groupDash   = "Dashboard"

// CORE INPUTS
lenBase     = input.int(14,  "Base Length",    group=groupCore, minval=1)
lenSmooth   = input.int(8,   "Smoothing",      group=groupCore, minval=1)
noiseCut    = input.int(5,   "Noise Filter",   group=groupCore, minval=1)
zls         = input.int(3,   "Zero-Lag Strength", group=groupCore, minval=1)


// SMOOTHING ENGINE INPUTS
emaBoost    = input.float(1.00, "EMA Boost",  group=groupSmooth, minval=0.1, step=0.1)
smaBoost    = input.float(1.00, "SMA Boost",  group=groupSmooth, minval=0.1, step=0.1)
gaussMix    = input.float(0.50, "Gaussian Mix", group=groupSmooth, minval=0.1, maxval=0.9, step=0.05)
deepSmooth  = input.int(10,     "Deep Smooth Layer", group=groupSmooth, minval=1)
superLayer  = input.int(6,      "Super Smooth Layer", group=groupSmooth, minval=1)


// PREMIUM VISALS INPUTS
gradIntensity = input.int(80, "Gradient Strength", group=groupVis, minval=10, maxval=95)
dashOpacity   = input.int(70, "Dashboard Opacity", group=groupVis, minval=20, maxval=90)
lineWidth     = input.int(3,  "Main Line Width",   group=groupVis, minval=1, maxval=5)
histTrans     = input.int(75, "Histogram Transparency", group=groupVis, minval=20, maxval=95)
bgPulse       = input.bool(true, "Background Pulse", group=groupVis)


// MULTI TIMEFRAME INPUTS
mtfEnable  = input.bool(true,  "Enable MTF Trend Confirmation", group=groupMTF)
mtfTF      = input.string("60", "MTF Timeframe", group=groupMTF)

groupDashboard = groupDash
showDash  = input(true, "Dashboard", group = groupDashboard)
dashPos  = input.string('Top Right', 'Location', options = ['Top Right', 'Bottom Right', 'Bottom Left'], group = groupDashboard, display = display.none)
textSize = input.string('Small', 'Size', options = ['Tiny', 'Small', 'Normal'], group = groupDashboard, display = display.none)

// RAW MONEY FLOW CALCULATION
rawMF = (close - open) * volume

// LAYER 1: BASE SMOOTHING
s1_ema = ta.ema(rawMF, lenBase) * emaBoost
s1_sma = ta.sma(rawMF, lenBase) * smaBoost
s1 = (s1_ema + s1_sma) / 2


// LAYER 2: GAUSSIAN NOISE REDUCTION
gA = ta.ema(s1, noiseCut)
gB = ta.sma(s1, noiseCut)
gBlend = gA * gaussMix + gB * (1 - gaussMix)


// LAYER 3: ZERO-LAG CORRECTION
lagCalc = gBlend - ta.ema(gBlend, zls)
zLayer = gBlend + lagCalc

// LAYER 4: DEEP SMOOTHING
deepLayer = ta.ema(zLayer, deepSmooth)

// LAYER 5: SUPER SMOOTH LEVEL
superLayerOut = ta.ema(deepLayer, superLayer)

// LAYER 6: FINAL NORMALIZATION
normBase = ta.ema(math.abs(superLayerOut), lenBase)
normSafe = normBase == 0 ? 1e-9 : normBase
mfo = superLayerOut / normSafe

// MULTI-TIMEFRAME TREND CONFIRMATION
mtf_mfo = mtfEnable ? request.security(syminfo.tickerid, mtfTF, mfo) : na
mtfTrend = mtfEnable ? (mtf_mfo > 0 ? 1 : -1) : 0

// PREMIUM GRADIENT COLARS
strength = math.min(math.abs(mfo) * gradIntensity, 90)
gradColor = mfo > 0 ? color.new(color.lime, 100 - strength) :
                      color.new(color.red,  100 - strength)

// BACKGROUND PULSE 
color bCol = na
if bgPulse
    bCol := mfo > 0 ? color.new(color.green, 95) : color.new(color.red, 95)
bgcolor(bCol)


// ZONES

// DYNAMIC ZONE COLORS (MFO-DRIVEN)
isOverBought = mfo > 1.60
isStrongOB   = mfo > 1.90
isOverSold   = mfo < -1.60
isStrongOS   = mfo < -1.90

// Dynamic intensity (stronger when further from zero)
zoneStrength = math.min(math.abs(mfo) * 35, 85)

// Overbought zone color
obColor = isOverBought
     ? color.new(color.green, 100 - zoneStrength)
     : color.new(color.red, 92)

// Oversold zone color
osColor = isOverSold
     ? color.new(color.red, 100 - zoneStrength)
     : color.new(color.green, 92)

// Zone lines
hTop1 = hline(1.90, "Strong Overbought", color.new(color.red, 85))
hTop2 = hline(1.60, "Overbought",        color.new(color.red, 90))
hMid  = hline(0.00, "Zero",              color.new(color.white, 85))
hBot1 = hline(-1.60,"Oversold",           color.new(color.green, 90))
hBot2 = hline(-1.90,"Strong Oversold",    color.new(color.green, 85))

// Dynamic fills
fill(hTop1, hTop2, obColor)
fill(hBot1, hBot2, osColor)


// MAIN PLOT
plot(mfo, "Premium Money Flow", color=gradColor, linewidth=lineWidth)


// HISTOGRAM
plot(mfo, "Histogram", style=plot.style_columns, color=color.new(gradColor, histTrans))

// DASHBOARD SYSTEM (FULL PREMIUM TNR STYLE)
txt = ""
if true
    txt := "Money Flow Status\n"
    txt += "────────────────────────\n"
    txt += "MFO Value: " + str.tostring(mfo, "#.###") + "\n"
    txt += "MTF Trend: " + (mtfTrend == 1 ? "BULLISH" : mtfTrend == -1 ? "BEARISH" : "OFF") + "\n"
    txt += "Strength:  " + str.tostring(strength, "#") + "%\n"
    txt += "Flow State: " + (mfo > 0 ? "Positive Buy Pressure" : "Negative Sell Pressure") + "\n"
    txt += "Power Zone: " + (math.abs(mfo) > 0.6 ? "STRONG" : "NORMAL") + "\n"
    txt += "────────────────────────\n"
    txt += "Smooth System: ACTIVE\n"


// tabel ----------------------------------------------------------------------

var table_position = dashPos == 'Bottom Left' ? position.bottom_left 
  : dashPos == 'Top Right' ? position.top_right 
  : position.bottom_right

var table_size = textSize == 'Tiny' ? size.tiny 
  : textSize == 'Small' ? size.small 
  : size.normal

tabel = table.new(table_position, 5, 5, bgcolor = #1e222d  , border_color = #373a46  , border_width = 1  , frame_color = #373a46  , frame_width = 1)
tbSize = table_size
if showDash
    if barstate.islast
        tabel.cell(0, 0, txt, text_color = color.white, text_size = tbSize)
        tabel.merge_cells(0,0,1,0)
