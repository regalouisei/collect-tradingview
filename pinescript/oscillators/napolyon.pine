//@version=5
indicator("MACD 7-26-9 2.Koyu", overlay=true)

[macdLine, signalLine, hist] = ta.macd(close, 7, 26, 9)

isUp   = hist > hist[1]
isDown = hist < hist[1]

isPos = hist > 0
isNeg = hist < 0

var int upSeq = 0
var int downSeq = 0
var bool weakSeenPos = false
var bool weakSeenNeg = false

buySignal = false
sellSignal = false

// --- AL ---
if isPos
    if isDown
        weakSeenPos := true
        upSeq := 0
    if isUp and weakSeenPos
        upSeq += 1
        if upSeq == 2
            buySignal := true
else
    weakSeenPos := false
    upSeq := 0

// --- SAT ---
if isNeg
    if isUp
        weakSeenNeg := true
        downSeq := 0
    if isDown and weakSeenNeg
        downSeq += 1
        if downSeq == 2
            sellSignal := true
else
    weakSeenNeg := false
    downSeq := 0

plotshape(buySignal, style=shape.labelup, location=location.belowbar, color=color.green, text="AL")
plotshape(sellSignal, style=shape.labeldown, location=location.abovebar, color=color.red, text="SAT")
