//@version=5
indicator("Delta ROC (acceleration) + Guide", overlay=false)

// Inputs
rocLen = input.int(20, "ROC Length")
smooth = input.int(3,  "EMA Smoothing (0=off)")

// Core
roc  = ta.roc(close, rocLen)        // 1st derivative (velocity)
droc = roc - roc[1]                 // 2nd derivative (acceleration)
d    = smooth > 0 ? ta.ema(droc, smooth) : droc

// Plot
plot(d, title="Delta ROC", style=plot.style_histogram, color=d >= 0 ? color.green : color.red)
hline(0, "Zero")

// One label on the last bar
var label info = na
if barstate.islast
    if info != na
        label.delete(info)
    msg = d > 0 ? "ACCELERATING - STAY LONG" : d < 0 ? "DECELERATING - CAUTION" : "FLAT"
    boxColor = d > 0 ? color.green : d < 0 ? color.red : color.gray
    info := label.new(bar_index, d, msg, style=label.style_label_left, textcolor=color.white, color=boxColor, size=size.large)
