//@version=5
////////////////////////////////////////////////////////////
//  Copyright by HPotter v1.0 24/04/2014
// Double Smoothed Stochastics (DSS) is designed by William Blaw. 
// It attempts to combine moving average methods with oscillator principles. 
////////////////////////////////////////////////////////////
indicator(title="DSS Bressert (Double Smoothed Stochastic)", shorttitle="DSS Bressert", overlay=false)

PDS        = input.int(10, minval=1, title="Period")
EMAlen     = input.int(9, minval=1, title="EMA Length")
TriggerLen = input.int(5, minval=1, title="Trigger Length")
Overbought = input.int(80, minval=1, title="Overbought Level")
Oversold   = input.int(20, minval=1, title="Oversold Level")
res        = input.timeframe(title="Resolution", defval="60")

hline(Overbought, color=color.green, linestyle=hline.style_solid)
hline(Oversold, color=color.red, linestyle=hline.style_solid)

// Use midpoint (H+L)/2 instead of close
[h, l] = request.security(syminfo.tickerid, res, [high, low])
c      = (h + l) / 2

// First smoothing
xPreCalc = ta.ema(ta.stoch(c, h, l, PDS), EMAlen)

// Double smoothing
xDSS     = ta.ema(ta.stoch(xPreCalc, xPreCalc, xPreCalc, PDS), EMAlen)
// Alternative (without double EMA smoothing):
// xDSS  = ta.stoch(xPreCalc, xPreCalc, xPreCalc, PDS)

xTrigger = ta.ema(xDSS, TriggerLen)

plot(xDSS, color=color.blue, title="DSS")
plot(xTrigger, color=color.red, title="Trigger")
