//@version=6
indicator("L-EMA", overlay = true)

// === 輸入參數 ===
emaLength    = input.int(20, title = "EMA Length", minval = 1)
showLastBars = input.int(20, title = "Show EMA only on last N bars", minval = 1, maxval = 500)
sourceType   = input.string("close", title = "Source", options = ["close", "open", "high", "low", "hl2", "hlc3", "ohlc4"])

// === 根據選擇設定 source ===
source = switch sourceType
    "close"  => close
    "open"   => open
    "high"   => high
    "low"    => low
    "hl2"    => hl2
    "hlc3"    => hlc3
    "ohlc4"   => ohlc4
    => close

// === 計算 EMA ===
emaValue = ta.ema(source, emaLength)

// === 繪製 EMA，只在最近 showLastBars 根 K 線顯示 ===
// title 必須是 const string，因此不做動態拼接，直接寫固定描述
plot(emaValue, 
     title       = "EMA (Recent Bars Only)",
     color       = color.rgb(90, 90, 90),
     linewidth   = 1,
     show_last   = showLastBars)
