//@version=5
indicator("Supply and Demand Zone Indicator (5m)", overlay=true)

// Settings
lookback = input.int(20, "Zone Lookback")
impulseMultiplier = input.float(1.5, "Impulse Strength")

// Candle calculations
body = math.abs(close - open)
avgBody = ta.sma(body, lookback)

// Strong move detection
bullImpulse = close > open and body > avgBody * impulseMultiplier
bearImpulse = open > close and body > avgBody * impulseMultiplier

// Base detection (small candle before impulse)
baseCandle = body < avgBody

// Demand Zone logic
demandZone = baseCandle[1] and bullImpulse

// Supply Zone logic
supplyZone = baseCandle[1] and bearImpulse

// Store zone levels
var float demandLow = na
var float demandHigh = na

var float supplyLow = na
var float supplyHigh = na

if demandZone
    demandLow := low[1]
    demandHigh := high[1]

if supplyZone
    supplyLow := low[1]
    supplyHigh := high[1]

// Draw zone labels
plotshape(demandZone, title="Demand Zone", location=location.belowbar,
     color=color.green, style=shape.labelup, text="Demand")

plotshape(supplyZone, title="Supply Zone", location=location.abovebar,
     color=color.red, style=shape.labeldown, text="Supply")

// Entry signals when price returns to zone
buySignal = not na(demandLow) and low <= demandHigh and low >= demandLow
sellSignal = not na(supplyHigh) and high >= supplyLow and high <= supplyHigh

plotshape(buySignal, title="Buy Entry", location=location.belowbar,
     color=color.lime, style=shape.triangleup, size=size.small)

plotshape(sellSignal, title="Sell Entry", location=location.abovebar,
     color=color.red, style=shape.triangledown, size=size.small)

// Alerts
alertcondition(buySignal, title="Buy Alert", message="Price entered Demand Zone")
alertcondition(sellSignal, title="Sell Alert", message="Price entered Supply Zone")
