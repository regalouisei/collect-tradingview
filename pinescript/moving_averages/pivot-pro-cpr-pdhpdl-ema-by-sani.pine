//@version=6
indicator("Pivot Points Standard", "Pivots", overlay=true, max_lines_count=500, max_labels_count=500)

// ======================================================
// === SECTION 1: PIVOT CORE SETTINGS
// ======================================================
pivotTypeInput           = input.string(title="Type", defval="Traditional", options=["Traditional", "Fibonacci", "Woodie", "Classic", "DM", "Camarilla"])
pivotAnchorInput         = input.string(title="Pivots Timeframe", defval="Auto", options=["Auto", "Daily", "Weekly", "Monthly", "Quarterly", "Yearly", "Biyearly", "Triyearly", "Quinquennially", "Decennially"])
maxHistoricalPivotsInput = input.int(title="Number of Pivots Back", defval=15, minval=1, maxval=200, display=display.none)
isDailyBasedInput        = input.bool(title="Use Daily-based Values", defval=true, display=display.none, tooltip="When this option is unchecked, Pivot Points will use intraday data while calculating on intraday charts.")
showLabelsInput          = input.bool(title="Show Labels", defval=true,  group="labels", display=display.none)
showPricesInput          = input.bool(title="Show Prices", defval=true,  group="labels", display=display.none)
positionLabelsInput      = input.string("Left", "Labels Position", options=["Left","Right"], group="labels", display=display.none, active=showLabelsInput or showPricesInput)
linewidthInput           = input.int(title="Line Width", defval=1, minval=1, maxval=100, group="levels", display=display.none)

DEFAULT_COLOR  = #FB8C00
RC             = color.red
SC             = color.green
showLevel2and3 = pivotTypeInput != "DM"
showLevel4     = pivotTypeInput != "DM" and pivotTypeInput != "Fibonacci"
showLevel5     = pivotTypeInput == "Traditional" or pivotTypeInput == "Camarilla"

// ======================================================
// === SECTION 2: PIVOT LEVEL ‚Äî INDIVIDUAL SETTINGS
// === Each level: Show/Hide, Color, Style, Width
// ======================================================

// --- P (Pivot) ---
pShowInput   = input.bool(true,         "Show P",    group="Pivot P")
pColorInput  = input.color(DEFAULT_COLOR, "Color",   group="Pivot P")
pStyleInput  = input.string("Solid",    "Style",     group="Pivot P", options=["Solid","Dashed","Dotted"])
pWidthInput  = input.int(1,             "Width",     group="Pivot P", minval=1, maxval=5)

// --- R1 ---
r1ShowInput  = input.bool(true,  "Show R1", group="Pivot R1", active=true)
r1ColorInput = input.color(RC,   "Color",   group="Pivot R1")
r1StyleInput = input.string("Solid", "Style", group="Pivot R1", options=["Solid","Dashed","Dotted"])
r1WidthInput = input.int(1,      "Width",   group="Pivot R1", minval=1, maxval=5)

// --- S1 ---
s1ShowInput  = input.bool(true,  "Show S1", group="Pivot S1", active=true)
s1ColorInput = input.color(SC,   "Color",   group="Pivot S1")
s1StyleInput = input.string("Solid", "Style", group="Pivot S1", options=["Solid","Dashed","Dotted"])
s1WidthInput = input.int(1,      "Width",   group="Pivot S1", minval=1, maxval=5)

// --- R2 ---
r2ShowInput  = input.bool(true,  "Show R2", group="Pivot R2", active=showLevel2and3)
r2ColorInput = input.color(RC,   "Color",   group="Pivot R2", active=showLevel2and3)
r2StyleInput = input.string("Solid", "Style", group="Pivot R2", options=["Solid","Dashed","Dotted"], active=showLevel2and3)
r2WidthInput = input.int(1,      "Width",   group="Pivot R2", minval=1, maxval=5, active=showLevel2and3)

// --- S2 ---
s2ShowInput  = input.bool(true,  "Show S2", group="Pivot S2", active=showLevel2and3)
s2ColorInput = input.color(SC,   "Color",   group="Pivot S2", active=showLevel2and3)
s2StyleInput = input.string("Solid", "Style", group="Pivot S2", options=["Solid","Dashed","Dotted"], active=showLevel2and3)
s2WidthInput = input.int(1,      "Width",   group="Pivot S2", minval=1, maxval=5, active=showLevel2and3)

// --- R3 ---
r3ShowInput  = input.bool(true,  "Show R3", group="Pivot R3", active=showLevel2and3)
r3ColorInput = input.color(RC,   "Color",   group="Pivot R3", active=showLevel2and3)
r3StyleInput = input.string("Solid", "Style", group="Pivot R3", options=["Solid","Dashed","Dotted"], active=showLevel2and3)
r3WidthInput = input.int(1,      "Width",   group="Pivot R3", minval=1, maxval=5, active=showLevel2and3)

// --- S3 ---
s3ShowInput  = input.bool(true,  "Show S3", group="Pivot S3", active=showLevel2and3)
s3ColorInput = input.color(SC,   "Color",   group="Pivot S3", active=showLevel2and3)
s3StyleInput = input.string("Solid", "Style", group="Pivot S3", options=["Solid","Dashed","Dotted"], active=showLevel2and3)
s3WidthInput = input.int(1,      "Width",   group="Pivot S3", minval=1, maxval=5, active=showLevel2and3)

// --- R4 ---
r4ShowInput  = input.bool(true,  "Show R4", group="Pivot R4", active=showLevel4)
r4ColorInput = input.color(RC,   "Color",   group="Pivot R4", active=showLevel4)
r4StyleInput = input.string("Solid", "Style", group="Pivot R4", options=["Solid","Dashed","Dotted"], active=showLevel4)
r4WidthInput = input.int(1,      "Width",   group="Pivot R4", minval=1, maxval=5, active=showLevel4)

// --- S4 ---
s4ShowInput  = input.bool(true,  "Show S4", group="Pivot S4", active=showLevel4)
s4ColorInput = input.color(SC,   "Color",   group="Pivot S4", active=showLevel4)
s4StyleInput = input.string("Solid", "Style", group="Pivot S4", options=["Solid","Dashed","Dotted"], active=showLevel4)
s4WidthInput = input.int(1,      "Width",   group="Pivot S4", minval=1, maxval=5, active=showLevel4)

// --- R5 ---
r5ShowInput  = input.bool(true,  "Show R5", group="Pivot R5", active=showLevel5)
r5ColorInput = input.color(RC,   "Color",   group="Pivot R5", active=showLevel5)
r5StyleInput = input.string("Solid", "Style", group="Pivot R5", options=["Solid","Dashed","Dotted"], active=showLevel5)
r5WidthInput = input.int(1,      "Width",   group="Pivot R5", minval=1, maxval=5, active=showLevel5)

// --- S5 ---
s5ShowInput  = input.bool(true,  "Show S5", group="Pivot S5", active=showLevel5)
s5ColorInput = input.color(SC,   "Color",   group="Pivot S5", active=showLevel5)
s5StyleInput = input.string("Solid", "Style", group="Pivot S5", options=["Solid","Dashed","Dotted"], active=showLevel5)
s5WidthInput = input.int(1,      "Width",   group="Pivot S5", minval=1, maxval=5, active=showLevel5)

// ======================================================
// === SECTION 3: HELPER ‚Äî String ‚Üí Pine line style
// ======================================================
f_lineStyle(s) =>
    switch s
        "Dashed" => line.style_dashed
        "Dotted" => line.style_dotted
        => line.style_solid

// ======================================================
// === SECTION 4: EMA SETTINGS
// ======================================================
emaShowInput = input.bool(true, "Show EMAs",                group="EMA")
emaFastLen   = input.int(10,    "EMA Fast Length",          group="EMA", minval=1)
emaSlowLen   = input.int(20,    "EMA Slow Length",          group="EMA", minval=1)
emaLineWidth = input.int(2,     "EMA Line Width",           group="EMA", minval=1, maxval=4)
showEMABand  = input.bool(true, "Show EMA Band Background", group="EMA")

// ======================================================
// === CPR VISUAL SETTINGS
// === Master toggle + individual per-line show/hide, color, style, width
// ======================================================
cprMasterShow       = input.bool(true,          "Show CPR (Master)",                            group="CPR")

// --- CPR Pivot ---
cprShowPivot        = input.bool(true,          "  Show CPR Pivot",                             group="CPR")
cprPivotColorInput  = input.color(color.orange, "  Color",                                      group="CPR")
cprPivotStyleInput  = input.string("Solid",     "  Style",  options=["Solid","Dashed","Dotted"],group="CPR")
cprPivotWidth       = input.int(1,              "  Width",  minval=1, maxval=5,                 group="CPR")

// --- CPR BC ---
cprShowBC           = input.bool(true,          "  Show CPR BC",                                group="CPR")
cprBCColorInput     = input.color(color.blue,   "  Color",                                      group="CPR")
cprBCStyleInput     = input.string("Dashed",    "  Style",  options=["Solid","Dashed","Dotted"],group="CPR")
cprBCWidth          = input.int(1,              "  Width",  minval=1, maxval=5,                 group="CPR")

// --- CPR TC ---
cprShowTC           = input.bool(true,          "  Show CPR TC",                                group="CPR")
cprTCColorInput     = input.color(color.blue,   "  Color",                                      group="CPR")
cprTCStyleInput     = input.string("Dashed",    "  Style",  options=["Solid","Dashed","Dotted"],group="CPR")
cprTCWidth          = input.int(1,              "  Width",  minval=1, maxval=5,                 group="CPR")

// Resolve effective CPR style & width per line
cprEffPivotStyle = f_lineStyle(cprPivotStyleInput)
cprEffBCStyle    = f_lineStyle(cprBCStyleInput)
cprEffTCStyle    = f_lineStyle(cprTCStyleInput)

// ======================================================
// === PDH / PDL VISUAL SETTINGS
// === Master toggle + individual per-line show/hide, color, style, width
// ======================================================
pdhlMasterShow        = input.bool(true,        "Show PDH/PDL (Master)",                         group="PDH/PDL")

// --- PDH ---
pdhlShowPDH           = input.bool(true,        "  Show PDH",                                    group="PDH/PDL")
pdHighColorInput      = input.color(color.lime, "  PDH Color",                                   group="PDH/PDL")
pdhlPDHStyleInput     = input.string("Dotted",  "  PDH Style", options=["Solid","Dashed","Dotted"],group="PDH/PDL")
pdhlPDHWidth          = input.int(2,            "  PDH Width", minval=1, maxval=5,               group="PDH/PDL")

// --- PDL ---
pdhlShowPDL           = input.bool(true,        "  Show PDL",                                    group="PDH/PDL")
pdLowColorInput       = input.color(color.red,  "  PDL Color",                                   group="PDH/PDL")
pdhlPDLStyleInput     = input.string("Dotted",  "  PDL Style", options=["Solid","Dashed","Dotted"],group="PDH/PDL")
pdhlPDLWidth          = input.int(2,            "  PDL Width", minval=1, maxval=5,               group="PDH/PDL")

// Resolve effective PDH/PDL style
pdhlEffPDHStyle = f_lineStyle(pdhlPDHStyleInput)
pdhlEffPDLStyle = f_lineStyle(pdhlPDLStyleInput)

// ======================================================
// === SECTION 7: PIVOT CORE LOGIC
// === graphicSettings now carries lineStyle + lineWidth per level
// ======================================================
type graphicSettings
    string levelName
    color  levelColor
    bool   showLevel
    string levelStyle   // NEW: per-level style string
    int    levelWidth   // NEW: per-level width

// Build settings array ‚Äî index order matches ta.pivot_point_levels output:
// [0]=P, [1]=R1, [2]=S1, [3]=R2, [4]=S2, [5]=R3, [6]=S3, [7]=R4, [8]=S4, [9]=R5, [10]=S5
var graphicSettingsArray = array.from(
     graphicSettings.new(" P", pColorInput,  pShowInput,  pStyleInput,  pWidthInput),
     graphicSettings.new("R1", r1ColorInput, r1ShowInput, r1StyleInput, r1WidthInput),
     graphicSettings.new("S1", s1ColorInput, s1ShowInput, s1StyleInput, s1WidthInput),
     graphicSettings.new("R2", r2ColorInput, r2ShowInput, r2StyleInput, r2WidthInput),
     graphicSettings.new("S2", s2ColorInput, s2ShowInput, s2StyleInput, s2WidthInput),
     graphicSettings.new("R3", r3ColorInput, r3ShowInput, r3StyleInput, r3WidthInput),
     graphicSettings.new("S3", s3ColorInput, s3ShowInput, s3StyleInput, s3WidthInput),
     graphicSettings.new("R4", r4ColorInput, r4ShowInput, r4StyleInput, r4WidthInput),
     graphicSettings.new("S4", s4ColorInput, s4ShowInput, s4StyleInput, s4WidthInput),
     graphicSettings.new("R5", r5ColorInput, r5ShowInput, r5StyleInput, r5WidthInput),
     graphicSettings.new("S5", s5ColorInput, s5ShowInput, s5StyleInput, s5WidthInput))

autoAnchor = switch
    timeframe.isintraday => timeframe.multiplier <= 15 ? "1D" : "1W"
    timeframe.isdaily    => "1M"
    => "12M"

pivotTimeframe = switch pivotAnchorInput
    "Auto"      => autoAnchor
    "Daily"     => "1D"
    "Weekly"    => "1W"
    "Monthly"   => "1M"
    "Quarterly" => "3M"
    => "12M"

//@variable The number of years in the selected Pivot period
pivotYearMultiplier = switch pivotAnchorInput
    "Biyearly"       => 2
    "Triyearly"      => 3
    "Quinquennially" => 5
    "Decennially"    => 10
    => 1

//@variable The number of values in the pivots of the selected type
numOfPivotLevels = switch pivotTypeInput
    "Traditional" => 11
    "Camarilla"   => 11
    "Woodie"      => 9
    "Classic"     => 9
    "Fibonacci"   => 7
    "DM"          => 3

type pivotGraphic
    line  pivotLine
    label pivotLabel

method delete(pivotGraphic graphic) =>
    graphic.pivotLine.delete()
    graphic.pivotLabel.delete()

var drawnGraphics = matrix.new<pivotGraphic>()

localPivotTimeframeChange    = timeframe.change(pivotTimeframe) and year % pivotYearMultiplier == 0
securityPivotTimeframeChange = timeframe.change(timeframe.period) and year % pivotYearMultiplier == 0

pivotTimeframeChangeCounter(condition) =>
    var count = 0
    if condition and bar_index > 0
        count += 1
    count

localPivots              = ta.pivot_point_levels(pivotTypeInput, localPivotTimeframeChange)
securityPivotPointsArray = ta.pivot_point_levels(pivotTypeInput, securityPivotTimeframeChange)
securityTimeframe        = timeframe.isintraday ? "1D" : timeframe.period

[securityPivots, securityPivotCounter] = request.security(syminfo.tickerid, pivotTimeframe, [securityPivotPointsArray, pivotTimeframeChangeCounter(securityPivotTimeframeChange)], lookahead=barmerge.lookahead_on)

pivotPointsArray = isDailyBasedInput ? securityPivots : localPivots

//@function Extends all lines of the last drawn pivot row to endTime (right edge).
affixOldPivots(endTime) =>
    if drawnGraphics.rows() > 0
        lastGraphics = drawnGraphics.row(drawnGraphics.rows() - 1)
        for graphic in lastGraphics
            graphic.pivotLine.set_x2(endTime)
            if positionLabelsInput == "Right"
                graphic.pivotLabel.set_x(endTime)

//@function Draws pivot lines ‚Äî each level uses its own individual color, style, width.
drawNewPivots(startTime) =>
    newGraphics = array.new<pivotGraphic>()
    for [index, coord] in pivotPointsArray
        levelSettings = graphicSettingsArray.get(index)
        if not na(coord) and levelSettings.showLevel
            lineEndTime  = startTime + timeframe.in_seconds(pivotTimeframe) * 1000 * pivotYearMultiplier
            // Per-level style and width resolved here
            resolvedStyle = f_lineStyle(levelSettings.levelStyle)
            pivotLine = line.new(
                 startTime, coord, lineEndTime, coord,
                 xloc  = xloc.bar_time,
                 color = levelSettings.levelColor,
                 width = levelSettings.levelWidth,
                 style = resolvedStyle)
            pivotLabel = label.new(
                 x         = positionLabelsInput == "Left" ? startTime : lineEndTime,
                 y         = coord,
                 text      = (showLabelsInput ? levelSettings.levelName + " " : "") + (showPricesInput ? "(" + str.tostring(coord, format.mintick) + ")" : ""),
                 style     = positionLabelsInput == "Left" ? label.style_label_right : label.style_label_left,
                 textcolor = levelSettings.levelColor,
                 color     = #00000000,
                 xloc      = xloc.bar_time)
            newGraphics.push(pivotGraphic.new(pivotLine, pivotLabel))
    drawnGraphics.add_row(array_id=newGraphics)
    if drawnGraphics.rows() > maxHistoricalPivotsInput
        oldGraphics = drawnGraphics.remove_row(0)
        for graphic in oldGraphics
            graphic.delete()

localPivotDrawConditionStatic    = not isDailyBasedInput and localPivotTimeframeChange
securityPivotDrawConditionStatic = isDailyBasedInput and securityPivotCounter != securityPivotCounter[1]
var isMultiYearly                = array.from("Biyearly", "Triyearly", "Quinquennially", "Decennially").includes(pivotAnchorInput)
localPivotDrawConditionDeveloping    = not isDailyBasedInput and time_close == time_close(pivotTimeframe) and not isMultiYearly
securityPivotDrawConditionDeveloping = false

if (securityPivotDrawConditionStatic or localPivotDrawConditionStatic)
    affixOldPivots(time)
    drawNewPivots(time)

var FIRST_BAR_TIME = time
if (barstate.islastconfirmedhistory and drawnGraphics.columns() == 0)
    if not na(securityPivots) and securityPivotCounter > 0
        if isDailyBasedInput
            drawNewPivots(FIRST_BAR_TIME)
        else
            runtime.error("Not enough intraday data to calculate Pivot Points. Lower the Pivots Timeframe or turn on the 'Use Daily-based Values' option in the indicator settings.")
    else
        runtime.error("Not enough data to calculate Pivot Points. Lower the Pivots Timeframe in the indicator settings.")

// Extend the most recent pivot row to right edge on every live bar
if barstate.islast and drawnGraphics.rows() > 0
    lastGraphics = drawnGraphics.row(drawnGraphics.rows() - 1)
    rightEdge    = timenow + 30 * 24 * 60 * 60 * 1000
    for graphic in lastGraphics
        graphic.pivotLine.set_x2(rightEdge)
        if positionLabelsInput == "Right"
            graphic.pivotLabel.set_x(rightEdge)

// ======================================================
// === SECTION 8: EMA ‚Äî Trend Color + Band Background
// ======================================================
emaFast    = ta.ema(close, emaFastLen)
emaSlow    = ta.ema(close, emaSlowLen)
bullTrend  = emaFast > emaSlow
bearTrend  = emaFast < emaSlow
trendColor = bullTrend ? color.green : bearTrend ? color.red : color.yellow

plot(emaShowInput ? emaFast : na, title="EMA Fast", color=trendColor, linewidth=emaLineWidth)
plot(emaShowInput ? emaSlow : na, title="EMA Slow", color=trendColor, linewidth=emaLineWidth)

ema_top = math.max(emaFast, emaSlow)
ema_bot = math.min(emaFast, emaSlow)
bgcolor(showEMABand and (close >= ema_bot and close <= ema_top) ? color.new(color.purple, 85) : na, title="EMA Band Background")

// ======================================================
// === SECTION 9: CPR ‚Äî All Historical Sessions (Non-Repainting)
// ======================================================

// Fetch previous completed day OHLC (non-repainting)
dHigh  = request.security(syminfo.tickerid, "1D", high[1],  lookahead=barmerge.lookahead_on)
dLow   = request.security(syminfo.tickerid, "1D", low[1],   lookahead=barmerge.lookahead_on)
dClose = request.security(syminfo.tickerid, "1D", close[1], lookahead=barmerge.lookahead_on)

// CPR calculations
cprPivot = (dHigh + dLow + dClose) / 3
cprBC    = (dHigh + dLow) / 2
cprTC    = 2.0 * cprPivot - cprBC

// New session detection ‚Äî fires on every historical day during bar replay
isNewDay = timeframe.change("1D")

// Line arrays ‚Äî unlimited history, no pruning
var array<line> cprPivotLines = array.new<line>()
var array<line> cprBCLines    = array.new<line>()
var array<line> cprTCLines    = array.new<line>()

if isNewDay and cprMasterShow and not na(cprPivot)
    // Seal previous session lines at this session boundary
    if array.size(cprPivotLines) > 0
        prevP = array.get(cprPivotLines, array.size(cprPivotLines) - 1)
        prevB = array.get(cprBCLines,    array.size(cprBCLines)    - 1)
        prevT = array.get(cprTCLines,    array.size(cprTCLines)    - 1)
        if not na(prevP)
            line.set_x2(prevP, time)
        if not na(prevB)
            line.set_x2(prevB, time)
        if not na(prevT)
            line.set_x2(prevT, time)

    futureTime = time + 366 * 24 * 60 * 60 * 1000

    newP = cprShowPivot ? line.new(time, cprPivot, futureTime, cprPivot, xloc=xloc.bar_time, color=cprPivotColorInput, width=cprPivotWidth, style=cprEffPivotStyle) : na
    newB = cprShowBC    ? line.new(time, cprBC,    futureTime, cprBC,    xloc=xloc.bar_time, color=cprBCColorInput,    width=cprBCWidth,    style=cprEffBCStyle)    : na
    newT = cprShowTC    ? line.new(time, cprTC,    futureTime, cprTC,    xloc=xloc.bar_time, color=cprTCColorInput,    width=cprTCWidth,    style=cprEffTCStyle)    : na

    array.push(cprPivotLines, newP)
    array.push(cprBCLines,    newB)
    array.push(cprTCLines,    newT)
    // No pruning ‚Äî all historical CPR sessions kept

// Extend current session CPR to right edge on live bar
if barstate.islast and cprMasterShow and array.size(cprPivotLines) > 0
    lastP     = array.get(cprPivotLines, array.size(cprPivotLines) - 1)
    lastB     = array.get(cprBCLines,    array.size(cprBCLines)    - 1)
    lastT     = array.get(cprTCLines,    array.size(cprTCLines)    - 1)
    rightEdge = timenow + 30 * 24 * 60 * 60 * 1000
    if not na(lastP)
        line.set_x2(lastP, rightEdge)
    if not na(lastB)
        line.set_x2(lastB, rightEdge)
    if not na(lastT)
        line.set_x2(lastT, rightEdge)

// ======================================================
// === SECTION 10: PDH / PDL ‚Äî All Historical Sessions (Non-Repainting)
// ======================================================

// Line arrays ‚Äî unlimited history, no pruning
var array<line> pdHighLines = array.new<line>()
var array<line> pdLowLines  = array.new<line>()

if isNewDay and pdhlMasterShow and not na(dHigh)
    // Seal previous session lines at this session boundary
    if array.size(pdHighLines) > 0
        prevH = array.get(pdHighLines, array.size(pdHighLines) - 1)
        prevL = array.get(pdLowLines,  array.size(pdLowLines)  - 1)
        if not na(prevH)
            line.set_x2(prevH, time)
        if not na(prevL)
            line.set_x2(prevL, time)

    futureTime = time + 366 * 24 * 60 * 60 * 1000

    newH = pdhlShowPDH ? line.new(time, dHigh, futureTime, dHigh, xloc=xloc.bar_time, color=pdHighColorInput, width=pdhlPDHWidth, style=pdhlEffPDHStyle) : na
    newL = pdhlShowPDL ? line.new(time, dLow,  futureTime, dLow,  xloc=xloc.bar_time, color=pdLowColorInput,  width=pdhlPDLWidth, style=pdhlEffPDLStyle) : na

    array.push(pdHighLines, newH)
    array.push(pdLowLines,  newL)
    // No pruning ‚Äî all historical PDH/PDL sessions kept

// Extend current session PDH/PDL to right edge on live bar
if barstate.islast and pdhlMasterShow and array.size(pdHighLines) > 0
    lastH     = array.get(pdHighLines, array.size(pdHighLines) - 1)
    lastL     = array.get(pdLowLines,  array.size(pdLowLines)  - 1)
    rightEdge = timenow + 30 * 24 * 60 * 60 * 1000
    if not na(lastH)
        line.set_x2(lastH, rightEdge)
    if not na(lastL)
        line.set_x2(lastL, rightEdge)

// ======================================================
// === SECTION 11: ALERTS
// ======================================================
alertcondition(ta.crossover(emaFast, emaSlow),  title="EMA Bullish Cross", message="‚úÖ EMA Fast crossed above EMA Slow ‚Äî Bullish Trend")
alertcondition(ta.crossunder(emaFast, emaSlow), title="EMA Bearish Cross", message="‚ùå EMA Fast crossed below EMA Slow ‚Äî Bearish Trend")
alertcondition(high >= dHigh, title="Price Touched PDH", message="‚ö†Ô∏è Price reached Previous Day High")
alertcondition(low  <= dLow,  title="Price Touched PDL", message="‚ö†Ô∏è Price reached Previous Day Low")
alertcondition(math.abs(close - cprPivot) <= syminfo.mintick * 5, title="Price Near CPR Pivot", message="üìå Price near CPR Pivot level")
