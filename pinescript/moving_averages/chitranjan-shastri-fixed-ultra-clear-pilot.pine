//@version=5
indicator("Chitranjan Shastri: Fixed Ultra-Clear Pilot", overlay=true)

// --- 1. DEMA CALCULATIONS (Direct Math - No Syntax Error) ---
// 10 DEMA
e1_10 = ta.ema(close, 10)
e2_10 = ta.ema(e1_10, 10)
d10 = 2 * e1_10 - e2_10

// 20 DEMA
e1_20 = ta.ema(close, 20)
e2_20 = ta.ema(e1_20, 20)
d20 = 2 * e1_20 - e2_20

// 50 DEMA
e1_50 = ta.ema(close, 50)
e2_50 = ta.ema(e1_50, 50)
d50 = 2 * e1_50 - e2_50

// Plotting DEMA Lines
plot(d10, "10 DEMA", color=color.new(color.blue, 40))
plot(d20, "20 DEMA", color=color.new(color.green, 30), linewidth=2)
plot(d50, "50 DEMA", color=color.new(color.orange, 20), linewidth=2)

// --- 2. MANUAL INPUTS (Type Daily Levels) ---
rs2_h = input.float(26013, "RS2 Top", group="RS2")
rs2_l = input.float(25913, "RS2 Bottom", group="RS2")
rs1_h = input.float(25831, "RS1 Top", group="RS1")
rs1_l = input.float(25783, "RS1 Bottom", group="RS1")
b1_h  = input.float(25613, "B1 Top", group="Base 1")
b1_l  = input.float(25556, "B1 Bottom", group="Base 1")

// --- 3. START OF DAY ZONES ---
var int dayStart = na
if ta.change(time("D"))
    dayStart := bar_index

if barstate.islast and not na(dayStart)
    box.new(dayStart, rs2_h, bar_index, rs2_l, border_color=color.maroon, bgcolor=color.new(color.maroon, 92), extend=extend.right)
    box.new(dayStart, rs1_h, bar_index, rs1_l, border_color=color.purple, bgcolor=color.new(color.purple, 92), extend=extend.right)
    box.new(dayStart, b1_h, bar_index, b1_l, border_color=color.green, bgcolor=color.new(color.green, 94), extend=extend.right)

// --- 4. ULTRA-CLEAR STAIRCASE LABELS (Anti-Overlap) ---
if barstate.islast
    // DEMA PRICES (Different offsets so they never clash)
    label.new(bar_index + 5,  d10, "10D: " + str.tostring(math.round(d10)), color=color.blue, textcolor=color.white, style=label.style_label_left, size=size.small)
    label.new(bar_index + 18, d20, "20D: " + str.tostring(math.round(d20)), color=color.green, textcolor=color.white, style=label.style_label_left, size=size.small)
    label.new(bar_index + 31, d50, "50D: " + str.tostring(math.round(d50)), color=color.orange, textcolor=color.white, style=label.style_label_left, size=size.small)

    // STAIRCASE RANGE PRICES
    label.new(bar_index + 45, rs2_h, "RS2 TOP: " + str.tostring(rs2_h), color=color.maroon, textcolor=color.white, style=label.style_label_left, size=size.small)
    label.new(bar_index + 45, rs2_l, "RS2 BTM: " + str.tostring(rs2_l), color=color.maroon, textcolor=color.white, style=label.style_label_left, size=size.small)
    
    label.new(bar_index + 58, rs1_h, "RS1 TOP: " + str.tostring(rs1_h), color=color.purple, textcolor=color.white, style=label.style_label_left, size=size.small)
    label.new(bar_index + 58, rs1_l, "RS1 BTM: " + str.tostring(rs1_l), color=color.purple, textcolor=color.white, style=label.style_label_left, size=size.small)
    
    label.new(bar_index + 71, b1_h, "B1 TOP: " + str.tostring(b1_h), color=color.green, textcolor=color.white, style=label.style_label_left, size=size.small)
    label.new(bar_index + 71, b1_l, "B1 BTM: " + str.tostring(b1_l), color=color.green, textcolor=color.white, style=label.style_label_left, size=size.small)
