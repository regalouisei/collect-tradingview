//@version=5
//WELLES WILDER MOVING AVERAGE - Multi-Timeframe

indicator('Welles Wilders MAs - MTF', shorttitle='WW Trend MAs MTF', overlay=true)

// User Inputs
i_timeframe               = input.timeframe("5"   , title='Timeframe for MAs'          , group="Multi-Timeframe Settings")
i_short_length            = input.int(34          , title='Short Trend MA'             , group="Welles Wilder MA")
i_medium_length           = input.int(72          , title='Medium Trend MA'            , group="Welles Wilder MA")
i_medium_length_extension = input.int(89          , title='Medium Trend Extension MA'  , group="Welles Wilder MA")
i_long_length             = input.int(144         , title='Long Trend MA'              , group="Welles Wilder MA")
b_MA_cross_colors         = input.bool(false      , title='Color change in ma crosses?', group="Color Inputs")
c_bullish_colors          = input.color(color.lime, title='Bullish Color'              , group="Color Inputs")
c_bearish_colors          = input.color(color.red , title='Bearish Color'              , group="Color Inputs")
c_long_trend_color        = input.color(color.blue, title='Long Trend Color'           , group="Color Inputs")

// Welles Wilder MA is equivalent to EMA with alpha = 1/length
// ta.ema uses alpha = 2/(length+1), so we need to convert
// RMA (Welles Wilder) uses alpha = 1/length which is the same as ta.rma
// Using ta.rma which is the built-in Welles Wilder smoothing

//Moving Averages calculated on MTF data - using ta.rma directly in request.security
Wilders_MA_short            = request.security(ticker.standard(syminfo.tickerid), i_timeframe, ta.rma(close, i_short_length), barmerge.gaps_off, barmerge.lookahead_off)
Wilders_MA_medium           = request.security(ticker.standard(syminfo.tickerid), i_timeframe, ta.rma(close, i_medium_length), barmerge.gaps_off, barmerge.lookahead_off)
Wilders_MA_medium_extension = request.security(ticker.standard(syminfo.tickerid), i_timeframe, ta.rma(close, i_medium_length_extension), barmerge.gaps_off, barmerge.lookahead_off)
Wilders_MA_long             = request.security(ticker.standard(syminfo.tickerid), i_timeframe, ta.rma(close, i_long_length), barmerge.gaps_off, barmerge.lookahead_off)

//Color Formulas if b_MA_cross_colors == false
Close_color_short  = close > Wilders_MA_short            ? c_bullish_colors : c_bearish_colors
Close_color_medium = close > Wilders_MA_medium           ? c_bullish_colors : c_bearish_colors
Close_color_long   = close > Wilders_MA_medium_extension ? c_bullish_colors : c_bearish_colors

//Color Formulas if b_MA_cross_colors == true
MA_cross_short = Wilders_MA_short > Wilders_MA_medium           ? c_bullish_colors : c_bearish_colors
MA_cross_long  = Wilders_MA_short > Wilders_MA_medium_extension ? c_bullish_colors : c_bearish_colors

p1 = plot(Wilders_MA_short           , color=b_MA_cross_colors ? MA_cross_short : Close_color_short , linewidth=2, title='Short Trend MA')
p2 = plot(Wilders_MA_medium          , color=b_MA_cross_colors ? MA_cross_long  : Close_color_medium, linewidth=2, title='Medium Trend MA')
p3 = plot(Wilders_MA_medium_extension, color=b_MA_cross_colors ? MA_cross_long  : Close_color_long  , linewidth=1, title='Medium Trend Extension MA', style=plot.style_circles)
p4 = plot(Wilders_MA_long            , color=c_long_trend_color, linewidth=2, title='Long Trend MA')

fill(p1, p2, color=b_MA_cross_colors ? color.new(MA_cross_short,90) : color.new(Close_color_short,90) , title='BG Short/Medium MA')
fill(p2, p3, color=b_MA_cross_colors ? color.new(MA_cross_long ,90) : color.new(Close_color_medium,90), title='BG Short/Extension MA')
