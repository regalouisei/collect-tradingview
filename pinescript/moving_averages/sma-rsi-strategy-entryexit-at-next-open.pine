//@version=5
strategy("SMA + RSI Strategy [Entry/Exit at Next Open]", overlay=true, initial_capital=10000, default_qty_type=strategy.percent_of_equity, default_qty_value=100)

// --- Input Parameters ---
smaLength = input.int(200, title="SMA Length", minval=1)
rsiLength = input.int(14, title="RSI Length", minval=1)
rsiBuyLevel = input.int(35, title="RSI Buy Level (Oversold)")
rsiSellLevel = input.int(65, title="RSI Sell Level (Overbought)")

// --- Calculate Indicators ---
smaValue = ta.sma(close, smaLength)
rsiValue = ta.rsi(close, rsiLength)

// --- Plotting for Visual Reference ---
plot(smaValue, color=color.blue, title="SMA", linewidth=2)
// We don't plot RSI here because overlay=true, but the logic uses it.

// --- Strategy Logic ---

// Entry Condition: Close is ABOVE SMA and RSI is BELOW 35
longCondition = (close > smaValue) and (rsiValue < rsiBuyLevel)

// Exit Condition: Close is BELOW SMA and RSI is ABOVE 65
exitCondition = (close < smaValue) and (rsiValue > rsiSellLevel)

// --- Execution (Next Bar Open) ---
// The 'process_orders_on_close=true' argument is NOT used here. 
// By default, strategies execute market orders at the OPEN of the next bar 
// immediately after the condition becomes true on the closing bar.

if (longCondition)
    strategy.entry("Long Entry", strategy.long)

if (exitCondition)
    strategy.close("Long Entry", comment="Exit Signal")

// --- Visual Markers (Optional) ---
// This marks the bar where the condition happened (Signal Bar)
plotshape(longCondition, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small, title="Buy Signal")
plotshape(exitCondition, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small, title="Sell Signal")
