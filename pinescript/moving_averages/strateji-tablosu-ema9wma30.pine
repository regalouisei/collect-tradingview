//@version=5
indicator("Strateji Tablosu", overlay=true)

// â”€â”€ PARAMETRELER
ema_len = input.int(9,  "EMA Periyodu")
wma_len = input.int(30, "WMA Periyodu")
tbl_pos = input.string("SaÄŸ Ãœst", "Tablo Konumu", options=["SaÄŸ Ãœst","SaÄŸ Alt","Sol Ãœst","Sol Alt","Orta Ãœst","Orta Alt"])

// â”€â”€ VERÄ°LER
ema9_4h  = request.security(syminfo.tickerid, "240", ta.ema(close, ema_len))
wma30_4h = request.security(syminfo.tickerid, "240", ta.wma(close, wma_len))
close_1d = request.security(syminfo.tickerid, "D", close)
ema9_1d  = request.security(syminfo.tickerid, "D", ta.ema(close, ema_len))
cross_up_1d = request.security(syminfo.tickerid, "D", ta.crossover(ta.ema(close, ema_len), ta.wma(close, wma_len)))
cross_dn_1d = request.security(syminfo.tickerid, "D", ta.crossunder(ta.ema(close, ema_len), ta.wma(close, wma_len)))

// â”€â”€ SÄ°NYAL MANTIÄžI
var int s1 = 0
if ta.crossover(ema9_4h, wma30_4h)
    s1 := 1
if ta.crossunder(ema9_4h, wma30_4h)
    s1 := -1

var int s3 = 0
if cross_up_1d
    s3 := 1
if cross_dn_1d
    s3 := -1

s2_al  = s1 ==  1 and close_1d > ema9_1d
s2_sat = s1 == -1 and close_1d < ema9_1d
guclu_al  = s2_al  and s3 ==  1
guclu_sat = s2_sat and s3 == -1

// â”€â”€ RENKLERs
C_BG    = color.new(#0D1117, 0)
C_BG2   = color.new(#161B22, 0)
C_LABEL = color.new(#8B949E, 0)
C_TITLE = color.new(#58A6FF, 0)
C_WHITE = color.new(#E6EDF3, 0)
C_GREEN = color.new(#00FF88, 0)
C_RED   = color.new(#FF3355, 0)
C_BLUE  = color.new(#33AAFF, 0)
C_ORNG  = color.new(#FF9900, 0)
C_GRAY  = color.new(#555555, 0)
C_SEP   = color.new(#21262D, 0)

// â”€â”€ METÄ°NLER
sig_txt = guclu_al  ? "ðŸ”¥ GÃœÃ‡LÃœ AL"  :
          guclu_sat ? "ðŸ”¥ GÃœÃ‡LÃœ SAT" :
          s2_al     ? "âœ… AL 2"       :
          s2_sat    ? "ðŸ”´ SAT 2"     :
          s1 ==  1  ? "ðŸŸ¢ AL 1"      :
          s1 == -1  ? "ðŸ”´ SAT 1"     : "â€” NÃ–TR"

sig_col = guclu_al  ? C_GREEN :
          guclu_sat ? C_RED   :
          s2_al     ? C_GREEN :
          s2_sat    ? C_RED   :
          s1 ==  1  ? C_BLUE  :
          s1 == -1  ? C_ORNG  : C_GRAY

s1_txt = s1 ==  1 ? "âœ…  4H EMA9 > WMA30" :
         s1 == -1 ? "ðŸ”´  4H EMA9 < WMA30" : "âšª  Bekleniyor"
s1_col = s1 ==  1 ? C_BLUE : s1 == -1 ? C_ORNG : C_GRAY

s2_txt = s2_al  ? "âœ…  Fiyat > 1G EMA9"   :
         s2_sat ? "ðŸ”´  Fiyat < 1G EMA9"   :
         s1==0  ? "âšª  Åžart 1 bekleniyor"  : "âšª  KoÅŸul yok"
s2_col = s2_al  ? C_GREEN : s2_sat ? C_RED : C_GRAY

s3_txt = guclu_al  ? "âœ…  1G EMA9 > WMA30"   :
         guclu_sat ? "ðŸ”´  1G EMA9 < WMA30"   :
         (s2_al or s2_sat) ? "âšª  KesiÅŸim bekleniyor" : "âšª  Åžart 2 bekleniyor"
s3_col = guclu_al  ? C_GREEN : guclu_sat ? C_RED : C_GRAY

guc_txt = guclu_al or guclu_sat ? "ðŸ”¥  GÃœÃ‡LÃœ  â˜…â˜…â˜…" :
          s2_al or s2_sat       ? "âš¡  ORTA   â˜…â˜…â˜†" :
          s1 != 0               ? "ðŸ’¤  ZAYIF  â˜…â˜†â˜†" : "â€”  YOK"
guc_col = guclu_al or guclu_sat ? C_GREEN :
          s2_al or s2_sat       ? C_BLUE  :
          s1 != 0               ? C_ORNG  : C_GRAY

// â”€â”€ TABLO POZÄ°SYONU
pos = tbl_pos == "SaÄŸ Ãœst"  ? position.top_right    :
      tbl_pos == "SaÄŸ Alt"  ? position.bottom_right :
      tbl_pos == "Sol Ãœst"  ? position.top_left     :
      tbl_pos == "Sol Alt"  ? position.bottom_left  :
      tbl_pos == "Orta Ãœst" ? position.top_center   : position.bottom_center

// â”€â”€ TABLO
var table t = na
if barstate.islast
    t := table.new(pos, 2, 9, bgcolor=C_BG, border_color=color.new(#30363D, 60), border_width=1, frame_color=C_TITLE, frame_width=2)

    // BaÅŸlÄ±k
    table.cell(t, 0, 0, syminfo.ticker, text_color=C_WHITE, bgcolor=C_BG2, text_size=size.normal, text_halign=text.align_left)
    table.cell(t, 1, 0, "STRATEJÄ°", text_color=C_TITLE, bgcolor=C_BG2, text_size=size.normal, text_halign=text.align_right)

    // Aktif Sinyal
    table.cell(t, 0, 1, "AKTÄ°F SÄ°NYAL", text_color=C_LABEL, bgcolor=C_BG, text_size=size.small, text_halign=text.align_left)
    table.cell(t, 1, 1, sig_txt, text_color=sig_col, bgcolor=C_BG, text_size=size.large, text_halign=text.align_right)

    // AyÄ±rÄ±cÄ±
    table.cell(t, 0, 2, "", bgcolor=C_SEP, text_color=C_SEP, text_size=size.tiny)
    table.cell(t, 1, 2, "", bgcolor=C_SEP, text_color=C_SEP, text_size=size.tiny)

    // Åžartlar
    table.cell(t, 0, 3, "ÅžART 1", text_color=C_LABEL, bgcolor=C_BG, text_size=size.small, text_halign=text.align_left)
    table.cell(t, 1, 3, s1_txt,   text_color=s1_col,  bgcolor=C_BG, text_size=size.small, text_halign=text.align_right)

    table.cell(t, 0, 4, "ÅžART 2", text_color=C_LABEL, bgcolor=C_BG, text_size=size.small, text_halign=text.align_left)
    table.cell(t, 1, 4, s2_txt,   text_color=s2_col,  bgcolor=C_BG, text_size=size.small, text_halign=text.align_right)

    table.cell(t, 0, 5, "ÅžART 3", text_color=C_LABEL, bgcolor=C_BG, text_size=size.small, text_halign=text.align_left)
    table.cell(t, 1, 5, s3_txt,   text_color=s3_col,  bgcolor=C_BG, text_size=size.small, text_halign=text.align_right)

    // AyÄ±rÄ±cÄ± 2
    table.cell(t, 0, 6, "", bgcolor=C_SEP, text_color=C_SEP, text_size=size.tiny)
    table.cell(t, 1, 6, "", bgcolor=C_SEP, text_color=C_SEP, text_size=size.tiny)

    // GÃ¼Ã§
    table.cell(t, 0, 7, "SÄ°NYAL GÃœCÃœ", text_color=C_LABEL, bgcolor=C_BG2, text_size=size.small, text_halign=text.align_left)
    table.cell(t, 1, 7, guc_txt,       text_color=guc_col,  bgcolor=C_BG2, text_size=size.small, text_halign=text.align_right)

    // Zaman
    table.cell(t, 0, 8, "ZAMAN DÄ°LÄ°MÄ°", text_color=C_LABEL, bgcolor=C_BG2, text_size=size.tiny, text_halign=text.align_left)
    table.cell(t, 1, 8, "4H + 1G",      text_color=C_GRAY,  bgcolor=C_BG2, text_size=size.tiny, text_halign=text.align_right)

// â”€â”€ ALERTLER
if ta.crossover(ema9_4h, wma30_4h)
    alert("ðŸŸ¢ AL1 â€” " + syminfo.ticker + ": 4H EMA9 WMA30'u yukarÄ± kesti!", alert.freq_once_per_bar)
if ta.crossunder(ema9_4h, wma30_4h)
    alert("ðŸ”´ SAT1 â€” " + syminfo.ticker + ": 4H EMA9 WMA30'u aÅŸaÄŸÄ± kesti!", alert.freq_once_per_bar)
if s2_al and ta.change(s2_al)
    alert("âœ… AL2 â€” " + syminfo.ticker + ": Fiyat 1G EMA9 Ã¼zerine Ã§Ä±ktÄ±!", alert.freq_once_per_bar)
if s2_sat and ta.change(s2_sat)
    alert("ðŸ”´ SAT2 â€” " + syminfo.ticker + ": Fiyat 1G EMA9 altÄ±na indi!", alert.freq_once_per_bar)
if guclu_al and ta.change(guclu_al)
    alert("ðŸ”¥ GÃœÃ‡LÃœ AL â€” " + syminfo.ticker + ": TÃ¼m ÅŸartlar AL yÃ¶nÃ¼nde!", alert.freq_once_per_bar)
if guclu_sat and ta.change(guclu_sat)
    alert("ðŸ”¥ GÃœÃ‡LÃœ SAT â€” " + syminfo.ticker + ": TÃ¼m ÅŸartlar SAT yÃ¶nÃ¼nde!", alert.freq_once_per_bar)
