//@version=6
indicator("HTF SMA Horizontal Levels", overlay = true)

// === INPUT ===
htf = input.timeframe("240", "Higher Timeframe (240 = 4H, D = Daily)", group="Obecné nastavení")

// --- Nastavení jednotlivých SMA ---
// SMA 20
show20  = input.bool(true, title="SMA 20", inline="sma20", group="Nastavení linek")
col20   = input.color(color.orange, title="", inline="sma20", group="Nastavení linek")
width20 = input.int(2, title="Tloušťka", minval=1, maxval=10, inline="sma20", group="Nastavení linek")

// SMA 50
show50  = input.bool(true, title="SMA 50", inline="sma50", group="Nastavení linek")
col50   = input.color(color.red, title="", inline="sma50", group="Nastavení linek")
width50 = input.int(2, title="Tloušťka", minval=1, maxval=10, inline="sma50", group="Nastavení linek")

// SMA 100
show100  = input.bool(true, title="SMA 100", inline="sma100", group="Nastavení linek")
col100   = input.color(color.teal, title="", inline="sma100", group="Nastavení linek")
width100 = input.int(2, title="Tloušťka", minval=1, maxval=10, inline="sma100", group="Nastavení linek")

// SMA 200
show200  = input.bool(true, title="SMA 200", inline="sma200", group="Nastavení linek")
col200   = input.color(color.blue, title="", inline="sma200", group="Nastavení linek")
width200 = input.int(2, title="Tloušťka", minval=1, maxval=10, inline="sma200", group="Nastavení linek")

// === HTF SMA VALUES ===
sma20  = request.security(syminfo.tickerid, htf, ta.sma(close, 20))
sma50  = request.security(syminfo.tickerid, htf, ta.sma(close, 50))
sma100 = request.security(syminfo.tickerid, htf, ta.sma(close, 100))
sma200 = request.security(syminfo.tickerid, htf, ta.sma(close, 200))

// === LINE STORAGE ===
var line line20  = na
var line line50  = na
var line line100 = na
var line line200 = na

// === FUNCTION TO DRAW HORIZONTAL RAY ===
drawLevel(_line, _price, _color, _width, _show) =>
    // Smazat předchozí linku, pokud existuje
    if not na(_line)
        line.delete(_line)
        
    line newLine = na
    // Vykreslit novou linku pouze pokud je zapnutá
    if _show
        newLine := line.new(
             x1 = bar_index, y1 = _price,
             x2 = bar_index + 1, y2 = _price,
             extend = extend.right, // Vykreslí "Ray" (paprsek) směrem doprava
             color = _color,
             width = _width)
    newLine

// === UPDATE ON LAST BAR ONLY ===
if barstate.islast
    line20  := drawLevel(line20,  sma20,  col20, width20, show20)
    line50  := drawLevel(line50,  sma50,  col50, width50, show50)
    line100 := drawLevel(line100, sma100, col100, width100, show100)
    line200 := drawLevel(line200, sma200, col200, width200, show200)
