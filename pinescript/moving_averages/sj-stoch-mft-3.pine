//@version=6
indicator("Stoch MTF 3 TF Direction Only", overlay=true)

// ===== INPUT =====
tf1 = input.timeframe("1",  "TF 1 (M1)")
tf2 = input.timeframe("5",  "TF 2 (M5)")
tf3 = input.timeframe("15", "TF 3 (M15)")

periodK = input.int(14, "%K Length", minval=1)
smoothK = input.int(1,  "%K Smoothing", minval=1)
periodD = input.int(3,  "%D Smoothing", minval=1)

// ===== STOCH DIRECTION FUNCTION =====
f_stoch_dir() =>
    k = ta.sma(ta.stoch(close, high, low, periodK), smoothK)
    d = ta.sma(k, periodD)
    k > d ? 1 : k < d ? -1 : 0

// ===== GET DIRECTION FROM EACH TF =====
dir1 = request.security(syminfo.tickerid, tf1, f_stoch_dir(), lookahead=barmerge.lookahead_off)
dir2 = request.security(syminfo.tickerid, tf2, f_stoch_dir(), lookahead=barmerge.lookahead_off)
dir3 = request.security(syminfo.tickerid, tf3, f_stoch_dir(), lookahead=barmerge.lookahead_off)

// ===== CONFLUENCE =====
buySignal  = dir1 == 1  and dir2 == 1  and dir3 == 1
sellSignal = dir1 == -1 and dir2 == -1 and dir3 == -1

// ===== BACKGROUND COLOR =====


// ===== OPTIONAL SIGNAL MARK =====
plotshape(buySignal,  title="BUY",  style=shape.circle,   location=location.bottom, color=color.lime, size=size.tiny)
plotshape(sellSignal, title="SELL", style=shape.circle, location=location.bottom, color=color.red,  size=size.tiny)



// ===== ALERTS =====
alertcondition(
    buySignal,
    title   = "Stoch MTF BUY",
    message = "Stoch MTF BUY signal"
)

alertcondition(
    sellSignal,
    title   = "Stoch MTF SELL",
    message = "Stoch MTF SELL signal"
)
