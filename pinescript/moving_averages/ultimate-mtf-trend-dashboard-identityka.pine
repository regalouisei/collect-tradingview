//@version=5
indicator("Ultimate MTF Trend Dashboard [identityKa]", shorttitle="MTF Dash Pro [identityKa]", overlay=true, max_labels_count=50)

// ==========================================
// 1. KULLANICI AYARLARI (identityKa Standard)
// ==========================================
grp_1 = "âš™ï¸ Zero-Lag Algorithm (HMA Engine)"
fastLen = input.int(14, "Fast HMA Length", minval=1, group=grp_1, tooltip="Controls the speed of the trend cloud.")
slowLen = input.int(50, "Slow HMA Length", minval=1, group=grp_1, tooltip="Baseline for the overall trend.")

grp_2 = "ðŸŽ¨ identityKa Theme & Dashboard"
col_bull = input.color(#00E676, "Bullish (Neon Green)", group=grp_2)
col_bear = input.color(#ff1744, "Bearish (Neon Red)", group=grp_2)
col_neut = input.color(#555555, "Neutral (Gray)", group=grp_2)
dashPos  = input.string("Top Right", "Dashboard Position", options=["Top Right", "Top Left", "Bottom Right", "Bottom Left"], group=grp_2)

grp_3 = "ðŸ‘ï¸ Chart Visuals (Overlay)"
showCloud = input.bool(true, "Show Zero-Lag Trend Cloud?", group=grp_3)
showBg    = input.bool(true, "Show Trend Background?", group=grp_3)
showBars  = input.bool(false, "Color Bars by Trend?", group=grp_3)
showSigs  = input.bool(false, "Show LONG / SHORT Labels?", group=grp_3, tooltip="Turned off by default for a cleaner chart. Alerts will still work.")

// Set Dashboard Position
var pos = position.top_right
if dashPos == "Top Left"
    pos := position.top_left
else if dashPos == "Bottom Right"
    pos := position.bottom_right
else if dashPos == "Bottom Left"
    pos := position.bottom_left

// ==========================================
// 2. MTF & TREND LOGIC
// ==========================================
get_trend() =>
    fast = ta.hma(close, fastLen)
    slow = ta.hma(close, slowLen)
    trend = 0
    if fast > slow
        trend := 1 
    else if fast < slow
        trend := -1 
    else
        trend := 0
    trend

trend_15m = request.security(syminfo.tickerid, "15", get_trend())
trend_1h  = request.security(syminfo.tickerid, "60", get_trend())
trend_4h  = request.security(syminfo.tickerid, "240", get_trend())
trend_1d  = request.security(syminfo.tickerid, "D", get_trend())

// ==========================================
// 3. CHART VISUALS & LOGIC
// ==========================================
fastMA = ta.hma(close, fastLen)
slowMA = ta.hma(close, slowLen)

current_trend = get_trend()
cloud_color = current_trend == 1 ? col_bull : current_trend == -1 ? col_bear : col_neut
bg_color    = current_trend == 1 ? color.new(col_bull, 95) : current_trend == -1 ? color.new(col_bear, 95) : na
bar_color   = current_trend == 1 ? col_bull : current_trend == -1 ? col_bear : na

p_fast = plot(showCloud ? fastMA : na, color=cloud_color, linewidth=2, title="Fast HMA")
p_slow = plot(showCloud ? slowMA : na, color=cloud_color, linewidth=3, title="Slow HMA")
fill(p_fast, p_slow, color=showCloud ? color.new(cloud_color, 85) : na, title="Trend Cloud")

bgcolor(showBg ? bg_color : na, title="Trend Background")
barcolor(showBars ? bar_color : na, title="Trend Bar Color")

// Pure Signals for Alerts & Optional Labels
long_cond  = ta.crossover(fastMA, slowMA)
short_cond = ta.crossunder(fastMA, slowMA)

plotshape(showSigs and long_cond, title="LONG Signal", text="LONG", style=shape.labelup, location=location.belowbar, color=col_bull, textcolor=color.black, size=size.small)
plotshape(showSigs and short_cond, title="SHORT Signal", text="SHORT", style=shape.labeldown, location=location.abovebar, color=col_bear, textcolor=color.white, size=size.small)

// ==========================================
// 4. PREMIUM DASHBOARD
// ==========================================
var table dash = table.new(pos, 3, 5, border_width=1, border_color=color.new(color.gray, 80))

get_color(t) => t == 1 ? col_bull : t == -1 ? col_bear : col_neut
get_text(t) => t == 1 ? "BULLISH" : t == -1 ? "BEARISH" : "NEUTRAL"
get_icon(t) => t == 1 ? "ðŸŸ¢" : t == -1 ? "ðŸ”´" : "âšª"

if barstate.islast
    table.cell(dash, 0, 0, "IDENTITYKA", text_color=color.white, bgcolor=color.new(color.black, 20), text_size=size.small)
    table.cell(dash, 1, 0, "MTF TREND", text_color=color.white, bgcolor=color.new(color.black, 20), text_size=size.small)
    table.cell(dash, 2, 0, "STATUS", text_color=color.gray, bgcolor=color.new(color.black, 20), text_size=size.small)
    
    table.cell(dash, 0, 1, "15 Min", text_color=color.gray, bgcolor=color.new(color.black, 40), text_size=size.small)
    table.cell(dash, 1, 1, get_text(trend_15m), text_color=get_color(trend_15m), bgcolor=color.new(color.black, 40), text_size=size.small)
    table.cell(dash, 2, 1, get_icon(trend_15m), bgcolor=color.new(color.black, 40), text_size=size.small)
    
    table.cell(dash, 0, 2, "1 Hour", text_color=color.gray, bgcolor=color.new(color.black, 40), text_size=size.small)
    table.cell(dash, 1, 2, get_text(trend_1h), text_color=get_color(trend_1h), bgcolor=color.new(color.black, 40), text_size=size.small)
    table.cell(dash, 2, 2, get_icon(trend_1h), bgcolor=color.new(color.black, 40), text_size=size.small)

    table.cell(dash, 0, 3, "4 Hour", text_color=color.gray, bgcolor=color.new(color.black, 40), text_size=size.small)
    table.cell(dash, 1, 3, get_text(trend_4h), text_color=get_color(trend_4h), bgcolor=color.new(color.black, 40), text_size=size.small)
    table.cell(dash, 2, 3, get_icon(trend_4h), bgcolor=color.new(color.black, 40), text_size=size.small)

    table.cell(dash, 0, 4, "Daily", text_color=color.gray, bgcolor=color.new(color.black, 40), text_size=size.small)
    table.cell(dash, 1, 4, get_text(trend_1d), text_color=get_color(trend_1d), bgcolor=color.new(color.black, 40), text_size=size.small)
    table.cell(dash, 2, 4, get_icon(trend_1d), bgcolor=color.new(color.black, 40), text_size=size.small)

// ==========================================
// 5. ALERTS
// ==========================================
bool all_bull = trend_15m == 1 and trend_1h == 1 and trend_4h == 1 and trend_1d == 1
bool all_bear = trend_15m == -1 and trend_1h == -1 and trend_4h == -1 and trend_1d == -1

alertcondition(long_cond, title="Trend Cloud Turned BULLISH", message="Zero-Lag Trend Cloud just turned Green (Bullish)!")
alertcondition(short_cond, title="Trend Cloud Turned BEARISH", message="Zero-Lag Trend Cloud just turned Red (Bearish)!")
alertcondition(all_bull, title="ðŸ”¥ Full MTF Alignment (LONG)", message="All timeframes (15m to 1D) perfectly aligned for LONG.")
alertcondition(all_bear, title="ðŸ©¸ Full MTF Alignment (SHORT)", message="All timeframes (15m to 1D) perfectly aligned for SHORT.")
